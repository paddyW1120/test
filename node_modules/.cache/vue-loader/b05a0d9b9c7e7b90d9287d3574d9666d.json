{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\login\\auth-redirect.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\login\\auth-redirect.vue","mtime":1609847106800},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQoNCmltcG9ydCBhdXRoIGZyb20gJ0AvYXBpL3dlY29tLWxvZ2luL3VzZXJhdXRoJw0KaW1wb3J0IHsgc2V0QWVzS2V5LCBzZXREZWJ1ZyB9IGZyb20gJ0AvdXRpbHMvYXV0aCcNCmltcG9ydCB7IHdlQ29tTG9naW4gfSBmcm9tICdAL2FwaS9zeXN0ZW0vdXNlcicNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAnQXV0aFJlZGlyZWN0JywNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsDQogICAgICByYWRpbzogJycsDQogICAgICB0ZW5hbnRMaXN0OiBbXSwNCiAgICAgIGxvZ2luRm9ybTogew0KICAgICAgICB1c2VybmFtZTogJycsDQogICAgICAgIHRlbmFudENvZGU6ICcnLA0KICAgICAgICB3ZUNvbUZsYWc6ICcnLA0KICAgICAgICB0ZW5hbnRJZDogJycNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgbGV0IGNvZGUgPSB0aGlzLiRyb3V0ZS5xdWVyeS5jb2RlDQogICAgbGV0IHN0YXRlID0gdGhpcy4kcm91dGUucXVlcnkuc3RhdGUNCiAgICBjb25zb2xlLmxvZygnY29kZTonICsgY29kZSArICcgLHN0YXRlOicgKyBzdGF0ZSkNCiAgICB0aGlzLmF1dGhMb2dpbihjb2RlLCBzdGF0ZSkNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHNlbGVjdFRlbmFudChyb3cpIHsNCiAgICAgIHRoaXMubG9naW5Gb3JtLnRlbmFudElkID0gcm93LnRlbmFudElkDQogICAgICB0aGlzLmxvZ2luRm9ybS5wYXNzd29yZCA9IHJvdy50ZW5hbnRDb2RlDQogICAgfSwNCiAgICBzdWJtaXRGb3JtKCkgew0KICAgICAgdGhpcy5kb1JlYWxMb2dpbigpDQogICAgfSwNCiAgICBhdXRoTG9naW4oY29kZSwgc3RhdGUpIHsNCiAgICAgIHNldERlYnVnKCd0cnVlJykNCiAgICAgIC8v5LyB5Lia5b6u5L+h55m75b2VDQogICAgICBhdXRoLmdldE9wZW5JZChjb2RlKS50aGVuKHJlcyA9PiB7DQogICAgICAgIGxldCB3ZUNvbUlkID0gcmVzLmRhdGEudXNlcklkDQogICAgICAgIGxldCBwYXJhbSA9IHsgd2VDb21JZDogd2VDb21JZCB9DQogICAgICAgIHdlQ29tTG9naW4oeyAncGFyYW1zJzogcGFyYW0gfSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgbGV0IGRhdGEgPSByZXNwb25zZS5kYXRhDQogICAgICAgICAgc2V0QWVzS2V5KGRhdGEuYWVzS2V5KQ0KICAgICAgICAgIHNldERlYnVnKGRhdGEuZGVidWcpDQogICAgICAgICAgbGV0IHRlbmFudExpc3QgPSBkYXRhLnRlbmFudHMNCiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS51c2VybmFtZSA9IGRhdGEud2VDb21JZA0KICAgICAgICAgIHRoaXMubG9naW5Gb3JtLndlQ29tRmxhZyA9ICcxJw0KICAgICAgICAgIGlmICh0ZW5hbnRMaXN0Lmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgdGhpcy5sb2dpbkZvcm0udGVuYW50SWQgPSB0ZW5hbnRMaXN0WzBdLnRlbmFudElkDQogICAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5wYXNzd29yZCA9IHRlbmFudExpc3RbMF0udGVuYW50Q29kZQ0KICAgICAgICAgICAgdGhpcy5kb1JlYWxMb2dpbigpDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMudGVuYW50TGlzdCA9IHRlbmFudExpc3QNCiAgICAgICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUNCg0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgYWxlcnQoZXJyb3IpDQogICAgICB9KQ0KDQogICAgfSwNCiAgICBkb1JlYWxMb2dpbigpIHsNCiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCd1c2VyL2xvZ2luJywgdGhpcy5sb2dpbkZvcm0pDQogICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbGRjb2RlL3N0b3JhZ2VTZWxlY3QnKQ0KICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdydWxlTWVzc2FnZS9zdG9yYWdlUnVsZU1lc3NhZ2UnKQ0KICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdydWxlQ2FjaGUvc3RvcmFnZVJ1bGVDYWNoZScpDQogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiAnZGFzaGJvYXJkJyB9KS5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgfSkNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikNCiAgICAgICAgfSkNCiAgICB9DQogIH0sDQogIHJlbmRlcjogZnVuY3Rpb24oaCkgew0KICAgIHJldHVybiBoKCkgLy8gYXZvaWQgd2FybmluZyBtZXNzYWdlDQogIH0NCn0NCg=="},{"version":3,"sources":["auth-redirect.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"auth-redirect.vue","sourceRoot":"src/views/login","sourcesContent":["<template>\r\n  <el-dialog :close-on-click-modal=\"false\" center :show-close=\"false\" :visible.sync=\"dialogVisible\" width=\"40%\">\r\n    <cus-page-title :label=\"$t('i18nView.comSelect')\"></cus-page-title>\r\n    <el-table :data=\"tenantList\" align=\"center\" border class=\"wraper-table\" element-loading-text=\"Loading\" fit\r\n              highlight-current-row\r\n              size=\"mini\">>\r\n      <el-table-column :label=\"$t('table.select')\" align=\"center\" width=\"50px\">\r\n        <template slot-scope=\"scope\">\r\n          <el-radio :label=\"scope.row.tenantId\" @change=\"selectTenant(scope.row)\" v-model=\"radio\">\r\n            {{ '' }}\r\n          </el-radio>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\" width=\"50px\">\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" :label=\"$t('i18nView.lesseeNme')\" prop=\"tenantName\"></el-table-column>\r\n      <el-table-column align=\"center\" :label=\"$t('i18nView.comCode')\" prop=\"tenantCode\"></el-table-column>\r\n    </el-table>\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button size=\"small\" :disabled=\"radio===''\"  type=\"primary\" @click=\"submitForm\"><i class=\"el-icon-success el-icon--left\"></i>\r\n            {{\r\n              $t('table.confirm')\r\n            }} </el-button>\r\n        </span>\r\n  </el-dialog>\r\n</template>\r\n<script>\r\n\r\nimport auth from '@/api/wecom-login/userauth'\r\nimport { setAesKey, setDebug } from '@/utils/auth'\r\nimport { weComLogin } from '@/api/system/user'\r\n\r\nexport default {\r\n  name: 'AuthRedirect',\r\n  data() {\r\n    return {\r\n      dialogVisible: false,\r\n      radio: '',\r\n      tenantList: [],\r\n      loginForm: {\r\n        username: '',\r\n        tenantCode: '',\r\n        weComFlag: '',\r\n        tenantId: ''\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    let code = this.$route.query.code\r\n    let state = this.$route.query.state\r\n    console.log('code:' + code + ' ,state:' + state)\r\n    this.authLogin(code, state)\r\n  },\r\n  methods: {\r\n    selectTenant(row) {\r\n      this.loginForm.tenantId = row.tenantId\r\n      this.loginForm.password = row.tenantCode\r\n    },\r\n    submitForm() {\r\n      this.doRealLogin()\r\n    },\r\n    authLogin(code, state) {\r\n      setDebug('true')\r\n      //企业微信登录\r\n      auth.getOpenId(code).then(res => {\r\n        let weComId = res.data.userId\r\n        let param = { weComId: weComId }\r\n        weComLogin({ 'params': param }).then(response => {\r\n          let data = response.data\r\n          setAesKey(data.aesKey)\r\n          setDebug(data.debug)\r\n          let tenantList = data.tenants\r\n          this.loginForm.username = data.weComId\r\n          this.loginForm.weComFlag = '1'\r\n          if (tenantList.length === 1) {\r\n            this.loginForm.tenantId = tenantList[0].tenantId\r\n            this.loginForm.password = tenantList[0].tenantCode\r\n            this.doRealLogin()\r\n          } else {\r\n            this.tenantList = tenantList\r\n            this.dialogVisible = true\r\n\r\n          }\r\n        })\r\n      }).catch(error => {\r\n        alert(error)\r\n      })\r\n\r\n    },\r\n    doRealLogin() {\r\n      this.$store.dispatch('user/login', this.loginForm)\r\n        .then(() => {\r\n          this.$store.dispatch('ldcode/storageSelect')\r\n          this.$store.dispatch('ruleMessage/storageRuleMessage')\r\n          this.$store.dispatch('ruleCache/storageRuleCache')\r\n          this.$router.push({ path: 'dashboard' }).catch(() => {\r\n          })\r\n        })\r\n        .catch(error => {\r\n          console.log(error)\r\n        })\r\n    }\r\n  },\r\n  render: function(h) {\r\n    return h() // avoid warning message\r\n  }\r\n}\r\n</script>\r\n"]}]}