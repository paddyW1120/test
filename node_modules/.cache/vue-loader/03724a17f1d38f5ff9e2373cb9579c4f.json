{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\system\\role\\role_authority\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\system\\role\\role_authority\\index.vue","mtime":1609847107195},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQge3RyZWVNZW51fSBmcm9tICdAL2FwaS9zeXN0ZW0vYXV0aG9yaXR5Jw0KaW1wb3J0IHtmaW5kUm9sZUJ5SWR9IGZyb20gIkAvYXBpL3N5c3RlbS9yb2xlIg0KaW1wb3J0IHtnZXRSb2xlQXV0aG9yaXR5QnlSb2xlSWQsIHNhdmVSb2xlQXV0aG9yaXR5fSBmcm9tICJAL2FwaS9zeXN0ZW0vcm9sZV9hdXRob3JpdHkiDQppbXBvcnQge2dldFVzZXJ9IGZyb20gIkAvdXRpbHMvYXV0aCINCmltcG9ydCB7Y2xvc2VWaXNpdFRhZ30gZnJvbSAiQC91dGlscy90YWdzVmlldyINCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAnYXV0aFNldHRpbmcnLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICByb2xlSWQ6IHVuZGVmaW5lZCwNCiAgICAgIGZsYWc6IHVuZGVmaW5lZCwNCiAgICAgIHJvbGVEYXRhOiB7DQogICAgICAgIGlkOiB1bmRlZmluZWQsDQogICAgICAgIHJvbGVDb2RlOiB1bmRlZmluZWQsDQogICAgICAgIHJvbGVOYW1lOiB1bmRlZmluZWQsDQogICAgICAgIHRlbmFudElkOiB1bmRlZmluZWQsDQogICAgICAgIGNyZWF0ZVRpbWU6IHVuZGVmaW5lZCwNCiAgICAgICAgdXBkYXRlVGltZTogdW5kZWZpbmVkDQogICAgICB9LA0KICAgICAgYWN0aXZlTmFtZTogJ2FsbG90TWVudScsIC8vIOmAiemhueWNoQ0KICAgICAgLy8g5qC85byP5YyW5ZCO56uv5Lyg6L+H5p2l55qE5pWw5o2u5Li6dnVl5qCR5omA6ZyA5Y+C5pWwDQogICAgICBkZWZhdWx0UHJvcHNNZW51OiB7DQogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLA0KICAgICAgICBsYWJlbDogJ25hbWUnDQogICAgICB9LA0KICAgICAgZGVmYXVsdENoZWNrZWRLZXlzOiBbXSwNCiAgICAgIGRlZmF1bHRDaGVja2VkTGVhZktleXM6IFtdLA0KICAgICAgbWVudUxpc3Q6IFtdLA0KICAgICAgbWVudVRyZWU6IFtdDQogICAgfQ0KICB9LA0KICBiZWZvcmVSb3V0ZUxlYXZlKHRvLCBmcm9tLCBuZXh0KSB7DQogICAgY2xvc2VWaXNpdFRhZygpDQogICAgbmV4dCgpDQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5yb2xlSWQgPSB0aGlzLmdldFJvdXRlUGFyYW0oJ3JvbGVJZCcpDQogICAgdGhpcy5mbGFnID0gdGhpcy5nZXRSb3V0ZVBhcmFtKCdmbGFnJykNCiAgICBpZiAodGhpcy5yb2xlSWQpIHsNCiAgICAgIHRoaXMuZ2V0Um9sZURhdGEoKQ0KICAgICAgdGhpcy5nZXRNZW51VGFiRGF0YSgpDQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgYmFjaygpIHsNCiAgICAgIGNsb3NlVmlzaXRUYWcoKQ0KICAgICAgaWYgKHRoaXMuZmxhZyA9PT0gJzEnKXsNCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICfop5LoibLnrqHnkIYnfSkNCiAgICAgIH1lbHNlew0KICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7bmFtZTogJ+enn+aIty3op5LoibLnrqHnkIYnfSkNCiAgICAgIH0NCiAgICB9LA0KICAgIGdldFJvbGVEYXRhKCkgew0KICAgICAgZmluZFJvbGVCeUlkKHRoaXMucm9sZUlkKS50aGVuKHJlcyA9PiB7DQogICAgICAgIHRoaXMucm9sZURhdGEgPSByZXMuZGF0YQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOinkuiJsuS4juiPnOWNleWFs+iBlA0KICAgIGdldE1lbnVUYWJEYXRhKCkgew0KICAgICAgY29uc3QgdXNlciA9IGdldFVzZXIoKQ0KICAgICAgdHJlZU1lbnUoeydyb2xlQ29kZXMnOiB1c2VyLnJvbGVDb2Rlc30pLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLm1lbnVMaXN0ID0gcmVzcG9uc2UuZGF0YS5tZW51TGlzdA0KICAgICAgICB0aGlzLm1lbnVUcmVlID0gcmVzcG9uc2UuZGF0YS5tZW51VHJlZQ0KICAgICAgICBnZXRSb2xlQXV0aG9yaXR5QnlSb2xlSWQodGhpcy5yb2xlSWQpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdGhpcy5kZWZhdWx0Q2hlY2tlZEtleXMgPSB0aGlzLl8ubWFwKHJlc3BvbnNlLmRhdGEsICdhdXRoSWQnKQ0KICAgICAgICAgIH0NCiAgICAgICAgICAvLyDojrflj5bmiYDmnInpu5jorqTpgInkuK3nmoTlj7blrZDoioLngrnvvIzmoLnmja7lj7blrZDoioLngrnmuLLmn5PkuIrnuqcNCiAgICAgICAgICBsZXQga2V5cyA9IFtdDQogICAgICAgICAgaWYgKHRoaXMuZGVmYXVsdENoZWNrZWRLZXlzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGZvciAoY29uc3QgY2hlY2tlZEtleSBvZiB0aGlzLmRlZmF1bHRDaGVja2VkS2V5cykgew0KICAgICAgICAgICAgICBsZXQgbm9kZSA9IHRoaXMuJHJlZnMubWVudVRyZWUuZ2V0Tm9kZShjaGVja2VkS2V5KQ0KICAgICAgICAgICAgICAvLyDliKTmlq0gbm9kZSDmmK/lkKblrZjlnKjmmK/kuLrkuobpmLLmraLmiYvliqjmlLnliqjmlbDmja7lupPlkI7pobXpnaLmiqXplJnnmoTmg4XlhrUNCiAgICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGtleXMucHVzaChub2RlLmRhdGEuaWQpDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy5kZWZhdWx0Q2hlY2tlZExlYWZLZXlzID0ga2V5cw0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHNhdmVSb2xlQXV0aG9yaXR5KCkgew0KICAgICAgY29uc3Qgc2VsZWN0ZWRJZHMgPSB0aGlzLiRyZWZzLm1lbnVUcmVlLmdldENoZWNrZWRLZXlzKCkuY29uY2F0KHRoaXMuJHJlZnMubWVudVRyZWUuZ2V0SGFsZkNoZWNrZWRLZXlzKCkpDQogICAgICB0aGlzLnJvbGVJZCA9IHRoaXMucm9sZUlkICsgJyc7DQogICAgICBzYXZlUm9sZUF1dGhvcml0eSh7J3JvbGVJZCc6IHRoaXMucm9sZUlkLCAnbWVudUlkcyc6IHNlbGVjdGVkSWRzLmpvaW4oJywnKX0pLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgdGhpcy5ub3RpZnlTdWNjZXNzKHJlc3BvbnNlLm1lc3NhZ2UpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5ub3RpZnlFcnJvcihyZXNwb25zZS5tZXNzYWdlKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/system/role/role_authority","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <div style=\"display: block;height: 10px\"></div>\r\n    <span style=\"font-size: 25px;font-weight: bold;\">{{ $t('login.role') + '：' + roleData.roleName }}</span>\r\n    <div style=\"display: block;height: 20px\"></div>\r\n    <el-tabs v-model=\"activeName\">\r\n      <el-tab-pane :label=\"$t('roleAuthorityView.assignMenu')\" name=\"allotMenu\">\r\n        <el-button  size=\"small\" @click=\"saveRoleAuthority\" style=\"margin-bottom: 20px;margin-left: 20px;\" type=\"primary\"\r\n                   v-auth=\"'sys-role:authSetting:save'\" v-show=\"menuTree.length > 0\">{{ $t('roleAuthorityView.save') }}\r\n        </el-button>\r\n        <el-button  size=\"small\" @click=\"back\" style=\"margin-bottom: 20px;margin-left: 20px;\" type=\"primary\"\r\n                   v-show=\"menuTree.length > 0\">{{ $t('i18nView.return') }}\r\n        </el-button>\r\n        <!-- check-strictly：在显示复选框的情况下，是否严格的遵循父子不互相关联的做法，默认为 false -->\r\n        <el-tree\r\n          :check-strictly=\"false\"\r\n          :data=\"menuTree\"\r\n          :default-checked-keys=\"defaultCheckedLeafKeys\"\r\n          :props=\"defaultPropsMenu\"\r\n          highlight-current\r\n          node-key=\"id\"\r\n          ref=\"menuTree\"\r\n          show-checkbox>\r\n        </el-tree>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {treeMenu} from '@/api/system/authority'\r\nimport {findRoleById} from \"@/api/system/role\"\r\nimport {getRoleAuthorityByRoleId, saveRoleAuthority} from \"@/api/system/role_authority\"\r\nimport {getUser} from \"@/utils/auth\"\r\nimport {closeVisitTag} from \"@/utils/tagsView\"\r\n\r\nexport default {\r\n  name: 'authSetting',\r\n  data() {\r\n    return {\r\n      roleId: undefined,\r\n      flag: undefined,\r\n      roleData: {\r\n        id: undefined,\r\n        roleCode: undefined,\r\n        roleName: undefined,\r\n        tenantId: undefined,\r\n        createTime: undefined,\r\n        updateTime: undefined\r\n      },\r\n      activeName: 'allotMenu', // 选项卡\r\n      // 格式化后端传过来的数据为vue树所需参数\r\n      defaultPropsMenu: {\r\n        children: 'children',\r\n        label: 'name'\r\n      },\r\n      defaultCheckedKeys: [],\r\n      defaultCheckedLeafKeys: [],\r\n      menuList: [],\r\n      menuTree: []\r\n    }\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    closeVisitTag()\r\n    next()\r\n  },\r\n  created() {\r\n    this.roleId = this.getRouteParam('roleId')\r\n    this.flag = this.getRouteParam('flag')\r\n    if (this.roleId) {\r\n      this.getRoleData()\r\n      this.getMenuTabData()\r\n    }\r\n  },\r\n  methods: {\r\n    back() {\r\n      closeVisitTag()\r\n      if (this.flag === '1'){\r\n        this.$router.push({name: '角色管理'})\r\n      }else{\r\n        this.$router.push({name: '租户-角色管理'})\r\n      }\r\n    },\r\n    getRoleData() {\r\n      findRoleById(this.roleId).then(res => {\r\n        this.roleData = res.data\r\n      })\r\n    },\r\n    // 角色与菜单关联\r\n    getMenuTabData() {\r\n      const user = getUser()\r\n      treeMenu({'roleCodes': user.roleCodes}).then(response => {\r\n        this.menuList = response.data.menuList\r\n        this.menuTree = response.data.menuTree\r\n        getRoleAuthorityByRoleId(this.roleId).then(response => {\r\n          if (response.data && response.data.length > 0) {\r\n            this.defaultCheckedKeys = this._.map(response.data, 'authId')\r\n          }\r\n          // 获取所有默认选中的叶子节点，根据叶子节点渲染上级\r\n          let keys = []\r\n          if (this.defaultCheckedKeys.length > 0) {\r\n            for (const checkedKey of this.defaultCheckedKeys) {\r\n              let node = this.$refs.menuTree.getNode(checkedKey)\r\n              // 判断 node 是否存在是为了防止手动改动数据库后页面报错的情况\r\n              if (node && node.childNodes.length === 0) {\r\n                keys.push(node.data.id)\r\n              }\r\n            }\r\n          }\r\n          this.defaultCheckedLeafKeys = keys\r\n        })\r\n      })\r\n    },\r\n    saveRoleAuthority() {\r\n      const selectedIds = this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys())\r\n      this.roleId = this.roleId + '';\r\n      saveRoleAuthority({'roleId': this.roleId, 'menuIds': selectedIds.join(',')}).then(response => {\r\n        if (response.code === 200) {\r\n          this.notifySuccess(response.message)\r\n        } else {\r\n          this.notifyError(response.message)\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}