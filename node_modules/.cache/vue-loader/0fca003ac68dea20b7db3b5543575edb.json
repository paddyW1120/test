{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-operation-def\\pd-preservation-def\\main\\index.vue?vue&type=style&index=0&id=aaf47fba&lang=scss&scoped=true&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-operation-def\\pd-preservation-def\\main\\index.vue","mtime":1609847106954},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1706753188288},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1706753191924},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1706753189537},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1706753187424},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQoNCi5zaG93RGl2IHsNCiAgd2lkdGg6IDEwMCU7DQogIGhlaWdodDogMTAwJTsNCiAgbWFyZ2luLXRvcDogLTQwcHg7DQogIG1hcmdpbi1sZWZ0OiAtNDBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBiYWNrZ3JvdW5kOiAjZmZmZmZmMDA7DQogIHotaW5kZXg6IDk5OQ0KfQ0KDQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6oBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-definition/pd-operation-def/pd-preservation-def/main","sourcesContent":["<template>\r\n  <cus-wraper>\r\n\r\n    <div :class=\"{ 'showDiv': showPageFlag === '1' }\"></div>\r\n\r\n    <cus-page-title-back v-if=\"!productCalcRevisionShowINfo\" :label=\"$t('route.pdPreservationDef')\" @backTo=\"goBack\"/>\r\n    <cus-page-title-back v-if=\"productCalcRevisionShowINfo\" :label=\"$t('route.productPvFormulaRevision')\"\r\n                         @backTo=\"goBackToRevision\"/>\r\n\r\n    <cus-product-info></cus-product-info>\r\n\r\n    <cus-form-title v-if=\"!productCalcRevisionShowINfo\" :display=\"true\" :label=\"$t('pdPreservation.choosePO')\"\r\n                    :showArrow=\"true\" @show=\"poFlag = !poFlag\"></cus-form-title>\r\n\r\n    <div v-if=\"!productCalcRevisionShowINfo && poFlag\">\r\n      <el-button dialog-disable=\"disable\" icon=\"el-icon-circle-plus\" size=\"small\" type=\"primary\"\r\n                 @click=\"showPreservation=true\">\r\n        {{ $t('pdPreservation.proConPreservationItem') }}\r\n      </el-button>\r\n      <el-dialog v-dialog-drag :close-on-click-modal=\"false\" :close-on-press-escape=\"false\" :show-close=false\r\n                 :visible.sync=\"showPreservation\" center style=\"margin-left: 20px\" top=\"8vh\" width=\"1200px\">\r\n        <preservation :poOptions=\"poOptions\" :selPO=\"selPO\" @backToMenu=\"backToMenu\"></preservation>\r\n      </el-dialog>\r\n      <!-- <el-form-item style=\"margin-right: 50px;text-align: right\">\r\n         <el-button dialog-disable=\"disable\" v-auth=\"'pd-po-info:saveInfo'\" icon=\"el-icon-circle-check\" size=\"small\" type=\"primary\"\r\n                    @click=\"savePOInfo\">\r\n           {{ $t('pdPreservation.saveButton') }}\r\n         </el-button>\r\n         <el-button dialog-disable=\"disable\" icon=\"el-icon-refresh\" size=\"small\" type=\"primary\" @click=\"refreshSelOptions\">\r\n           {{ $t('pdPreservation.refreshButton') }}\r\n         </el-button>\r\n       </el-form-item> -->\r\n    </div>\r\n\r\n    <cus-table-title :label=\"$t('pdPreservation.tittle2')\"></cus-table-title>\r\n    <el-table :data=\"poInfoResult\" border @row-click=\"rowClick\">\r\n      <el-table-column :label=\"$t('pdtempPdBnft.choose')\" align=\"center\" width=\"50\">\r\n        <template slot-scope=\"scope\">\r\n          <el-radio-group v-model=\"selectedPO\" @change=\"chooseOnePO\">\r\n            <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n          </el-radio-group>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\" width=\"50\"></el-table-column>\r\n      <el-table-column :label=\"$t('i18nView.pdCode')\" align=\"center\" prop=\"pdCode\"></el-table-column>\r\n      <el-table-column :label=\"$t('pdPreservation.posCode')\" align=\"center\" prop=\"paCode\"></el-table-column>\r\n      <el-table-column :label=\"$t('pdPreservation.posName')\" align=\"center\" prop=\"paName\"></el-table-column>\r\n      <el-table-column :label=\"$t('pdPreservation.ruleCount')\" align=\"center\" prop=\"ruleCount\"></el-table-column>\r\n      <el-table-column :label=\"$t('pdPreservation.calcCount')\" align=\"center\" prop=\"calcCount\"></el-table-column>\r\n      <el-table-column v-if=\"!productCalcRevisionShowINfo\" :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\"\r\n                       width=\"120\">\r\n        <template slot-scope=\"scope\">\r\n          <cus-del-btn v-auth=\"'pd-po-info:deletePdPa'\" @ok=\"deletePdPa(scope.row)\"></cus-del-btn>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 规则和公式部分 -->\r\n    <div v-if=\"showSeleOptions\">\r\n\r\n      <!-- 规则部分 -->\r\n      <div v-if=\"!productCalcRevisionShowINfo || productCalcRevisionShowINfo && revisionType === 'rule'\">\r\n        <cus-form-title :label=\"$t('i18nView.pdgenlPdPaInfo')\" style=\"margin-top: 50px\"></cus-form-title>\r\n        <el-form ref=\"formAddRule\" :model=\"formAddRule\" :rules=\"rulesForAddRule\" label-width=\"auto\">\r\n          <el-row :gutter=\"10\" type=\"flex\">\r\n            <el-col :span=\"8\">\r\n              <el-form-item :label=\"$t('rule.pdRuleDtCls')\" prop=\"pdRuleDtCls\">\r\n                <cus-select v-model=\"formAddRule.pdRuleDtCls\" codetype=\"ruleBusinessDetailClass\"\r\n                            filter=\"1$14$15\"></cus-select>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\"></el-col>\r\n            <el-col :span=\"8\" style=\"text-align: right\">\r\n              <el-form-item>\r\n                <el-button dialog-disable=\"disable\" icon=\"el-icon-connection\" size=\"small\" type=\"primary\"\r\n                           @click=\"toRules\">\r\n                  {{ $t('i18nView.selecRules') }}\r\n                </el-button>\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n        </el-form>\r\n\r\n        <cus-table-title :label=\"$t('i18nView.pdGenlPdPa')\"></cus-table-title>\r\n        <el-table :data=\"tableData_currentRule\" border @row-click=\"chooseOneRule\">\r\n          <el-table-column :label=\"$t('pdtempPdBnft.choose')\" align=\"center\" width=\"50\">\r\n            <template slot-scope=\"scope\">\r\n              <el-radio v-model=\"chooseRuleId\" :label=\"scope.row.id\">\r\n                <span class=\"el-radio__label\"></span>\r\n              </el-radio>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n            <template v-slot=\"scope\">\r\n              {{ initTableIndex('page_currentRule', scope.$index) }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.detail')\" align=\"center\" width=\"80\">\r\n            <template v-slot=\"scope\">\r\n              <el-button dialog-disable=\"disable\" size=\"small\" type=\"text\" @click=\"showRule(scope.row, '1')\">>>\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.ruleCode')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"pdRuleCode\"></el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.ruleType')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"pdRuleCls\">\r\n            <template v-slot=\"scope\">\r\n              {{ scope.row.pdRuleCls | filter_ruleBusinessModule }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('rule.pdRuleDtCls')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"pdRuleDtCls\">\r\n            <template v-slot=\"scope\">\r\n              {{ scope.row.pdRuleDtCls | filter_ruleBusinessDetailClass }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.ruleDec')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"pdRuleDesc\"></el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.ruleFlag')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"valDefFlag\"></el-table-column>\r\n          <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" min-width=\"200\">\r\n            <template v-slot=\"scope\">\r\n              {{\r\n                scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n              }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n            <template slot-scope=\"scope\">\r\n              <cus-popover v-auth=\"'pd-po-info:deleteRuleOrCalc'\" :content=\"$t('confirmMessage.delete')\"\r\n                           icon=\"el-icon-delete\" size=\"mini\" type=\"danger\"\r\n                           @confirm=\"deleteRuleOrCalc(scope.row, '1')\"></cus-popover>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n        <cus-pagination ref=\"page_currentRule\" v-model=\"tableData_currentRule\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                        :params=\"params_currentRule\" url=\"/pd-po-info/base/getRuleAndCalcInfo\"/>\r\n      </div>\r\n\r\n      <!-- 公式部分 -->\r\n      <div v-if=\"!productCalcRevisionShowINfo || productCalcRevisionShowINfo && revisionType === 'calc'\">\r\n        <cus-form-title :label=\"$t('pdPreservation.tittle4')\" style=\"margin-top: 50px\"></cus-form-title>\r\n        <!-- 已选择产品保全公式 -->\r\n        <cus-table-title :label=\"$t('pdPreservation.tittle6')\"></cus-table-title>\r\n        <el-table :data=\"tableData_currentFormula\" border @row-click=\"chooseOneCalc\">\r\n          <el-table-column :label=\"$t('pdtempPdBnft.choose')\" align=\"center\" width=\"50\">\r\n            <template slot-scope=\"scope\">\r\n              <el-radio v-model=\"chooseCalcId\" :label=\"scope.row.id\">\r\n                <span class=\"el-radio__label\"></span>\r\n              </el-radio>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n            <template v-slot=\"scope\">\r\n              {{ initTableIndex('page_currentFormula', scope.$index) }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.detail')\" align=\"center\" width=\"80\">\r\n            <template v-slot=\"scope\">\r\n              <el-button dialog-disable=\"disable\" size=\"small\" type=\"text\" @click=\"showRule(scope.row, '2')\">>>\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.formulaCode')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"pdCalcCode\"></el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.calcType')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"pdBussType\">\r\n            <template v-slot=\"scope\">\r\n              {{ scope.row.pdBussType | filter_ruleBusinessModule }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('rule.pdBussDetailType')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"pdBussDetailType\">\r\n            <template v-slot=\"scope\">\r\n              {{ scope.row.pdBussDetailType | filter_ruleBusinessDetailClass }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.formulaDec')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"pdCalcDesc\"></el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.calcFlag')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"valDefFlag\"></el-table-column>\r\n          <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" min-width=\"200\">\r\n            <template v-slot=\"scope\">\r\n              {{\r\n                scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n              }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n            <template slot-scope=\"scope\">\r\n              <cus-popover v-auth=\"'pd-po-info:deleteRuleOrCalc'\" :content=\"$t('confirmMessage.delete')\"\r\n                           icon=\"el-icon-delete\" size=\"mini\" type=\"danger\"\r\n                           @confirm=\"deleteRuleOrCalc(scope.row, '2')\"></cus-popover>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n        <cus-pagination ref=\"page_currentFormula\" v-model=\"tableData_currentFormula\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                        :params=\"params_currentFormula\" url=\"/pd-po-info/base/getRuleAndCalcInfo\"/>\r\n\r\n        <!-- 可选择产品保全公式 -->\r\n        <cus-table-title :label=\"$t('pdPreservation.tittle8')\" style=\"margin-top: 30px\"></cus-table-title>\r\n        <el-table :data=\"tableData_briefFormula\" border>\r\n          <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n            <template v-slot=\"scope\">\r\n              {{ initTableIndex('page_briefFormula', scope.$index) }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.detail')\" align=\"center\" width=\"80\">\r\n            <template v-slot=\"scope\">\r\n              <el-button dialog-disable=\"disable\" size=\"small\" type=\"text\" @click=\"showRule(scope.row, '2')\">>>\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.formulaCode')\" align=\"center\"\r\n                           min-width=\"200\" prop=\"pdCalcCode\"></el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.calcType')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"pdBussType\">\r\n            <template v-slot=\"scope\">\r\n              {{ scope.row.pdBussType | filter_ruleBusinessModule }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('rule.pdBussDetailType')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"pdBussDetailType\">\r\n            <template v-slot=\"scope\">\r\n              {{ scope.row.pdBussDetailType | filter_ruleBusinessDetailClass }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('i18nView.formulaDec')\" align=\"center\" min-width=\"200\"\r\n                           prop=\"pdCalcDesc\"></el-table-column>\r\n          <!--          <el-table-column :label=\"$t('i18nView.calcFlag')\" align=\"center\" min-width=\"200\"-->\r\n          <!--                           prop=\"valDefFlag\"></el-table-column>-->\r\n          <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" min-width=\"200\">\r\n            <template v-slot=\"scope\">\r\n              {{\r\n                scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n              }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n            <template slot-scope=\"scope\">\r\n              <el-button dialog-disable=\"disable\" icon=\"el-icon-connection\" size=\"small\" type=\"primary\"\r\n                         @click=\"associate(scope.row)\">\r\n                {{ $t('pdgenlPaInfo.select') }}\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n        <cus-pagination ref=\"page_briefFormula\" v-model=\"tableData_briefFormula\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                        :params=\"params_briefFormula\" url=\"/pd-po-info/base/briefFormula\"/>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 定义完毕按钮 -->\r\n    <operationbutton :procInsId=\"pdProcessId\" :type=\"type\" clazz=\"operationalFinishDef\"></operationbutton>\r\n\r\n    <!-- 规则弹窗 -->\r\n    <el-dialog v-if=\"dialogVisible.rule\" v-dialog-drag :close-on-click-modal=\"false\" :close-on-press-escape=\"false\"\r\n               :show-close=\"true\" :visible.sync=\"dialogVisible.rule\" center width=\"75%\"\r\n               @close=\"dialogVisible.rule = false\">\r\n      <pdgenlPaRule :pdPaInfo=\"selectedPO\" :pdRuleDtCls=\"formAddRule.pdRuleDtCls\" Mark=\"pd\"\r\n                    @closeDialogRule=\"closeDialogRule\"></pdgenlPaRule>\r\n    </el-dialog>\r\n\r\n    <!-- 决策树编辑弹窗 -->\r\n    <cus-rule-modify :flag=\"ruleView.flag\" :performType=\"ruleView.performType\" :ruleCode=\"ruleView.ruleCode\"\r\n                     :ruleModifyClosed=\"ruleViewClosed\" :ruleType=\"ruleView.ruleType\"\r\n                     :visible=\"ruleView.visible\"></cus-rule-modify>\r\n\r\n  </cus-wraper>\r\n</template>\r\n\r\n<script>\r\n\r\nimport operationbutton from '@/views/basicinfo/operationend/index'\r\nimport pdgenlPaRule from '@/views/general-config/gen-paInfo-conf/pdgenlPaRule/index'\r\nimport preservation from \"@/views/product-definition/pd-framework-def/pd-attr-def/base-attr-def/preservation/index\"\r\nimport {deletePdPa, deleteRuleOrCalc, getAllPOName, getPdPaInfo, saveInfo} from \"@/api/basicinfo/poInfoDesign\"\r\nimport {connectionRule} from \"@/api/basicinfo/pdgenlPaInfo\"\r\nimport {pdtempPdPaInfoList} from '@/api/basicinfo/ProductAttributeDefinition'\r\n\r\nlet _this\r\n\r\nexport default {\r\n  name: \"poInfoDesign\",\r\n  components: {operationbutton, pdgenlPaRule, preservation},\r\n  filters: {\r\n    filter_ruleBusinessModule(code) {\r\n      return _this.getCodeName('ruleBusinessModule', code)\r\n    },\r\n    filter_ruleBusinessDetailClass(code) {\r\n      return _this.getCodeName('ruleBusinessDetailClass', code)\r\n    },\r\n    filter_ruleAttr(code) {\r\n      return _this.getCodeName('ruleAttr', code, true)\r\n    }\r\n  },\r\n  data() {\r\n    _this = this\r\n    return {\r\n      page: undefined,\r\n      pageSize: undefined,\r\n      productCalcRevisionShowINfo: false,\r\n      revisionType: '',\r\n      ruleView: {\r\n        visible: false,\r\n        ruleType: '',\r\n        flag: '',\r\n        ruleCode: '',\r\n        performType: ''\r\n      },\r\n      dialogVisible: {\r\n        rule: false,\r\n        formula: false\r\n      },\r\n      // 产品信息\r\n      product: {\r\n        id: undefined,\r\n        bType: '',\r\n        cType: '',\r\n        pdCode: '',\r\n        pdEdition: '',\r\n        pdVerId: undefined,\r\n        pdSalechnl: '',\r\n        pdName: '',\r\n        pdShortname: '',\r\n        pdEnName: '',\r\n        pdShortEnName: '',\r\n        operator: '',\r\n        pdApplDate: undefined,\r\n        pdProcessId: undefined,\r\n        createTime: undefined,\r\n        updateTime: undefined\r\n      },\r\n      type: 'productPreservationFlag',\r\n      pdProcessId: '',\r\n      PdPaInfo: {\r\n        PdPaInfo: \"\",\r\n        pdInfoId: \"\",\r\n        pdCode: \"\",\r\n        pdVerId: '',\r\n        pdPaCode: \"\",\r\n        pdPaName: \"\",\r\n        pdAttr: \"\",\r\n        pdPaType: [],\r\n        pdgenlPdPaDesTypeList: [],\r\n      },\r\n      showSeleOptions: false,\r\n      showPreservation: false,\r\n      selectedPO: {},\r\n      chooseRuleId: '',\r\n      chooseRuleCode: '',\r\n      chooseCalcId: '',\r\n      chooseCalcCode: '',\r\n      tableData_currentRule: [],\r\n      tableData_currentFormula: [],\r\n      tableData_briefFormula: [],\r\n      params_currentRule: {\r\n        pdtempPdPaInfoVo: undefined,\r\n        ruleType: '1'\r\n      },\r\n      params_currentFormula: {\r\n        pdtempPdPaInfoVo: undefined,\r\n        ruleType: '2'\r\n      },\r\n      params_briefFormula: {\r\n        product: undefined,\r\n        productDetailType: '',\r\n        pdBussDetailTypeList: ['43', '45', '46'],\r\n        pdBussId: undefined\r\n      },\r\n      poOptions: [],\r\n      poFlag: true,\r\n      selPO: [],\r\n      poInfoResult: [],\r\n      showPageFlag: '0',\r\n      formAddRule: {\r\n        pdRuleDtCls: ''\r\n      },\r\n      rulesForAddRule: {\r\n        pdRuleDtCls: [{required: true, message: '请选择规则细类', trigger: 'change'}]\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$emit('finish')\r\n  },\r\n  created() {\r\n    this.page = this.$route.query.page\r\n    this.pageSize = this.$route.query.pageSize\r\n    this.productCalcRevisionShowINfo = this.$route.query.productCalcRevisionShowINfo === 'true'\r\n    this.revisionType = this.$route.query.revisionType\r\n    this.showPageFlag = this.$route.query.showPageFlag\r\n    this.product = this.getPdData()\r\n    this.PdPaInfo.pdCode = this.product.pdCode\r\n    this.PdPaInfo.pdVerId = this.product.pdVerId\r\n    this.PdPaInfo.pdInfoId = this.product.id\r\n    let data = this.buildRequestData({\r\n      \"pdCode\": '000000',\r\n      \"pdInfoId\": this.product.id,\r\n      \"clsPdCode\": this.product.pdCode,\r\n      \"paOperation\": \"Y\"\r\n    })\r\n    let data1 = this.buildRequestData({\r\n      \"pdInfoId\": this.product.id,\r\n    })\r\n    this.initTable();\r\n    this.getAllPOName(data, data1)\r\n    this.pdProcessId = this.product.pdProcessId\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      this.$router.push({name: '保全定义入口', params: {}})\r\n    },\r\n    goBackToRevision() {\r\n      this.$router.push({name: '产品公式订正主页', params: {path: this.$route.path, page: this.page, pageSize: this.pageSize}})\r\n    },\r\n    /*关闭决策树编辑弹窗*/\r\n    ruleViewClosed() {\r\n      this.ruleView.visible = false\r\n      switch (this.ruleView.ruleType) {\r\n        case \"1\":\r\n          this.chooseRuleId = ''\r\n          this.chooseRuleCode = ''\r\n          break\r\n        case \"2\":\r\n          this.chooseCalcId = ''\r\n          this.chooseCalcCode = ''\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    },\r\n    closeDialogRule() {\r\n      this.dialogVisible.rule = false\r\n      this.$refs.page_currentRule.reload()\r\n    },\r\n    closeDialogFormula() {\r\n      this.dialogVisible.formula = false\r\n      this.$refs.page_currentFormula.reload()\r\n    },\r\n    /* 选择一条规则 */\r\n    chooseOneRule(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (this.chooseRuleId === row.id) {\r\n          this.chooseRuleId = ''\r\n          this.chooseRuleCode = ''\r\n        } else {\r\n          this.chooseRuleId = row.id\r\n          this.chooseRuleCode = row.code\r\n          this.ruleView.flag = row.ruleAttr === '1' ? '1' : '2'\r\n          this.ruleView.ruleType = '1'\r\n          this.ruleView.ruleCode = row.pdRuleCode\r\n          this.ruleView.performType = row.performType\r\n          this.ruleView.visible = true\r\n        }\r\n      }\r\n    },\r\n    /* 选择一条公式 */\r\n    chooseOneCalc(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (this.chooseCalcId === row.id) {\r\n          this.chooseCalcId = ''\r\n          this.chooseCalcCode = ''\r\n        } else {\r\n          this.chooseCalcId = row.id\r\n          this.chooseCalcCode = row.code\r\n          this.ruleView.flag = row.ruleAttr === '1' ? '1' : '2'\r\n          this.ruleView.ruleType = '2'\r\n          this.ruleView.ruleCode = row.pdCalcCode\r\n          this.ruleView.performType = row.performType\r\n          this.ruleView.visible = true\r\n        }\r\n      }\r\n    },\r\n    /* 删除规则或公式 */\r\n    deleteRuleOrCalc(row, ruleType) {\r\n      const param = {\r\n        ruleType: ruleType,\r\n        pdtempPdRulesVo: row,\r\n        pdtempPdCalcVo: row\r\n      }\r\n      deleteRuleOrCalc(this.buildRequestData(param)).then(() => {\r\n        this.notifySuccess(this.$t('successMessage.delete'))\r\n        switch (ruleType) {\r\n          case '1':\r\n            this.$refs.page_currentRule.reload()\r\n            break\r\n          case '2':\r\n            this.$refs.page_currentFormula.reload()\r\n            this.$refs.page_briefFormula.reload()\r\n            break\r\n          default:\r\n            break\r\n        }\r\n      })\r\n    },\r\n    toRules() {\r\n      this.$refs.formAddRule.validate(valid => {\r\n        if (valid) {\r\n          this.dialogVisible.rule = true\r\n        }\r\n      })\r\n    },\r\n    /* 保存按钮 */\r\n    savePOInfo() {\r\n      let data = this.buildRequestData({\r\n        'selpo': this.selPO,\r\n        'PdPaInfo': this.product,\r\n      })\r\n      saveInfo(data).then(() => {\r\n        let data1 = this.buildRequestData({\r\n          \"pdInfoId\": this.product.id,\r\n        })\r\n        getPdPaInfo(data1).then(res => {\r\n          this.poInfoResult = res.data\r\n          this.notifySuccess('保全项目保存完成')\r\n          this.selectedPO = {}\r\n          this.showSeleOptions = false\r\n        })\r\n      })\r\n    },\r\n    /* 刷新重置选择的保全项目 */\r\n    refreshSelOptions() {\r\n      this.selPO = []\r\n      for (const row of this.poInfoResult) {\r\n        for (const datum of this.poOptions) {\r\n          if (row.paCode === datum.pdPaCode) {\r\n            this.selPO.push(datum)\r\n            break\r\n          }\r\n        }\r\n      }\r\n    },\r\n    chooseOnePO() {\r\n      this.chooseRuleId = ''\r\n      this.chooseRuleCode = ''\r\n      this.chooseCalcId = ''\r\n      this.chooseCalcCode = ''\r\n      this.params_currentRule.pdtempPdPaInfoVo = this.selectedPO\r\n      this.params_currentFormula.pdtempPdPaInfoVo = this.selectedPO\r\n      this.params_briefFormula.product = this.product\r\n      this.params_briefFormula.productDetailType = this.product.cType\r\n      this.params_briefFormula.pdBussId = this.selectedPO.id\r\n      this.showSeleOptions = true\r\n      this.$nextTick(() => {\r\n        if (!this.productCalcRevisionShowINfo || this.productCalcRevisionShowINfo && this.revisionType === 'calc') {\r\n          this.$refs.page_currentFormula.reload()\r\n          this.$refs.page_briefFormula.reload()\r\n        }\r\n        if (!this.productCalcRevisionShowINfo || this.productCalcRevisionShowINfo && this.revisionType === 'rule') {\r\n          this.$refs.page_currentRule.reload()\r\n        }\r\n      })\r\n    },\r\n    rowClick(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (this.selectedPO.id === row.id) {\r\n          this.selectedPO = {}\r\n          this.formAddRule.pdRuleDtCls = ''\r\n          this.showSeleOptions = false\r\n        }\r\n      }\r\n    },\r\n    /*获取保全项目名称*/\r\n    getAllPOName(data, data1) {\r\n      this.poOptions = [];\r\n      getAllPOName(data).then(res => {\r\n        for (const row of res.data) {\r\n          this.poOptions.push(row)\r\n        }\r\n      })\r\n      this.findChoosePreservation();\r\n    },\r\n    showRule(row, ruleType) {\r\n      this.ruleView.ruleType = ruleType\r\n      this.ruleView.flag = '1'\r\n      this.ruleView.ruleCode = ruleType === '1' ? row.pdRuleCode : row.pdCalcCode\r\n      this.ruleView.performType = row.performType\r\n      this.ruleView.visible = true\r\n    },\r\n    associate(row) {\r\n      let map = {\r\n        \"ruleType\": '2',\r\n        \"Mark\": 'pd',\r\n        \"pdInfo\": this.product,\r\n        \"pdBussDetailType\": row.pdBussDetailType,\r\n        \"pdtempPdPaInfoVo\": this.selectedPO,\r\n        \"pdtempPdCalcVo\": row\r\n      }\r\n      connectionRule(this.buildRequestData(map)).then(() => {\r\n        this.notifySuccess(this.$t('rule.associationSuccess'))\r\n        this.$refs.page_currentFormula.reload()\r\n        this.$refs.page_briefFormula.reload()\r\n      })\r\n    },\r\n    deletePdPa(row) {\r\n      const params = {\r\n        pdtempPdPaInfoVo: row\r\n      }\r\n      deletePdPa(this.buildRequestData(params)).then(() => {\r\n        this.notifySuccess('删除成功')\r\n        this.showSeleOptions = false\r\n        let data = this.buildRequestData({\r\n          \"pdCode\": '000000',\r\n          \"pdInfoId\": this.product.id,\r\n          \"clsPdCode\": this.product.pdCode\r\n        })\r\n        let data1 = this.buildRequestData({\r\n          \"pdInfoId\": this.product.id,\r\n        })\r\n        this.getAllPOName(data, data1)\r\n        this.initTable();\r\n      })\r\n    },\r\n    backToMenu(flag) {\r\n      if (flag) {\r\n        this.showPreservation = false;\r\n        //刷新表数据\r\n        this.initTable();\r\n        this.findChoosePreservation();\r\n      }\r\n    },\r\n    findChoosePreservation() {\r\n      this.selPO = [];\r\n      let back5 = '';\r\n      back5 = pdtempPdPaInfoList(this.product.id);\r\n      back5.then(response => {\r\n        for (let i = 0; i < response.data.length; i++) {\r\n          this.selPO.push(\r\n            response.data[i].pdPaInfoId + ':' + response.data[i].paCode + ':' + response.data[i].paName\r\n          );\r\n        }\r\n      });\r\n    },\r\n    initTable() {\r\n      let data1 = this.buildRequestData({\r\n        \"pdInfoId\": this.product.id,\r\n      })\r\n      getPdPaInfo(data1).then(res => {\r\n        this.poInfoResult = res.data\r\n        this.selectedPO = {}\r\n        this.pdPaCode = ''\r\n        this.pdCode = ''\r\n        this.showSeleOptions = false\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n.showDiv {\r\n  width: 100%;\r\n  height: 100%;\r\n  margin-top: -40px;\r\n  margin-left: -40px;\r\n  position: absolute;\r\n  background: #ffffff00;\r\n  z-index: 999\r\n}\r\n\r\n</style>\r\n"]}]}