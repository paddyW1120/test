{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-structure-def\\payment-def\\prem-formula\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-structure-def\\payment-def\\prem-formula\\index.vue","mtime":1609847106897},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQoNCmltcG9ydCB7DQogIGFzc29jaWF0ZSwNCiAgZGVsZXRlRm9ybXVsYSwNCiAgZmluZEV4dFByZW1CeUlkLA0KICBnZXRSYXRlSW5mbywNCiAgc2F2ZUZvcm11bGFJblJ1bGVFbmdpbmUNCn0gZnJvbSAiQC9hcGkvYmFzaWNpbmZvL3ByZW1BbW91bnRGb3JtdWxhIg0KaW1wb3J0IHtmaW5kUHJlbUJ5SWR9IGZyb20gJ0AvYXBpL2Jhc2ljaW5mby9hY2NlcHRJbnN1cmFuY2VSdWxlcycNCmltcG9ydCBYTFNYIGZyb20gJ3hsc3gnDQppbXBvcnQge2dldENhbGNDb2RlfSBmcm9tICJAL2FwaS9iYXNpY2luZm8vcGR0ZW1wcGRwcmVtIg0KaW1wb3J0IHByZW1BbW91bnRGb3JtdWxhU2VsZWN0DQogIGZyb20gIkAvdmlld3MvcHJvZHVjdC1kZWZpbml0aW9uL3BkLWZyYW1ld29yay1kZWYvcGQtc3RydWN0dXJlLWRlZi9wYXltZW50LWRlZi9wcmVtLWZvcm11bGEtc2VsZWN0Ig0KDQpsZXQgX3RoaXMNCg0KZXhwb3J0IGRlZmF1bHQgew0KDQogIG5hbWU6ICdwcmVtRm9ybXVsYScsDQogIGNvbXBvbmVudHM6IHsNCiAgICBwcmVtQW1vdW50Rm9ybXVsYVNlbGVjdA0KICB9LA0KICBmaWx0ZXJzOiB7DQogICAgZmlsdGVyX3BkQnVzc1R5cGUoY29kZSkgew0KICAgICAgcmV0dXJuIF90aGlzLmdldENvZGVOYW1lKCdydWxlQnVzaW5lc3NNb2R1bGUnLCBjb2RlKQ0KICAgIH0sDQogICAgZmlsdGVyX3BkQnVzc0RldGFpbFR5cGUoY29kZSkgew0KICAgICAgcmV0dXJuIF90aGlzLmdldENvZGVOYW1lKCdydWxlQnVzaW5lc3NEZXRhaWxDbGFzcycsIGNvZGUpDQogICAgfSwNCiAgICBmaWx0ZXJfcGRQYXlFbmRVbml0KGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncGRzYm5mdGR5JywgY29kZSwgdHJ1ZSkNCiAgICB9LA0KICAgIGZpbHRlcl9jYWxjTWV0aG9kKGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncGRfcHJlbV9jYWxfbWV0aG9kJywgY29kZSkNCiAgICB9LA0KICAgIGZpbHRlcl9wYXlaZXJvKGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncGRfcHJlbV96ZXJvJywgY29kZSkNCiAgICB9LA0KICAgIGZpbHRlcl9zdGFydENhbGNSdWxlKGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncGRfcHJlbV9zdGFydF9jYWxjX3J1bGUnLCBjb2RlKQ0KICAgIH0sDQogICAgZmlsdGVyX3N0YXJ0Q2FsY01ldGhvZChjb2RlKSB7DQogICAgICByZXR1cm4gX3RoaXMuZ2V0Q29kZU5hbWUoJ3BkX3ByZW1fc3RhcnRfY2FsY19tZXRob2QnLCBjb2RlKQ0KICAgIH0sDQogICAgZmlsdGVyX2VuZENhbGNSdWxlKGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncGRfcHJlbV9lbmRfY2FsY19ydWxlJywgY29kZSkNCiAgICB9LA0KICAgIGZpbHRlcl9lbmRDYWxjTWV0aG9kKGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncGRfcHJlbV9lbmRfY2FsY19tZXRob2QnLCBjb2RlKQ0KICAgIH0sDQogICAgZmlsdGVyX3BkRXh0UHJlbU9iaihjb2RlKSB7DQogICAgICByZXR1cm4gX3RoaXMuZ2V0Q29kZU5hbWUoJ3BkQWRkUHJlbU9iaicsIGNvZGUpDQogICAgfSwNCiAgICBmaWx0ZXJfcGRFeHRQcmVtVHlwZShjb2RlKSB7DQogICAgICByZXR1cm4gX3RoaXMuZ2V0Q29kZU5hbWUoJ3BkX3ByZW1fYWRkaXRpb25fdHlwZScsIGNvZGUpDQogICAgfSwNCiAgICBmaWx0ZXJfcGRFeHRQcmVtTW9kZShjb2RlKSB7DQogICAgICByZXR1cm4gX3RoaXMuZ2V0Q29kZU5hbWUoJ3BkX3ByZW1fYWRkaXRpb25fYWRkaXRpb25fbW9kZScsIGNvZGUpDQogICAgfQ0KICB9LA0KICBwcm9wczogew0KICAgIC8vIOS4muWKoeWkp+exuw0KICAgIGd1YXJhbnRlZURldGFpbHM6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IHVuZGVmaW5lZA0KICAgIH0sDQogICAgLy8g5Lia5Yqh57uG57G7DQogICAgY2FsY3VsYXRpb25Gb3JtdWxhVHlwZTogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogdW5kZWZpbmVkDQogICAgfSwNCiAgICAvLyDnvLTotLnkv6Hmga8NCiAgICBwZFV3U2lUeXBlT3B0aW9uczogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogdW5kZWZpbmVkDQogICAgfSwNCiAgICAvLyDliqDotLnkv6Hmga8NCiAgICBwZFV3U2lUeXBlRHRPcHRpb25zOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICByZXF1aXJlZDogZmFsc2UsDQogICAgICBkZWZhdWx0OiB1bmRlZmluZWQNCiAgICB9LA0KICAgIC8vIOiuouato+agh+ivhg0KICAgIHByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbzogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlDQogICAgfQ0KICB9LA0KICBkYXRhKCkgew0KICAgIF90aGlzID0gdGhpcw0KICAgIHJldHVybiB7DQogICAgICBwcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fOiBmYWxzZSwNCiAgICAgIHBhZ2U6IHVuZGVmaW5lZCwNCiAgICAgIHBhZ2VTaXplOiB1bmRlZmluZWQsDQogICAgICByZXZpc2lvblR5cGU6ICcnLA0KICAgICAgZmlsdGVyc19wZENvZGU6IFtdLA0KICAgICAgcGFyYW1zX3ByZW1pdW06IHsNCiAgICAgICAgZXFfcGRJbmZvSWQ6IHVuZGVmaW5lZA0KICAgICAgfSwNCiAgICAgIHBhcmFtc19leHRQcmVtaXVtOiB7DQogICAgICAgIHBkSW5mb0lkOiB1bmRlZmluZWQNCiAgICAgIH0sDQogICAgICBwYXJhbXNfY3VycmVudDogew0KICAgICAgICBlcV9wZEluZm9JZDogdW5kZWZpbmVkLA0KICAgICAgICBlcV9wZEJ1c3NUeXBlOiAnMScsDQogICAgICAgIGVxX3BkQnVzc0RldGFpbFR5cGU6ICcnLA0KICAgICAgICBlcV9wZFN0cnVjdHVyZVR5cGU6ICcnLA0KICAgICAgICBlcV9wZEJ1c3NJZDogJycsDQogICAgICAgIGVxX3BkVHlwZTogJzEnDQogICAgICB9LA0KICAgICAgcGFyYW1zX2JyaWVmOiB7DQogICAgICAgIHByb2R1Y3Q6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRCdXNzSWQ6IHVuZGVmaW5lZCwNCiAgICAgICAgcHJvZHVjdERldGFpbFR5cGU6ICcnLA0KICAgICAgICBwZEJ1c3NEZXRhaWxUeXBlOiB0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18gPyAnJyA6IHRoaXMuY2FsY3VsYXRpb25Gb3JtdWxhVHlwZQ0KICAgICAgfSwNCiAgICAgIGZvcm11bGFTZWxlY3RWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGZvcm11bGFWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGF0dHJpYnV0ZU9iajoge30sDQogICAgICBmb3JtdWxhVmlldzogew0KICAgICAgICBmbGFnOiAnJywNCiAgICAgICAgcnVsZUNvZGU6ICcnLA0KICAgICAgICB2aXNpYmxlOiBmYWxzZSwNCiAgICAgICAgcGVyZm9ybVR5cGU6ICcnDQogICAgICB9LA0KICAgICAgbGFuZ3VhZ2U6IG51bGwsDQogICAgICBydWxlTWVzc2FnZUluZm9Cb206IFtdLA0KICAgICAgdW5kZXJ3cml0aW5nU2hvdzogZmFsc2UsLy/kuIrkvKDotLnnjofooagNCiAgICAgIGZpbGVMaXN0OiBbXSwNCiAgICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4OS9hcGkvcGR0ZW1wLXBkLWZpbGUvdXBMb2FkJywNCiAgICAgIHByb2R1Y3RCbmZ0Rm9ybTogew0KICAgICAgICBwcmVtOiAnJywNCiAgICAgICAgZXh0UHJlbTogJycsDQogICAgICAgIEV4cHJlc3Npb25UeXBlOiAnJw0KICAgICAgfSwNCiAgICAgIHJhdGVGb3JtOiB7DQogICAgICAgIHZwdTogdW5kZWZpbmVkLA0KICAgICAgICByYXRlRWRpdGlvbjogJycsDQogICAgICAgIHN0YXJ0RGF0ZTogdW5kZWZpbmVkLA0KICAgICAgICBlbmREYXRlOiB1bmRlZmluZWQNCiAgICAgIH0sDQogICAgICByYXRlRWRpdEZsYWc6IGZhbHNlLA0KICAgICAgdmFyaWFibGVSYXRlRmxhZzogZmFsc2UsDQogICAgICB0YWJsZURhdGFQcmVtaXVtOiBbXSwNCiAgICAgIHRhYmxlRGF0YUV4dFByZW1pdW06IFtdLA0KICAgICAgdGFibGVEYXRhRm9ybXVsYTogW10sDQogICAgICB0YWJsZURhdGFCcmllZkZvcm11bGE6IFtdLA0KICAgICAgc2VsZWN0ZWRGb3JtdWxhOiB7fSwNCiAgICAgIHNlbGVjdGVkUHJlbWl1bUluUmV2OiB7fSwNCiAgICAgIHNlbGVjdGVkRXh0UHJlbWl1bUluUmV2OiB7fSwNCiAgICAgIHRhYmxlRGF0YUZvcm11bGFQYXJhbXM6IFtdLA0KICAgICAgc2hvd0ZsYWc6IGZhbHNlLA0KICAgICAgT3B0aW9uczE6IFtdLC8v57y06LS5DQogICAgICBPcHRpb25zMjogW10sLy/liqDotLkNCiAgICAgIHByb2R1Y3Q6IHsNCiAgICAgICAgaWQ6IHVuZGVmaW5lZCwNCiAgICAgICAgYlR5cGU6ICcnLA0KICAgICAgICBjVHlwZTogJycsDQogICAgICAgIHBkQ29kZTogJycsDQogICAgICAgIHBkRWRpdGlvbjogJycsDQogICAgICAgIHBkVmVySWQ6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRTYWxlY2hubDogJycsDQogICAgICAgIHBkTmFtZTogJycsDQogICAgICAgIHBkU2hvcnRuYW1lOiAnJywNCiAgICAgICAgcGRFbk5hbWU6ICcnLA0KICAgICAgICBwZFNob3J0RW5OYW1lOiAnJywNCiAgICAgICAgb3BlcmF0b3I6ICcnLA0KICAgICAgICBwZEFwcGxEYXRlOiB1bmRlZmluZWQsDQogICAgICAgIHBkUHJvY2Vzc0lkOiB1bmRlZmluZWQsDQogICAgICAgIGNyZWF0ZVRpbWU6IHVuZGVmaW5lZCwNCiAgICAgICAgdXBkYXRlVGltZTogdW5kZWZpbmVkDQogICAgICB9LA0KICAgICAgZGF0YUdldDoge30sDQogICAgICByYXRlRm9ybVJ1bGVzOiB7DQogICAgICAgIHZwdTogW3sNCiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwNCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCdwcmVtRm9ybXVsYS5wbGVhc2VJbnB1dFZQVScpLA0KICAgICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnDQogICAgICAgIH1dLA0KICAgICAgICByYXRlRWRpdGlvbjogW3sNCiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwNCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCdwcmVtRm9ybXVsYS5wbGVhc2VJbnB1dEVkaXRpb24nKSwNCiAgICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJw0KICAgICAgICB9XQ0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICB0YWJsZURhdGFCcmllZkZvcm11bGEoKSB7DQogICAgICB0aGlzLmZpbHRlcnNfcGRDb2RlID0gW10NCiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnRhYmxlRGF0YUJyaWVmRm9ybXVsYSkgew0KICAgICAgICBpZiAoIXRoaXMuXy5pbmNsdWRlcyh0aGlzLl8ubWFwKHRoaXMuZmlsdGVyc19wZENvZGUsICd2YWx1ZScpLCBpdGVtLnBkQ29kZSkpIHsNCiAgICAgICAgICB0aGlzLmZpbHRlcnNfcGRDb2RlLnB1c2goew0KICAgICAgICAgICAgdGV4dDogaXRlbS5wZENvZGUgKyAnOicgKyBpdGVtLnBkTmFtZSwNCiAgICAgICAgICAgIHZhbHVlOiBpdGVtLnBkQ29kZQ0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy5sYW5ndWFnZSA9IHRoaXMuJHN0b3JlLnN0YXRlLmFwcC5sYW5ndWFnZQ0KICAgIHRoaXMucnVsZU1lc3NhZ2VJbmZvQm9tID0gdGhpcy4kc3RvcmUuc3RhdGUucnVsZU1lc3NhZ2UucnVsZU1lc3NhZ2VzDQogICAgaWYgKHRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvXykgeyAvLyDku47lhazlvI/orqLmraPov5vlhaXvvIzkuI3liJ3lp4vljJblhazlvI/ooajmoLzmlbDmja7vvIzmoLnmja7pgInkuK3nmoTkuJrliqHpobnlho3ov5vooYzmn6Xor6INCiAgICAgIGlmICh0aGlzLnJldmlzaW9uVHlwZSA9PT0gJ3ByZW1pdW0nKSB7DQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9wcmVtaXVtLnJlbG9hZCgpDQogICAgICB9IGVsc2UgaWYgKHRoaXMucmV2aXNpb25UeXBlID09PSAnZXh0UHJlbWl1bScpIHsNCiAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2V4dFByZW1pdW0ucmVsb2FkKCkNCiAgICAgIH0NCiAgICB9IGVsc2UgeyAvLyDku47nvLTotLnlrprkuYnov5vlhaUNCiAgICAgIHRoaXMuZmluZFByZW1CeUlkKHRoaXMucHJvZHVjdC5pZCkNCiAgICAgIHRoaXMucHJvZHVjdEJuZnRGb3JtLnByZW0gPSB0aGlzLnBkVXdTaVR5cGVPcHRpb25zDQogICAgICB0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5FeHByZXNzaW9uVHlwZSA9IHRoaXMuY2FsY3VsYXRpb25Gb3JtdWxhVHlwZQ0KICAgICAgaWYgKHRoaXMucGRVd1NpVHlwZUR0T3B0aW9ucykgew0KICAgICAgICB0aGlzLmZpbmRFeHRQcmVtQnlJZCh0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5wcmVtKS50aGVuKCgpID0+IHsNCiAgICAgICAgICB0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5leHRQcmVtID0gdGhpcy5wZFV3U2lUeXBlRHRPcHRpb25zDQogICAgICAgICAgdGhpcy5oYW5kbGVTZWFyY2goKQ0KICAgICAgICB9KQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5oYW5kbGVTZWFyY2goKQ0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICB0aGlzLnBhZ2UgPSB0aGlzLiRyb3V0ZS5xdWVyeS5wYWdlDQogICAgdGhpcy5wYWdlU2l6ZSA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnBhZ2VTaXplDQogICAgdGhpcy5yZXZpc2lvblR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeS5yZXZpc2lvblR5cGUNCiAgICAvLyDnvLTotLnlhazlvI/orqLmraPmoIfor4YNCiAgICBpZiAodGhpcy5yZXZpc2lvblR5cGUgPT09ICdwcmVtaXVtJykgew0KICAgICAgdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fID0gdHJ1ZQ0KICAgICAgdGhpcy5wYXJhbXNfYnJpZWYucGRCdXNzRGV0YWlsVHlwZSA9ICcxNycNCiAgICB9DQogICAgLy8g5Yqg6LS55YWs5byP6K6i5q2j5qCH6K+GDQogICAgaWYgKHRoaXMucmV2aXNpb25UeXBlID09PSAnZXh0UHJlbWl1bScpIHsNCiAgICAgIHRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvXyA9IHRydWUNCiAgICAgIHRoaXMucGFyYW1zX2JyaWVmLnBkQnVzc0RldGFpbFR5cGUgPSAnMTknDQogICAgfQ0KICAgIHRoaXMuaW5pdFByb2R1Y3RJbmZvKCkNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHJhdGVFZGl0RmxhZ0NoYW5nZWQocmF0ZUVkaXRGbGFnKSB7DQogICAgICB0aGlzLnZhcmlhYmxlUmF0ZUZsYWcgPSBmYWxzZQ0KICAgICAgaWYgKGZhbHNlID09PSByYXRlRWRpdEZsYWcpIHsNCiAgICAgICAgLy8g6I635Y+W6LS5546H6KGo6YWN572u5pWw5o2uDQogICAgICAgIGdldFJhdGVJbmZvKHRoaXMuYnVpbGRSZXF1ZXN0RGF0YSh7DQogICAgICAgICAgcGRQcmVtSWQ6IHRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvXyA/IHRoaXMuc2VsZWN0ZWRQcmVtaXVtSW5SZXYuaWQgOiB0aGlzLmdldENhcHRpb24odGhpcy5wZFV3U2lUeXBlT3B0aW9ucywgMCksDQogICAgICAgICAgcGRDYWxjQ29kZTogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fID8gdGhpcy5zZWxlY3RlZFByZW1pdW1JblJldi5wZFByZW1DYWxjQ29kZSA6IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLnBkQ2FsY0NvZGUNCiAgICAgICAgfSwpKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgew0KICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnJhdGVGb3JtLCByZXNwb25zZS5kYXRhKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgICAgIHRoaXMuJHJlZnMucmF0ZUZvcm0ucmVzZXRGaWVsZHMoKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICB9DQogICAgfSwNCiAgICBzaG93Rm9ybXVsYShyb3cpIHsNCiAgICAgIHRoaXMuZm9ybXVsYVZpZXcuZmxhZyA9ICcxJw0KICAgICAgdGhpcy5mb3JtdWxhVmlldy5ydWxlQ29kZSA9IHJvdy5wZENhbGNDb2RlDQogICAgICB0aGlzLmZvcm11bGFWaWV3LnBlcmZvcm1UeXBlID0gcm93LnBlcmZvcm1UeXBlDQogICAgICB0aGlzLmZvcm11bGFWaWV3LnZpc2libGUgPSB0cnVlDQogICAgfSwNCiAgICBmaWx0ZXJfcGRDb2RlKHZhbHVlLCByb3cpIHsNCiAgICAgIHJldHVybiB2YWx1ZSA9PT0gcm93LnBkQ29kZQ0KICAgIH0sDQogICAgcnVsZU1vZHVsZUNsb3NlZCgpIHsNCiAgICAgIHRoaXMuZm9ybXVsYVZpc2libGUgPSBmYWxzZQ0KICAgICAgaWYgKCF0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18gfHwgdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fICYmIChPYmplY3Qua2V5cyh0aGlzLnNlbGVjdGVkUHJlbWl1bUluUmV2KS5sZW5ndGggPiAwIHx8IE9iamVjdC5rZXlzKHRoaXMuc2VsZWN0ZWRFeHRQcmVtaXVtSW5SZXYpLmxlbmd0aCA+IDApKSB7DQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5yZWxvYWQoKQ0KICAgICAgfQ0KICAgIH0sDQogICAgZm9ybXVsYVZpZXdDbG9zZWQoKSB7DQogICAgICB0aGlzLmZvcm11bGFWaWV3LnZpc2libGUgPSBmYWxzZQ0KICAgICAgaWYgKCF0aGlzLnNob3dGbGFnKSB7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRGb3JtdWxhID0ge30NCiAgICAgIH0NCiAgICB9LA0KICAgIC8v5pi+56S657y06LS56aG55pWw57uEDQogICAgZmluZFByZW1CeUlkKGlkKSB7DQogICAgICBsZXQgcGFyYW1zID0gew0KICAgICAgICBwZEluZm9JZDogaWQsDQogICAgICAgIHBkUHJvZ0NvZGU6ICcnLA0KICAgICAgfQ0KICAgICAgZmluZFByZW1CeUlkKHBhcmFtcykudGhlbihyZXMgPT4gew0KICAgICAgICBsZXQgZGF0YSA9IHJlcy5kYXRhDQogICAgICAgIHRoaXMuT3B0aW9uczEgPSBbXQ0KICAgICAgICBpZiAoZGF0YS5sZW5ndGgpIHsNCiAgICAgICAgICBkYXRhLmZvckVhY2godmFsID0+IHsNCiAgICAgICAgICAgIHRoaXMuT3B0aW9uczEucHVzaCh7DQogICAgICAgICAgICAgIGtleTogdmFsLmlkLA0KICAgICAgICAgICAgICB2YWx1ZTogdmFsLmlkICsgIjoiICsgdmFsLnBkUHJlbUNvZGUsDQogICAgICAgICAgICAgIGxhYmVsOiB2YWwucGRQcmVtQ29kZSArICI6IiArIHZhbC5wZFBheU5hbWUNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8v5pi+56S65Yqg6LS56aG55pWw57uEDQogICAgYXN5bmMgZmluZEV4dFByZW1CeUlkKHJvdykgew0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KICAgICAgICB0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5leHRQcmVtID0gJycNCiAgICAgICAgdGhpcy5PcHRpb25zMiA9IFtdDQogICAgICAgIGxldCBjb2RlID0gdGhpcy5nZXRDYXB0aW9uKHJvdywgMSkNCiAgICAgICAgaWYgKCFjb2RlKSB7DQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgZmluZEV4dFByZW1CeUlkKGNvZGUpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICBsZXQgZGF0YSA9IHJlcy5kYXRhDQogICAgICAgICAgdGhpcy5PcHRpb25zMiA9IFtdDQogICAgICAgICAgaWYgKGRhdGEubGVuZ3RoKSB7DQogICAgICAgICAgICBkYXRhLmZvckVhY2godmFsID0+IHsNCiAgICAgICAgICAgICAgdGhpcy5PcHRpb25zMi5wdXNoKHsNCiAgICAgICAgICAgICAgICBrZXk6IHZhbC5pZCwNCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsLmlkICsgIjoiICsgdmFsLnBkRXh0UHJlbUNvZGUsDQogICAgICAgICAgICAgICAgbGFiZWw6IHZhbC5wZEV4dFByZW1Db2RlICsgIjoiICsgdmFsLnBkRXh0UHJlbU5hbWUNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgIHJlc29sdmUoKQ0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHNlbGVjdGVkUHJlbWl1bUNoYW5nZWQodmFsKSB7DQogICAgICBpZiAodGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fKSB7IC8vIOS7juiuouato+i/m+WFpQ0KICAgICAgICB0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5leHRQcmVtID0gJycNCiAgICAgICAgdGhpcy5PcHRpb25zMiA9IFtdDQogICAgICAgIGlmICh2YWwpIHsNCiAgICAgICAgICB0aGlzLmZpbmRFeHRQcmVtQnlJZCh2YWwpDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7IC8vIOS7juS6p+WTgeWumuS5iei/m+WFpQ0KICAgICAgICBpZiAodGhpcy5wZFV3U2lUeXBlRHRPcHRpb25zKSB7DQogICAgICAgICAgdGhpcy5wcm9kdWN0Qm5mdEZvcm0uZXh0UHJlbSA9ICcnDQogICAgICAgICAgdGhpcy5PcHRpb25zMiA9IFtdDQogICAgICAgICAgaWYgKHZhbCkgew0KICAgICAgICAgICAgdGhpcy5maW5kRXh0UHJlbUJ5SWQodmFsKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAodmFsKSB7DQogICAgICAgICAgICB0aGlzLmhhbmRsZVNlYXJjaCgpDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBzZWxlY3RlZEV4dFByZW1pdW1DaGFuZ2VkKHZhbCkgew0KICAgICAgdmFsICYmIHRoaXMuaGFuZGxlU2VhcmNoKCkNCiAgICB9LA0KICAgIGhhbmRsZVNlYXJjaCgpIHsNCiAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRJbmZvSWQgPSB0aGlzLnByb2R1Y3QuaWQNCiAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRCdXNzVHlwZSA9ICcxJw0KICAgICAgdGhpcy5wYXJhbXNfY3VycmVudC5lcV9wZFR5cGUgPSAnMScNCiAgICAgIGlmICh0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18pIHsNCiAgICAgICAgaWYgKHRoaXMucmV2aXNpb25UeXBlID09PSAncHJlbWl1bScpIHsNCiAgICAgICAgICB0aGlzLnBhcmFtc19jdXJyZW50LmVxX3BkQnVzc0RldGFpbFR5cGUgPSAnMTcnDQogICAgICAgICAgdGhpcy5wYXJhbXNfY3VycmVudC5lcV9wZFN0cnVjdHVyZVR5cGUgPSAnMDUnDQogICAgICAgICAgdGhpcy5wYXJhbXNfY3VycmVudC5lcV9wZEJ1c3NJZCA9IHRoaXMuc2VsZWN0ZWRQcmVtaXVtSW5SZXYuaWQNCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJldmlzaW9uVHlwZSA9PT0gJ2V4dFByZW1pdW0nKSB7DQogICAgICAgICAgdGhpcy5wYXJhbXNfY3VycmVudC5lcV9wZEJ1c3NEZXRhaWxUeXBlID0gJzE5Jw0KICAgICAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRTdHJ1Y3R1cmVUeXBlID0gJzA2Jw0KICAgICAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRCdXNzSWQgPSB0aGlzLnNlbGVjdGVkRXh0UHJlbWl1bUluUmV2LmlkDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmICh0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5leHRQcmVtKSB7DQogICAgICAgICAgdGhpcy5wYXJhbXNfY3VycmVudC5lcV9wZEJ1c3NEZXRhaWxUeXBlID0gJzE5Jw0KICAgICAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRTdHJ1Y3R1cmVUeXBlID0gJzA2Jw0KICAgICAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRCdXNzSWQgPSB0aGlzLmdldENhcHRpb24odGhpcy5wcm9kdWN0Qm5mdEZvcm0uZXh0UHJlbSwgMCkNCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5wcmVtKSB7DQogICAgICAgICAgdGhpcy5wYXJhbXNfY3VycmVudC5lcV9wZEJ1c3NEZXRhaWxUeXBlID0gJzE3Jw0KICAgICAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRTdHJ1Y3R1cmVUeXBlID0gJzA1Jw0KICAgICAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRCdXNzSWQgPSB0aGlzLmdldENhcHRpb24odGhpcy5wcm9kdWN0Qm5mdEZvcm0ucHJlbSwgMCkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQucmVsb2FkKCkudGhlbigoKSA9PiB7DQogICAgICAgIGlmICgodGhpcy5jYWxjdWxhdGlvbkZvcm11bGFUeXBlID09PSAnMTcnIHx8IHRoaXMucmV2aXNpb25UeXBlID09PSAncHJlbWl1bScpICYmIHRoaXMudGFibGVEYXRhRm9ybXVsYS5sZW5ndGggPT09IDEgJiYgdGhpcy50YWJsZURhdGFGb3JtdWxhWzBdLmRhdGFHZXQpIHsNCiAgICAgICAgICB0aGlzLnNlbGVjdGVkRm9ybXVsYSA9IHRoaXMudGFibGVEYXRhRm9ybXVsYVswXQ0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGb3JtdWxhQ2hhbmdlZCgpDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBpbml0UHJvZHVjdEluZm8oKSB7DQogICAgICBsZXQgcGR0ZW1wUGRJbmZvID0gdGhpcy5nZXRQZERhdGEoKQ0KICAgICAgaWYgKE9iamVjdC5rZXlzKHBkdGVtcFBkSW5mbykubGVuZ3RoID4gMCkgew0KICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMucHJvZHVjdCwgcGR0ZW1wUGRJbmZvKQ0KICAgICAgICB0aGlzLnBhcmFtc19icmllZi5wcm9kdWN0ID0gcGR0ZW1wUGRJbmZvDQogICAgICAgIHRoaXMucGFyYW1zX2JyaWVmLnBkQnVzc0lkID0gdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fID8gdW5kZWZpbmVkIDogKHRoaXMuY2FsY3VsYXRpb25Gb3JtdWxhVHlwZSA9PT0gJzE3JyA/IHRoaXMuZ2V0Q2FwdGlvbih0aGlzLnBkVXdTaVR5cGVPcHRpb25zLCAwKSA6IHRoaXMuZ2V0Q2FwdGlvbih0aGlzLnBkVXdTaVR5cGVEdE9wdGlvbnMsIDApKQ0KICAgICAgICB0aGlzLnBhcmFtc19wcmVtaXVtLmVxX3BkSW5mb0lkID0gcGR0ZW1wUGRJbmZvLmlkDQogICAgICAgIHRoaXMucGFyYW1zX2V4dFByZW1pdW0ucGRJbmZvSWQgPSBwZHRlbXBQZEluZm8uaWQNCiAgICAgICAgdGhpcy5wYXJhbXNfYnJpZWYucHJvZHVjdERldGFpbFR5cGUgPSB0aGlzLnByb2R1Y3QuY1R5cGUNCiAgICAgICAgaWYgKCF0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18pIHsNCiAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgICB0aGlzLiRyZWZzLnBhZ2VfYnJpZWYucmVsb2FkKCkNCiAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLm5vdGlmeUVycm9yKHRoaXMuJHQoJ21lc3NhZ2UuaW52YWxpZFByb2R1Y3RJbmZvJykpDQogICAgICB9DQogICAgfSwNCiAgICBiYWNrVG9QcmVtRGVmKCkgew0KICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlRGlhbG9nVmlzaWJsZV9mb3JtdWxhJywgZmFsc2UpDQogICAgfSwNCiAgICBiYWNrVG9Gb3JtdWxhUmV2KCkgew0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICfkuqflk4HlhazlvI/orqLmraPkuLvpobUnLCBwYXJhbXM6IHtwYXRoOiB0aGlzLiRyb3V0ZS5wYXRoLCBwYWdlOiB0aGlzLnBhZ2UsIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplfX0pDQogICAgfSwNCiAgICB0b0Zvcm11bGFTZWxlY3QoKSB7DQogICAgICBpZiAodGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fKSB7IC8vIOiuouatow0KICAgICAgICBpZiAodGhpcy5yZXZpc2lvblR5cGUgPT09ICdwcmVtaXVtJykgew0KICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLnNlbGVjdGVkUHJlbWl1bUluUmV2KS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMubm90aWZ5RXJyb3IodGhpcy4kdCgncHJlbUZvcm11bGEucGxlYXNlU2VsZWN0UHJlbWl1bScpKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMucHJvZHVjdEJuZnRGb3JtLkV4cHJlc3Npb25UeXBlID0gJzE3Jw0KICAgICAgICAgICAgdGhpcy5wcm9kdWN0Qm5mdEZvcm0ucHJlbSA9IHRoaXMuc2VsZWN0ZWRQcmVtaXVtSW5SZXYuaWQgKyAnOicgKyB0aGlzLnNlbGVjdGVkUHJlbWl1bUluUmV2LnBkUHJlbUNvZGUNCiAgICAgICAgICAgIHRoaXMucHJvZHVjdEJuZnRGb3JtLmV4dFByZW0gPSAnJw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJldmlzaW9uVHlwZSA9PT0gJ2V4dFByZW1pdW0nKSB7DQogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc2VsZWN0ZWRFeHRQcmVtaXVtSW5SZXYpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5ub3RpZnlFcnJvcih0aGlzLiR0KCdwcmVtRm9ybXVsYS5wbGVhc2VTZWxlY3RFeHRQcmVtaXVtJykpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5wcm9kdWN0Qm5mdEZvcm0uRXhwcmVzc2lvblR5cGUgPSAnMTknDQogICAgICAgICAgICB0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5wcmVtID0gJycNCiAgICAgICAgICAgIHRoaXMucHJvZHVjdEJuZnRGb3JtLmV4dFByZW0gPSB0aGlzLnNlbGVjdGVkRXh0UHJlbWl1bUluUmV2LmlkICsgJzonICsgdGhpcy5zZWxlY3RlZEV4dFByZW1pdW1JblJldi5wZEV4dFByZW1Db2RlDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgeyAvLyDkuqflk4HlrprkuYkNCiAgICAgICAgaWYgKHRoaXMucGRVd1NpVHlwZUR0T3B0aW9ucykgew0KICAgICAgICAgIGlmICghdGhpcy5wcm9kdWN0Qm5mdEZvcm0uZXh0UHJlbSB8fCAhdGhpcy5wcm9kdWN0Qm5mdEZvcm0ucHJlbSkgew0KICAgICAgICAgICAgdGhpcy5ub3RpZnlFcnJvcih0aGlzLiR0KCdwcmVtRm9ybXVsYS5wbGVhc2VTZWxlY3RQcmVtaXVtQW5kRWN0UHJlbWl1bScpKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmICghdGhpcy5wcm9kdWN0Qm5mdEZvcm0ucHJlbSkgew0KICAgICAgICAgICAgdGhpcy5ub3RpZnlFcnJvcih0aGlzLiR0KCdwcmVtRm9ybXVsYS5wbGVhc2VTZWxlY3RQcmVtaXVtQW5kRWN0UHJlbWl1bScpKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICghdGhpcy5wZFV3U2lUeXBlRHRPcHRpb25zKSB7DQogICAgICAgICAgdGhpcy5wcm9kdWN0Qm5mdEZvcm0uRXhwcmVzc2lvblR5cGUgPSAnMTcnIC8vIOWFrOW8j+e7huexu++8mue8tOi0uQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMucHJvZHVjdEJuZnRGb3JtLkV4cHJlc3Npb25UeXBlID0gJzE5JyAvLyDlhazlvI/nu4bnsbvvvJrliqDotLkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKHRoaXMucmV2aXNpb25UeXBlID09PSAnZXh0UHJlbWl1bScpIHsNCiAgICAgICAgdGhpcy5mb3JtdWxhU2VsZWN0VmlzaWJsZSA9IHRydWUNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJGVtaXQoJ2NoYW5nZURpYWxvZ1Zpc2libGVfZm9ybXVsYVNlbGVjdCcsIHRydWUsICcxJywgdGhpcy5wcm9kdWN0Qm5mdEZvcm0uRXhwcmVzc2lvblR5cGUsDQogICAgICAgICAgdGhpcy5wcm9kdWN0Qm5mdEZvcm0ucHJlbSwgdGhpcy5wcm9kdWN0Qm5mdEZvcm0uZXh0UHJlbSkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWKoOi0ueWFrOW8j+iuouato+aXtuWFs+mXreabtOWkmuWFrOW8j+W8ueeqlw0KICAgIGNoYW5nZURpYWxvZ1Zpc2libGVfZm9ybXVsYVNlbGVjdChmbGFnKSB7DQogICAgICB0aGlzLmZvcm11bGFTZWxlY3RWaXNpYmxlID0gZmxhZw0KICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQucmVsb2FkKCkNCiAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5yZWxvYWQoKQ0KICAgIH0sDQogICAgYnJpbmdJbkNhbGNDb2RlKHBkQnVzc0RldGFpbFR5cGUsIHBkQnVzc0lkLCBwZENhbGNDb2RlKSB7DQogICAgICBpZiAoJzE5JyA9PT0gcGRCdXNzRGV0YWlsVHlwZSkgew0KICAgICAgICBmb3IgKGNvbnN0IGV4dFByZW1pdW0gb2YgdGhpcy50YWJsZURhdGFFeHRQcmVtaXVtKSB7DQogICAgICAgICAgaWYgKGV4dFByZW1pdW0uaWQgPT09IHBkQnVzc0lkKSB7DQogICAgICAgICAgICB0aGlzLiRzZXQoZXh0UHJlbWl1bSwgJ3BkRXh0UHJlbUNhbGNDb2RlJywgcGRDYWxjQ29kZSkNCiAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKCcxNycgPT09IHBkQnVzc0RldGFpbFR5cGUpIHsNCiAgICAgICAgZm9yIChjb25zdCBwcmVtaXVtIG9mIHRoaXMudGFibGVEYXRhUHJlbWl1bSkgew0KICAgICAgICAgIGlmIChwcmVtaXVtLmlkID09PSBwZEJ1c3NJZCkgew0KICAgICAgICAgICAgdGhpcy4kc2V0KHByZW1pdW0sICdwZFByZW1DYWxjQ29kZScsIHBkQ2FsY0NvZGUpDQogICAgICAgICAgICBicmVhaw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgdG9BZGRGb3JtdWxhKCkgew0KICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgIHBkQnVzc1R5cGU6IHRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvXyA/ICcxJyA6IHRoaXMuZ3VhcmFudGVlRGV0YWlscywNCiAgICAgICAgcGRCdXNzRGV0YWlsVHlwZTogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fID8gKHRoaXMucmV2aXNpb25UeXBlID09PSAncHJlbWl1bScgPyAnMTcnIDogJzE5JykgOiB0aGlzLmNhbGN1bGF0aW9uRm9ybXVsYVR5cGUNCiAgICAgIH0NCiAgICAgIGdldENhbGNDb2RlKHRoaXMuYnVpbGRSZXF1ZXN0RGF0YShwYXJhbSkpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLmF0dHJpYnV0ZU9iaiA9IHsNCiAgICAgICAgICBjb2RlOiByZXNwb25zZS5kYXRhLA0KICAgICAgICAgIHJ1bGVCdXNzTW9kdTogcGFyYW0ucGRCdXNzVHlwZSwNCiAgICAgICAgICBydWxlQnVzc01vZHVEZXRhOiBwYXJhbS5wZEJ1c3NEZXRhaWxUeXBlLA0KICAgICAgICAgIHJ1bGVUeXBlOiAnMicsDQogICAgICAgICAgcGRUeXBlOiAnMScsDQogICAgICAgICAgcmlza1R5cGU6IHRoaXMucHJvZHVjdC5iVHlwZSwNCiAgICAgICAgICByaXNrRGV0YWlsOiB0aGlzLnByb2R1Y3QuY1R5cGUsDQogICAgICAgICAgcGRDb2RlOiB0aGlzLnByb2R1Y3QucGRDb2RlLA0KICAgICAgICAgIHBkRWRpdGlvbjogdGhpcy5wcm9kdWN0LnBkRWRpdGlvbg0KICAgICAgICB9DQogICAgICAgIHRoaXMuZm9ybXVsYVZpc2libGUgPSB0cnVlDQogICAgICB9KQ0KICAgIH0sDQogICAgcm93Q2xpY2socm93LCBjb2x1bW4sIGV2ZW50KSB7DQogICAgICBpZiAoZXZlbnQudGFyZ2V0Lm5vZGVOYW1lID09PSAiSU5QVVQiKSB7DQogICAgICAgIGlmIChyb3cuaWQgPT09IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLmlkKSB7DQogICAgICAgICAgdGhpcy5zZWxlY3RlZEZvcm11bGEgPSB7fQ0KICAgICAgICAgIHRoaXMudGFibGVEYXRhRm9ybXVsYVBhcmFtcyA9IFtdDQogICAgICAgICAgdGhpcy5yZXNldFJhdGVGb3JtKCkNCiAgICAgICAgICB0aGlzLnNob3dGbGFnID0gZmFsc2UNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgcm93Q2xpY2tQcmVtaXVtKHJvdywgY29sdW1uLCBldmVudCkgew0KICAgICAgaWYgKGV2ZW50LnRhcmdldC5ub2RlTmFtZSA9PT0gIklOUFVUIikgew0KICAgICAgICBpZiAocm93LmlkID09PSB0aGlzLnNlbGVjdGVkUHJlbWl1bUluUmV2LmlkKSB7DQogICAgICAgICAgdGhpcy5zZWxlY3RlZFByZW1pdW1JblJldiA9IHt9DQogICAgICAgICAgdGhpcy5wYXJhbXNfYnJpZWYucGRCdXNzSWQgPSB1bmRlZmluZWQNCiAgICAgICAgICB0aGlzLnRhYmxlRGF0YUZvcm11bGEgPSBbXQ0KICAgICAgICAgIHRoaXMuJHJlZnMucGFnZV9jdXJyZW50LnRvdGFsID0gMA0KICAgICAgICAgIHRoaXMuJHJlZnMucGFnZV9jdXJyZW50LnBhZ2UgPSAxDQogICAgICAgICAgdGhpcy50YWJsZURhdGFCcmllZkZvcm11bGEgPSBbXQ0KICAgICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi50b3RhbCA9IDANCiAgICAgICAgICB0aGlzLiRyZWZzLnBhZ2VfYnJpZWYucGFnZSA9IDENCiAgICAgICAgICB0aGlzLnNlbGVjdGVkRm9ybXVsYSA9IHt9DQogICAgICAgICAgdGhpcy50YWJsZURhdGFGb3JtdWxhUGFyYW1zID0gW10NCiAgICAgICAgICB0aGlzLnJlc2V0UmF0ZUZvcm0oKQ0KICAgICAgICAgIHRoaXMuc2hvd0ZsYWcgPSBmYWxzZQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICByb3dDbGlja0V4dFByZW1pdW0ocm93LCBjb2x1bW4sIGV2ZW50KSB7DQogICAgICBpZiAoZXZlbnQudGFyZ2V0Lm5vZGVOYW1lID09PSAiSU5QVVQiKSB7DQogICAgICAgIGlmIChyb3cuaWQgPT09IHRoaXMuc2VsZWN0ZWRFeHRQcmVtaXVtSW5SZXYuaWQpIHsNCiAgICAgICAgICB0aGlzLnNlbGVjdGVkRXh0UHJlbWl1bUluUmV2ID0ge30NCiAgICAgICAgICB0aGlzLnBhcmFtc19icmllZi5wZEJ1c3NJZCA9IHVuZGVmaW5lZA0KICAgICAgICAgIHRoaXMudGFibGVEYXRhRm9ybXVsYSA9IFtdDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQudG90YWwgPSAwDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQucGFnZSA9IDENCiAgICAgICAgICB0aGlzLnRhYmxlRGF0YUJyaWVmRm9ybXVsYSA9IFtdDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnRvdGFsID0gMA0KICAgICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5wYWdlID0gMQ0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGb3JtdWxhID0ge30NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgcmVzZXRSYXRlRm9ybSgpIHsNCiAgICAgIHRoaXMucmF0ZUZvcm0gPSB7DQogICAgICAgIHZwdTogdW5kZWZpbmVkLA0KICAgICAgICByYXRlRWRpdGlvbjogJycsDQogICAgICAgIHN0YXJ0RGF0ZTogdW5kZWZpbmVkLA0KICAgICAgICBlbmREYXRlOiB1bmRlZmluZWQNCiAgICAgIH0NCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgaWYgKHRoaXMuJHJlZnMucmF0ZUZvcm0pIHsNCiAgICAgICAgICB0aGlzLiRyZWZzLnJhdGVGb3JtLmNsZWFyVmFsaWRhdGUoKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgc2VsZWN0ZWRGb3JtdWxhQ2hhbmdlZCgpIHsNCiAgICAgIGlmICh0aGlzLmNhbGN1bGF0aW9uRm9ybXVsYVR5cGUgPT09ICcxNycgfHwgdGhpcy5yZXZpc2lvblR5cGUgPT09ICdwcmVtaXVtJykgew0KICAgICAgICB0aGlzLnJhdGVFZGl0RmxhZyA9IGZhbHNlDQogICAgICAgIHRoaXMudmFyaWFibGVSYXRlRmxhZyA9IGZhbHNlDQogICAgICAgIHRoaXMudGFibGVEYXRhRm9ybXVsYVBhcmFtcyA9IFtdDQogICAgICAgIGlmICghdGhpcy5zZWxlY3RlZEZvcm11bGEuZGF0YUdldCkgew0KICAgICAgICAgIHRoaXMuZm9ybXVsYVZpZXcuZmxhZyA9IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLnJ1bGVBdHRyID09PSAnMScgPyAnMScgOiAnMicNCiAgICAgICAgICB0aGlzLmZvcm11bGFWaWV3LnJ1bGVDb2RlID0gdGhpcy5zZWxlY3RlZEZvcm11bGEucGRDYWxjQ29kZQ0KICAgICAgICAgIHRoaXMuZm9ybXVsYVZpZXcucGVyZm9ybVR5cGUgPSB0aGlzLnNlbGVjdGVkRm9ybXVsYS5wZXJmb3JtVHlwZQ0KICAgICAgICAgIHRoaXMuZm9ybXVsYVZpZXcudmlzaWJsZSA9IHRydWUNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmRhdGFHZXQgPSBKU09OLnBhcnNlKHRoaXMuc2VsZWN0ZWRGb3JtdWxhLmRhdGFHZXQpDQogICAgICAgIHRoaXMudGFibGVEYXRhRm9ybXVsYVBhcmFtcyA9IHRoaXMuZGF0YUdldC5wYXJhbUxpc3QNCiAgICAgICAgLy8g6I635Y+W6LS5546H6KGo6YWN572u5pWw5o2uDQogICAgICAgIGdldFJhdGVJbmZvKHRoaXMuYnVpbGRSZXF1ZXN0RGF0YSh7DQogICAgICAgICAgcGRQcmVtSWQ6IHRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvXyA/IHRoaXMuc2VsZWN0ZWRQcmVtaXVtSW5SZXYuaWQgOiB0aGlzLmdldENhcHRpb24odGhpcy5wZFV3U2lUeXBlT3B0aW9ucywgMCksDQogICAgICAgICAgcGRDYWxjQ29kZTogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fID8gdGhpcy5zZWxlY3RlZFByZW1pdW1JblJldi5wZFByZW1DYWxjQ29kZSA6IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLnBkQ2FsY0NvZGUNCiAgICAgICAgfSkpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgIHRoaXMuc2hvd0ZsYWcgPSB0cnVlDQogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEpIHsNCiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5yYXRlRm9ybSwgcmVzcG9uc2UuZGF0YSkNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgICAgICB0aGlzLiRyZWZzLnJhdGVGb3JtLnJlc2V0RmllbGRzKCkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5mb3JtdWxhVmlldy5mbGFnID0gdGhpcy5zZWxlY3RlZEZvcm11bGEucnVsZUF0dHIgPT09ICcxJyA/ICcxJyA6ICcyJw0KICAgICAgICB0aGlzLmZvcm11bGFWaWV3LnJ1bGVDb2RlID0gdGhpcy5zZWxlY3RlZEZvcm11bGEucGRDYWxjQ29kZQ0KICAgICAgICB0aGlzLmZvcm11bGFWaWV3LnBlcmZvcm1UeXBlID0gdGhpcy5zZWxlY3RlZEZvcm11bGEucGVyZm9ybVR5cGUNCiAgICAgICAgdGhpcy5mb3JtdWxhVmlldy52aXNpYmxlID0gdHJ1ZQ0KICAgICAgfQ0KICAgIH0sDQogICAgaW5pdFRhYmxlRGF0YUluUmV2KCkgew0KICAgICAgdGhpcy5oYW5kbGVTZWFyY2goKQ0KICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgfSwNCiAgICBzZWxlY3RlZFByZW1pdW1JblJldkNoYW5nZWQoKSB7DQogICAgICB0aGlzLnNlbGVjdGVkRm9ybXVsYSA9IHt9DQogICAgICB0aGlzLnRhYmxlRGF0YUZvcm11bGFQYXJhbXMgPSBbXQ0KICAgICAgdGhpcy5yZXNldFJhdGVGb3JtKCkNCiAgICAgIHRoaXMuc2hvd0ZsYWcgPSBmYWxzZQ0KICAgICAgdGhpcy5oYW5kbGVTZWFyY2goKQ0KICAgICAgdGhpcy5wYXJhbXNfYnJpZWYucGRCdXNzSWQgPSB0aGlzLnNlbGVjdGVkUHJlbWl1bUluUmV2LmlkDQogICAgICB0aGlzLiRyZWZzLnBhZ2VfYnJpZWYucmVsb2FkKCkNCiAgICB9LA0KICAgIHNlbGVjdGVkRXh0UHJlbWl1bUluUmV2Q2hhbmdlZCgpIHsNCiAgICAgIHRoaXMuc2VsZWN0ZWRGb3JtdWxhID0ge30NCiAgICAgIHRoaXMuaGFuZGxlU2VhcmNoKCkNCiAgICAgIHRoaXMucGFyYW1zX2JyaWVmLnBkQnVzc0lkID0gdGhpcy5zZWxlY3RlZEV4dFByZW1pdW1JblJldi5pZA0KICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgfSwNCiAgICBkZWxldGVGb3JtdWxhKHJvdykgew0KICAgICAgZGVsZXRlRm9ybXVsYShyb3cpLnRoZW4oKCkgPT4gew0KICAgICAgICB0aGlzLm5vdGlmeVN1Y2Nlc3ModGhpcy4kdCgnc3VjY2Vzc01lc3NhZ2UuZGVsZXRlJykpDQogICAgICAgIHRoaXMuaGFuZGxlU2VhcmNoKCkNCiAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgICAgIGlmICghdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fKSB7DQogICAgICAgICAgdGhpcy4kZW1pdCgnYnJpbmdJbkNhbGNDb2RlJywgcm93LnBkQnVzc0RldGFpbFR5cGUsIHJvdy5wZEJ1c3NJZCwgdW5kZWZpbmVkKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuYnJpbmdJbkNhbGNDb2RlKHJvdy5wZEJ1c3NEZXRhaWxUeXBlLCByb3cucGRCdXNzSWQsIHVuZGVmaW5lZCkNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnNob3dGbGFnID0gZmFsc2UNCiAgICAgIH0pDQogICAgfSwNCiAgICBnZXRDYXB0aW9uKG9iaiwgc3RhdGUpIHsNCiAgICAgIGNvbnN0IGluZGV4ID0gb2JqLmxhc3RJbmRleE9mKCI6IikNCiAgICAgIGlmIChzdGF0ZSA9PT0gMCkgew0KICAgICAgICByZXR1cm4gb2JqLnN1YnN0cmluZygwLCBpbmRleCkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBvYmouc3Vic3RyaW5nKGluZGV4ICsgMSwgb2JqLmxlbmd0aCkNCiAgICAgIH0NCiAgICB9LA0KICAgIGhhbmRsZUJlZm9yZVVwbG9hZChmaWxlKSB7DQogICAgICB0aGlzLiRjb25maXJtKFN0cmluZyh0aGlzLiR0KCdwcmVtRm9ybXVsYS50ZXh0MDUnKSksIFN0cmluZyh0aGlzLiR0KCdjb25maXJtTWVzc2FnZS50aXAnKSksIHsNCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMuJHQoJ2NvbmZpcm1NZXNzYWdlLmNvbmZpcm0nKSwNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy4kdCgnY29uZmlybU1lc3NhZ2UuY2FuY2VsJyksDQogICAgICAgIHR5cGU6ICd3YXJuaW5nJw0KICAgICAgfSkudGhlbigoKSA9PiB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICdpbmZvJywNCiAgICAgICAgICBtZXNzYWdlOiBTdHJpbmcodGhpcy4kdCgncHJlbUZvcm11bGEuY29udGludWUnKSkNCiAgICAgICAgfSkNCiAgICAgICAgdGhpcy5maWxlTGlzdCA9IFtdDQogICAgICAgIHRoaXMuZmlsZUxpc3QucHVzaChmaWxlKQ0KICAgICAgICBsZXQgZmlsZXMgPSB7MDogZmlsZX0NCiAgICAgICAgdGhpcy5yZWFkRXhjZWwoZmlsZXMpDQogICAgICAgIHJldHVybiB0cnVlDQogICAgICB9KS5jYXRjaCgoKSA9PiB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICdpbmZvJywNCiAgICAgICAgICBtZXNzYWdlOiBTdHJpbmcodGhpcy4kdCgncHJlbUZvcm11bGEuY2FuY2VsZWQnKSkNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICB9KQ0KICAgICAgcmV0dXJuIGZhbHNlDQogICAgfSwNCiAgICBoYW5kbGVSZW1vdmUoZmlsZSwgZmlsZUxpc3QpIHsNCiAgICAgIHRoaXMuZmlsZUxpc3QgPSBmaWxlTGlzdA0KICAgIH0sDQogICAgLy/kuIvovb0NCiAgICBkb3dubG9hZEN2VGFibGUoKSB7DQogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5zZWxlY3RlZEZvcm11bGEpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICB0aGlzLm5vdGlmeUVycm9yKHRoaXMuJHQoJ3ByZW1Gb3JtdWxhLnBsZWFzZVNlbGVjdEZvcm11bGEnKSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICBsZXQgY29sdW1ucyA9IFtdDQogICAgICBmb3IgKGNvbnN0IHBhcmFtIG9mIHRoaXMuZGF0YUdldC5wYXJhbUFycikgew0KICAgICAgICBjb2x1bW5zLnB1c2goew0KICAgICAgICAgIHRpdGxlOiBwYXJhbS5wcm9wLA0KICAgICAgICAgIGtleTogcGFyYW0uY29sdW1uDQogICAgICAgIH0pDQogICAgICB9DQogICAgICAvLyDlpITnkIbnsbvlnovkuLrml6XmnJ/nmoTmlbDmja4NCiAgICAgIGxldCBjb2x1bW5BcnIgPSB0aGlzLl8ubWFwKGNvbHVtbnMsICdrZXknKQ0KICAgICAgZm9yIChjb25zdCBwYXJhbSBvZiB0aGlzLnRhYmxlRGF0YUZvcm11bGFQYXJhbXMpIHsNCiAgICAgICAgZm9yIChjb25zdCBjb2x1bW4gb2YgY29sdW1uQXJyKSB7DQogICAgICAgICAgbGV0IGNvbW1hbmRUeXBlID0gdGhpcy5nZXRDb21tYW5kVHlwZUJ5Q29sdW1uKGNvbHVtbikNCiAgICAgICAgICBpZiAoY29tbWFuZFR5cGUgPT09ICdEYXRlJykgew0KICAgICAgICAgICAgdGhpcy4kc2V0KHBhcmFtLCBjb2x1bW4sIHRoaXMuZm9ybWF0RGF0ZShuZXcgRGF0ZShwYXJhbVtjb2x1bW5dKSwgJ3l5eXktTU0tZGQnKSkNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMuZXhwb3J0MkV4Y2VsKGNvbHVtbnMsIHRoaXMudGFibGVEYXRhRm9ybXVsYVBhcmFtcywgdGhpcy4kdCgncHJlbUZvcm11bGEucmF0ZVRhYmxlJykgKyAnXycgKyB0aGlzLmZvcm1hdERhdGUobmV3IERhdGUoKSwgJ3l5eXktTU0tZGQgaGg6bW06c3MnKSkNCiAgICB9LA0KICAgIGdldENvbW1hbmRUeXBlQnlDb2x1bW4oY29sdW1uKSB7DQogICAgICBmb3IgKGNvbnN0IHBhcmFtQXJyRWxlbWVudCBvZiB0aGlzLmRhdGFHZXQucGFyYW1BcnIpIHsNCiAgICAgICAgaWYgKHBhcmFtQXJyRWxlbWVudC5jb2x1bW4gPT09IGNvbHVtbikgew0KICAgICAgICAgIHJldHVybiBwYXJhbUFyckVsZW1lbnQuY29tbWFuZFR5cGUNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHVuZGVmaW5lZA0KICAgIH0sDQogICAgcmVhZEV4Y2VsKGZpbGVzKSB7Ly/ooajmoLzlr7zlhaUNCiAgICAgIGlmIChmaWxlcy5sZW5ndGggPD0gMCkgey8v5aaC5p6c5rKh5pyJ5paH5Lu25ZCNDQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgfSBlbHNlIGlmICghL1wuKHhsc3x4bHN4KSQvLnRlc3QoZmlsZXNbMF0ubmFtZS50b0xvd2VyQ2FzZSgpKSkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKFN0cmluZyh0aGlzLiR0KCdwcmVtRm9ybXVsYS5pbmNvcnJlY3RGb3JtYXQnKSkpDQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgfQ0KICAgICAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCkNCiAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gKGV2KSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgY29uc3QgZGF0YSA9IGV2LnRhcmdldC5yZXN1bHQNCiAgICAgICAgICBjb25zdCB3b3JrYm9vayA9IFhMU1gucmVhZChkYXRhLCB7DQogICAgICAgICAgICB0eXBlOiAnYmluYXJ5Jw0KICAgICAgICAgIH0pDQogICAgICAgICAgY29uc3Qgd3NuYW1lID0gd29ya2Jvb2suU2hlZXROYW1lc1swXS8v5Y+W56ys5LiA5byg6KGoDQogICAgICAgICAgY29uc3Qgd3MgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24od29ya2Jvb2suU2hlZXRzW3dzbmFtZV0pLy/nlJ/miJBqc29u6KGo5qC85YaF5a65DQogICAgICAgICAgLy/ph43lhpnmlbDmja4NCiAgICAgICAgICB0cnkgew0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKQ0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLiRyZWZzLnVwbG9hZC52YWx1ZSA9ICcnDQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZmlsZVJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZXNbMF0pDQogICAgICAvL+WKoOi9veaIkOWKn+WQjg0KICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZXZ0KSB7DQogICAgICAgIGlmIChldnQudGFyZ2V0LnJlYWR5U3RhdGUgPT09IEZpbGVSZWFkZXIuRE9ORSkgew0KICAgICAgICAgIGNvbnN0IGRhdGEgPSBmaWxlUmVhZGVyLnJlc3VsdA0KICAgICAgICAgIHZhciB3b3JrYm9vayA9IFhMU1gucmVhZChkYXRhLCB7dHlwZTogJ2JpbmFyeSd9KQ0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHNoZWV0X25hbWVfbGlzdCA9IHdvcmtib29rLlNoZWV0TmFtZXMNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHdvcmtib29rLlNoZWV0c1tzaGVldF9uYW1lX2xpc3RbMF1dLCB7aGVhZGVyOiAxfSkNCiAgICAgICAgX3RoaXMudGFibGVEYXRhRm9ybXVsYVBhcmFtcyA9IFtdDQogICAgICAgIGxldCBrZXlBcnJheSA9IFtdDQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0WzBdLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgbGV0IHByb3BOYW1lID0gcmVzdWx0WzBdW2ldDQogICAgICAgICAgZm9yIChjb25zdCBwYXJhbUFyckVsZW1lbnQgb2YgX3RoaXMuZGF0YUdldC5wYXJhbUFycikgew0KICAgICAgICAgICAgaWYgKHByb3BOYW1lID09PSBwYXJhbUFyckVsZW1lbnQucHJvcCkgew0KICAgICAgICAgICAgICBsZXQga2V5ID0gcGFyYW1BcnJFbGVtZW50LmNvbHVtbg0KICAgICAgICAgICAgICBrZXlBcnJheS5wdXNoKGtleSkNCiAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBpZiAoaSA+IDApIHsNCiAgICAgICAgICAgIGxldCBkYXRhSXRlbSA9IHt9DQogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJlc3VsdFtpXS5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICBsZXQgdmFsdWUgPSByZXN1bHRbaV1bal0NCiAgICAgICAgICAgICAgaWYgKCdtdWx0aXBsZScgPT09IF90aGlzLmRhdGFHZXQucGFyYW1BcnJbal0uY29tbWFuZFR5cGUpIHsNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnNwbGl0KCcsJykNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICBfdGhpcy4kc2V0KHZhbHVlLCBpLCBTdHJpbmcodmFsdWVbaV0pLnRyaW0oKSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgX3RoaXMuJHNldChkYXRhSXRlbSwga2V5QXJyYXlbal0sIHZhbHVlKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX3RoaXMuJHNldChfdGhpcy50YWJsZURhdGFGb3JtdWxhUGFyYW1zLCBpIC0gMSwgZGF0YUl0ZW0pDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBkZWxldGVGb3JtdWxhUGFyYW0ocm93KSB7DQogICAgICB0aGlzLnRhYmxlRGF0YUZvcm11bGFQYXJhbXMuc3BsaWNlKHRoaXMudGFibGVEYXRhRm9ybXVsYVBhcmFtcy5pbmRleE9mKHJvdyksIDEpDQogICAgfSwNCiAgICBhZGREYXRhUm93KCkgew0KICAgICAgdGhpcy50YWJsZURhdGFGb3JtdWxhUGFyYW1zLnB1c2goe30pDQogICAgfSwNCiAgICBzYXZlRm9ybXVsYVBhcmFtKCkgew0KICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc2VsZWN0ZWRGb3JtdWxhKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgdGhpcy5ub3RpZnlFcnJvcih0aGlzLiR0KCdwZHRlbXBQZFVuZGVyd3JpdGluZ0Ftb3VudEZvcm11bGEucGxlYXNlU2VsZWN0Rm9ybXVsYScpKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuJHJlZnMucmF0ZUZvcm0udmFsaWRhdGUocGFzcyA9PiB7DQogICAgICAgIGlmICh0aGlzLnJhdGVFZGl0RmxhZyAmJiAhcGFzcykgew0KICAgICAgICAgIHRoaXMuZm9jdXNJdGVtKCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRyZWZzLnJhdGVGb3JtLmNsZWFyVmFsaWRhdGUoKQ0KICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmRhdGFHZXQsICdwYXJhbUxpc3QnLCB0aGlzLnRhYmxlRGF0YUZvcm11bGFQYXJhbXMpDQogICAgICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgICAgICBydWxlQ29kZTogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fID8gdGhpcy5zZWxlY3RlZFByZW1pdW1JblJldi5wZFByZW1DYWxjQ29kZSA6IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLnBkQ2FsY0NvZGUsDQogICAgICAgICAgICBkeW5hbWljVGFibGU6IEpTT04uc3RyaW5naWZ5KHRoaXMuZGF0YUdldCksDQogICAgICAgICAgICByYXRlRm9ybTogdGhpcy5yYXRlRm9ybSwNCiAgICAgICAgICAgIHBkUHJlbUlkOiB0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18gPyB0aGlzLnNlbGVjdGVkUHJlbWl1bUluUmV2LmlkIDogdGhpcy5nZXRDYXB0aW9uKHRoaXMucGRVd1NpVHlwZU9wdGlvbnMsIDApLA0KICAgICAgICAgICAgcmF0ZUVkaXRGbGFnOiB0aGlzLnJhdGVFZGl0RmxhZw0KICAgICAgICAgIH0NCiAgICAgICAgICBzYXZlRm9ybXVsYUluUnVsZUVuZ2luZSh0aGlzLmJ1aWxkUmVxdWVzdERhdGEocGFyYW0pKS50aGVuKCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMubm90aWZ5U3VjY2Vzcyh0aGlzLiR0KCdzdWNjZXNzTWVzc2FnZS5zYXZlJykpDQogICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5zZWxlY3RlZEZvcm11bGEsICdkYXRhR2V0JywgSlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhR2V0KSkNCiAgICAgICAgICAgIHRoaXMucmF0ZUVkaXRGbGFnID0gZmFsc2UNCiAgICAgICAgICAgIHRoaXMudmFyaWFibGVSYXRlRmxhZyA9IGZhbHNlDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHJlZnJlc2hGb3JtdWxhUGFyYW0oKSB7DQogICAgICB0aGlzLnNlbGVjdGVkRm9ybXVsYUNoYW5nZWQoKQ0KICAgIH0sDQogICAgaGFuZGxlU2VsZWN0Rm9ybXVsYShyb3cpIHsNCiAgICAgIGlmICh0aGlzLnJldmlzaW9uVHlwZSA9PT0gJ3ByZW1pdW0nICYmIE9iamVjdC5rZXlzKHRoaXMuc2VsZWN0ZWRQcmVtaXVtSW5SZXYpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICB0aGlzLm5vdGlmeUVycm9yKHRoaXMuJHQoJ3ByZW1Gb3JtdWxhLnBsZWFzZVNlbGVjdFByZW1pdW0nKSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICBpZiAodGhpcy5yZXZpc2lvblR5cGUgPT09ICdleHRQcmVtaXVtJyAmJiBPYmplY3Qua2V5cyh0aGlzLnNlbGVjdGVkRXh0UHJlbWl1bUluUmV2KS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgdGhpcy5ub3RpZnlFcnJvcih0aGlzLiR0KCdwcmVtRm9ybXVsYS5wbGVhc2VTZWxlY3RFeHRQcmVtaXVtJykpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgbGV0IFBkdGVtcFBkQ2FsYyA9IHsNCiAgICAgICAgcGRJbmZvSWQ6IHRoaXMucHJvZHVjdC5pZCwNCiAgICAgICAgcGRWZXJJZDogdGhpcy5wcm9kdWN0LnBkVmVySWQsDQogICAgICAgIHBkVHlwZTogJycsDQogICAgICAgIHBkQ29kZTogdGhpcy5wcm9kdWN0LnBkQ29kZSwNCiAgICAgICAgcGRCdXNzVHlwZTogJzEnLA0KICAgICAgICBwZEJ1c3NEZXRhaWxUeXBlOiB0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18gPyAodGhpcy5yZXZpc2lvblR5cGUgPT09ICdwcmVtaXVtJyA/ICcxNycgOiAnMTknKSA6IHRoaXMuY2FsY3VsYXRpb25Gb3JtdWxhVHlwZSwNCiAgICAgICAgcGRCdXNzSWQ6ICcnLA0KICAgICAgICBwZEJ1c3NDb2RlOiAnJywNCiAgICAgICAgcGRTdHJ1Y3R1cmVUeXBlOiAnJywNCiAgICAgICAgcGRDYWxjQ29kZTogcm93LnBkQ2FsY0NvZGUsDQogICAgICAgIHBkQ2FsY0Rlc2M6IHJvdy5wZENhbGNEZXNjDQogICAgICB9DQogICAgICBpZiAodGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fKSB7IC8vIOiuouatow0KICAgICAgICBpZiAodGhpcy5yZXZpc2lvblR5cGUgPT09ICdwcmVtaXVtJykgew0KICAgICAgICAgIFBkdGVtcFBkQ2FsYy5wZFN0cnVjdHVyZVR5cGUgPSAnMDUnDQogICAgICAgICAgUGR0ZW1wUGRDYWxjLnBkQnVzc0lkID0gdGhpcy5zZWxlY3RlZFByZW1pdW1JblJldi5pZA0KICAgICAgICAgIFBkdGVtcFBkQ2FsYy5wZEJ1c3NDb2RlID0gdGhpcy5zZWxlY3RlZFByZW1pdW1JblJldi5wZFByZW1Db2RlDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgUGR0ZW1wUGRDYWxjLnBkU3RydWN0dXJlVHlwZSA9ICcwNicNCiAgICAgICAgICBQZHRlbXBQZENhbGMucGRCdXNzSWQgPSB0aGlzLnNlbGVjdGVkRXh0UHJlbWl1bUluUmV2LmlkDQogICAgICAgICAgUGR0ZW1wUGRDYWxjLnBkQnVzc0NvZGUgPSB0aGlzLnNlbGVjdGVkRXh0UHJlbWl1bUluUmV2LnBkRXh0UHJlbUNvZGUNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsgLy8g6Z2e6K6i5q2jDQogICAgICAgIGlmICh0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5leHRQcmVtKSB7DQogICAgICAgICAgUGR0ZW1wUGRDYWxjLnBkU3RydWN0dXJlVHlwZSA9ICcwNicNCiAgICAgICAgICBQZHRlbXBQZENhbGMucGRCdXNzSWQgPSB0aGlzLmdldENhcHRpb24odGhpcy5wcm9kdWN0Qm5mdEZvcm0uZXh0UHJlbSwgMCkNCiAgICAgICAgICBQZHRlbXBQZENhbGMucGRCdXNzQ29kZSA9IHRoaXMuZ2V0Q2FwdGlvbih0aGlzLnByb2R1Y3RCbmZ0Rm9ybS5leHRQcmVtLCAxKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIFBkdGVtcFBkQ2FsYy5wZFN0cnVjdHVyZVR5cGUgPSAnMDUnDQogICAgICAgICAgUGR0ZW1wUGRDYWxjLnBkQnVzc0lkID0gdGhpcy5nZXRDYXB0aW9uKHRoaXMucHJvZHVjdEJuZnRGb3JtLnByZW0sIDApDQogICAgICAgICAgUGR0ZW1wUGRDYWxjLnBkQnVzc0NvZGUgPSB0aGlzLmdldENhcHRpb24odGhpcy5wcm9kdWN0Qm5mdEZvcm0ucHJlbSwgMSkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgIHNlbGVjdGVkRm9ybXVsYTogcm93LA0KICAgICAgICBwZHRlbXBQZENhbGM6IFBkdGVtcFBkQ2FsYywNCiAgICAgICAgcHJvZHVjdDogdGhpcy5wcm9kdWN0LA0KICAgICAgICBwZEJ1c3NUeXBlOiAnMScsDQogICAgICAgIHBkQnVzc0RldGFpbFR5cGU6IFBkdGVtcFBkQ2FsYy5wZEJ1c3NEZXRhaWxUeXBlLA0KICAgICAgICBuZWVkQ2hlY2tpbmc6IHRydWUNCiAgICAgIH0NCiAgICAgIGFzc29jaWF0ZSh0aGlzLmJ1aWxkUmVxdWVzdERhdGEocGFyYW0pKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgbGV0IHN1Y2Nlc3NGbGFnID0gcmVzcG9uc2UuZGF0YS5mbGFnDQogICAgICAgIGxldCBwZHRlbXBQZENhbGMgPSByZXNwb25zZS5kYXRhLnBkdGVtcFBkQ2FsYw0KICAgICAgICBpZiAoc3VjY2Vzc0ZsYWcgPT09IHRydWUpIHsNCiAgICAgICAgICB0aGlzLm5vdGlmeVN1Y2Nlc3ModGhpcy4kdCgncnVsZS5hc3NvY2lhdGlvblN1Y2Nlc3MnKSkNCiAgICAgICAgICB0aGlzLmhhbmRsZVNlYXJjaCgpDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgICAgICAgaWYgKCF0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mb18pIHsNCiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2JyaW5nSW5DYWxjQ29kZScsIHBkdGVtcFBkQ2FsYy5wZEJ1c3NEZXRhaWxUeXBlLCBwZHRlbXBQZENhbGMucGRCdXNzSWQsIHBkdGVtcFBkQ2FsYy5wZENhbGNDb2RlKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLmJyaW5nSW5DYWxjQ29kZShQZHRlbXBQZENhbGMucGRCdXNzRGV0YWlsVHlwZSwgcGR0ZW1wUGRDYWxjLnBkQnVzc0lkLCBwZHRlbXBQZENhbGMucGRDYWxjQ29kZSkNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kY29uZmlybShTdHJpbmcodGhpcy4kdCgndW5kZXJ3cml0aW5nQW1vdW50Rm9ybXVsYVNlbGVjdC5jb25maXJtX292ZXJ3cml0ZV9mb3JtdWxhJykpLCBTdHJpbmcodGhpcy4kdCgnY29uZmlybU1lc3NhZ2UudGlwJykpLCB7DQogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogU3RyaW5nKHRoaXMuJHQoJ2NvbmZpcm1NZXNzYWdlLmNvbmZpcm0nKSksDQogICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBTdHJpbmcodGhpcy4kdCgnY29uZmlybU1lc3NhZ2UuY2FuY2VsJykpLA0KICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnDQogICAgICAgICAgfSkudGhlbigoKSA9PiB7DQogICAgICAgICAgICBwYXJhbS5uZWVkQ2hlY2tpbmcgPSBmYWxzZQ0KICAgICAgICAgICAgYXNzb2NpYXRlKHRoaXMuYnVpbGRSZXF1ZXN0RGF0YShwYXJhbSkpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICBsZXQgcGR0ZW1wUGRDYWxjID0gcmVzcG9uc2UuZGF0YS5wZHRlbXBQZENhbGMNCiAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTdWNjZXNzKHRoaXMuJHQoJ3J1bGUuYXNzb2NpYXRpb25TdWNjZXNzJykpDQogICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2VhcmNoKCkNCiAgICAgICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgICAgICAgICAgIGlmICghdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm9fKSB7DQogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnYnJpbmdJbkNhbGNDb2RlJywgcGR0ZW1wUGRDYWxjLnBkQnVzc0RldGFpbFR5cGUsIHBkdGVtcFBkQ2FsYy5wZEJ1c3NJZCwgcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUpDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy5icmluZ0luQ2FsY0NvZGUoUGR0ZW1wUGRDYWxjLnBkQnVzc0RldGFpbFR5cGUsIHBkdGVtcFBkQ2FsYy5wZEJ1c3NJZCwgcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUpDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5tZXNzYWdlSW5mbyh0aGlzLiR0KCd1bmRlcndyaXRpbmdBbW91bnRGb3JtdWxhU2VsZWN0LmNhbmNlbGVkJykpDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-definition/pd-framework-def/pd-structure-def/payment-def/prem-formula","sourcesContent":["<template>\r\n  <cus-wraper>\r\n\r\n    <!--  -->\r\n    <cus-page-title-back v-if=\"!productCalcRevisionShowINfo_\" :isDialog=\"true\"\r\n                         :label=\"pdUwSiTypeDtOptions?$t('premFormula.extPremCalcDef'):$t('premFormula.premCalcDef')\"\r\n                         @backTo=\"backToPremDef\"/>\r\n    <!--  -->\r\n    <cus-page-title-back v-if=\"revisionType === 'extPremium'\" :label=\"$t('route.pdExtPremFormulaRevision')\"\r\n                         @backTo=\"backToFormulaRev\"/>\r\n\r\n    <el-form v-if=\"!productCalcRevisionShowINfo_\" ref=\"productBnftForm\" :model=\"productBnftForm\" label-width=\"auto\">\r\n      <el-row :gutter=\"10\">\r\n        <el-col :span=\"8\">\r\n          <el-form-item :label=\"$t('premFormula.premItem')\">\r\n            <el-select v-model=\"productBnftForm.prem\" :placeholder=\"$t('pdtempPdBnft.pleaseChoose')\" clearable\r\n                       disabled filterable @change=\"selectedPremiumChanged\">\r\n              <el-option v-for=\"item in Options1\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\"></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-form-item v-if=\"pdUwSiTypeDtOptions\" :label=\"$t('premFormula.extPremItem')\">\r\n            <el-select v-model=\"productBnftForm.extPrem\" :placeholder=\"$t('pdtempPdBnft.pleaseChoose')\" clearable\r\n                       disabled filterable @change=\"selectedExtPremiumChanged\">\r\n              <el-option v-for=\"item in Options2\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\r\n              </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n        </el-col>\r\n      </el-row>\r\n    </el-form>\r\n\r\n    <!--  -->\r\n    <div v-if=\"revisionType === 'premium'\">\r\n      <cus-table-title :label=\"$t('premFormula.pdPremItem')\"/>\r\n      <el-table :data=\"tableDataPremium\" border element-loading-text=\"Loading\" fit highlight-current-row\r\n                max-height=\"300\" size=\"mini\" @row-click=\"rowClickPremium\">\r\n        <el-table-column :label=\"$t('table.select')\" width=\"50\">\r\n          <template slot-scope=\"scope\">\r\n            <el-radio-group v-model=\"selectedPremiumInRev\" @change=\"selectedPremiumInRevChanged\">\r\n              <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n            </el-radio-group>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.detail')\" type=\"expand\" width=\"80\">\r\n          <template slot-scope=\"props\">\r\n            <el-form class=\"demo-table-expand\" inline label-position=\"left\">\r\n              <el-form-item :label=\"$t('pay_def.pay_calc_method')\">\r\n                <span>{{ props.row.pdPremCalMode | filter_calcMethod }}</span>\r\n              </el-form-item>\r\n              <el-form-item :label=\"$t('pay_def.pay_zero')\">\r\n                <span>{{ props.row.pdPremZeroFlag | filter_payZero }}</span>\r\n              </el-form-item>\r\n              <el-form-item :label=\"$t('pay_def.pay_start_calc_basis')\">\r\n                <span>{{ props.row.pdPayStartCalRule | filter_startCalcRule }}</span>\r\n              </el-form-item>\r\n              <el-form-item :label=\"$t('pay_def.pay_start_calc_valuetypes')\">\r\n                <span>{{ props.row.pdPayStartCalMode | filter_startCalcMethod }}</span>\r\n              </el-form-item>\r\n              <el-form-item :label=\"$t('pay_def.pay_end_calc_basis')\">\r\n                <span>{{ props.row.pdPayEndCalRule | filter_endCalcRule }}</span>\r\n              </el-form-item>\r\n              <el-form-item :label=\"$t('pay_def.pay_end_calc_method')\">\r\n                <span>{{ props.row.pdPayEndCalMode | filter_endCalcMethod }}</span>\r\n              </el-form-item>\r\n              <el-form-item :label=\"$t('pay_def.pay_calc_formula_code')\">\r\n                <span>{{ props.row.pdPremCalcCode }}</span>\r\n              </el-form-item>\r\n            </el-form>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n          <template v-slot=\"scope\">\r\n            {{ initTableIndex('page_premium', scope.$index) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdPremCode')\" align=\"center\" min-width=\"200\" prop=\"pdPremCode\"\r\n                         sortable></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdPayName')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdPayName\"></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdRateChangeFlag')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdRateChangeFlag\"></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdPremAccRela')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdPremAccRela\"></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdPayEndPeriod')\" align=\"center\" min-width=\"200\">\r\n          <template v-slot=\"scope\">\r\n            <span v-for=\"item in scope.row.pdtempPdPremPeriodList\">\r\n              {{ item.pdPayEndPeriod }}\r\n              {{ item.pdPayEndUnit | filter_pdPayEndUnit }}\r\n              {{\r\n                scope.row.pdtempPdPremPeriodList.indexOf(item) === scope.row.pdtempPdPremPeriodList.length - 1 ? '' : ','\r\n              }}\r\n            </span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdCalcCode')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdPremCalcCode\"></el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_premium\" v-model=\"tableDataPremium\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_premium\" url=\"/PremAmountFormul/list/getAllPremiumByPdInfoId\"/>\r\n    </div>\r\n\r\n    <!--  -->\r\n    <div v-if=\"revisionType === 'extPremium'\">\r\n      <cus-table-title :label=\"$t('premFormula.pdExtPremItem')\"/>\r\n      <el-table :data=\"tableDataExtPremium\" border element-loading-text=\"Loading\" fit highlight-current-row\r\n                max-height=\"300\" size=\"mini\" @row-click=\"rowClickExtPremium\">\r\n        <el-table-column :label=\"$t('table.select')\" width=\"50\">\r\n          <template slot-scope=\"scope\">\r\n            <el-radio-group v-model=\"selectedExtPremiumInRev\" @change=\"selectedExtPremiumInRevChanged\">\r\n              <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n            </el-radio-group>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n          <template v-slot=\"scope\">\r\n            {{ initTableIndex('page_extPremium', scope.$index) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdPremCode')\" align=\"center\" min-width=\"200\" prop=\"pdPremCode\"\r\n                         sortable></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdPayName')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdPremName\"></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdExtPremCode')\" align=\"center\" min-width=\"200\" prop=\"pdExtPremCode\"\r\n                         sortable></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdExtPremName')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdExtPremName\"></el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdExtPremObj')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdExtPremObj\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdExtPremObj | filter_pdExtPremObj }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdExtPremType')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdExtPremType\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdExtPremType | filter_pdExtPremType }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('premFormula.pdExtPremMode')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdExtPremMode\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdExtPremMode | filter_pdExtPremMode }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdCalcCode')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdExtPremCalcCode\"></el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_extPremium\" v-model=\"tableDataExtPremium\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_extPremium\" url=\"/PremAmountFormul/list/getAllExtPremiumByPdInfoId\"/>\r\n    </div>\r\n\r\n    <!--  -->\r\n    <div\r\n      v-if=\"!productCalcRevisionShowINfo_ || productCalcRevisionShowINfo_ && (Object.keys(selectedPremiumInRev).length > 0 || Object.keys(selectedExtPremiumInRev).length > 0)\">\r\n      <cus-form-title v-if=\"!productCalcRevisionShowINfo_\" :first=\"true\"\r\n                      :label=\"pdUwSiTypeDtOptions?$t('premFormula.selectedExtPremFormula'):$t('premFormula.selectedPremFormula')\"></cus-form-title>\r\n      <cus-form-title v-if=\"productCalcRevisionShowINfo_\" :first=\"true\"\r\n                      :label=\"revisionType==='extPremium'?$t('premFormula.selectedExtPremFormula'):$t('premFormula.selectedPremFormula')\"></cus-form-title>\r\n      <cus-table-title v-if=\"!productCalcRevisionShowINfo_\"\r\n                       :label=\"pdUwSiTypeDtOptions?$t('premFormula.pdExtPremFormula'):$t('premFormula.pdPremFormula')\"/>\r\n      <cus-table-title v-if=\"productCalcRevisionShowINfo_\"\r\n                       :label=\"revisionType==='extPremium'?$t('premFormula.pdExtPremFormula'):$t('premFormula.pdPremFormula')\"/>\r\n      <el-table :data=\"tableDataFormula\" border element-loading-text=\"Loading\" fit\r\n                highlight-current-row max-height=\"300\" size=\"mini\" @row-click=\"rowClick\">\r\n        <el-table-column :label=\"$t('table.select')\" width=\"50\">\r\n          <template slot-scope=\"scope\">\r\n            <el-radio-group v-model=\"selectedFormula\" @change=\"selectedFormulaChanged\">\r\n              <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n            </el-radio-group>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.detail')\" align=\"center\" width=\"80\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"small\" type=\"text\" @click=\"showFormula(scope.row)\">>></el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column v-if=\"!pdUwSiTypeDtOptions\" :label=\"$t('premFormula.premItem')\" align=\"center\" min-width=\"200\"\r\n                         sortable>\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.premiumCode ? scope.row.premiumCode + ':' + scope.row.premiumName : '' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column v-if=\"pdUwSiTypeDtOptions || productCalcRevisionShowINfo_\"\r\n                         :label=\"$t('premFormula.extPremItem')\"\r\n                         align=\"center\"\r\n                         min-width=\"200\" sortable>\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.extPremiumCode ? scope.row.extPremiumCode + ':' + scope.row.extPremiumName : '' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdBussDetailType')\" align=\"center\" min-width=\"200\" prop=\"pdExtPremCode\"\r\n                         sortable>\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdBussDetailType | filter_pdBussDetailType }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"pdUwSiTypeDtOptions?$t('premFormula.extPremCalcCode'):$t('premFormula.premCalcCode')\"\r\n                         align=\"center\" min-width=\"200\" prop=\"pdCalcCode\" sortable></el-table-column>\r\n        <el-table-column :label=\"pdUwSiTypeDtOptions?$t('premFormula.extPremCalcDesc'):$t('premFormula.premCalcDesc')\"\r\n                         align=\"center\" min-width=\"200\" prop=\"pdCalcDesc\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" min-width=\"200\">\r\n          <template v-slot=\"scope\">\r\n            {{\r\n              scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n            }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n          <template slot-scope=\"scope\">\r\n            <cus-del-btn v-auth=\"'PremAmountFormul:delete'\" @ok=\"deleteFormula(scope.row)\"></cus-del-btn>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_current\" v-model=\"tableDataFormula\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_current\" url=\"/PremAmountFormul/list/currentFormula\"/>\r\n    </div>\r\n\r\n    <!--  -->\r\n    <div v-if=\"showFlag\">\r\n      <cus-form-title :label=\"$t('premFormula.premRateConfig')\"/>\r\n      <el-form ref=\"rateForm\" :model=\"rateForm\" :rules=\"rateFormRules\" label-width=\"auto\">\r\n        <el-row :gutter=\"10\" type=\"flex\">\r\n          <el-col :span=\"6\">\r\n            <el-form-item :label=\"$t('premFormula.editPremRateConfig')\">\r\n              <el-switch v-model=\"rateEditFlag\" @change=\"rateEditFlagChanged\"></el-switch>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"6\">\r\n            <el-form-item :label=\"$t('premFormula.variableRateFlag')\">\r\n              <el-switch v-model=\"variableRateFlag\" :disabled=\"!rateEditFlag\"></el-switch>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n        <el-row :gutter=\"10\" type=\"flex\">\r\n          <el-col :span=\"6\">\r\n            <el-form-item label=\"VPU\" prop=\"vpu\">\r\n              <el-input v-model=\"rateForm.vpu\" :disabled=\"!rateEditFlag\"\r\n                        :placeholder=\"$t('form.please_enter')+$t('form.number')\" clearable filterable\r\n                        type=\"number\"></el-input>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"6\">\r\n            <el-form-item :label=\"$t('premFormula.edition')\" prop=\"rateEdition\">\r\n              <el-input v-model=\"rateForm.rateEdition\" :disabled=\"!rateEditFlag\" clearable></el-input>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"6\">\r\n            <el-form-item :label=\"$t('premFormula.startDate')\"\r\n                          :rules=\"{required: variableRateFlag, message: this.$t('premFormula.pleaseSelectStartDate'), trigger: 'change'}\"\r\n                          prop=\"startDate\">\r\n              <el-date-picker v-model=\"rateForm.startDate\" :disabled=\"!rateEditFlag\"\r\n                              value-format=\"yyyy-MM-dd\"></el-date-picker>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"6\">\r\n            <el-form-item :label=\"$t('premFormula.endDate')\"\r\n                          :rules=\"{required: variableRateFlag, message: this.$t('premFormula.pleaseSelectEndDate'), trigger: 'change'}\"\r\n                          prop=\"endDate\">\r\n              <el-date-picker v-model=\"rateForm.endDate\" :disabled=\"!rateEditFlag\"\r\n                              value-format=\"yyyy-MM-dd\"></el-date-picker>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n      </el-form>\r\n\r\n      <el-row>\r\n        <el-button-group>\r\n          <el-button icon=\"el-icon-upload\" size=\"small\" type=\"primary\" @click=\"underwritingShow = true\">\r\n            {{ $t('premFormula.uploadRateTable') }}\r\n          </el-button>\r\n        </el-button-group>\r\n      </el-row>\r\n\r\n      <cus-table-title :label=\"$t('premFormula.rateTable')\"/>\r\n      <el-table ref=\"tableDataFormulaParams\" :data=\"tableDataFormulaParams\" border element-loading-text=\"Loading\" fit\r\n                highlight-current-row max-height=\"300\" size=\"mini\">\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\"></el-table-column>\r\n        <el-table-column v-for=\"item in dataGet.paramArr\" :label=\"item.prop\" :prop=\"item.column\" align=\"center\">\r\n          <template v-slot=\"scope\">\r\n            <el-input v-if=\"item.commandType === 'String' || item.commandType === 'RESULT'\"\r\n                      v-model=\"scope.row[item.column]\"></el-input>\r\n            <el-input-number v-if=\"item.commandType === 'Number' || item.commandType === 'Int'\"\r\n                             v-model=\"scope.row[item.column]\"\r\n                             style=\"width: 100%\"></el-input-number>\r\n            <el-select v-if=\"item.commandType === 'select'\" v-model=\"scope.row[item.column]\">\r\n              <el-option v-for=\"option in item.options\" :label=\"option.label\" :value=\"option.value\"></el-option>\r\n            </el-select>\r\n            <el-select v-if=\"item.commandType === 'multiple'\" v-model=\"scope.row[item.column]\" multiple>\r\n              <el-option v-for=\"option in item.options\" :label=\"option.label\" :value=\"option.value\"></el-option>\r\n            </el-select>\r\n            <el-date-picker v-if=\"item.commandType === 'Date'\" v-model=\"scope.row[item.column]\"\r\n                            :placeholder=\"$t('dynamicTable.selectDate')\" type=\"date\"\r\n                            value-format=\"yyyy-MM-dd\"></el-date-picker>\r\n            <el-button v-if=\"item.commandType === 'RULEID'\" size=\"mini\">{{ $t('route.multilingual_information') }}\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.actions')\" :width=\"tableDataFormulaParams.length > 0 ? 150 : undefined\"\r\n                         align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"mini\" type=\"danger\" @click=\"deleteFormulaParam(scope.row)\">-</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-button size=\"mini\" type=\"primary\" @click=\"addDataRow\">+</el-button>\r\n      <el-form>\r\n        <el-form-item style=\"text-align: right\">\r\n          <el-button icon=\"el-icon-success\" size=\"small\" type=\"primary\" @click=\"saveFormulaParam\">\r\n            {{ $t('pdtempPdClmBnft.save') }}\r\n          </el-button>\r\n          <el-button icon=\"el-icon-refresh\" size=\"small\" type=\"primary\" @click=\"refreshFormulaParam\">\r\n            {{ $t('pdtempPdClmBnft.clean') }}\r\n          </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <!--  -->\r\n    <div\r\n      v-if=\"!productCalcRevisionShowINfo_ || productCalcRevisionShowINfo_ && (Object.keys(selectedPremiumInRev).length > 0 || Object.keys(selectedExtPremiumInRev).length > 0)\">\r\n      <cus-form-title v-if=\"!productCalcRevisionShowINfo_\" :first=\"true\"\r\n                      :label=\"pdUwSiTypeDtOptions?$t('premFormula.selectableExtPremFormula'):$t('premFormula.selectablePremFormula')\"\r\n                      style=\"margin-top: 50px\"></cus-form-title>\r\n      <cus-form-title v-if=\"productCalcRevisionShowINfo_\" :first=\"true\"\r\n                      :label=\"revisionType==='extPremium'?$t('premFormula.selectableExtPremFormula'):$t('premFormula.selectablePremFormula')\"\r\n                      style=\"margin-top: 50px\"></cus-form-title>\r\n\r\n      <el-row style=\"text-align: right\">\r\n        <el-button icon=\"el-icon-connection\" size=\"small\" type=\"primary\" @click=\"toFormulaSelect\">\r\n          {{ $t('rule.moreFormula') }}\r\n        </el-button>\r\n        <el-button icon=\"el-icon-circle-plus el-icon--left\" size=\"small\" type=\"primary\" @click=\"toAddFormula\">\r\n          {{ $t('rule.toAddFormula') }}\r\n        </el-button>\r\n      </el-row>\r\n\r\n      <cus-table-title v-if=\"!productCalcRevisionShowINfo_\"\r\n                       :label=\"pdUwSiTypeDtOptions?$t('premFormula.extPremFormula'):$t('premFormula.premFormula')\"></cus-table-title>\r\n      <cus-table-title v-if=\"productCalcRevisionShowINfo_\"\r\n                       :label=\"revisionType==='extPremium'?$t('premFormula.extPremFormula'):$t('premFormula.premFormula')\"></cus-table-title>\r\n      <el-table :data=\"tableDataBriefFormula\" border element-loading-text=\"Loading\" fit highlight-current-row\r\n                size=\"mini\">\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n          <template v-slot=\"scope\">\r\n            {{ initTableIndex('page_brief', scope.$index) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.detail')\" align=\"center\" width=\"80\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"small\" type=\"text\" @click=\"showFormula(scope.row)\">>></el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :filter-method=\"filter_pdCode\" :filters=\"filters_pdCode\" :label=\"$t('rule.product')\"\r\n                         align=\"center\" min-width=\"200\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.pdCode ? scope.row.pdCode + ':' + scope.row.pdName : '' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column v-if=\"calculationFormulaType === '17' || productCalcRevisionShowINfo_\"\r\n                         :label=\"$t('premFormula.premItem')\" align=\"center\" min-width=\"200\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.premiumCode ? scope.row.premiumCode + ':' + scope.row.premiumName : '' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column v-if=\"calculationFormulaType === '19' || revisionType === 'extPremium'\"\r\n                         :label=\"$t('premFormula.extPremItem')\" align=\"center\" min-width=\"200\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.extPremiumCode ? scope.row.extPremiumCode + ':' + scope.row.extPremiumName : '' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdBussDetailType')\" align=\"center\" min-width=\"200\" prop=\"pdBussDetailType\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdBussDetailType | filter_pdBussDetailType }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdCalcCode')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCalcCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdCalcDesc')\" align=\"center\" prop=\"pdCalcDesc\"\r\n                         width=\"120\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" width=\"100\">\r\n          <template v-slot=\"scope\">\r\n            {{\r\n              scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n            }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n          <template v-slot=\"scope\">\r\n            <el-button v-auth=\"'PremAmountFormul:associate'\" icon=\"el-icon-connection\"\r\n                       size=\"mini\" type=\"primary\" @click=\"handleSelectFormula(scope.row)\">\r\n              {{ $t('form.select') }}\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_brief\" v-model=\"tableDataBriefFormula\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_brief\" url=\"/PremAmountFormul/list/briefFormula\"/>\r\n    </div>\r\n\r\n    <!---->\r\n    <el-dialog v-dialog-drag :append-to-body=\"true\" :close-on-click-modal=\"false\" :close-on-press-escape=\"false\"\r\n               :visible.sync=\"underwritingShow\" center width=\"70%\">\r\n      <cus-page-title-back :isDialog=\"true\" :label=\"$t('premFormula.uploadRateTable')\"\r\n                           @backTo=\"underwritingShow = false\"/>\r\n      <el-row>\r\n        <el-button-group>\r\n          <el-button v-auth=\"'pdtemp-pd-cv:downloadCvTable'\" size=\"small\" type=\"primary\" @click=\"downloadCvTable\">\r\n            {{ $t('premFormula.downloadRateTable') }}\r\n          </el-button>\r\n        </el-button-group>\r\n      </el-row>\r\n\r\n      <el-form id=\"uploadForm\" style=\"margin-top: 5px\">\r\n        <el-form-item>\r\n          <el-upload ref=\"upload\" :auto-upload=\"true\" :before-upload=\"handleBeforeUpload\" :file-list=\"fileList\"\r\n                     :on-remove=\"handleRemove\" action=\"url\" class=\"upload-demo\" drag multiple>\r\n            <i class=\"el-icon-upload\"></i>\r\n            <div class=\"el-upload__text\">{{ $t('premFormula.text01') }}</div>\r\n            <div class=\"el-upload__text\">{{ $t('premFormula.text02') }}<em>{{ $t('premFormula.text03') }}</em></div>\r\n            <div slot=\"tip\" class=\"el-upload__tip\">{{ $t('premFormula.text04') }}</div>\r\n          </el-upload>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-dialog>\r\n\r\n    <!--  -->\r\n    <el-dialog v-if=\"formulaSelectVisible\" v-dialog-drag :close-on-click-modal=\"false\"\r\n               :visible.sync=\"formulaSelectVisible\" append-to-body center width=\"70%\">\r\n      <premAmountFormulaSelect :calculationFormulaType=\"productBnftForm.ExpressionType\"\r\n                               :pdUwSiTypeDtOptions=\"productBnftForm.extPrem\"\r\n                               :pdUwSiTypeOptions=\"productBnftForm.prem\" guaranteeDetails=\"1\"\r\n                               @bringInCalcCode=\"bringInCalcCode\"\r\n                               @changeDialogVisible_formulaSelect=\"changeDialogVisible_formulaSelect\"></premAmountFormulaSelect>\r\n    </el-dialog>\r\n\r\n    <!--  -->\r\n    <cus-rule-definition :attributeObj=\"attributeObj\" :ruleDefinitionClosed=\"ruleModuleClosed\"\r\n                         :visible=\"formulaVisible\"></cus-rule-definition>\r\n\r\n    <!--  -->\r\n    <cus-rule-modify :flag=\"formulaView.flag\" :performType=\"formulaView.performType\" :ruleCode=\"formulaView.ruleCode\"\r\n                     :ruleModifyClosed=\"formulaViewClosed\" :ruleType=\"'2'\"\r\n                     :visible=\"formulaView.visible\"></cus-rule-modify>\r\n\r\n  </cus-wraper>\r\n</template>\r\n\r\n<script>\r\n\r\nimport {\r\n  associate,\r\n  deleteFormula,\r\n  findExtPremById,\r\n  getRateInfo,\r\n  saveFormulaInRuleEngine\r\n} from \"@/api/basicinfo/premAmountFormula\"\r\nimport {findPremById} from '@/api/basicinfo/acceptInsuranceRules'\r\nimport XLSX from 'xlsx'\r\nimport {getCalcCode} from \"@/api/basicinfo/pdtemppdprem\"\r\nimport premAmountFormulaSelect\r\n  from \"@/views/product-definition/pd-framework-def/pd-structure-def/payment-def/prem-formula-select\"\r\n\r\nlet _this\r\n\r\nexport default {\r\n\r\n  name: 'premFormula',\r\n  components: {\r\n    premAmountFormulaSelect\r\n  },\r\n  filters: {\r\n    filter_pdBussType(code) {\r\n      return _this.getCodeName('ruleBusinessModule', code)\r\n    },\r\n    filter_pdBussDetailType(code) {\r\n      return _this.getCodeName('ruleBusinessDetailClass', code)\r\n    },\r\n    filter_pdPayEndUnit(code) {\r\n      return _this.getCodeName('pdsbnftdy', code, true)\r\n    },\r\n    filter_calcMethod(code) {\r\n      return _this.getCodeName('pd_prem_cal_method', code)\r\n    },\r\n    filter_payZero(code) {\r\n      return _this.getCodeName('pd_prem_zero', code)\r\n    },\r\n    filter_startCalcRule(code) {\r\n      return _this.getCodeName('pd_prem_start_calc_rule', code)\r\n    },\r\n    filter_startCalcMethod(code) {\r\n      return _this.getCodeName('pd_prem_start_calc_method', code)\r\n    },\r\n    filter_endCalcRule(code) {\r\n      return _this.getCodeName('pd_prem_end_calc_rule', code)\r\n    },\r\n    filter_endCalcMethod(code) {\r\n      return _this.getCodeName('pd_prem_end_calc_method', code)\r\n    },\r\n    filter_pdExtPremObj(code) {\r\n      return _this.getCodeName('pdAddPremObj', code)\r\n    },\r\n    filter_pdExtPremType(code) {\r\n      return _this.getCodeName('pd_prem_addition_type', code)\r\n    },\r\n    filter_pdExtPremMode(code) {\r\n      return _this.getCodeName('pd_prem_addition_addition_mode', code)\r\n    }\r\n  },\r\n  props: {\r\n    // \r\n    guaranteeDetails: {\r\n      type: String,\r\n      default: undefined\r\n    },\r\n    // \r\n    calculationFormulaType: {\r\n      type: String,\r\n      default: undefined\r\n    },\r\n    // \r\n    pdUwSiTypeOptions: {\r\n      type: String,\r\n      default: undefined\r\n    },\r\n    // \r\n    pdUwSiTypeDtOptions: {\r\n      type: String,\r\n      required: false,\r\n      default: undefined\r\n    },\r\n    // \r\n    productCalcRevisionShowINfo: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: false\r\n    }\r\n  },\r\n  data() {\r\n    _this = this\r\n    return {\r\n      productCalcRevisionShowINfo_: false,\r\n      page: undefined,\r\n      pageSize: undefined,\r\n      revisionType: '',\r\n      filters_pdCode: [],\r\n      params_premium: {\r\n        eq_pdInfoId: undefined\r\n      },\r\n      params_extPremium: {\r\n        pdInfoId: undefined\r\n      },\r\n      params_current: {\r\n        eq_pdInfoId: undefined,\r\n        eq_pdBussType: '1',\r\n        eq_pdBussDetailType: '',\r\n        eq_pdStructureType: '',\r\n        eq_pdBussId: '',\r\n        eq_pdType: '1'\r\n      },\r\n      params_brief: {\r\n        product: undefined,\r\n        pdBussId: undefined,\r\n        productDetailType: '',\r\n        pdBussDetailType: this.productCalcRevisionShowINfo_ ? '' : this.calculationFormulaType\r\n      },\r\n      formulaSelectVisible: false,\r\n      formulaVisible: false,\r\n      attributeObj: {},\r\n      formulaView: {\r\n        flag: '',\r\n        ruleCode: '',\r\n        visible: false,\r\n        performType: ''\r\n      },\r\n      language: null,\r\n      ruleMessageInfoBom: [],\r\n      underwritingShow: false,//\r\n      fileList: [],\r\n      url: 'http://localhost:8089/api/pdtemp-pd-file/upLoad',\r\n      productBnftForm: {\r\n        prem: '',\r\n        extPrem: '',\r\n        ExpressionType: ''\r\n      },\r\n      rateForm: {\r\n        vpu: undefined,\r\n        rateEdition: '',\r\n        startDate: undefined,\r\n        endDate: undefined\r\n      },\r\n      rateEditFlag: false,\r\n      variableRateFlag: false,\r\n      tableDataPremium: [],\r\n      tableDataExtPremium: [],\r\n      tableDataFormula: [],\r\n      tableDataBriefFormula: [],\r\n      selectedFormula: {},\r\n      selectedPremiumInRev: {},\r\n      selectedExtPremiumInRev: {},\r\n      tableDataFormulaParams: [],\r\n      showFlag: false,\r\n      Options1: [],//\r\n      Options2: [],//\r\n      product: {\r\n        id: undefined,\r\n        bType: '',\r\n        cType: '',\r\n        pdCode: '',\r\n        pdEdition: '',\r\n        pdVerId: undefined,\r\n        pdSalechnl: '',\r\n        pdName: '',\r\n        pdShortname: '',\r\n        pdEnName: '',\r\n        pdShortEnName: '',\r\n        operator: '',\r\n        pdApplDate: undefined,\r\n        pdProcessId: undefined,\r\n        createTime: undefined,\r\n        updateTime: undefined\r\n      },\r\n      dataGet: {},\r\n      rateFormRules: {\r\n        vpu: [{\r\n          required: true,\r\n          message: this.$t('premFormula.pleaseInputVPU'),\r\n          trigger: 'change'\r\n        }],\r\n        rateEdition: [{\r\n          required: true,\r\n          message: this.$t('premFormula.pleaseInputEdition'),\r\n          trigger: 'change'\r\n        }]\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    tableDataBriefFormula() {\r\n      this.filters_pdCode = []\r\n      for (const item of this.tableDataBriefFormula) {\r\n        if (!this._.includes(this._.map(this.filters_pdCode, 'value'), item.pdCode)) {\r\n          this.filters_pdCode.push({\r\n            text: item.pdCode + ':' + item.pdName,\r\n            value: item.pdCode\r\n          })\r\n        }\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.language = this.$store.state.app.language\r\n    this.ruleMessageInfoBom = this.$store.state.ruleMessage.ruleMessages\r\n    if (this.productCalcRevisionShowINfo_) { // \r\n      if (this.revisionType === 'premium') {\r\n        this.$refs.page_premium.reload()\r\n      } else if (this.revisionType === 'extPremium') {\r\n        this.$refs.page_extPremium.reload()\r\n      }\r\n    } else { // \r\n      this.findPremById(this.product.id)\r\n      this.productBnftForm.prem = this.pdUwSiTypeOptions\r\n      this.productBnftForm.ExpressionType = this.calculationFormulaType\r\n      if (this.pdUwSiTypeDtOptions) {\r\n        this.findExtPremById(this.productBnftForm.prem).then(() => {\r\n          this.productBnftForm.extPrem = this.pdUwSiTypeDtOptions\r\n          this.handleSearch()\r\n        })\r\n      } else {\r\n        this.handleSearch()\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.page = this.$route.query.page\r\n    this.pageSize = this.$route.query.pageSize\r\n    this.revisionType = this.$route.query.revisionType\r\n    // \r\n    if (this.revisionType === 'premium') {\r\n      this.productCalcRevisionShowINfo_ = true\r\n      this.params_brief.pdBussDetailType = '17'\r\n    }\r\n    // \r\n    if (this.revisionType === 'extPremium') {\r\n      this.productCalcRevisionShowINfo_ = true\r\n      this.params_brief.pdBussDetailType = '19'\r\n    }\r\n    this.initProductInfo()\r\n  },\r\n  methods: {\r\n    rateEditFlagChanged(rateEditFlag) {\r\n      this.variableRateFlag = false\r\n      if (false === rateEditFlag) {\r\n        // \r\n        getRateInfo(this.buildRequestData({\r\n          pdPremId: this.productCalcRevisionShowINfo_ ? this.selectedPremiumInRev.id : this.getCaption(this.pdUwSiTypeOptions, 0),\r\n          pdCalcCode: this.productCalcRevisionShowINfo_ ? this.selectedPremiumInRev.pdPremCalcCode : this.selectedFormula.pdCalcCode\r\n        },)).then(response => {\r\n          if (response.data) {\r\n            Object.assign(this.rateForm, response.data)\r\n          } else {\r\n            this.$nextTick(() => {\r\n              this.$refs.rateForm.resetFields()\r\n            })\r\n          }\r\n        })\r\n      }\r\n    },\r\n    showFormula(row) {\r\n      this.formulaView.flag = '1'\r\n      this.formulaView.ruleCode = row.pdCalcCode\r\n      this.formulaView.performType = row.performType\r\n      this.formulaView.visible = true\r\n    },\r\n    filter_pdCode(value, row) {\r\n      return value === row.pdCode\r\n    },\r\n    ruleModuleClosed() {\r\n      this.formulaVisible = false\r\n      if (!this.productCalcRevisionShowINfo_ || this.productCalcRevisionShowINfo_ && (Object.keys(this.selectedPremiumInRev).length > 0 || Object.keys(this.selectedExtPremiumInRev).length > 0)) {\r\n        this.$refs.page_brief.reload()\r\n      }\r\n    },\r\n    formulaViewClosed() {\r\n      this.formulaView.visible = false\r\n      if (!this.showFlag) {\r\n        this.selectedFormula = {}\r\n      }\r\n    },\r\n    //\r\n    findPremById(id) {\r\n      let params = {\r\n        pdInfoId: id,\r\n        pdProgCode: '',\r\n      }\r\n      findPremById(params).then(res => {\r\n        let data = res.data\r\n        this.Options1 = []\r\n        if (data.length) {\r\n          data.forEach(val => {\r\n            this.Options1.push({\r\n              key: val.id,\r\n              value: val.id + \":\" + val.pdPremCode,\r\n              label: val.pdPremCode + \":\" + val.pdPayName\r\n            })\r\n          })\r\n        }\r\n      })\r\n    },\r\n    //\r\n    async findExtPremById(row) {\r\n      return new Promise(resolve => {\r\n        this.productBnftForm.extPrem = ''\r\n        this.Options2 = []\r\n        let code = this.getCaption(row, 1)\r\n        if (!code) {\r\n          return\r\n        }\r\n        findExtPremById(code).then(res => {\r\n          let data = res.data\r\n          this.Options2 = []\r\n          if (data.length) {\r\n            data.forEach(val => {\r\n              this.Options2.push({\r\n                key: val.id,\r\n                value: val.id + \":\" + val.pdExtPremCode,\r\n                label: val.pdExtPremCode + \":\" + val.pdExtPremName\r\n              })\r\n            })\r\n          }\r\n          resolve()\r\n        })\r\n      })\r\n    },\r\n    selectedPremiumChanged(val) {\r\n      if (this.productCalcRevisionShowINfo_) { // \r\n        this.productBnftForm.extPrem = ''\r\n        this.Options2 = []\r\n        if (val) {\r\n          this.findExtPremById(val)\r\n        }\r\n      } else { // \r\n        if (this.pdUwSiTypeDtOptions) {\r\n          this.productBnftForm.extPrem = ''\r\n          this.Options2 = []\r\n          if (val) {\r\n            this.findExtPremById(val)\r\n          }\r\n        } else {\r\n          if (val) {\r\n            this.handleSearch()\r\n          }\r\n        }\r\n      }\r\n    },\r\n    selectedExtPremiumChanged(val) {\r\n      val && this.handleSearch()\r\n    },\r\n    handleSearch() {\r\n      this.params_current.eq_pdInfoId = this.product.id\r\n      this.params_current.eq_pdBussType = '1'\r\n      this.params_current.eq_pdType = '1'\r\n      if (this.productCalcRevisionShowINfo_) {\r\n        if (this.revisionType === 'premium') {\r\n          this.params_current.eq_pdBussDetailType = '17'\r\n          this.params_current.eq_pdStructureType = '05'\r\n          this.params_current.eq_pdBussId = this.selectedPremiumInRev.id\r\n        } else if (this.revisionType === 'extPremium') {\r\n          this.params_current.eq_pdBussDetailType = '19'\r\n          this.params_current.eq_pdStructureType = '06'\r\n          this.params_current.eq_pdBussId = this.selectedExtPremiumInRev.id\r\n        }\r\n      } else {\r\n        if (this.productBnftForm.extPrem) {\r\n          this.params_current.eq_pdBussDetailType = '19'\r\n          this.params_current.eq_pdStructureType = '06'\r\n          this.params_current.eq_pdBussId = this.getCaption(this.productBnftForm.extPrem, 0)\r\n        } else if (this.productBnftForm.prem) {\r\n          this.params_current.eq_pdBussDetailType = '17'\r\n          this.params_current.eq_pdStructureType = '05'\r\n          this.params_current.eq_pdBussId = this.getCaption(this.productBnftForm.prem, 0)\r\n        }\r\n      }\r\n      this.$refs.page_current.reload().then(() => {\r\n        if ((this.calculationFormulaType === '17' || this.revisionType === 'premium') && this.tableDataFormula.length === 1 && this.tableDataFormula[0].dataGet) {\r\n          this.selectedFormula = this.tableDataFormula[0]\r\n          this.selectedFormulaChanged()\r\n        }\r\n      })\r\n    },\r\n    initProductInfo() {\r\n      let pdtempPdInfo = this.getPdData()\r\n      if (Object.keys(pdtempPdInfo).length > 0) {\r\n        Object.assign(this.product, pdtempPdInfo)\r\n        this.params_brief.product = pdtempPdInfo\r\n        this.params_brief.pdBussId = this.productCalcRevisionShowINfo_ ? undefined : (this.calculationFormulaType === '17' ? this.getCaption(this.pdUwSiTypeOptions, 0) : this.getCaption(this.pdUwSiTypeDtOptions, 0))\r\n        this.params_premium.eq_pdInfoId = pdtempPdInfo.id\r\n        this.params_extPremium.pdInfoId = pdtempPdInfo.id\r\n        this.params_brief.productDetailType = this.product.cType\r\n        if (!this.productCalcRevisionShowINfo_) {\r\n          this.$nextTick(() => {\r\n            this.$refs.page_brief.reload()\r\n          })\r\n        }\r\n      } else {\r\n        this.notifyError(this.$t('message.invalidProductInfo'))\r\n      }\r\n    },\r\n    backToPremDef() {\r\n      this.$emit('changeDialogVisible_formula', false)\r\n    },\r\n    backToFormulaRev() {\r\n      this.$router.push({name: '', params: {path: this.$route.path, page: this.page, pageSize: this.pageSize}})\r\n    },\r\n    toFormulaSelect() {\r\n      if (this.productCalcRevisionShowINfo_) { // \r\n        if (this.revisionType === 'premium') {\r\n          if (Object.keys(this.selectedPremiumInRev).length === 0) {\r\n            this.notifyError(this.$t('premFormula.pleaseSelectPremium'))\r\n            return\r\n          } else {\r\n            this.productBnftForm.ExpressionType = '17'\r\n            this.productBnftForm.prem = this.selectedPremiumInRev.id + ':' + this.selectedPremiumInRev.pdPremCode\r\n            this.productBnftForm.extPrem = ''\r\n          }\r\n        } else if (this.revisionType === 'extPremium') {\r\n          if (Object.keys(this.selectedExtPremiumInRev).length === 0) {\r\n            this.notifyError(this.$t('premFormula.pleaseSelectExtPremium'))\r\n            return\r\n          } else {\r\n            this.productBnftForm.ExpressionType = '19'\r\n            this.productBnftForm.prem = ''\r\n            this.productBnftForm.extPrem = this.selectedExtPremiumInRev.id + ':' + this.selectedExtPremiumInRev.pdExtPremCode\r\n          }\r\n        }\r\n      } else { // \r\n        if (this.pdUwSiTypeDtOptions) {\r\n          if (!this.productBnftForm.extPrem || !this.productBnftForm.prem) {\r\n            this.notifyError(this.$t('premFormula.pleaseSelectPremiumAndEctPremium'))\r\n            return\r\n          }\r\n        } else {\r\n          if (!this.productBnftForm.prem) {\r\n            this.notifyError(this.$t('premFormula.pleaseSelectPremiumAndEctPremium'))\r\n            return\r\n          }\r\n        }\r\n        if (!this.pdUwSiTypeDtOptions) {\r\n          this.productBnftForm.ExpressionType = '17' // \r\n        } else {\r\n          this.productBnftForm.ExpressionType = '19' // \r\n        }\r\n      }\r\n      if (this.revisionType === 'extPremium') {\r\n        this.formulaSelectVisible = true\r\n      } else {\r\n        this.$emit('changeDialogVisible_formulaSelect', true, '1', this.productBnftForm.ExpressionType,\r\n          this.productBnftForm.prem, this.productBnftForm.extPrem)\r\n      }\r\n    },\r\n    // \r\n    changeDialogVisible_formulaSelect(flag) {\r\n      this.formulaSelectVisible = flag\r\n      this.$refs.page_current.reload()\r\n      this.$refs.page_brief.reload()\r\n    },\r\n    bringInCalcCode(pdBussDetailType, pdBussId, pdCalcCode) {\r\n      if ('19' === pdBussDetailType) {\r\n        for (const extPremium of this.tableDataExtPremium) {\r\n          if (extPremium.id === pdBussId) {\r\n            this.$set(extPremium, 'pdExtPremCalcCode', pdCalcCode)\r\n            break\r\n          }\r\n        }\r\n      } else if ('17' === pdBussDetailType) {\r\n        for (const premium of this.tableDataPremium) {\r\n          if (premium.id === pdBussId) {\r\n            this.$set(premium, 'pdPremCalcCode', pdCalcCode)\r\n            break\r\n          }\r\n        }\r\n      }\r\n    },\r\n    toAddFormula() {\r\n      const param = {\r\n        pdBussType: this.productCalcRevisionShowINfo_ ? '1' : this.guaranteeDetails,\r\n        pdBussDetailType: this.productCalcRevisionShowINfo_ ? (this.revisionType === 'premium' ? '17' : '19') : this.calculationFormulaType\r\n      }\r\n      getCalcCode(this.buildRequestData(param)).then(response => {\r\n        this.attributeObj = {\r\n          code: response.data,\r\n          ruleBussModu: param.pdBussType,\r\n          ruleBussModuDeta: param.pdBussDetailType,\r\n          ruleType: '2',\r\n          pdType: '1',\r\n          riskType: this.product.bType,\r\n          riskDetail: this.product.cType,\r\n          pdCode: this.product.pdCode,\r\n          pdEdition: this.product.pdEdition\r\n        }\r\n        this.formulaVisible = true\r\n      })\r\n    },\r\n    rowClick(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (row.id === this.selectedFormula.id) {\r\n          this.selectedFormula = {}\r\n          this.tableDataFormulaParams = []\r\n          this.resetRateForm()\r\n          this.showFlag = false\r\n        }\r\n      }\r\n    },\r\n    rowClickPremium(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (row.id === this.selectedPremiumInRev.id) {\r\n          this.selectedPremiumInRev = {}\r\n          this.params_brief.pdBussId = undefined\r\n          this.tableDataFormula = []\r\n          this.$refs.page_current.total = 0\r\n          this.$refs.page_current.page = 1\r\n          this.tableDataBriefFormula = []\r\n          this.$refs.page_brief.total = 0\r\n          this.$refs.page_brief.page = 1\r\n          this.selectedFormula = {}\r\n          this.tableDataFormulaParams = []\r\n          this.resetRateForm()\r\n          this.showFlag = false\r\n        }\r\n      }\r\n    },\r\n    rowClickExtPremium(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (row.id === this.selectedExtPremiumInRev.id) {\r\n          this.selectedExtPremiumInRev = {}\r\n          this.params_brief.pdBussId = undefined\r\n          this.tableDataFormula = []\r\n          this.$refs.page_current.total = 0\r\n          this.$refs.page_current.page = 1\r\n          this.tableDataBriefFormula = []\r\n          this.$refs.page_brief.total = 0\r\n          this.$refs.page_brief.page = 1\r\n          this.selectedFormula = {}\r\n        }\r\n      }\r\n    },\r\n    resetRateForm() {\r\n      this.rateForm = {\r\n        vpu: undefined,\r\n        rateEdition: '',\r\n        startDate: undefined,\r\n        endDate: undefined\r\n      }\r\n      this.$nextTick(() => {\r\n        if (this.$refs.rateForm) {\r\n          this.$refs.rateForm.clearValidate()\r\n        }\r\n      })\r\n    },\r\n    selectedFormulaChanged() {\r\n      if (this.calculationFormulaType === '17' || this.revisionType === 'premium') {\r\n        this.rateEditFlag = false\r\n        this.variableRateFlag = false\r\n        this.tableDataFormulaParams = []\r\n        if (!this.selectedFormula.dataGet) {\r\n          this.formulaView.flag = this.selectedFormula.ruleAttr === '1' ? '1' : '2'\r\n          this.formulaView.ruleCode = this.selectedFormula.pdCalcCode\r\n          this.formulaView.performType = this.selectedFormula.performType\r\n          this.formulaView.visible = true\r\n          return\r\n        }\r\n        this.dataGet = JSON.parse(this.selectedFormula.dataGet)\r\n        this.tableDataFormulaParams = this.dataGet.paramList\r\n        // \r\n        getRateInfo(this.buildRequestData({\r\n          pdPremId: this.productCalcRevisionShowINfo_ ? this.selectedPremiumInRev.id : this.getCaption(this.pdUwSiTypeOptions, 0),\r\n          pdCalcCode: this.productCalcRevisionShowINfo_ ? this.selectedPremiumInRev.pdPremCalcCode : this.selectedFormula.pdCalcCode\r\n        })).then(response => {\r\n          this.showFlag = true\r\n          if (response.data) {\r\n            Object.assign(this.rateForm, response.data)\r\n          } else {\r\n            this.$nextTick(() => {\r\n              this.$refs.rateForm.resetFields()\r\n            })\r\n          }\r\n        })\r\n      } else {\r\n        this.formulaView.flag = this.selectedFormula.ruleAttr === '1' ? '1' : '2'\r\n        this.formulaView.ruleCode = this.selectedFormula.pdCalcCode\r\n        this.formulaView.performType = this.selectedFormula.performType\r\n        this.formulaView.visible = true\r\n      }\r\n    },\r\n    initTableDataInRev() {\r\n      this.handleSearch()\r\n      this.$refs.page_brief.reload()\r\n    },\r\n    selectedPremiumInRevChanged() {\r\n      this.selectedFormula = {}\r\n      this.tableDataFormulaParams = []\r\n      this.resetRateForm()\r\n      this.showFlag = false\r\n      this.handleSearch()\r\n      this.params_brief.pdBussId = this.selectedPremiumInRev.id\r\n      this.$refs.page_brief.reload()\r\n    },\r\n    selectedExtPremiumInRevChanged() {\r\n      this.selectedFormula = {}\r\n      this.handleSearch()\r\n      this.params_brief.pdBussId = this.selectedExtPremiumInRev.id\r\n      this.$refs.page_brief.reload()\r\n    },\r\n    deleteFormula(row) {\r\n      deleteFormula(row).then(() => {\r\n        this.notifySuccess(this.$t('successMessage.delete'))\r\n        this.handleSearch()\r\n        this.$refs.page_brief.reload()\r\n        if (!this.productCalcRevisionShowINfo_) {\r\n          this.$emit('bringInCalcCode', row.pdBussDetailType, row.pdBussId, undefined)\r\n        } else {\r\n          this.bringInCalcCode(row.pdBussDetailType, row.pdBussId, undefined)\r\n        }\r\n        this.showFlag = false\r\n      })\r\n    },\r\n    getCaption(obj, state) {\r\n      const index = obj.lastIndexOf(\":\")\r\n      if (state === 0) {\r\n        return obj.substring(0, index)\r\n      } else {\r\n        return obj.substring(index + 1, obj.length)\r\n      }\r\n    },\r\n    handleBeforeUpload(file) {\r\n      this.$confirm(String(this.$t('premFormula.text05')), String(this.$t('confirmMessage.tip')), {\r\n        confirmButtonText: this.$t('confirmMessage.confirm'),\r\n        cancelButtonText: this.$t('confirmMessage.cancel'),\r\n        type: 'warning'\r\n      }).then(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: String(this.$t('premFormula.continue'))\r\n        })\r\n        this.fileList = []\r\n        this.fileList.push(file)\r\n        let files = {0: file}\r\n        this.readExcel(files)\r\n        return true\r\n      }).catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: String(this.$t('premFormula.canceled'))\r\n        })\r\n        return false\r\n      })\r\n      return false\r\n    },\r\n    handleRemove(file, fileList) {\r\n      this.fileList = fileList\r\n    },\r\n    //\r\n    downloadCvTable() {\r\n      if (Object.keys(this.selectedFormula).length === 0) {\r\n        this.notifyError(this.$t('premFormula.pleaseSelectFormula'))\r\n        return\r\n      }\r\n      let columns = []\r\n      for (const param of this.dataGet.paramArr) {\r\n        columns.push({\r\n          title: param.prop,\r\n          key: param.column\r\n        })\r\n      }\r\n      // \r\n      let columnArr = this._.map(columns, 'key')\r\n      for (const param of this.tableDataFormulaParams) {\r\n        for (const column of columnArr) {\r\n          let commandType = this.getCommandTypeByColumn(column)\r\n          if (commandType === 'Date') {\r\n            this.$set(param, column, this.formatDate(new Date(param[column]), 'yyyy-MM-dd'))\r\n          }\r\n        }\r\n      }\r\n      this.export2Excel(columns, this.tableDataFormulaParams, this.$t('premFormula.rateTable') + '_' + this.formatDate(new Date(), 'yyyy-MM-dd hh:mm:ss'))\r\n    },\r\n    getCommandTypeByColumn(column) {\r\n      for (const paramArrElement of this.dataGet.paramArr) {\r\n        if (paramArrElement.column === column) {\r\n          return paramArrElement.commandType\r\n        }\r\n      }\r\n      return undefined\r\n    },\r\n    readExcel(files) {//\r\n      if (files.length <= 0) {//\r\n        return false\r\n      } else if (!/\\.(xls|xlsx)$/.test(files[0].name.toLowerCase())) {\r\n        this.$message.error(String(this.$t('premFormula.incorrectFormat')))\r\n        return false\r\n      }\r\n      const fileReader = new FileReader()\r\n      fileReader.onload = (ev) => {\r\n        try {\r\n          const data = ev.target.result\r\n          const workbook = XLSX.read(data, {\r\n            type: 'binary'\r\n          })\r\n          const wsname = workbook.SheetNames[0]//\r\n          const ws = XLSX.utils.sheet_to_json(workbook.Sheets[wsname])//json\r\n          //\r\n          try {\r\n          } catch (err) {\r\n            console.log(err)\r\n          }\r\n          this.$refs.upload.value = ''\r\n        } catch (e) {\r\n          return false\r\n        }\r\n      }\r\n      fileReader.readAsBinaryString(files[0])\r\n      //\r\n      fileReader.onload = function (evt) {\r\n        if (evt.target.readyState === FileReader.DONE) {\r\n          const data = fileReader.result\r\n          var workbook = XLSX.read(data, {type: 'binary'})\r\n        }\r\n        const sheet_name_list = workbook.SheetNames\r\n        const result = XLSX.utils.sheet_to_json(workbook.Sheets[sheet_name_list[0]], {header: 1})\r\n        _this.tableDataFormulaParams = []\r\n        let keyArray = []\r\n        for (let i = 0; i < result[0].length; i++) {\r\n          let propName = result[0][i]\r\n          for (const paramArrElement of _this.dataGet.paramArr) {\r\n            if (propName === paramArrElement.prop) {\r\n              let key = paramArrElement.column\r\n              keyArray.push(key)\r\n              break\r\n            }\r\n          }\r\n        }\r\n        for (let i = 0; i < result.length; i++) {\r\n          if (i > 0) {\r\n            let dataItem = {}\r\n            for (let j = 0; j < result[i].length; j++) {\r\n              let value = result[i][j]\r\n              if ('multiple' === _this.dataGet.paramArr[j].commandType) {\r\n                value = value.split(',')\r\n                for (let i = 0; i < value.length; i++) {\r\n                  _this.$set(value, i, String(value[i]).trim())\r\n                }\r\n              }\r\n              _this.$set(dataItem, keyArray[j], value)\r\n            }\r\n            _this.$set(_this.tableDataFormulaParams, i - 1, dataItem)\r\n          }\r\n        }\r\n      }\r\n    },\r\n    deleteFormulaParam(row) {\r\n      this.tableDataFormulaParams.splice(this.tableDataFormulaParams.indexOf(row), 1)\r\n    },\r\n    addDataRow() {\r\n      this.tableDataFormulaParams.push({})\r\n    },\r\n    saveFormulaParam() {\r\n      if (Object.keys(this.selectedFormula).length === 0) {\r\n        this.notifyError(this.$t('pdtempPdUnderwritingAmountFormula.pleaseSelectFormula'))\r\n        return\r\n      }\r\n      this.$refs.rateForm.validate(pass => {\r\n        if (this.rateEditFlag && !pass) {\r\n          this.focusItem()\r\n        } else {\r\n          this.$refs.rateForm.clearValidate()\r\n          this.$set(this.dataGet, 'paramList', this.tableDataFormulaParams)\r\n          const param = {\r\n            ruleCode: this.productCalcRevisionShowINfo_ ? this.selectedPremiumInRev.pdPremCalcCode : this.selectedFormula.pdCalcCode,\r\n            dynamicTable: JSON.stringify(this.dataGet),\r\n            rateForm: this.rateForm,\r\n            pdPremId: this.productCalcRevisionShowINfo_ ? this.selectedPremiumInRev.id : this.getCaption(this.pdUwSiTypeOptions, 0),\r\n            rateEditFlag: this.rateEditFlag\r\n          }\r\n          saveFormulaInRuleEngine(this.buildRequestData(param)).then(() => {\r\n            this.notifySuccess(this.$t('successMessage.save'))\r\n            this.$set(this.selectedFormula, 'dataGet', JSON.stringify(this.dataGet))\r\n            this.rateEditFlag = false\r\n            this.variableRateFlag = false\r\n          })\r\n        }\r\n      })\r\n    },\r\n    refreshFormulaParam() {\r\n      this.selectedFormulaChanged()\r\n    },\r\n    handleSelectFormula(row) {\r\n      if (this.revisionType === 'premium' && Object.keys(this.selectedPremiumInRev).length === 0) {\r\n        this.notifyError(this.$t('premFormula.pleaseSelectPremium'))\r\n        return\r\n      }\r\n      if (this.revisionType === 'extPremium' && Object.keys(this.selectedExtPremiumInRev).length === 0) {\r\n        this.notifyError(this.$t('premFormula.pleaseSelectExtPremium'))\r\n        return\r\n      }\r\n      let PdtempPdCalc = {\r\n        pdInfoId: this.product.id,\r\n        pdVerId: this.product.pdVerId,\r\n        pdType: '',\r\n        pdCode: this.product.pdCode,\r\n        pdBussType: '1',\r\n        pdBussDetailType: this.productCalcRevisionShowINfo_ ? (this.revisionType === 'premium' ? '17' : '19') : this.calculationFormulaType,\r\n        pdBussId: '',\r\n        pdBussCode: '',\r\n        pdStructureType: '',\r\n        pdCalcCode: row.pdCalcCode,\r\n        pdCalcDesc: row.pdCalcDesc\r\n      }\r\n      if (this.productCalcRevisionShowINfo_) { // \r\n        if (this.revisionType === 'premium') {\r\n          PdtempPdCalc.pdStructureType = '05'\r\n          PdtempPdCalc.pdBussId = this.selectedPremiumInRev.id\r\n          PdtempPdCalc.pdBussCode = this.selectedPremiumInRev.pdPremCode\r\n        } else {\r\n          PdtempPdCalc.pdStructureType = '06'\r\n          PdtempPdCalc.pdBussId = this.selectedExtPremiumInRev.id\r\n          PdtempPdCalc.pdBussCode = this.selectedExtPremiumInRev.pdExtPremCode\r\n        }\r\n      } else { // \r\n        if (this.productBnftForm.extPrem) {\r\n          PdtempPdCalc.pdStructureType = '06'\r\n          PdtempPdCalc.pdBussId = this.getCaption(this.productBnftForm.extPrem, 0)\r\n          PdtempPdCalc.pdBussCode = this.getCaption(this.productBnftForm.extPrem, 1)\r\n        } else {\r\n          PdtempPdCalc.pdStructureType = '05'\r\n          PdtempPdCalc.pdBussId = this.getCaption(this.productBnftForm.prem, 0)\r\n          PdtempPdCalc.pdBussCode = this.getCaption(this.productBnftForm.prem, 1)\r\n        }\r\n      }\r\n      const param = {\r\n        selectedFormula: row,\r\n        pdtempPdCalc: PdtempPdCalc,\r\n        product: this.product,\r\n        pdBussType: '1',\r\n        pdBussDetailType: PdtempPdCalc.pdBussDetailType,\r\n        needChecking: true\r\n      }\r\n      associate(this.buildRequestData(param)).then(response => {\r\n        let successFlag = response.data.flag\r\n        let pdtempPdCalc = response.data.pdtempPdCalc\r\n        if (successFlag === true) {\r\n          this.notifySuccess(this.$t('rule.associationSuccess'))\r\n          this.handleSearch()\r\n          this.$refs.page_brief.reload()\r\n          if (!this.productCalcRevisionShowINfo_) {\r\n            this.$emit('bringInCalcCode', pdtempPdCalc.pdBussDetailType, pdtempPdCalc.pdBussId, pdtempPdCalc.pdCalcCode)\r\n          } else {\r\n            this.bringInCalcCode(PdtempPdCalc.pdBussDetailType, pdtempPdCalc.pdBussId, pdtempPdCalc.pdCalcCode)\r\n          }\r\n        } else {\r\n          this.$confirm(String(this.$t('underwritingAmountFormulaSelect.confirm_overwrite_formula')), String(this.$t('confirmMessage.tip')), {\r\n            confirmButtonText: String(this.$t('confirmMessage.confirm')),\r\n            cancelButtonText: String(this.$t('confirmMessage.cancel')),\r\n            type: 'warning'\r\n          }).then(() => {\r\n            param.needChecking = false\r\n            associate(this.buildRequestData(param)).then(response => {\r\n              let pdtempPdCalc = response.data.pdtempPdCalc\r\n              this.notifySuccess(this.$t('rule.associationSuccess'))\r\n              this.handleSearch()\r\n              this.$refs.page_brief.reload()\r\n              if (!this.productCalcRevisionShowINfo_) {\r\n                this.$emit('bringInCalcCode', pdtempPdCalc.pdBussDetailType, pdtempPdCalc.pdBussId, pdtempPdCalc.pdCalcCode)\r\n              } else {\r\n                this.bringInCalcCode(PdtempPdCalc.pdBussDetailType, pdtempPdCalc.pdBussId, pdtempPdCalc.pdCalcCode)\r\n              }\r\n            })\r\n          }).catch(() => {\r\n            this.messageInfo(this.$t('underwritingAmountFormulaSelect.canceled'))\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n</style>\r\n"]}]}