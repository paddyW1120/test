{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-package-definition\\pp-operation-def\\pp-sales-def\\sale-attr-def\\index.vue?vue&type=style&index=0&id=7ab38f4c&lang=scss&scoped=true&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-package-definition\\pp-operation-def\\pp-sales-def\\sale-attr-def\\index.vue","mtime":1609847107044},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1706753188288},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1706753191924},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1706753189537},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1706753187424},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouc2hvd0RpdiB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIG1hcmdpbi10b3A6IC00MHB4OwogIG1hcmdpbi1sZWZ0OiAtNDBweDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYmFja2dyb3VuZDogI2ZmZmZmZjAwOwogIHotaW5kZXg6IDk5OTsKfQoK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6lBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-package-definition/pp-operation-def/pp-sales-def/sale-attr-def","sourcesContent":["<template>\r\n  <cus-wraper>\r\n    <div :class=\"{ 'showDiv': this.showPageFlag == 1 }\"></div>\r\n    <!-- 产品套餐销售属性表格 -->\r\n    <cus-table-title :label=\"$t('saleAttributeDefinition.product_sales_attribute_information')\"></cus-table-title>\r\n    <el-table :data=\"tableData_sale\"  ref=\"multipleTable\" @selection-change=\"checkSaleAttributeTable\" border element-loading-text=\"Loading\" fit size=\"mini\">\r\n      <el-table-column :label=\"$t('productValueAddedTax.select')\" type=\"selection\" align=\"center\" width=\"50px\"></el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\"></el-table-column>\r\n      <el-table-column :label=\"$t('saleAttributeDefinition.pdSlMgc')\" align=\"center\" prop=\"pdSlMgc\" :filter-method=\"filterHandler\" :filters=\"pdSlMgcFilters\">\r\n        <template v-slot=\"scope\">{{scope.row.pdSlMgc | filter_pdSlMgc}}</template>\r\n      </el-table-column>\r\n      <el-table-column  :filter-method=\"filterHandler\" :filters=\"pdSlChanlFilters\"\r\n                       :label=\"$t('saleAttributeDefinition.pdSlChanl')\" align=\"center\" prop=\"pdSlChanl\">\r\n        <template v-slot=\"scope\">{{scope.row.pdSlChanl | filter_pdSlChanl}}</template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('saleAttributeDefinition.pdSlCurr')\" align=\"center\" prop=\"pdSlCurr\">\r\n        <template v-slot=\"scope\">{{scope.row.pdSlCurr | filter_pdSlCurr}}</template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('saleAttributeDefinition.pdSlState')\" align=\"center\" prop=\"pdSlState\">\r\n        <template v-slot=\"scope\">{{scope.row.pdSlState | filter_pdSlState}}</template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('saleAttributeDefinition.pdSlStartDate')\" align=\"center\"\r\n                       prop=\"pdSlStartDate\"></el-table-column>\r\n      <el-table-column :label=\"$t('saleAttributeDefinition.pdSlEndDate')\" align=\"center\"\r\n                       prop=\"pdSlEndDate\"></el-table-column>\r\n    </el-table>\r\n    <!-- 分页 -->\r\n    <cus-pagination :autoBuild=\"false\" :pageSize=\"10\" :params=\"params_sale\" ref=\"page_sale\"\r\n                    url=\"/pd-package-sale-def/base/list\" v-model=\"tableData_sale\"/>\r\n    <el-row v-if=\"this.checkSaleAttribute.length>1\" style=\"float: right\">\r\n      <el-button  size=\"small\"  @click=\"deleteMoreTax\" v-auth=\"'pdtemp-pd-value-added-tax:delete'\" icon=\"el-icon-delete\" type=\"danger\" dialog-disable=\"disable\">{{$t('table.delete')}}</el-button>\r\n    </el-row>\r\n    <div v-if=\"this.checkSaleAttribute.length<2\" >\r\n    <!-- 产品销售基本信息表单（新增） -->\r\n    <el-form :model=\"form_sale\" :rules=\"rules\" label-position=\"right\" label-width=\"118px\"\r\n             ref=\"form_sale\" style=\"margin: 50px 0 0 0\" v-show=\"this.checkSaleAttribute.length=='0'\">\r\n      <cus-row :gutter=\"10\">\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlMgc')\" prop=\"pdSlMgc\">\r\n            <el-select :placeholder=\"$t('form.please_select')\" clearable filterable multiple\r\n                       v-model=\"form_sale.pdSlMgc\">\r\n              <el-option :disabled=\"pdSlMgc.disabled\" :key=\"pdSlMgc.slMgcCode\"\r\n                         :label=\"pdSlMgc.slMgcCode + ':' + pdSlMgc.slMgcName\"\r\n                         :value=\"pdSlMgc.slMgcCode\" v-for=\"pdSlMgc in pdSlMgcOptions\"></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlChanl')\" prop=\"pdSlChanl\">\r\n            <cus-multi-select :codetype=\"'pdSlChanl'\" :disabledCodeArray=\"pdSlChanlDisabledCodeArray\"\r\n                              v-model=\"form_sale.pdSlChanl\"></cus-multi-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlCurr')\" prop=\"pdSlCurr\">\r\n            <cus-multi-select :codetype=\"'productCurrency'\" v-model=\"form_sale.pdSlCurr\"></cus-multi-select>\r\n          </el-form-item>\r\n        </el-col>\r\n      </cus-row>\r\n      <cus-row :gutter=\"10\">\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlState')\" prop=\"pdSlState\">\r\n            <cus-radio :codetype=\"'pdSlState'\" v-model=\"form_sale.pdSlState\"></cus-radio>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlStartDate')\" prop=\"pdSlStartDate\">\r\n            <el-date-picker :placeholder=\"$t('form.please_select')\" clearable  :disabled=\"form_sale.pdSlState=='N'\"\r\n                            value-format=\"yyyy-MM-dd\"\r\n                            v-model=\"form_sale.pdSlStartDate\" ></el-date-picker>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlEndDate')\" prop=\"pdSlEndDate\">\r\n            <el-date-picker :placeholder=\"$t('form.please_select')\" clearable\r\n                            value-format=\"yyyy-MM-dd\"\r\n                            v-model=\"form_sale.pdSlEndDate\" ></el-date-picker>\r\n          </el-form-item>\r\n        </el-col>\r\n      </cus-row>\r\n    </el-form>\r\n    <!-- 产品销售基本信息表单（修改） -->\r\n    <el-form  :model=\"form_sale_update\" :rules=\"rules\" label-position=\"right\" label-width=\"118px\"\r\n             ref=\"form_sale_update\" style=\"margin: 50px 0 0 0\" v-show=\"this.checkSaleAttribute.length=='1'\">\r\n      <cus-row :gutter=\"10\">\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlMgc')\" prop=\"pdSlMgc\">\r\n            <el-select :placeholder=\"$t('form.please_select')\" clearable filterable v-model=\"form_sale_update.pdSlMgc\">\r\n              <el-option :disabled=\"pdSlMgc.disabled\" :key=\"pdSlMgc.slMgcCode\"\r\n                         :label=\"pdSlMgc.slMgcCode + ':' + pdSlMgc.slMgcName\" :value=\"pdSlMgc.slMgcCode\"\r\n                         v-for=\"pdSlMgc in pdSlMgcOptions\"></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlChanl')\" prop=\"pdSlChanl\">\r\n            <cus-select :codetype=\"'pdSlChanl'\" :disabledCodeArray=\"pdSlChanlDisabledCodeArray\"\r\n                        v-model=\"form_sale_update.pdSlChanl\"></cus-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlCurr')\" prop=\"pdSlCurr\">\r\n            <cus-select :codetype=\"'productCurrency'\" v-model=\"form_sale_update.pdSlCurr\"></cus-select>\r\n          </el-form-item>\r\n        </el-col>\r\n      </cus-row>\r\n      <cus-row :gutter=\"10\">\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlState')\" prop=\"pdSlState\">\r\n            <cus-radio :codetype=\"'pdSlState'\" v-model=\"form_sale_update.pdSlState\"></cus-radio>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlStartDate')\" prop=\"pdSlStartDate\">\r\n            <el-date-picker :placeholder=\"$t('form.please_select')\" clearable  :disabled=\"form_sale_update.pdSlState=='N'\"\r\n                            value-format=\"yyyy-MM-dd\"\r\n                            v-model=\"form_sale_update.pdSlStartDate\" ></el-date-picker>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"7\">\r\n          <el-form-item :label=\"$t('saleAttributeDefinition.pdSlEndDate')\" prop=\"pdSlEndDate\">\r\n            <el-date-picker :placeholder=\"$t('form.please_select')\" clearable\r\n                            value-format=\"yyyy-MM-dd\"\r\n                            v-model=\"form_sale_update.pdSlEndDate\" ></el-date-picker>\r\n          </el-form-item>\r\n        </el-col>\r\n      </cus-row>\r\n    </el-form>\r\n    <!--按钮 -->\r\n    <el-row style=\"float: right;margin: 50px 0 50px 0\">\r\n      <el-button  size=\"small\" @click=\"handleAdd\" icon=\"el-icon-success\" v-auth=\"'pd-package-sale-def:add'\" dialog-disable=\"disable\"\r\n                 type=\"primary\" v-if=\"this.checkSaleAttribute.length=='0'\">{{ $t('saleAttributeDefinition.save') }}</el-button>\r\n      <el-button  size=\"small\" @click=\"handleUpdate\"  type=\"primary\" v-auth=\"'pd-package-sale-def:update'\" dialog-disable=\"disable\"\r\n                 icon=\"el-icon-success\" v-if=\"this.checkSaleAttribute.length=='1'\">{{ $t('saleAttributeDefinition.update') }}\r\n      </el-button>\r\n      <el-button  size=\"small\" :content=\"$t('confirmMessage.delete')\" @click=\"handleDelete\" icon=\"el-icon-delete\" dialog-disable=\"disable\"\r\n                type=\"danger\" v-auth=\"'pd-package-sale-def:delete'\" v-if=\"this.checkSaleAttribute.length=='1'\">{{ $t('saleAttributeDefinition.delete')}}\r\n      </el-button>\r\n      <el-button  size=\"small\" @click=\"clearForm\" icon=\"el-icon-refresh\" dialog-disable=\"disable\" type=\"primary\">{{ $t('saleAttributeDefinition.refresh') }}</el-button>\r\n    </el-row>\r\n    </div>\r\n  </cus-wraper>\r\n</template>\r\n<script>\r\n\r\n  import {addPdtempPdSlInfo, deletePdtempPdSlInfo, updatePdtempPdSlInfo,updatePdtempPpInfo\r\n    ,getAllSysSlMgc,getPdAttrInfo,queryPdRptInfoByProductId} from \"@/api/basicinfo/saleAttributeDefinition\"\r\n  import {mapGetters} from \"vuex\"\r\n\r\n  let _this\r\n  export default {\r\n    name: 'saleAttributeDefinition',\r\n    filters: {\r\n      filter_pdSlMgc(code) {\r\n        for (const pdSlMgc of _this.pdSlMgcOptions) {\r\n          if (pdSlMgc.slMgcCode === code) {\r\n            return pdSlMgc.slMgcCode + ':' + pdSlMgc.slMgcName\r\n          }\r\n        }\r\n        return code\r\n      },\r\n      filter_pdSlChanl(code) {\r\n        return _this.getCodeName('pdSlChanl', code)\r\n      },\r\n      filter_pdSlCurr(code) {\r\n        return _this.getCodeName('productCurrency', code)\r\n      },\r\n      filter_pdSlState(code) {\r\n        return _this.getCodeName('pdSlState', code)\r\n      }\r\n    },\r\n    data() {\r\n      _this = this\r\n      const validateEndDate = (rule, value, callback) => {\r\n        if (typeof value === 'string') {\r\n          value = this.parse(value, 'yyyy-MM-dd')\r\n        }\r\n        if (typeof this.form_sale_init.pdSlEndDate === 'string') {\r\n          this.form_sale_init.pdSlEndDate = this.parse(this.form_sale_init.pdSlEndDate, 'yyyy-MM-dd')\r\n        }\r\n        if (typeof this.form_sale.pdSlStartDate === 'string') {\r\n          this.form_sale.pdSlStartDate = this.parse(this.form_sale.pdSlStartDate, 'yyyy-MM-dd')\r\n        }\r\n        if (this.form_sale_init.pdSlEndDate && value.getTime() > this.form_sale_init.pdSlEndDate.getTime()) {\r\n          callback(new Error(this.$t('saleAttributeDefinition.message.tooLate') + '：' + this.formatDate(this.form_sale_init.pdSlEndDate, 'yyyy-MM-dd')))\r\n        } else if (this.form_sale.pdSlStartDate && value.getTime() < this.form_sale.pdSlStartDate.getTime()) {\r\n          callback(new Error(this.$t('saleAttributeDefinition.message.earlierThanStart')))\r\n        }\r\n        callback()\r\n      };\r\n      const validateStartDate = (rule, value, callback) => {\r\n        if (typeof value === 'string') {\r\n          value = this.parse(value, 'yyyy-MM-dd')\r\n        }\r\n        if (typeof this.form_sale_init.pdSlStartDate === 'string') {\r\n          this.form_sale_init.pdSlStartDate = this.parse(this.form_sale_init.pdSlStartDate, 'yyyy-MM-dd')\r\n        }\r\n        if (this.form_sale_init.pdSlStartDate && value.getTime() < this.form_sale_init.pdSlStartDate.getTime()) {\r\n          callback(new Error(this.$t('saleAttributeDefinition.message.tooEarly') + '：' + this.formatDate(this.form_sale_init.pdSlStartDate, 'yyyy-MM-dd')))\r\n        }\r\n        callback()\r\n      };\r\n      return {\r\n        // 产品信息\r\n        product: {\r\n          id: undefined,\r\n          pdVerId:'1',\r\n          pdInfoId:'',\r\n          pdCode:'',\r\n          pdName:''\r\n        },\r\n        //初始化下拉选\r\n        pdSlMgcFilters:[],\r\n        pdSlChanlFilters:[],\r\n        checkSaleAttribute:[],\r\n        product_extra: {},\r\n        showPageFlag:'',\r\n        // 监管对象\r\n        pdtempPdRptInfo: {},\r\n        // 储存带入的数据\r\n        form_sale_init: {\r\n          pdSlMgc: [\"0000\"],\r\n          pdSlChanl: [\"00\"],\r\n          pdSlCurr: [],\r\n          pdSlStartDate: undefined,\r\n          pdSlEndDate: undefined\r\n        },\r\n        // 表单\r\n        form_sale: {\r\n          id: undefined,\r\n          operator: '',\r\n          pdInfoId: undefined,\r\n          pdVerId: undefined,\r\n          pdType: '',\r\n          pdCode: '',\r\n          pdName:'',\r\n          pdSlMgc: [],\r\n          pdSlMgcLev: '',\r\n          pdSlChanl: [],\r\n          pdSlCurr: [],\r\n          pdSlState: 'Y',\r\n          pdSlStartDate: undefined,\r\n          pdSlEndDate: undefined,\r\n          createTime: undefined,\r\n          updateTime: undefined\r\n\r\n        },\r\n        form_sale_update: {\r\n          id: undefined,\r\n          pdInfoId: undefined,\r\n          pdVerId: undefined,\r\n          pdType: '',\r\n          pdCode: '',\r\n          pdName:'',\r\n          pdSlMgc: '',\r\n          pdSlMgcLev: '',\r\n          pdSlChanl: '',\r\n          pdSlCurr: '',\r\n          pdSlState: 'Y',\r\n          pdSlStartDate: undefined,\r\n          pdSlEndDate: undefined,\r\n          createTime: undefined,\r\n          updateTime: undefined,\r\n          operator: ''\r\n        },\r\n        // 表格数据\r\n        tableData_sale: [],\r\n        params_sale: {\r\n          eq_pdInfoId: undefined\r\n        },\r\n        selectedSale: {},\r\n        pdSlChanlDisabledCodeArray: [],\r\n        pdSlMgcOptions: [],\r\n\r\n        // 表单验证\r\n        rules: {\r\n          pdSlMgc: [{\r\n            required: true,\r\n            message: this.$t('form.please_enter') + this.$t('saleAttributeDefinition.pdSlMgc'),\r\n            trigger: 'change'\r\n          }],\r\n          pdSlChanl: [{\r\n            required: true,\r\n            message: this.$t('form.please_select') + this.$t('saleAttributeDefinition.pdSlChanl'),\r\n            trigger: 'change'\r\n          }],\r\n          pdSlCurr: [{\r\n            required: true,\r\n            message: this.$t('form.please_select') + this.$t('saleAttributeDefinition.pdSlCurr'),\r\n            trigger: 'change'\r\n          }],\r\n          pdSlState: [{\r\n            required: true,\r\n            message: this.$t('form.please_select') + this.$t('saleAttributeDefinition.pdSlState'),\r\n            trigger: 'change'\r\n          }],\r\n          pdSlStartDate: [{\r\n            required: true,\r\n            message: this.$t('form.please_select') + this.$t('saleAttributeDefinition.pdSlStartDate'),\r\n            trigger: 'change'\r\n          }, {validator: validateStartDate, trigger: 'change'}],\r\n          pdSlEndDate: [{\r\n            required: true,\r\n            message: this.$t('form.please_select') + this.$t('saleAttributeDefinition.pdSlEndDate'),\r\n            trigger: 'change'\r\n          }, {validator: validateEndDate, trigger: 'change'}]\r\n        }\r\n      }\r\n    },\r\n    watch: {\r\n      tableData_sale:function() {\r\n        if (this.tableData_sale.length > 0) {\r\n          this.pdSlMgcFilters = [];\r\n          this.pdSlChanlFilters=[];\r\n          this.tableData_sale.forEach(val => {\r\n            this.pdSlMgcFilters.push({\r\n              text: this.filters_pdSlMgc(val.pdSlMgc),\r\n              value: val.pdSlMgc\r\n            });\r\n            this.pdSlChanlFilters.push({\r\n              text: this.getCodeName('pdSlChanl', val.pdSlChanl),\r\n              value: val.pdSlChanl\r\n            });\r\n          });\r\n          //销售机构\r\n          this.pdSlMgcFilters = this.pdSlMgcFilters.reduce(function(prev, element) {\r\n            if (!prev.find(el => el.text == element.text)) {\r\n              prev.push(element);\r\n            }\r\n            return prev;\r\n          }, []);\r\n          //销售渠道\r\n          this.pdSlChanlFilters = this.pdSlChanlFilters.reduce(function(prev, element) {\r\n            if (!prev.find(el => el.text == element.text)) {\r\n              prev.push(element);\r\n            }\r\n            return prev;\r\n          }, []);\r\n        }\r\n      },\r\n      'form_sale.pdSlMgc'(selectedCodes) {\r\n        if (selectedCodes.length === 0) {\r\n          for (const pdSlMgc of this.pdSlMgcOptions) {\r\n            pdSlMgc.disabled = false\r\n          }\r\n        } else {\r\n          if (this._.includes(selectedCodes, '0000')) {\r\n            for (const pdSlMgc of this.pdSlMgcOptions) {\r\n              pdSlMgc.disabled = pdSlMgc.slMgcCode !== '0000'\r\n            }\r\n          } else {\r\n            for (const pdSlMgc of this.pdSlMgcOptions) {\r\n              pdSlMgc.disabled = pdSlMgc.slMgcCode === '0000'\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'form_sale.pdSlChanl'(selectedCodes) {\r\n        if (selectedCodes.length === 0) {\r\n          this.pdSlChanlDisabledCodeArray = []\r\n        } else {\r\n          let allCodes = this._.map(this.ldcodes['pdSlChanl'], 'code');\r\n          if (this._.includes(selectedCodes, '00')) {\r\n            allCodes = allCodes.filter(code => {\r\n              return code !== '00'\r\n            })\r\n            this.pdSlChanlDisabledCodeArray = allCodes\r\n          } else {\r\n            allCodes = allCodes.filter(code => {\r\n              return code === '00'\r\n            })\r\n            this.pdSlChanlDisabledCodeArray = allCodes\r\n          }\r\n        }\r\n      },\r\n      'form_sale.pdSlStartDate'() {\r\n        const val =this.form_sale.pdSlState;\r\n        if(val=='Y'){\r\n          this.$nextTick(() => {\r\n              this.$refs.form_sale.validateField('pdSlEndDate')\r\n          })\r\n        }\r\n      },\r\n      'form_sale_update.pdSlStartDate'() {\r\n        const val =this.form_sale_update.pdSlStartDate;\r\n        if(val=='Y'){\r\n          this.$nextTick(() => {\r\n              this.$refs.form_sale_update.validateField('pdSlEndDate')\r\n          })\r\n        }\r\n      },\r\n      'form_sale.pdSlState'(){\r\n        const val =this.form_sale.pdSlState;\r\n        if(val=='N'){\r\n          this.rules.pdSlStartDate= [{required: false}]\r\n        }else{\r\n          this.rules.pdSlStartDate= [{required: true, message: this.$t('form.please_select') + this.$t('saleAttributeDefinition.pdSlStartDate'), trigger: 'change'}]\r\n        }\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapGetters([\r\n        'ldcodes'\r\n      ])\r\n    },\r\n    mounted() {\r\n      if (this.product.id) {\r\n        this.initTableDataSale()\r\n      }\r\n    },\r\n    async created() {\r\n      this.showPageFlag = this.$route.query.showPageFlag\r\n      await this.init()\r\n    },\r\n    methods: {\r\n      async init() {\r\n        this.initProductInfo();\r\n        await this.initOtherInfo();\r\n        await this.initMgcInfo();\r\n        // 将带入的信息复制到 form 对象上\r\n        //Object.assign(this.form_sale, this.form_sale_init)\r\n      },\r\n      //初始化表格信息\r\n      initTableDataSale() {\r\n        this.$refs.page_sale.buildData()\r\n      },\r\n      // 初始化产品信息\r\n      initProductInfo() {\r\n        let pdPpInfo = this.getPdData();\r\n        this.product.id=pdPpInfo.id;\r\n        this.product.pdInfoId=pdPpInfo.pdInfoId;\r\n        this.product.pdCode=pdPpInfo.ppCode;\r\n        this.product.pdName=pdPpInfo.ppName;\r\n        this.params_sale.pdInfoId = pdPpInfo.id;\r\n      },\r\n      filterHandler(value, row, column) {\r\n        if (column) {\r\n          const property = column[\"property\"];\r\n          return row[property] === value;\r\n        }\r\n      },\r\n      filters_pdSlMgc(code) {\r\n        for (const pdSlMgc of this.pdSlMgcOptions) {\r\n          if (pdSlMgc.slMgcCode === code) {\r\n            return pdSlMgc.slMgcCode + ':' + pdSlMgc.slMgcName\r\n          }\r\n        }\r\n        return code\r\n      },\r\n      // 初始化其它需要带入的信息\r\n      async initOtherInfo() {\r\n        if (this.product.pdInfoId) {\r\n          // 带入保单币种\r\n          const paramsMap = {\r\n            pd_info_id: this.product.pdInfoId,\r\n            pd_atrs_code: 'productCurrency'\r\n          }\r\n          const pdtempPdAtrsInfo = (await getPdAttrInfo(this.buildRequestData(paramsMap))).data\r\n          if (!!pdtempPdAtrsInfo) {\r\n            this.form_sale_init.pdSlCurr = this._.map(pdtempPdAtrsInfo, 'pdAtrsVal')\r\n          }\r\n          // 带入产品起售日期和停售日期\r\n          this.pdtempPdRptInfo = (await queryPdRptInfoByProductId(this.product.pdInfoId)).data\r\n          if (!!this.pdtempPdRptInfo) {\r\n            this.form_sale_init.pdSlStartDate = this.pdtempPdRptInfo.pdStartDate;\r\n            this.form_sale_init.pdSlEndDate = this.pdtempPdRptInfo.pdStopDate\r\n          }\r\n        }\r\n      },\r\n      async initMgcInfo() {\r\n        if (!this.product.pdInfoId) {\r\n          return\r\n        }\r\n        this.pdSlMgcOptions=[];\r\n        for (const pdSlMgc of (await getAllSysSlMgc()).data) {\r\n          this.pdSlMgcOptions.push(pdSlMgc)\r\n        }\r\n        for (const pdSlMgc of this.pdSlMgcOptions) {\r\n          this.$set(pdSlMgc, 'disabled', false)\r\n        }\r\n      },\r\n      checkSaleAttributeTable(val){\r\n        this.checkSaleAttribute=val\r\n        this.$nextTick(()=>{\r\n          if(this.checkSaleAttribute.length==1){\r\n            Object.assign(this.form_sale_update,val[0]);\r\n            // 置灰全机构和全渠道\r\n            for (const pdSlMgc of this.pdSlMgcOptions) {\r\n              pdSlMgc.disabled = pdSlMgc.slMgcCode === '0000';\r\n            }\r\n            this.pdSlChanlDisabledCodeArray = ['00']\r\n          }else if(this.checkSaleAttribute.length==0){\r\n            this.clearForm()\r\n          }\r\n        })\r\n      },\r\n      deleteMoreTax(){\r\n        this.handleDelete()\r\n      },\r\n      cancelUpdateSale() {\r\n        this.selectedSale = {};\r\n        this.$nextTick(() => {\r\n          this.resetFormSale();\r\n          this.resetFormSaleUpdate()\r\n        })\r\n      },\r\n      handleAdd() {\r\n        this.$refs.form_sale.validate(async pass => {\r\n          if (pass) {\r\n            this.form_sale.pdInfoId = this.product.id;\r\n            this.form_sale.pdVerId = this.product.pdVerId;\r\n            this.form_sale.pdCode = this.product.pdCode;\r\n            this.form_sale.pdName = this.product.pdName;\r\n            this.form_sale.pdType = '2';\r\n            let map = {\r\n              'pdtempPdSlInfo': this.form_sale\r\n            }\r\n            console.log(map)\r\n            // 新增\r\n            addPdtempPdSlInfo(this.form_sale).then(() => {\r\n              this.notifySuccess(this.$t('successMessage.save'))\r\n              updatePdtempPpInfo(this.buildRequestData(map)).then(() => {\r\n              })\r\n              this.resetFormSale();\r\n              this.$refs.page_sale.reload();\r\n              //告知父页面已经保存\r\n              this.$emit('childFn', true);\r\n\r\n            })\r\n          } else {\r\n            this.notifyError(this.$t('form.form_validation_failed'))\r\n          }\r\n        })\r\n      },\r\n      handleUpdate() {\r\n        this.$refs.form_sale_update.validate(async pass => {\r\n          if (pass) {\r\n            // 更新\r\n            updatePdtempPdSlInfo(this.form_sale_update).then(() => {\r\n              this.notifySuccess(this.$t('successMessage.update'))\r\n              this.cancelUpdateSale();\r\n              //告知父页面已经保存\r\n              this.$emit('childFn', true);\r\n              this.$refs.page_sale.buildData()\r\n            })\r\n          } else {\r\n            this.notifyError(this.$t('form.form_validation_failed'))\r\n          }\r\n        })\r\n      },\r\n      handleDelete() {\r\n        // 删除\r\n        let delKeys =  this.checkSaleAttribute.map(sale => sale.id)\r\n        deletePdtempPdSlInfo(this.buildRequestData({\"delKeys\": delKeys})).then(() => {\r\n          this.notifySuccess(this.$t('successMessage.delete'))\r\n          this.cancelUpdateSale();\r\n          this.$refs.page_sale.reload()\r\n        })\r\n      },\r\n      clearForm() {\r\n        this.$refs.multipleTable.clearSelection();\r\n          this.resetFormSaleUpdate()\r\n          this.resetFormSale()\r\n\r\n      },\r\n      resetFormSale() {\r\n        this.form_sale = {\r\n          id: undefined,\r\n          pdInfoId: undefined,\r\n          pdVerId: undefined,\r\n          pdType: '',\r\n          pdCode: '',\r\n          pdSlMgc: [],\r\n          pdSlMgcLev: '',\r\n          pdSlChanl: [],\r\n          pdSlCurr: [],\r\n          pdSlState: 'Y',\r\n          pdSlStartDate: undefined,\r\n          pdSlEndDate: undefined,\r\n          createTime: undefined,\r\n          updateTime: undefined,\r\n          operator: ''\r\n        };\r\n        // 将带入的信息复制到 form 对象上\r\n        Object.assign(this.form_sale, this.form_sale_init);\r\n        this.$nextTick(() => {\r\n          this.$refs.form_sale.clearValidate()\r\n        })\r\n      },\r\n      resetFormSaleUpdate() {\r\n        this.form_sale_update.pdSlMgc = '';\r\n        this.form_sale_update.pdSlChanl = '';\r\n        this.form_sale_update.pdSlCurr = '';\r\n        this.form_sale_update.pdSlState = 'Y';\r\n        this.form_sale_update.pdSlStartDate = this.form_sale_init.pdSlStartDate;\r\n        this.form_sale_update.pdSlEndDate = this.form_sale_init.pdSlEndDate;\r\n        this.$nextTick(() => {\r\n          this.$refs.form_sale_update.clearValidate()\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .showDiv {\r\n    width: 100%;\r\n    height: 100%;\r\n    margin-top: -40px;\r\n    margin-left: -40px;\r\n    position: absolute;\r\n    background: #ffffff00;\r\n    z-index: 999;\r\n  }\r\n\r\n</style>\r\n"]}]}