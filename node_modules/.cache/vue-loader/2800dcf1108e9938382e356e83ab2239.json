{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-package-definition\\pp-operation-def\\pp-underwriting-def\\unw-renew-rule\\index.vue?vue&type=style&index=0&id=3b820214&lang=scss&scoped=true&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-package-definition\\pp-operation-def\\pp-underwriting-def\\unw-renew-rule\\index.vue","mtime":1609847107060},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1706753188288},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1706753191924},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1706753189537},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1706753187424},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgLmNzdCB7CiAgICB3aWR0aDogNzNweDsKICAgIG1hcmdpbi1yaWdodDogLTVweDsKICAgIGJvcmRlcjogMDsKICB9Ci5lbC1pbnB1dHsKICB3aWR0aDogMjIwcHg7Cn0KLmVsLXNlbGVjdHsKICB3aWR0aDogMjIwcHg7Cn0KICBociB7CiAgICBtYXJnaW4tdG9wOiA3cHg7CiAgICAqbWFyZ2luOiAwOwogICAgYm9yZGVyOiAwOwogICAgY29sb3I6IGJsYWNrOwogICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7CiAgICBoZWlnaHQ6IDJweDsKICB9CgogIC5kaXZpZGVyIHsKICAgIGNvbG9yOiBibGFjazsKICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOwogICAgd2lkdGg6IDFweDsKICB9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-package-definition/pp-operation-def/pp-underwriting-def/unw-renew-rule","sourcesContent":["<template>\r\n  <cus-wraper>\r\n    <cus-form-title :label=\"$t('renewInsuranceRule.customRuleConfiguration')\"></cus-form-title>\r\n    <el-form :model=\"insuranceRuleForm\" label-width=\"auto\"  :rules=\"insuranceRuleFormRule\"  ref=\"insuranceRuleForm\" >\r\n      <el-row>\r\n        <el-col :span=\"8\">\r\n          <el-form-item  :label=\"$t('renewInsuranceRule.pdRuleGrade')\" prop=\"pdRuleGrade\">\r\n            <cus-radio :codetype=\"'ruleProperties'\"  :filter=\"rulePropertiesFilter\"  :isRequired=\"true\" v-model=\"insuranceRuleForm.pdRuleGrade\" ></cus-radio>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"10\">\r\n          <el-form-item  :label=\"$t('renewInsuranceRule.product')\" v-show=\"showRuleProductFlag\"  prop=\"pdGradeCode\">\r\n            <el-select  clearable filterable v-model=\"insuranceRuleForm.pdGradeCode\">\r\n              <el-option :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" v-for=\"item in productOptions\">\r\n              </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n        </el-col>\r\n      </el-row>\r\n    </el-form>\r\n    <el-button dialog-disable=\"disable\"  size=\"small\" @click=\"findRulesOptions\" icon=\"el-icon-connection\" type=\"primary\">\r\n      {{$t('renewInsuranceRule.ruleSelect')}}\r\n    </el-button>\r\n    <br/>\r\n    <cus-form-title  :label=\"$t('renewInsuranceRule.selectRule')\"></cus-form-title>\r\n    <cus-table-title  :label=\"$t('renewInsuranceRule.productPackageRenewInsuranceRule')\"/>\r\n    <el-table :data=\"cusConfigs\" @row-click=\"chooseOne\" align=\"center\" border class=\"wraper-table\"\r\n              element-loading-text=\"Loading\"\r\n              fit highlight-current-row max-height=\"500px\" ref=\"cusTable\" size=\"mini\">\r\n      <el-table-column :label=\"$t('pdtempPdBnft.choose')\" width=\"50\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-radio :label=\"scope.row.id\" v-model=\"radio2\">\r\n            <span class=\"el-radio__label\"></span>\r\n          </el-radio>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\" width=\"50\"></el-table-column>\r\n      <el-table-column :label=\"$t('renewInsuranceRule.pdRuleGrade')\" align=\"center\" prop=\"pdType\">\r\n        <template v-slot=\"scope\">{{ scope.row.pdType | filter_pdRuleDef }}</template>\r\n      </el-table-column>\r\n      <el-table-column  :label=\"$t('renewInsuranceRule.pdRuleDef')\" align=\"center\" prop=\"pdRuleGrade\">\r\n        <template v-slot=\"scope\">\r\n          {{ scope.row.pdRuleGrade === '1' ? '通用' : scope.row.pdRuleGrade === '2' ? '产品:' + scope.row.pdPackageCode : '套餐:' + scope.row.pdPackageCode}}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('renewInsuranceRule.pdRuleCode')\" align=\"center\" prop=\"pdRuleCode\" width=\"180px\"></el-table-column>\r\n      <el-table-column :label=\"$t('renewInsuranceRule.pdRuleDesc')\" align=\"center\" prop=\"pdRuleDesc\" width=\"180px\"></el-table-column>\r\n      <el-table-column :label=\"$t('renewInsuranceRule.details')\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button dialog-disable=\"disable\"  size=\"small\" @click=\"showRules(scope.row.pdRuleCode)\" type=\"text\">>></el-button>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('renewInsuranceRule.operation')\" align=\"center\"  width=\"90px\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button dialog-disable=\"disable\" @click=\"delCusRow(scope.row)\" icon=\"el-icon-delete\"\r\n                     size=\"mini\" type=\"danger\" v-auth=\"'renewInsuranceRule:deleteRule'\"></el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <el-dialog v-dialog-drag v-if=\"showRule\" :close-on-click-modal=\"false\" :visible.sync=\"showRule\" append-to-body center\r\n               width=\"75%\">\r\n      <cus-page-title-back :isDialog=\"true\" @backTo=\"showRule=false\"  :label=\"$t('i18nView.renewalRules')\"/>\r\n      <el-form :model=\"productForm\" label-width=\"auto\" ref=\"productForm\">\r\n        <el-row>\r\n          <el-col :span=\"8\">\r\n            <el-form-item  :label=\"$t('renewInsuranceRule.productMeat')\">\r\n              <el-tag type=\"info\">{{ productForm.product }}</el-tag>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\" v-show=\"showRuleProductFlag\">\r\n            <el-form-item  :label=\"$t('renewInsuranceRule.product')\">\r\n              <el-select  clearable filterable v-model=\"productCode\" :disabled=\"true\">\r\n                <el-option :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" v-for=\"item in productOptions\">\r\n                </el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item :label=\"$t('renewInsuranceRule.ruleAttributeType')\">\r\n              <cus-select :codetype=\"'ruleBusinessDetailClass'\" v-model=\"productForm.ruleBussType\" :disabled=\"true\"></cus-select>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n      </el-form>\r\n      <cus-form-title :label=\"$t('renewInsuranceRule.ruleSelect')\"></cus-form-title>\r\n      <el-form :model=\"cusForm\" label-width=\"auto\" ref=\"cusForm\">\r\n        <el-row>\r\n          <el-col :span=\"8\">\r\n            <el-form-item :label=\"$t('renewInsuranceRule.pickMeat')\">\r\n              <el-select :placeholder=\"$t('pdtempPdBnft.pleaseChoose')\"  clearable filterable\r\n                         v-model=\"cusForm.package\" @change=\"findProductByPackageId\">\r\n                <el-option :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" v-for=\"item in packageOptions\">\r\n                </el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item :label=\"$t('renewInsuranceRule.designatedProducts')\">\r\n              <el-select :placeholder=\"$t('pdtempPdBnft.pleaseChoose')\"  clearable filterable\r\n                         v-model=\"cusForm.product\">\r\n                <el-option :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" v-for=\"item in appointProductOptions\">\r\n                </el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item :label=\"$t('renewInsuranceRule.ruleAttributeType')\">\r\n              <cus-select :codetype=\"'ruleBusinessDetailClass'\" :filter=\"ruleBusinessModuleFilter\" v-model=\"cusForm.pdBussType\" ></cus-select>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n        <el-row>\r\n          <el-col :span=\"8\">\r\n            <el-form-item :label=\"$t('renewInsuranceRule.ruleCode')\" prop=\"ruleCode\">\r\n              <el-input v-model=\"cusForm.ruleCode\"></el-input>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-button dialog-disable=\"disable\"  size=\"small\" @click=\"searchRules\" icon=\"el-icon-search\" type=\"primary\">\r\n                {{ $t('renewInsuranceRule.search') }}</el-button>\r\n        </el-row>\r\n      </el-form>\r\n      <el-button dialog-disable=\"disable\"  size=\"small\" @click=\"addRules\" type=\"primary\"><i class=\"el-icon-plus el-icon--left\"></i>{{ $t('renewInsuranceRule.addRule') }}\r\n      </el-button>\r\n      <cus-table-title :label=\" $t('renewInsuranceRule.rule')\" />\r\n      <el-table :data=\"ruleConfigs\" @selection-change=\"handleSelectionChange\" align=\"center\" border class=\"wraper-table\"\r\n                element-loading-text=\"Loading\" fit highlight-current-row ref=\"configsTable\" size=\"mini\">\r\n        <el-table-column type=\"selection\" width=\"55\"  align=\"center\"></el-table-column>\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\" width=\"50\"></el-table-column>\r\n        <el-table-column :label=\"$t('renewInsuranceRule.pdRuleDef')\" align=\"center\" prop=\"pdRuleGrade\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdRuleGrade === '1' ? '通用' : scope.row.pdRuleGrade === '2' ? '产品:' + scope.row.pdCode : '套餐:' + scope.row.pdCode}}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :filter-method=\"filterHandler\" :filters=\"codeFilters\"\r\n                         :label=\"$t('renewInsuranceRule.ruleCode')\"\r\n                         align=\"center\" prop=\"pdRuleCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('renewInsuranceRule.pdRuleDesc')\" align=\"center\" prop=\"pdRuleDesc\"></el-table-column>\r\n        <el-table-column :label=\"$t('renewInsuranceRule.details')\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button  dialog-disable=\"disable\" size=\"small\" @click=\"showRules(scope.row.pdRuleCode)\" type=\"text\">>></el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <br/>\r\n      <div style=\"float:right\">\r\n        <el-button  dialog-disable=\"disable\" size=\"small\" @click=\"connRules\" icon=\"el-icon-connection\"  v-auth=\"'renewInsuranceRule:connRules'\" type=\"primary\">\r\n          {{ $t('renewInsuranceRule.choice') }}\r\n        </el-button>\r\n        <el-button dialog-disable=\"disable\"  size=\"small\" @click=\"refreshRuleConfigs\" icon=\"el-icon-refresh\" type=\"primary\">\r\n          {{ $t('renewInsuranceRule.refresh') }}\r\n        </el-button>\r\n      </div>\r\n      <br/>\r\n    </el-dialog>\r\n    <!-- 规则引擎定义弹窗 -->\r\n    <cus-rule-definition :attributeObj=\"attributeObj\" :ruleDefinitionClosed=\"ruleModuleClosed\"\r\n                         :visible=\"ruleVisible\"></cus-rule-definition>\r\n    <!-- 规则查看弹窗 -->\r\n    <cus-rule-modify :flag=\"ruleView.flag\" :ruleCode=\"ruleView.ruleCode\" :ruleModifyClosed=\"ruleMakeClosed\"\r\n                     :ruleType=\"'1'\" :visible=\"ruleView.visible\"></cus-rule-modify>\r\n  </cus-wraper>\r\n</template>\r\n\r\n<script>\r\n  import {connRules,\r\n    deleteRule,\r\n    packageList,\r\n    findRulesByParams,\r\n    findRulesList,\r\n    getRuleCode,\r\n    findProductList\r\n  } from \"@/api/basicinfo/renewInsuranceRule\";\r\n  import {mapGetters} from \"vuex\"\r\n  import ruleModule from '@/views/ibrms/ruleManagement/ruleModule/index'\r\n  import ruleMake from '@/views/ibrms/ruleManagement/ruleMake/index'\r\n\r\n  let _this;\r\n\r\n  export default {\r\n    name: \"renewInsuranceRule\",\r\n    filters: {\r\n      filter_pdRuleDef(code){\r\n        return _this.getCodeName(\"ruleProperties\", code, true);\r\n      },\r\n      filter_pdRulePropDtCls(code) {\r\n        if (code) {\r\n          return _this.getCascaderCodeName('ruleAscrDeta', code);\r\n        } else {\r\n          return code;\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      _this = this;\r\n      return {\r\n        ruleView: {\r\n          visible: false,\r\n          updateDynamicTable: false,\r\n          flag: '',\r\n          ruleCode: '',\r\n          ruleQuery: undefined\r\n        },\r\n        attributeObj: {},\r\n        ruleVisible: false,\r\n        pdPpInfo: {},\r\n        radio2: null,\r\n        showRule: false,\r\n        language: null,\r\n        productCode:'',\r\n        ruleMessageInfoBom: [],\r\n        ruleBusinessModuleFilter:'1$10$11',\r\n        rulePropertiesFilter:'1$2$3',\r\n        cusConfigs: [],\r\n        ruleConfigs: [],\r\n        productOptions:[],\r\n        showRuleProductFlag:true,\r\n        packageOptions: [],\r\n        appointProductOptions:[],\r\n        codeFilters: [],\r\n        chooseRules: [],\r\n        //套餐自定义投保核保规则配置\r\n        insuranceRuleForm:{\r\n          pdRuleGrade:'2',\r\n          pdGradeCode:''\r\n        },\r\n        //选择规则\r\n        cusForm: {\r\n          package:'',\r\n          product: '',\r\n          ruleCode: '',\r\n          ruleBussType:''\r\n        },\r\n        productForm: {\r\n          product:'',\r\n          ruleBussType:''\r\n        },\r\n        insuranceRuleFormRule: {\r\n          pdRuleGrade: [{required: true, message: \"请选择规则所属级别\", trigger: \"blur\"}],\r\n          pdGradeCode: [{required: true, message: \"请选择产品\", trigger: \"blur\"}]\r\n        }\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapGetters([\r\n        'ruleMassages',\r\n      ])\r\n    },\r\n    components: {ruleModule, ruleMake},\r\n    mounted() {\r\n      this.language = this.$store.state.app.language;\r\n      this.ruleMessageInfoBom = this.$store.state.ruleMessage.ruleMessages;\r\n    },\r\n    created() {\r\n      this.pdPpInfo = this.getPdData();\r\n      this.productForm.product=this.pdPpInfo.ppCode+\":\"+this.pdPpInfo.ppName;\r\n      this.productForm.ruleBussType='11';\r\n      if (this.pdPpInfo) {\r\n        this.findCusConfigsData();\r\n        this.findProductList()\r\n      }\r\n    },\r\n    watch: {\r\n      ruleConfigs: function () {\r\n        if (this.ruleConfigs.length > 0) {\r\n          this.codeFilters = [];\r\n          this.ruleConfigs.forEach(val => {\r\n            this.codeFilters.push({\r\n              text: val.pdRuleCode,\r\n              value: val.pdRuleCode\r\n            });\r\n          });\r\n          this.codeFilters = this.codeFilters.reduce(function (prev, element) {\r\n            if (!prev.find(el => el.text == element.text)) {\r\n              prev.push(element);\r\n            }\r\n            return prev;\r\n          }, []);\r\n        }\r\n      },\r\n      'insuranceRuleForm.pdRuleGrade'(){\r\n        const val=this.insuranceRuleForm.pdRuleGrade;\r\n        if(val=='2'){\r\n          this.showRuleProductFlag=true;\r\n          this.insuranceRuleFormRule.pdGradeCode= [{required: true, message: \"请选择产品\", trigger: \"blur\"}]\r\n        }else{\r\n          this.showRuleProductFlag=false;\r\n          this.insuranceRuleFormRule.pdGradeCode= [{required: false}]\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      ruleModuleClosed() {\r\n        this.ruleVisible = false;\r\n        this.searchRules()\r\n      },\r\n      ruleMakeClosed() {\r\n        this.ruleView.visible = false;\r\n        this.radio2 = null\r\n      },\r\n      ruleViewClosed() {\r\n        this.radio2 = null\r\n      },\r\n      findProductByPackageId(val){\r\n        if(val==null || val==\"\"){\r\n          this.appointProductOptions = [];\r\n          return\r\n        }\r\n        findProductList(this.buildRequestData({\"pdInfoId\":val})).then(res => {\r\n          let data = res.data;\r\n          this.appointProductOptions = [];\r\n          this.cusForm.product='';\r\n          if (data.length) {\r\n            data.forEach(product => {\r\n              this.appointProductOptions.push({\r\n                value: product.pdCode,\r\n                label: product.pdCode + \":\" + product.pdName\r\n              });\r\n            });\r\n          }\r\n        });\r\n      },\r\n      findProductList(){\r\n        findProductList(this.buildRequestData({\"pdInfoId\":this.pdPpInfo.id})).then(res => {\r\n          let data = res.data;\r\n          this.productOptions = [];\r\n          if (data.length) {\r\n            data.forEach(val => {\r\n              this.productOptions.push({\r\n                value: val.pdCode,\r\n                label: val.pdCode + \":\" + val.pdName\r\n              });\r\n            });\r\n          }\r\n        });\r\n      },\r\n      findCusConfigsData() {\r\n        findRulesList(this.buildRequestData({\"pdInfoId\":this.pdPpInfo.id,\"pdCode\":this.pdPpInfo.ppCode})).then(res => {\r\n          this.cusConfigs = res.data;\r\n        });\r\n      },\r\n      findRulesOptions() {\r\n        this.$refs[\"insuranceRuleForm\"].validate(valid => {\r\n          if (valid) {\r\n            this.showRule = true;\r\n            this.cusForm.package = this.pdPpInfo.id;\r\n            packageList().then(res => {\r\n              let data = res.data;\r\n              this.packageOptions = [];\r\n              if (data.length) {\r\n                data.forEach(val => {\r\n                  this.packageOptions.push({\r\n                    value: val.id,\r\n                    label: val.ppCode + \":\" + val.ppName\r\n                  });\r\n                });\r\n              }\r\n              this.findProductByPackageId(this.cusForm.package);\r\n              this.searchRules()\r\n            });\r\n          }\r\n        });\r\n        if(this.showRuleProductFlag) {\r\n          this.productCode = this.insuranceRuleForm.pdGradeCode;\r\n          this.cusForm.product = this.insuranceRuleForm.pdGradeCode\r\n        }\r\n      },\r\n      refreshRuleConfigs() {\r\n        this.$refs[\"cusForm\"].resetFields();\r\n        this.searchRules()\r\n      },\r\n      addRules() {\r\n        const param = {\r\n          pdBussType: '8',\r\n          pdBussDetailType: '11'\r\n        };\r\n        let pdCode='';\r\n        if(this.showRuleProductFlag){\r\n          pdCode=this.productCode\r\n        }else{\r\n          pdCode=this.pdPpInfo.ppCode\r\n        }\r\n        getRuleCode(this.buildRequestData(param)).then(response => {\r\n          this.attributeObj = {\r\n            code: response.data,\r\n            ruleBussModu: '8',\r\n            ruleBussModuDeta: '11',\r\n            ruleType: '1',\r\n            ruleAttr: '3',\r\n            pdType: '2',\r\n            pdCode: pdCode,\r\n            pdEdition: '1'\r\n          };\r\n          if(this.insuranceRuleForm.pdRuleGrade=='2'){\r\n            this.attributeObj.ruleType='1',\r\n              this.attributeObj.pdType='1',\r\n              this.attributeObj.ruleAttr='2',\r\n              this.attributeObj.pdCode=this.insuranceRuleForm.pdGradeCode,\r\n              this.attributeObj.riskType=this.pdType,\r\n              this.attributeObj.riskDetail=this.pdDetailType\r\n          }\r\n          this.ruleVisible = true\r\n        })\r\n      },\r\n      showRules(code) {\r\n        this.ruleView.flag = '1';\r\n        this.ruleView.ruleCode = code;\r\n        this.ruleView.ruleQuery = true;\r\n        this.ruleView.updateDynamicTable = false;\r\n        this.ruleView.visible = true\r\n      },\r\n      searchRules() {\r\n        let params = {\r\n          pdInfoId:this.pdPpInfo.id,\r\n          packageId: this.cusForm.package,\r\n          pdCode: this.cusForm.product,\r\n          pdRuleCode: this.cusForm.ruleCode,\r\n          pdBussType: this.cusForm.pdBussType\r\n        };\r\n        if (this.insuranceRuleForm.pdRuleGrade==='2'){\r\n          if(!this.cusForm.product){\r\n            params={};\r\n            params = {\r\n              pdInfoId:this.pdPpInfo.id,\r\n              packageId: this.cusForm.package,\r\n              pdCode: this.productCode,\r\n              pdRuleCode: this.cusForm.ruleCode,\r\n              pdBussType: this.cusForm.pdBussType\r\n            }\r\n          }\r\n        }\r\n        findRulesByParams(this.buildRequestData(params)).then(res => {\r\n          let data = res.data;\r\n          data = data.reduce(function (prev, element) {\r\n            if (!prev.find(el => el.pdRuleCode == element.pdRuleCode)) {\r\n              prev.push(element);\r\n            }\r\n            return prev;\r\n          }, []);\r\n          this.ruleConfigs = data;\r\n        })\r\n      },\r\n      connRules() {\r\n        if (this.chooseRules.length === 0) {\r\n          this.notifyError('请选择规则');\r\n          return\r\n        }\r\n        let pdtempPdRulesList = [];\r\n        this.chooseRules.forEach(rule => {\r\n          let pdtempPdRules = {\r\n            pdVerId:1,\r\n            pdCode: rule.pdCode,\r\n            pdInfoId:this.pdPpInfo.id,\r\n            pdType:this.insuranceRuleForm.pdRuleGrade,\r\n            pdRuleGrade: rule.pdRuleGrade,\r\n            pdRuleCls: rule.pdRuleCls,\r\n            pdRuleDtCls: rule.pdRuleDtCls,\r\n            pdRulePropCls: rule.pdRulePropCls,\r\n            pdRulePropDtCls: rule.pdRulePropDtCls,\r\n            pdRuleCode: rule.pdRuleCode,\r\n            pdRuleDesc: rule.pdRuleDesc\r\n          };\r\n          if(this.insuranceRuleForm.pdRuleGrade=='2'){\r\n            pdtempPdRules.pdPackageCode=this.insuranceRuleForm.pdGradeCode\r\n          }else{\r\n            pdtempPdRules.pdPackageCode=this.pdPpInfo.ppCode\r\n          }\r\n          pdtempPdRulesList.push(pdtempPdRules);\r\n        });\r\n        const param = {\r\n          rules: pdtempPdRulesList,\r\n          pdtempPpInfo: this.pdPpInfo,\r\n          pdCode: this.productCode,\r\n          pdBussType: '8',\r\n          pdBussDetailType: '11'\r\n        };\r\n        connRules(this.buildRequestData(param)).then(res => {\r\n          this.notifySuccess(res.message);\r\n          this.findCusConfigsData();\r\n          this.searchRules();\r\n        })\r\n      },\r\n      delCusRow(row) {\r\n        deleteRule(row.id).then(res => {\r\n          if (res.code == 200) {\r\n            this.notifySuccess(res.message);\r\n            this.findCusConfigsData();\r\n          }\r\n        });\r\n      },\r\n      filterHandler(value, row, column) {\r\n        if (column) {\r\n          const property = column[\"property\"];\r\n          return row[property] === value;\r\n        }\r\n      },\r\n      chooseOne(row, column, event) {\r\n        if (event.target.nodeName == \"INPUT\") {\r\n          if (row.id == this.radio2) {\r\n            this.radio2 = null;\r\n            this.$refs.cusTable.setCurrentRow()\r\n          } else {\r\n            this.radio2 = row.id;\r\n            this.ruleView.flag = '2';\r\n            this.ruleView.ruleCode = row.pdRuleCode;\r\n            this.ruleView.ruleQuery = false;\r\n            this.ruleView.updateDynamicTable = true;\r\n            this.ruleView.visible = true\r\n          }\r\n        }\r\n      },\r\n      handleSelectionChange(row) {\r\n        this.chooseRules = row;\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  .cst {\r\n    width: 73px;\r\n    margin-right: -5px;\r\n    border: 0;\r\n  }\r\n.el-input{\r\n  width: 220px;\r\n}\r\n.el-select{\r\n  width: 220px;\r\n}\r\n  hr {\r\n    margin-top: 7px;\r\n    *margin: 0;\r\n    border: 0;\r\n    color: black;\r\n    background-color: black;\r\n    height: 2px;\r\n  }\r\n\r\n  .divider {\r\n    color: black;\r\n    background-color: black;\r\n    width: 1px;\r\n  }\r\n</style>\r\n"]}]}