{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-structure-def\\payment-def\\discount-formula\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-structure-def\\payment-def\\discount-formula\\index.vue","mtime":1609847106888},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQge2RlbGV0ZURpc2NvdW50Rm9ybXVsYX0gZnJvbSAiQC9hcGkvYmFzaWNpbmZvL3BkdGVtcERpc2NvdW50Rm9ybXVsYSINCmltcG9ydCB7Y29udGFjdEZvcm11bGEsIGdldENhbGNDb2RlfSBmcm9tICJAL2FwaS9iYXNpY2luZm8vcGR0ZW1wRGlzY291bnRGb3JtdWxhU2VsZWN0Ig0KaW1wb3J0IHt1cGRhdGVQZHRlbXBQZENtcG5JbmZvfSBmcm9tICJAL2FwaS9iYXNpY2luZm8vcGR0ZW1wcGRjbXBuaW5mbyINCmltcG9ydCBwZERpc2NvdW50Rm9ybXVsYVNlbGVjdA0KICBmcm9tICJAL3ZpZXdzL3Byb2R1Y3QtZGVmaW5pdGlvbi9wZC1mcmFtZXdvcmstZGVmL3BkLXN0cnVjdHVyZS1kZWYvcGF5bWVudC1kZWYvZGlzY291bnQtZm9ybXVsYS1zZWxlY3QiDQoNCmxldCBfdGhpcw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdwZERpc2NvdW50Rm9ybXVsYScsDQogIGNvbXBvbmVudHM6IHtwZERpc2NvdW50Rm9ybXVsYVNlbGVjdH0sDQogIGZpbHRlcnM6IHsNCiAgICBmaWx0ZXJfcGRCdXNzVHlwZShjb2RlKSB7DQogICAgICByZXR1cm4gX3RoaXMuZ2V0Q29kZU5hbWUoJ3BkQ2FsY0J1c3NUeXBlJywgY29kZSkNCiAgICB9LA0KICAgIGZpbHRlcl9wZEJ1c3NEZXRhaWxUeXBlKGNvZGUpIHsNCiAgICAgIHJldHVybiBfdGhpcy5nZXRDb2RlTmFtZSgncnVsZUJ1c2luZXNzRGV0YWlsQ2xhc3MnLCBjb2RlKQ0KICAgIH0sDQogICAgZmlsdGVyX3BkQ21wblR5cGUoY29kZSkgew0KICAgICAgcmV0dXJuIF90aGlzLmdldENvZGVOYW1lKCdwcmVmZXJlbnRpYWxUeXBlJywgY29kZSkNCiAgICB9LA0KICAgIGZpbHRlcl9wZENtcG5DYWxjTW9kZShjb2RlKSB7DQogICAgICByZXR1cm4gX3RoaXMuZ2V0Q29kZU5hbWUoJ3ByZWZlcmVudGlhbENsY3VsYXRpb25UeXBlJywgY29kZSkNCiAgICB9DQogIH0sDQogIHByb3BzOiB7DQogICAgZ3VhcmFudGVlRGV0YWlsczogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogdW5kZWZpbmVkDQogICAgfSwNCiAgICBjYWxjdWxhdGlvbkZvcm11bGFUeXBlOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiB1bmRlZmluZWQNCiAgICB9LA0KICAgIHBkRGlzQ291bnQ6IHsNCiAgICAgIHR5cGU6IE9iamVjdCwNCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwNCiAgICAgIGRlZmF1bHQ6ICgpID0+IHsNCiAgICAgICAgcmV0dXJuIHt9DQogICAgICB9DQogICAgfSwNCiAgICBwZERpc2NvdW50UmFuZ2VPcHRpb25zOiB7DQogICAgICB0eXBlOiBBcnJheSwNCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwNCiAgICAgIGRlZmF1bHQ6ICgpID0+IHsNCiAgICAgICAgcmV0dXJuIFtdDQogICAgICB9DQogICAgfQ0KICB9LA0KICBkYXRhKCkgew0KICAgIF90aGlzID0gdGhpcw0KICAgIHJldHVybiB7DQogICAgICBwYWdlOiB1bmRlZmluZWQsDQogICAgICBwYWdlU2l6ZTogdW5kZWZpbmVkLA0KICAgICAgb3JkZXJJbmRleEFycl9hZGRpdGlvbl9kaXNjb3VudDogW10sDQogICAgICBwcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm86IGZhbHNlLA0KICAgICAgc2hvd0Zvcm11bGFTZWxlY3Q6IGZhbHNlLA0KICAgICAgZmlsdGVyc19wZENvZGU6IFtdLA0KICAgICAgc2VsZWN0ZWREaXNjb3VudDoge30sDQogICAgICBzZWxlY3RlZEZvcm11bGE6IHt9LA0KICAgICAgZm9ybXVsYVZpZXc6IHsNCiAgICAgICAgZmxhZzogJycsDQogICAgICAgIHJ1bGVDb2RlOiAnJywNCiAgICAgICAgcGVyZm9ybVR5cGU6ICcnLA0KICAgICAgICB2aXNpYmxlOiBmYWxzZQ0KICAgICAgfSwNCiAgICAgIGZvcm11bGFWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGF0dHJpYnV0ZU9iajoge30sDQogICAgICBwcm9kdWN0OiB7DQogICAgICAgIGlkOiB1bmRlZmluZWQsDQogICAgICAgIGJUeXBlOiAnJywNCiAgICAgICAgY1R5cGU6ICcnLA0KICAgICAgICBwZENvZGU6ICcnLA0KICAgICAgICBwZEVkaXRpb246ICcnLA0KICAgICAgICBwZFZlcklkOiB1bmRlZmluZWQsDQogICAgICAgIHBkU2FsZWNobmw6ICcnLA0KICAgICAgICBwZE5hbWU6ICcnLA0KICAgICAgICBwZFNob3J0bmFtZTogJycsDQogICAgICAgIHBkRW5OYW1lOiAnJywNCiAgICAgICAgcGRTaG9ydEVuTmFtZTogJycsDQogICAgICAgIG9wZXJhdG9yOiAnJywNCiAgICAgICAgcGRTdGFydERhdGVSdWxlOiAnJywNCiAgICAgICAgcGRTdGFydERhdGVNb2RlOiAnJywNCiAgICAgICAgcGRTdGFydFBlcmlvZDogdW5kZWZpbmVkLA0KICAgICAgICBwZFN0YXJ0UGVyaW9kVW5pdDogJycsDQogICAgICAgIHBkRW5kRGF0ZVJ1bGU6ICcnLA0KICAgICAgICBwZEVuZERhdGVNb2RlOiAnJywNCiAgICAgICAgcGRFbmRQZXJpb2Q6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRFbmRQZXJpb2RVbml0OiAnJywNCiAgICAgICAgcGRHcmFjZVBlcmlvZDogdW5kZWZpbmVkLA0KICAgICAgICBwZE9ic2VydmF0aW9uRGF5OiB1bmRlZmluZWQsDQogICAgICAgIHBkQXBwbERhdGU6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRQcm9jZXNzSWQ6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRTdGFydERhdGU6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRTdG9wRGF0ZTogdW5kZWZpbmVkLA0KICAgICAgICBjcmVhdGVUaW1lOiB1bmRlZmluZWQsDQogICAgICAgIHVwZGF0ZVRpbWU6IHVuZGVmaW5lZA0KICAgICAgfSwNCiAgICAgIGZvcm1fcnVsZTogew0KICAgICAgICBydWxlQnVzc01vZHVEZXRhOiAnJywNCiAgICAgICAgZGVzY3JpcHRpb246ICcnDQogICAgICB9LA0KICAgICAgcGFyYW1zX2Rpc2NvdW50OiB7DQogICAgICAgIHBkSW5mb0lkOiB1bmRlZmluZWQNCiAgICAgIH0sDQogICAgICBwYXJhbXNfY3VycmVudDogew0KICAgICAgICBlcV9wZEluZm9JZDogdW5kZWZpbmVkLA0KICAgICAgICBlcV9wZEJ1c3NUeXBlOiAnMScsDQogICAgICAgIGVxX3BkQnVzc0RldGFpbFR5cGU6ICc0MCcsDQogICAgICAgIGVxX3BkVHlwZTogJzEnLA0KICAgICAgICBlcV9wZEJ1c3NJZDogdW5kZWZpbmVkDQogICAgICB9LA0KICAgICAgcGFyYW1zX2JyaWVmOiB7DQogICAgICAgIHByb2R1Y3Q6IHVuZGVmaW5lZCwNCiAgICAgICAgcGRCdXNzSWQ6IHVuZGVmaW5lZCwNCiAgICAgICAgcHJvZHVjdERldGFpbFR5cGU6ICcnLA0KICAgICAgICBwZEJ1c3NEZXRhaWxUeXBlOiAnNDAnDQogICAgICB9LA0KICAgICAgcGRDbXBuVHlwZTogJycsDQogICAgICBwZERpc2NvdW50UmFuZ2VzOiBbXSwNCiAgICAgIHBkRGlzY291bnRPcHRpb25zOiBbXSwNCiAgICAgIGZpbHRlckNtcG5UeXBlOiAnMSREJEUkRyRJJEokSycsDQogICAgICBwZFV3U2lUeXBlOiAnJywNCiAgICAgIHRhYmxlRGF0YV9mb3JtdWxhOiBbXSwNCiAgICAgIHRhYmxlRGF0YUJyaWVmRm9ybXVsYTogW10sDQogICAgICBPcHRpb25zOiBbXSwNCiAgICAgIE9wdGlvbnMyOiBbXSwNCiAgICAgIE9wdGlvbnMzOiBbXSwvL+aMh+WumuS/nemanOaVsOe7hA0KICAgICAgT3B0aW9uczQ6IFtdLC8v5oyH5a6a5L+d6Zqc5piO57uG5pWw57uEDQogICAgICBkaXNjb3VudFRhYmxlRGF0YTogW10sDQogICAgICBmb3JtdWxhTGlzdDogW10NCiAgICB9DQogIH0sDQogIHdhdGNoOiB7DQogICAgdGFibGVEYXRhQnJpZWZGb3JtdWxhKCkgew0KICAgICAgdGhpcy5maWx0ZXJzX3BkQ29kZSA9IFtdDQogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy50YWJsZURhdGFCcmllZkZvcm11bGEpIHsNCiAgICAgICAgaWYgKCF0aGlzLl8uaW5jbHVkZXModGhpcy5fLm1hcCh0aGlzLmZpbHRlcnNfcGRDb2RlLCAndmFsdWUnKSwgaXRlbS5wZENvZGUpKSB7DQogICAgICAgICAgdGhpcy5maWx0ZXJzX3BkQ29kZS5wdXNoKHsNCiAgICAgICAgICAgIHRleHQ6IGl0ZW0ucGRDb2RlICsgJzonICsgaXRlbS5wZE5hbWUsDQogICAgICAgICAgICB2YWx1ZTogaXRlbS5wZENvZGUNCiAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMuaW5pdFByb2R1Y3RJbmZvKCkNCiAgICBpZiAodGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8pIHsNCiAgICAgIHRoaXMuJHJlZnMucGFnZV9kaXNjb3VudC5yZWxvYWQoKS50aGVuKCgpID0+IHsNCiAgICAgICAgdGhpcy5nZXRPcmRlck51bWJlcigpDQogICAgICB9KQ0KICAgIH0gZWxzZSB7DQogICAgICAvLyDojrflj5bkvJjmg6DojIPlm7QNCiAgICAgIHRoaXMucGREaXNjb3VudE9wdGlvbnMgPSB0aGlzLnBkRGlzY291bnRSYW5nZU9wdGlvbnMNCiAgICAgIHRoaXMucGREaXNjb3VudFJhbmdlcyA9IHRoaXMucGREaXNDb3VudC5wZENtcG5SYW5nZQ0KICAgICAgdGhpcy5wZENtcG5UeXBlID0gdGhpcy5wZERpc0NvdW50LnBkQ21wblR5cGUNCiAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRCdXNzSWQgPSB0aGlzLnBkRGlzQ291bnQuaWQNCiAgICAgIHRoaXMucGFyYW1zX2JyaWVmLnBkQnVzc0lkID0gdGhpcy5wZERpc0NvdW50LmlkDQogICAgICB0aGlzLiRyZWZzLnBhZ2VfY3VycmVudC5yZWxvYWQoKQ0KICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMucGFnZSA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnBhZ2UNCiAgICB0aGlzLnBhZ2VTaXplID0gdGhpcy4kcm91dGUucXVlcnkucGFnZVNpemUNCiAgICB0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbyA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbyA9PT0gJ3RydWUnDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBmaWx0ZXJfcGRDb2RlKHZhbHVlLCByb3cpIHsNCiAgICAgIHJldHVybiB2YWx1ZSA9PT0gcm93LnBkQ29kZQ0KICAgIH0sDQogICAgaW5pdFByb2R1Y3RJbmZvKCkgew0KICAgICAgbGV0IHBkdGVtcFBkSW5mbyA9IHRoaXMuZ2V0UGREYXRhKCkNCiAgICAgIGlmIChPYmplY3Qua2V5cyhwZHRlbXBQZEluZm8pLmxlbmd0aCA+IDApIHsNCiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnByb2R1Y3QsIHBkdGVtcFBkSW5mbykNCiAgICAgICAgdGhpcy5wYXJhbXNfYnJpZWYucHJvZHVjdCA9IHBkdGVtcFBkSW5mbw0KICAgICAgICB0aGlzLnBhcmFtc19icmllZi5wcm9kdWN0RGV0YWlsVHlwZSA9IHRoaXMucHJvZHVjdC5jVHlwZQ0KICAgICAgICB0aGlzLnBhcmFtc19jdXJyZW50LmVxX3BkSW5mb0lkID0gdGhpcy5wcm9kdWN0LmlkDQogICAgICAgIGlmICh0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbykgew0KICAgICAgICAgIHRoaXMucGFyYW1zX2Rpc2NvdW50LnBkSW5mb0lkID0gdGhpcy5wcm9kdWN0LmlkDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMubm90aWZ5RXJyb3IodGhpcy4kdCgnbWVzc2FnZS5pbnZhbGlkUHJvZHVjdEluZm8nKSkNCiAgICAgIH0NCiAgICB9LA0KICAgIHJ1bGVNb2R1bGVDbG9zZWQoKSB7DQogICAgICB0aGlzLmZvcm11bGFWaXNpYmxlID0gZmFsc2UNCiAgICAgIGlmICghdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8gfHwgdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8gJiYgT2JqZWN0LmtleXModGhpcy5zZWxlY3RlZERpc2NvdW50KS5sZW5ndGggPiAwKSB7DQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5yZWxvYWQoKQ0KICAgICAgfQ0KICAgIH0sDQogICAgZm9ybXVsYVZpZXdDbG9zZWQoKSB7DQogICAgICB0aGlzLmZvcm11bGFWaWV3LnZpc2libGUgPSBmYWxzZQ0KICAgICAgdGhpcy5zZWxlY3RlZEZvcm11bGEgPSB7fQ0KICAgIH0sDQogICAgc2VsZWN0ZWRGb3JtdWxhQ2hhbmdlZCgpIHsNCiAgICAgIHRoaXMuZm9ybXVsYVZpZXcuZmxhZyA9IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLnJ1bGVBdHRyID09PSAnMScgPyAnMScgOiAnMicNCiAgICAgIHRoaXMuZm9ybXVsYVZpZXcucGVyZm9ybVR5cGUgPSB0aGlzLnNlbGVjdGVkRm9ybXVsYS5wZXJmb3JtVHlwZQ0KICAgICAgdGhpcy5mb3JtdWxhVmlldy5ydWxlQ29kZSA9IHRoaXMuc2VsZWN0ZWRGb3JtdWxhLnBkQ2FsY0NvZGUNCiAgICAgIHRoaXMuZm9ybXVsYVZpZXcudmlzaWJsZSA9IHRydWUNCiAgICB9LA0KICAgIHNob3dGb3JtdWxhKHJvdykgew0KICAgICAgdGhpcy5mb3JtdWxhVmlldy5mbGFnID0gJzEnDQogICAgICB0aGlzLmZvcm11bGFWaWV3LnJ1bGVDb2RlID0gcm93LnBkQ2FsY0NvZGUNCiAgICAgIHRoaXMuZm9ybXVsYVZpZXcucGVyZm9ybVR5cGUgPSByb3cucGVyZm9ybVR5cGUNCiAgICAgIHRoaXMuZm9ybXVsYVZpZXcudmlzaWJsZSA9IHRydWUNCiAgICB9LA0KICAgIGJhY2soKSB7DQogICAgICB0aGlzLiRlbWl0KCdjaGFuZ2VEaWFsb2dWaXNpYmxlX3BkRGlzY291bnQnLCBmYWxzZSkNCiAgICB9LA0KICAgIGJhY2tUb1JldmlzaW9uKCkgew0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICfkuqflk4HlhazlvI/orqLmraPkuLvpobUnLCBwYXJhbXM6IHtwYXRoOiB0aGlzLiRyb3V0ZS5wYXRoLCBwYWdlOiB0aGlzLnBhZ2UsIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplfX0pDQogICAgfSwNCiAgICB0b1NlbGVjdEZvcm11bGEoKSB7DQogICAgICBpZiAodGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8pIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc2VsZWN0ZWREaXNjb3VudCkubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgdGhpcy5ub3RpZnlFcnJvcih0aGlzLiR0KCdwZERpc2NvdW50Rm9ybXVsYS5wbGVhc2VTZWxlY3REaXNjb3VudCcpKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIHRoaXMuc2hvd0Zvcm11bGFTZWxlY3QgPSB0cnVlDQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLiRlbWl0KCdjaGFuZ2VEaWFsb2dWaXNpYmxlX3BkRGlzY291bnRTZWxlY3QnLCB0cnVlKQ0KICAgICAgfQ0KICAgIH0sDQogICAgdG9BZGRGb3JtdWxhKCkgew0KICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgIHBkQnVzc1R5cGU6ICcxJywNCiAgICAgICAgcGRCdXNzRGV0YWlsVHlwZTogJzQwJw0KICAgICAgfQ0KICAgICAgZ2V0Q2FsY0NvZGUodGhpcy5idWlsZFJlcXVlc3REYXRhKHBhcmFtKSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgIHRoaXMuYXR0cmlidXRlT2JqID0gew0KICAgICAgICAgIGNvZGU6IHJlc3BvbnNlLmRhdGEsDQogICAgICAgICAgcnVsZUJ1c3NNb2R1OiAnMScsDQogICAgICAgICAgcnVsZUJ1c3NNb2R1RGV0YTogJzQwJywNCiAgICAgICAgICBydWxlVHlwZTogJzInLA0KICAgICAgICAgIHBkVHlwZTogJzEnLA0KICAgICAgICAgIHJpc2tUeXBlOiB0aGlzLnByb2R1Y3QuYlR5cGUsDQogICAgICAgICAgcmlza0RldGFpbDogdGhpcy5wcm9kdWN0LmNUeXBlLA0KICAgICAgICAgIHBkQ29kZTogdGhpcy5wcm9kdWN0LnBkQ29kZSwNCiAgICAgICAgICBydWxlQXNjckNsczogJzUnLA0KICAgICAgICAgIHJ1bGVBc2NyRGV0YTogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8gPyB0aGlzLnNlbGVjdGVkRGlzY291bnQucGRDbXBuVHlwZSA6IHRoaXMucGREaXNDb3VudC5wZENtcG5UeXBlLA0KICAgICAgICAgIHBkRWRpdGlvbjogdGhpcy5wcm9kdWN0LnBkRWRpdGlvbg0KICAgICAgICB9DQogICAgICAgIHRoaXMuZm9ybXVsYVZpc2libGUgPSB0cnVlDQogICAgICB9KQ0KICAgIH0sDQogICAgaGFuZGxlRGVsZXRlRm9ybXVsYShyb3cpIHsNCiAgICAgIGRlbGV0ZURpc2NvdW50Rm9ybXVsYShyb3cpLnRoZW4oKCkgPT4gew0KICAgICAgICB0aGlzLm5vdGlmeVN1Y2Nlc3ModGhpcy4kdCgnc3VjY2Vzc01lc3NhZ2UuZGVsZXRlJykpDQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9jdXJyZW50LnJlbG9hZCgpDQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5yZWxvYWQoKQ0KICAgICAgICBpZiAodGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8pIHsNCiAgICAgICAgICBmb3IgKGNvbnN0IGRpc2NvdW50IG9mIHRoaXMuZGlzY291bnRUYWJsZURhdGEpIHsNCiAgICAgICAgICAgIGlmIChkaXNjb3VudC5pZCA9PT0gdGhpcy5zZWxlY3RlZERpc2NvdW50LmlkKSB7DQogICAgICAgICAgICAgIHRoaXMuJHNldChkaXNjb3VudCwgJ3BkQ21wbkNhbGNDb2RlJywgdW5kZWZpbmVkKQ0KICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRlbWl0KCdicmluZ0luQ2FsY0NvZGUnLCAnNDAnLCByb3cucGRCdXNzSWQsIHVuZGVmaW5lZCkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIGhhbmRsZVNlbGVjdEZvcm11bGEocm93KSB7DQogICAgICBsZXQgUGR0ZW1wUGRDYWxjID0gew0KICAgICAgICBwZEluZm9JZDogdGhpcy5wcm9kdWN0LmlkLA0KICAgICAgICBwZFZlcklkOiB0aGlzLnByb2R1Y3QucGRWZXJJZCwNCiAgICAgICAgcGRUeXBlOiAnJywNCiAgICAgICAgcGRDb2RlOiB0aGlzLnByb2R1Y3QucGRDb2RlLA0KICAgICAgICBwZEJ1c3NUeXBlOiAnMScsDQogICAgICAgIHBkQnVzc0RldGFpbFR5cGU6ICc0MCcsDQogICAgICAgIHBkQnVzc0lkOiB0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbyA/IHRoaXMuc2VsZWN0ZWREaXNjb3VudC5pZCA6IHRoaXMucGREaXNDb3VudC5pZCwNCiAgICAgICAgcGRCdXNzQ29kZTogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8gPyB0aGlzLnNlbGVjdGVkRGlzY291bnQucGRDbXBuQ29kZSA6IHRoaXMucGREaXNDb3VudC5wZENtcG5Db2RlLA0KICAgICAgICBwZFN0cnVjdHVyZVR5cGU6ICcwOCcsDQogICAgICAgIHBkQ2FsY0NvZGU6IHJvdy5wZENhbGNDb2RlLA0KICAgICAgICBwZENhbGNEZXNjOiByb3cucGRDYWxjRGVzYw0KICAgICAgfQ0KICAgICAgaWYgKCF0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbykgew0KICAgICAgICB0aGlzLnBkRGlzQ291bnQucGRDbXBuUmFuZ2UgPSBTdHJpbmcodGhpcy5wZERpc0NvdW50LnBkQ21wblJhbmdlKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZERpc2NvdW50LnBkQ21wblJhbmdlID0gU3RyaW5nKHRoaXMuc2VsZWN0ZWREaXNjb3VudC5wZENtcG5SYW5nZSkNCiAgICAgIH0NCiAgICAgIC8v5YWz6IGU5YWs5byP6KGoDQogICAgICBjb25zdCBwYXJhbSA9IHsNCiAgICAgICAgc2VsZWN0ZWRGb3JtdWxhOiByb3csDQogICAgICAgIHBkdGVtcFBkQ2FsYzogUGR0ZW1wUGRDYWxjLA0KICAgICAgICBwcm9kdWN0OiB0aGlzLnByb2R1Y3QsDQogICAgICAgIHBkQnVzc1R5cGU6ICcxJywNCiAgICAgICAgcGRCdXNzRGV0YWlsVHlwZTogJzQwJywNCiAgICAgICAgbmVlZENoZWNraW5nOiB0cnVlDQogICAgICB9DQogICAgICBjb250YWN0Rm9ybXVsYSh0aGlzLmJ1aWxkUmVxdWVzdERhdGEocGFyYW0pKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgY29uc3QgcGR0ZW1wUGRDYWxjID0gcmVzcG9uc2UuZGF0YS5wZHRlbXBQZENhbGMNCiAgICAgICAgY29uc3QgZmxhZyA9IHJlc3BvbnNlLmRhdGEuZmxhZw0KICAgICAgICBpZiAoZmxhZyA9PT0gdHJ1ZSkgew0KICAgICAgICAgIC8vIOWFs+iBlOS6p+WTgeS8mOaDoOihqA0KICAgICAgICAgIGlmICh0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbykgew0KICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERpc2NvdW50LnBkQ21wbkNhbGNDb2RlID0gcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5wZERpc0NvdW50LnBkQ21wbkNhbGNDb2RlID0gcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUNCiAgICAgICAgICB9DQogICAgICAgICAgdXBkYXRlUGR0ZW1wUGRDbXBuSW5mbyh0aGlzLmJ1aWxkUmVxdWVzdERhdGEoeyJQZHRlbXBQZENtcG5JbmZvIjogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8gPyB0aGlzLnNlbGVjdGVkRGlzY291bnQgOiB0aGlzLnBkRGlzQ291bnQsfSkpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5ub3RpZnlTdWNjZXNzKHRoaXMuJHQoInJ1bGUuYXNzb2NpYXRpb25TdWNjZXNzIikpDQogICAgICAgICAgICB0aGlzLiRyZWZzLnBhZ2VfY3VycmVudC5yZWxvYWQoKQ0KICAgICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnJlbG9hZCgpDQogICAgICAgICAgICBpZiAoIXRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvKSB7DQogICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2JyaW5nSW5DYWxjQ29kZScsIHBkdGVtcFBkQ2FsYy5wZEJ1c3NEZXRhaWxUeXBlLCBwZHRlbXBQZENhbGMucGRCdXNzSWQsIHBkdGVtcFBkQ2FsYy5wZENhbGNDb2RlKQ0KICAgICAgICAgICAgICB0aGlzLnBkRGlzQ291bnQucGRDbXBuUmFuZ2UgPSBbdGhpcy5wZERpc0NvdW50LnBkQ21wblJhbmdlXQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgZm9yIChjb25zdCBkaXNjb3VudCBvZiB0aGlzLmRpc2NvdW50VGFibGVEYXRhKSB7DQogICAgICAgICAgICAgICAgaWYgKGRpc2NvdW50LmlkID09PSB0aGlzLnNlbGVjdGVkRGlzY291bnQuaWQpIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHNldChkaXNjb3VudCwgJ3BkQ21wbkNhbGNDb2RlJywgcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUpDQogICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kY29uZmlybShTdHJpbmcodGhpcy4kdCgndW5kZXJ3cml0aW5nQW1vdW50Rm9ybXVsYVNlbGVjdC5jb25maXJtX292ZXJ3cml0ZV9mb3JtdWxhJykpLCBTdHJpbmcodGhpcy4kdCgnY29uZmlybU1lc3NhZ2UudGlwJykpLCB7DQogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogU3RyaW5nKHRoaXMuJHQoJ2NvbmZpcm1NZXNzYWdlLmNvbmZpcm0nKSksDQogICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBTdHJpbmcodGhpcy4kdCgnY29uZmlybU1lc3NhZ2UuY2FuY2VsJykpLA0KICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnDQogICAgICAgICAgfSkudGhlbigoKSA9PiB7DQogICAgICAgICAgICBwYXJhbS5uZWVkQ2hlY2tpbmcgPSBmYWxzZQ0KICAgICAgICAgICAgY29udGFjdEZvcm11bGEodGhpcy5idWlsZFJlcXVlc3REYXRhKHBhcmFtKSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHBkdGVtcFBkQ2FsYyA9IHJlc3BvbnNlLmRhdGEucGR0ZW1wUGRDYWxjDQogICAgICAgICAgICAgIGlmICh0aGlzLnByb2R1Y3RDYWxjUmV2aXNpb25TaG93SU5mbykgew0KICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWREaXNjb3VudC5wZENtcG5DYWxjQ29kZSA9IHBkdGVtcFBkQ2FsYy5wZENhbGNDb2RlDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy5wZERpc0NvdW50LnBkQ21wbkNhbGNDb2RlID0gcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAvLyDlhbPogZTkuqflk4HkvJjmg6DooagNCiAgICAgICAgICAgICAgdXBkYXRlUGR0ZW1wUGRDbXBuSW5mbyh0aGlzLmJ1aWxkUmVxdWVzdERhdGEoeyJQZHRlbXBQZENtcG5JbmZvIjogdGhpcy5wcm9kdWN0Q2FsY1JldmlzaW9uU2hvd0lOZm8gPyB0aGlzLnNlbGVjdGVkRGlzY291bnQgOiB0aGlzLnBkRGlzQ291bnR9KSkudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTdWNjZXNzKHRoaXMuJHQoInJ1bGUuYXNzb2NpYXRpb25TdWNjZXNzIikpDQogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQucmVsb2FkKCkNCiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLnBhZ2VfYnJpZWYucmVsb2FkKCkNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucHJvZHVjdENhbGNSZXZpc2lvblNob3dJTmZvKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdicmluZ0luQ2FsY0NvZGUnLCBwZHRlbXBQZENhbGMucGRCdXNzRGV0YWlsVHlwZSwgcGR0ZW1wUGRDYWxjLnBkQnVzc0lkLCBwZHRlbXBQZENhbGMucGRDYWxjQ29kZSkNCiAgICAgICAgICAgICAgICAgIHRoaXMucGREaXNDb3VudC5wZENtcG5SYW5nZSA9IFt0aGlzLnBkRGlzQ291bnQucGRDbXBuUmFuZ2VdDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZGlzY291bnQgb2YgdGhpcy5kaXNjb3VudFRhYmxlRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoZGlzY291bnQuaWQgPT09IHRoaXMuc2VsZWN0ZWREaXNjb3VudC5pZCkgew0KICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNldChkaXNjb3VudCwgJ3BkQ21wbkNhbGNDb2RlJywgcGR0ZW1wUGRDYWxjLnBkQ2FsY0NvZGUpDQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5tZXNzYWdlSW5mbyh0aGlzLiR0KCd1bmRlcndyaXRpbmdBbW91bnRGb3JtdWxhU2VsZWN0LmNhbmNlbGVkJykpDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOiOt+WPluebuOWQjOe8luWPt+eahOaVsOe7hA0KICAgIGdldE9yZGVyTnVtYmVyKCkgew0KICAgICAgbGV0IHRhYmxlRGF0YSA9IHRoaXMuZGlzY291bnRUYWJsZURhdGENCiAgICAgIGxldCBvcmRlckluZGV4QXJyID0gW10NCiAgICAgIC8vIOaMieeFpyBwYXltZW50SWQg5o6S5bqP77yM5bCGIHBheW1lbnRJZCDnm7jlkIznmoTmlbDmja7ov57lnKjkuIDotbcNCiAgICAgIHRhYmxlRGF0YSA9IHRoaXMuXy5vcmRlckJ5KHRhYmxlRGF0YSwgJ3BkUHJlbUlkJywgJ2FzYycpDQogICAgICB0aGlzLmRpc2NvdW50VGFibGVEYXRhID0gdGFibGVEYXRhDQogICAgICBsZXQgb3JkZXJPYmogPSB7fQ0KICAgICAgdGFibGVEYXRhLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7DQogICAgICAgIGVsZW1lbnQucm93SW5kZXggPSBpbmRleA0KICAgICAgICBpZiAob3JkZXJPYmpbZWxlbWVudC5wZFByZW1JZF0pIHsNCiAgICAgICAgICBvcmRlck9ialtlbGVtZW50LnBkUHJlbUlkXS5wdXNoKGluZGV4KQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG9yZGVyT2JqW2VsZW1lbnQucGRQcmVtSWRdID0gW10NCiAgICAgICAgICBvcmRlck9ialtlbGVtZW50LnBkUHJlbUlkXS5wdXNoKGluZGV4KQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgLy8g6ZyA6KaB5ZCI5bm255qE6KGM55qEaW5kZXjlt7Lnu4/lrZjlnKjkuoblkIzkuIDkuKrmlbDnu4Tph4zvvIzmiorov5nkupvmlbDnu4TlrZjlgqjliLAgdGhpcy5vcmRlckluZGV4QXJyDQogICAgICBmb3IgKGxldCBrIGluIG9yZGVyT2JqKSB7DQogICAgICAgIG9yZGVySW5kZXhBcnIucHVzaChvcmRlck9ialtrXSkNCiAgICAgIH0NCiAgICAgIHRoaXMub3JkZXJJbmRleEFycl9hZGRpdGlvbl9kaXNjb3VudCA9IG9yZGVySW5kZXhBcnINCiAgICB9LA0KICAgIC8vIOS8mOaDoOihqOagvOWQiOW5tg0KICAgIG9iamVjdFNwYW5NZXRob2RfZGlzY291bnQoe3JvdywgY29sdW1uLCByb3dJbmRleCwgY29sdW1uSW5kZXh9KSB7DQogICAgICBpZiAoY29sdW1uSW5kZXggPT09IDIgfHwgY29sdW1uSW5kZXggPT09IDMpIHsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9yZGVySW5kZXhBcnJfYWRkaXRpb25fZGlzY291bnQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBsZXQgZWxlbWVudCA9IHRoaXMub3JkZXJJbmRleEFycl9hZGRpdGlvbl9kaXNjb3VudFtpXQ0KICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZWxlbWVudC5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgbGV0IGl0ZW0gPSBlbGVtZW50W2pdDQogICAgICAgICAgICBpZiAocm93SW5kZXggPT09IGl0ZW0pIHsNCiAgICAgICAgICAgICAgaWYgKGogPT09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgcm93c3BhbjogZWxlbWVudC5sZW5ndGgsDQogICAgICAgICAgICAgICAgICBjb2xzcGFuOiAxDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICByb3dzcGFuOiAwLA0KICAgICAgICAgICAgICAgICAgY29sc3BhbjogMA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgcm93Q2xpY2tfZGlzY291bnQocm93LCBjb2x1bW4sIGV2ZW50KSB7DQogICAgICBpZiAoZXZlbnQudGFyZ2V0Lm5vZGVOYW1lID09PSAiSU5QVVQiKSB7DQogICAgICAgIGlmIChyb3cuaWQgPT09IHRoaXMuc2VsZWN0ZWREaXNjb3VudC5pZCkgew0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWREaXNjb3VudCA9IHt9DQogICAgICAgICAgdGhpcy5mb3JtdWxhTGlzdCA9IFtdDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQudG90YWwgPSAwDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQucGFnZSA9IDENCiAgICAgICAgICB0aGlzLnRhYmxlRGF0YUJyaWVmRm9ybXVsYSA9IFtdDQogICAgICAgICAgdGhpcy4kcmVmcy5wYWdlX2JyaWVmLnRvdGFsID0gMA0KICAgICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5wYWdlID0gMQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBzZWxlY3RlZERpc2NvdW50Q2hhbmdlZCgpIHsNCiAgICAgIHRoaXMucGFyYW1zX2N1cnJlbnQuZXFfcGRCdXNzSWQgPSB0aGlzLnNlbGVjdGVkRGlzY291bnQuaWQNCiAgICAgIHRoaXMucGFyYW1zX2JyaWVmLnBkQnVzc0lkID0gdGhpcy5zZWxlY3RlZERpc2NvdW50LmlkDQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9jdXJyZW50LnJlbG9hZCgpDQogICAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5yZWxvYWQoKQ0KICAgICAgfSkNCiAgICB9LA0KICAgIGJyaW5nSW5DYWxjQ29kZShwZEJ1c3NEZXRhaWxUeXBlLCBwZEJ1c3NJZCwgY2FsY0NvZGUpIHsNCiAgICAgIGZvciAoY29uc3QgZGlzY291bnQgb2YgdGhpcy5kaXNjb3VudFRhYmxlRGF0YSkgew0KICAgICAgICBpZiAoZGlzY291bnQuaWQgPT09IE51bWJlcihwZEJ1c3NJZCkpIHsNCiAgICAgICAgICB0aGlzLiRzZXQoZGlzY291bnQsICdwZENtcG5DYWxjQ29kZScsIGNhbGNDb2RlKQ0KICAgICAgICAgIGJyZWFrDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOiuouato+aXtuWFs+mXreabtOWkmuWFrOW8j+eahOW8ueeqlw0KICAgIGNoYW5nZURpYWxvZ1Zpc2libGVfcGREaXNjb3VudFNlbGVjdChmbGFnKSB7DQogICAgICB0aGlzLnNob3dGb3JtdWxhU2VsZWN0ID0gZmxhZw0KICAgICAgdGhpcy4kcmVmcy5wYWdlX2N1cnJlbnQucmVsb2FkKCkNCiAgICAgIHRoaXMuJHJlZnMucGFnZV9icmllZi5yZWxvYWQoKQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2NA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-definition/pd-framework-def/pd-structure-def/payment-def/discount-formula","sourcesContent":["<template>\r\n  <cus-wraper>\r\n    <cus-page-title-back v-if=\"!productCalcRevisionShowINfo\" :isDialog=\"true\"\r\n                         :label=\"$t('pdDiscountFormulaSelect.pdDisCountCalcMenu')\" @backTo=\"back\"/>\r\n    <cus-page-title-back v-if=\"productCalcRevisionShowINfo\" :label=\"$t('route.pdDiscountFormulaRevision')\"\r\n                         @backTo=\"backToRevision\"/>\r\n\r\n    <el-form v-if=\"!productCalcRevisionShowINfo\" label-width=\"auto\">\r\n      <el-row :gutter=\"10\">\r\n        <el-col :span=\"8\">\r\n          <el-form-item :label=\"$t('pdDiscountFormulaSelect.product')\">\r\n            <el-tag type=\"info\">{{ pdDisCount.pdCode + ':' + pdDisCount.pdName }}</el-tag>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-form-item :label=\"$t('pdDiscountFormulaSelect.premCode')\">\r\n            <el-tag type=\"info\">{{ pdDisCount.pdPremCode + ':' + pdDisCount.pdPayName }}\r\n            </el-tag>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-form-item :label=\"$t('pdDiscountFormulaSelect.pdCmpnCode')\">\r\n            <el-tag type=\"info\">{{ pdDisCount.pdCmpnCode }}</el-tag>\r\n          </el-form-item>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row :gutter=\"10\">\r\n        <el-col :span=\"8\">\r\n          <el-form-item :label=\"$t('pdDiscountFormula.pdCmpnType')\">\r\n            <cus-select v-model=\"pdCmpnType\" :codetype=\"'preferentialType'\" :disabled=\"true\"\r\n                        :filter=\"filterCmpnType\"></cus-select>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :span=\"16\">\r\n          <el-form-item :label=\"$t('pdDiscountFormulaSelect.pdDisRange')\">\r\n            <el-checkbox-group v-model=\"pdDiscountRanges\" :disabled=\"true\">\r\n              <el-checkbox v-for=\"item in pdDiscountOptions\" :key=\"item.value\"\r\n                           :label=\"item.value\">{{ item.label }}\r\n              </el-checkbox>\r\n            </el-checkbox-group>\r\n          </el-form-item>\r\n        </el-col>\r\n      </el-row>\r\n    </el-form>\r\n\r\n    <div v-if=\"productCalcRevisionShowINfo\">\r\n      <cus-table-title :label=\"$t('pay_def.pd_pay_discount')\"></cus-table-title>\r\n      <el-table :data=\"discountTableData\" :span-method=\"objectSpanMethod_discount\" border element-loading-text=\"Loading\"\r\n                fit size=\"mini\" @row-click=\"rowClick_discount\">\r\n        <el-table-column :label=\"$t('table.select')\" align=\"center\" width=\"50\">\r\n          <template slot-scope=\"scope\">\r\n            <el-radio-group v-model=\"selectedDiscount\" @change=\"selectedDiscountChanged\">\r\n              <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n            </el-radio-group>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n          <template v-slot=\"scope\">\r\n            {{ initTableIndex('page_discount', scope.$index) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_code')\" align=\"center\" min-width=\"200\" prop=\"pdPremCode\"\r\n                         sortable></el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_name')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdPayName\"></el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_discount_range')\" align=\"center\" min-width=\"200\" prop=\"pdCmpnRange\">\r\n          <template v-slot=\"scope\">{{ scope.row.pdCmpnRange }}</template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_discount_type')\" align=\"center\" min-width=\"200\" prop=\"pdCmpnType\">\r\n          <template v-slot=\"scope\">{{ scope.row.pdCmpnType | filter_pdCmpnType }}</template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_discount_calc')\" align=\"center\" min-width=\"200\" prop=\"pdCmpnCalcMode\">\r\n          <template v-slot=\"scope\">{{ scope.row.pdCmpnCalcMode | filter_pdCmpnCalcMode }}</template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_discount_val')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCmpnVal\"></el-table-column>\r\n        <el-table-column :label=\"$t('pay_def.pay_discount_calc_code')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCmpnCalcCode\"></el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_discount\" v-model=\"discountTableData\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_discount\" url=\"/pdtemp-pd-discount-formula/base/getAllDiscountByPdInfoId\"/>\r\n    </div>\r\n\r\n    <div v-if=\"!productCalcRevisionShowINfo || productCalcRevisionShowINfo && Object.keys(selectedDiscount).length > 0\">\r\n      <!-- 已选择公式 -->\r\n      <cus-form-title :first=\"true\" :label=\"$t('pdDiscountFormula.selectedDiscountFormula')\"></cus-form-title>\r\n      <cus-table-title :label=\"$t('pdDiscountFormula.pdDiscountFormula')\"/>\r\n      <el-table ref=\"formulaList\" :data=\"formulaList\" border element-loading-text=\"Loading\" fit highlight-current-row\r\n                max-height=\"300\" size=\"mini\">\r\n        <el-table-column :label=\"$t('table.select')\" width=\"50\">\r\n          <template slot-scope=\"scope\">\r\n            <el-radio-group v-model=\"selectedFormula\" @change=\"selectedFormulaChanged\">\r\n              <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n            </el-radio-group>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n          <template v-slot=\"scope\">\r\n            {{ initTableIndex('page_current', scope.$index) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pdDiscountFormulaSelect.details')\" align=\"center\" width=\"80\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"small\" type=\"text\" @click=\"showFormula(scope.row)\">>></el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pdDiscountFormula.discountItem')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCmpnCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdBussDetailType')\" align=\"center\" min-width=\"200\" prop=\"pdBussDetailType\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdBussDetailType | filter_pdBussDetailType }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pdDiscountFormulaSelect.pdCalcCode')\" align=\"center\"\r\n                         min-width=\"200\" prop=\"pdCalcCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('pdDiscountFormulaSelect.pdCalcDesc')\" align=\"center\"\r\n                         min-width=\"200\" prop=\"pdCalcDesc\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" min-width=\"200\">\r\n          <template v-slot=\"scope\">\r\n            {{\r\n              scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n            }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n          <template v-slot=\"scope\">\r\n            <cus-del-btn v-auth=\"'pdtemp-pd-discount-formula:delete'\"\r\n                         @ok=\"handleDeleteFormula(scope.row)\"></cus-del-btn>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_current\" v-model=\"formulaList\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_current\" url=\"/pdtemp-pd-discount-formula/base/search\"/>\r\n\r\n      <!-- 可选择公式 -->\r\n      <cus-form-title :first=\"true\" :label=\"$t('pdDiscountFormula.selectableDiscountFormula')\"\r\n                      style=\"margin-top: 50px\"></cus-form-title>\r\n\r\n      <el-row style=\"text-align: right\">\r\n        <el-button icon=\"el-icon-connection\" size=\"small\" type=\"primary\" @click=\"toSelectFormula\">\r\n          {{ $t('rule.moreFormula') }}\r\n        </el-button>\r\n        <el-button icon=\"el-icon-circle-plus el-icon--left\" size=\"small\" type=\"primary\" @click=\"toAddFormula\">\r\n          {{ $t('rule.toAddFormula') }}\r\n        </el-button>\r\n      </el-row>\r\n\r\n      <cus-table-title :label=\"$t('pdDiscountFormula.discountFormula')\"></cus-table-title>\r\n      <el-table :data=\"tableDataBriefFormula\" border element-loading-text=\"Loading\" fit highlight-current-row\r\n                max-height=\"300\" size=\"mini\">\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" width=\"50\">\r\n          <template v-slot=\"scope\">\r\n            {{ initTableIndex('page_brief', scope.$index) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.detail')\" align=\"center\" width=\"80\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"small\" type=\"text\" @click=\"showFormula(scope.row)\">>></el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :filter-method=\"filter_pdCode\" :filters=\"filters_pdCode\" :label=\"$t('rule.product')\"\r\n                         align=\"center\"\r\n                         min-width=\"200\" sortable>\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.pdCode ? scope.row.pdCode + ':' + scope.row.pdName : '' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('pdDiscountFormula.discountItem')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCmpnCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdBussDetailType')\" align=\"center\" min-width=\"200\" prop=\"pdBussDetailType\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.pdBussDetailType | filter_pdBussDetailType }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdCalcCode')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCalcCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.pdCalcDesc')\" align=\"center\" min-width=\"200\"\r\n                         prop=\"pdCalcDesc\"></el-table-column>\r\n        <el-table-column :label=\"$t('rule.ruleAttr')\" align=\"center\" min-width=\"200\">\r\n          <template v-slot=\"scope\">\r\n            {{\r\n              scope.row.ruleAttr === '1' ? $t('rule.general') : (scope.row.ruleAttr === '2' ? $t('rule.individual') : '')\r\n            }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('table.actions')\" align=\"center\" fixed=\"right\" width=\"120\">\r\n          <template v-slot=\"scope\">\r\n            <el-button v-auth=\"'PremAmountFormul:associate'\" icon=\"el-icon-connection\"\r\n                       size=\"mini\" type=\"primary\" @click=\"handleSelectFormula(scope.row)\">\r\n              {{ $t('form.select') }}\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <cus-pagination ref=\"page_brief\" v-model=\"tableDataBriefFormula\" :autoBuild=\"false\" :pageSize=\"5\"\r\n                      :params=\"params_brief\" url=\"/pdtemp-pd-discount-formula/base/briefFormula\"/>\r\n    </div>\r\n\r\n    <!-- 弹窗（公式选择，订正时使用） -->\r\n    <el-dialog v-if=\"showFormulaSelect\" v-dialog-drag :close-on-click-modal=\"false\"\r\n               :visible.sync=\"showFormulaSelect\" append-to-body center width=\"70%\">\r\n      <pdDiscountFormulaSelect :pdDisCount=\"selectedDiscount\" calculationFormulaType=\"40\" guaranteeDetails=\"1\"\r\n                               @bringInCalcCode=\"bringInCalcCode\"\r\n                               @changeDialogVisible_pdDiscountSelect=\"changeDialogVisible_pdDiscountSelect\"></pdDiscountFormulaSelect>\r\n    </el-dialog>\r\n\r\n    <!-- 规则引擎公式定义弹窗 -->\r\n    <cus-rule-definition :attributeObj=\"attributeObj\" :ruleDefinitionClosed=\"ruleModuleClosed\"\r\n                         :visible=\"formulaVisible\"></cus-rule-definition>\r\n\r\n    <!-- 公式查看和决策树编辑弹窗 -->\r\n    <cus-rule-modify :flag=\"formulaView.flag\" :performType=\"formulaView.performType\" :ruleCode=\"formulaView.ruleCode\"\r\n                     :ruleModifyClosed=\"formulaViewClosed\" :ruleType=\"'2'\"\r\n                     :visible=\"formulaView.visible\"></cus-rule-modify>\r\n\r\n  </cus-wraper>\r\n</template>\r\n\r\n<script>\r\nimport {deleteDiscountFormula} from \"@/api/basicinfo/pdtempDiscountFormula\"\r\nimport {contactFormula, getCalcCode} from \"@/api/basicinfo/pdtempDiscountFormulaSelect\"\r\nimport {updatePdtempPdCmpnInfo} from \"@/api/basicinfo/pdtemppdcmpninfo\"\r\nimport pdDiscountFormulaSelect\r\n  from \"@/views/product-definition/pd-framework-def/pd-structure-def/payment-def/discount-formula-select\"\r\n\r\nlet _this\r\n\r\nexport default {\r\n  name: 'pdDiscountFormula',\r\n  components: {pdDiscountFormulaSelect},\r\n  filters: {\r\n    filter_pdBussType(code) {\r\n      return _this.getCodeName('pdCalcBussType', code)\r\n    },\r\n    filter_pdBussDetailType(code) {\r\n      return _this.getCodeName('ruleBusinessDetailClass', code)\r\n    },\r\n    filter_pdCmpnType(code) {\r\n      return _this.getCodeName('preferentialType', code)\r\n    },\r\n    filter_pdCmpnCalcMode(code) {\r\n      return _this.getCodeName('preferentialClculationType', code)\r\n    }\r\n  },\r\n  props: {\r\n    guaranteeDetails: {\r\n      type: String,\r\n      default: undefined\r\n    },\r\n    calculationFormulaType: {\r\n      type: String,\r\n      default: undefined\r\n    },\r\n    pdDisCount: {\r\n      type: Object,\r\n      required: false,\r\n      default: () => {\r\n        return {}\r\n      }\r\n    },\r\n    pdDiscountRangeOptions: {\r\n      type: Array,\r\n      required: false,\r\n      default: () => {\r\n        return []\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    _this = this\r\n    return {\r\n      page: undefined,\r\n      pageSize: undefined,\r\n      orderIndexArr_addition_discount: [],\r\n      productCalcRevisionShowINfo: false,\r\n      showFormulaSelect: false,\r\n      filters_pdCode: [],\r\n      selectedDiscount: {},\r\n      selectedFormula: {},\r\n      formulaView: {\r\n        flag: '',\r\n        ruleCode: '',\r\n        performType: '',\r\n        visible: false\r\n      },\r\n      formulaVisible: false,\r\n      attributeObj: {},\r\n      product: {\r\n        id: undefined,\r\n        bType: '',\r\n        cType: '',\r\n        pdCode: '',\r\n        pdEdition: '',\r\n        pdVerId: undefined,\r\n        pdSalechnl: '',\r\n        pdName: '',\r\n        pdShortname: '',\r\n        pdEnName: '',\r\n        pdShortEnName: '',\r\n        operator: '',\r\n        pdStartDateRule: '',\r\n        pdStartDateMode: '',\r\n        pdStartPeriod: undefined,\r\n        pdStartPeriodUnit: '',\r\n        pdEndDateRule: '',\r\n        pdEndDateMode: '',\r\n        pdEndPeriod: undefined,\r\n        pdEndPeriodUnit: '',\r\n        pdGracePeriod: undefined,\r\n        pdObservationDay: undefined,\r\n        pdApplDate: undefined,\r\n        pdProcessId: undefined,\r\n        pdStartDate: undefined,\r\n        pdStopDate: undefined,\r\n        createTime: undefined,\r\n        updateTime: undefined\r\n      },\r\n      form_rule: {\r\n        ruleBussModuDeta: '',\r\n        description: ''\r\n      },\r\n      params_discount: {\r\n        pdInfoId: undefined\r\n      },\r\n      params_current: {\r\n        eq_pdInfoId: undefined,\r\n        eq_pdBussType: '1',\r\n        eq_pdBussDetailType: '40',\r\n        eq_pdType: '1',\r\n        eq_pdBussId: undefined\r\n      },\r\n      params_brief: {\r\n        product: undefined,\r\n        pdBussId: undefined,\r\n        productDetailType: '',\r\n        pdBussDetailType: '40'\r\n      },\r\n      pdCmpnType: '',\r\n      pdDiscountRanges: [],\r\n      pdDiscountOptions: [],\r\n      filterCmpnType: '1$D$E$G$I$J$K',\r\n      pdUwSiType: '',\r\n      tableData_formula: [],\r\n      tableDataBriefFormula: [],\r\n      Options: [],\r\n      Options2: [],\r\n      Options3: [],//指定保障数组\r\n      Options4: [],//指定保障明细数组\r\n      discountTableData: [],\r\n      formulaList: []\r\n    }\r\n  },\r\n  watch: {\r\n    tableDataBriefFormula() {\r\n      this.filters_pdCode = []\r\n      for (const item of this.tableDataBriefFormula) {\r\n        if (!this._.includes(this._.map(this.filters_pdCode, 'value'), item.pdCode)) {\r\n          this.filters_pdCode.push({\r\n            text: item.pdCode + ':' + item.pdName,\r\n            value: item.pdCode\r\n          })\r\n        }\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initProductInfo()\r\n    if (this.productCalcRevisionShowINfo) {\r\n      this.$refs.page_discount.reload().then(() => {\r\n        this.getOrderNumber()\r\n      })\r\n    } else {\r\n      // 获取优惠范围\r\n      this.pdDiscountOptions = this.pdDiscountRangeOptions\r\n      this.pdDiscountRanges = this.pdDisCount.pdCmpnRange\r\n      this.pdCmpnType = this.pdDisCount.pdCmpnType\r\n      this.params_current.eq_pdBussId = this.pdDisCount.id\r\n      this.params_brief.pdBussId = this.pdDisCount.id\r\n      this.$refs.page_current.reload()\r\n      this.$refs.page_brief.reload()\r\n    }\r\n  },\r\n  created() {\r\n    this.page = this.$route.query.page\r\n    this.pageSize = this.$route.query.pageSize\r\n    this.productCalcRevisionShowINfo = this.$route.query.productCalcRevisionShowINfo === 'true'\r\n  },\r\n  methods: {\r\n    filter_pdCode(value, row) {\r\n      return value === row.pdCode\r\n    },\r\n    initProductInfo() {\r\n      let pdtempPdInfo = this.getPdData()\r\n      if (Object.keys(pdtempPdInfo).length > 0) {\r\n        Object.assign(this.product, pdtempPdInfo)\r\n        this.params_brief.product = pdtempPdInfo\r\n        this.params_brief.productDetailType = this.product.cType\r\n        this.params_current.eq_pdInfoId = this.product.id\r\n        if (this.productCalcRevisionShowINfo) {\r\n          this.params_discount.pdInfoId = this.product.id\r\n        }\r\n      } else {\r\n        this.notifyError(this.$t('message.invalidProductInfo'))\r\n      }\r\n    },\r\n    ruleModuleClosed() {\r\n      this.formulaVisible = false\r\n      if (!this.productCalcRevisionShowINfo || this.productCalcRevisionShowINfo && Object.keys(this.selectedDiscount).length > 0) {\r\n        this.$refs.page_brief.reload()\r\n      }\r\n    },\r\n    formulaViewClosed() {\r\n      this.formulaView.visible = false\r\n      this.selectedFormula = {}\r\n    },\r\n    selectedFormulaChanged() {\r\n      this.formulaView.flag = this.selectedFormula.ruleAttr === '1' ? '1' : '2'\r\n      this.formulaView.performType = this.selectedFormula.performType\r\n      this.formulaView.ruleCode = this.selectedFormula.pdCalcCode\r\n      this.formulaView.visible = true\r\n    },\r\n    showFormula(row) {\r\n      this.formulaView.flag = '1'\r\n      this.formulaView.ruleCode = row.pdCalcCode\r\n      this.formulaView.performType = row.performType\r\n      this.formulaView.visible = true\r\n    },\r\n    back() {\r\n      this.$emit('changeDialogVisible_pdDiscount', false)\r\n    },\r\n    backToRevision() {\r\n      this.$router.push({name: '产品公式订正主页', params: {path: this.$route.path, page: this.page, pageSize: this.pageSize}})\r\n    },\r\n    toSelectFormula() {\r\n      if (this.productCalcRevisionShowINfo) {\r\n        if (Object.keys(this.selectedDiscount).length === 0) {\r\n          this.notifyError(this.$t('pdDiscountFormula.pleaseSelectDiscount'))\r\n          return\r\n        }\r\n        this.showFormulaSelect = true\r\n      } else {\r\n        this.$emit('changeDialogVisible_pdDiscountSelect', true)\r\n      }\r\n    },\r\n    toAddFormula() {\r\n      const param = {\r\n        pdBussType: '1',\r\n        pdBussDetailType: '40'\r\n      }\r\n      getCalcCode(this.buildRequestData(param)).then(response => {\r\n        this.attributeObj = {\r\n          code: response.data,\r\n          ruleBussModu: '1',\r\n          ruleBussModuDeta: '40',\r\n          ruleType: '2',\r\n          pdType: '1',\r\n          riskType: this.product.bType,\r\n          riskDetail: this.product.cType,\r\n          pdCode: this.product.pdCode,\r\n          ruleAscrCls: '5',\r\n          ruleAscrDeta: this.productCalcRevisionShowINfo ? this.selectedDiscount.pdCmpnType : this.pdDisCount.pdCmpnType,\r\n          pdEdition: this.product.pdEdition\r\n        }\r\n        this.formulaVisible = true\r\n      })\r\n    },\r\n    handleDeleteFormula(row) {\r\n      deleteDiscountFormula(row).then(() => {\r\n        this.notifySuccess(this.$t('successMessage.delete'))\r\n        this.$refs.page_current.reload()\r\n        this.$refs.page_brief.reload()\r\n        if (this.productCalcRevisionShowINfo) {\r\n          for (const discount of this.discountTableData) {\r\n            if (discount.id === this.selectedDiscount.id) {\r\n              this.$set(discount, 'pdCmpnCalcCode', undefined)\r\n              break\r\n            }\r\n          }\r\n        } else {\r\n          this.$emit('bringInCalcCode', '40', row.pdBussId, undefined)\r\n        }\r\n      })\r\n    },\r\n    handleSelectFormula(row) {\r\n      let PdtempPdCalc = {\r\n        pdInfoId: this.product.id,\r\n        pdVerId: this.product.pdVerId,\r\n        pdType: '',\r\n        pdCode: this.product.pdCode,\r\n        pdBussType: '1',\r\n        pdBussDetailType: '40',\r\n        pdBussId: this.productCalcRevisionShowINfo ? this.selectedDiscount.id : this.pdDisCount.id,\r\n        pdBussCode: this.productCalcRevisionShowINfo ? this.selectedDiscount.pdCmpnCode : this.pdDisCount.pdCmpnCode,\r\n        pdStructureType: '08',\r\n        pdCalcCode: row.pdCalcCode,\r\n        pdCalcDesc: row.pdCalcDesc\r\n      }\r\n      if (!this.productCalcRevisionShowINfo) {\r\n        this.pdDisCount.pdCmpnRange = String(this.pdDisCount.pdCmpnRange)\r\n      } else {\r\n        this.selectedDiscount.pdCmpnRange = String(this.selectedDiscount.pdCmpnRange)\r\n      }\r\n      //关联公式表\r\n      const param = {\r\n        selectedFormula: row,\r\n        pdtempPdCalc: PdtempPdCalc,\r\n        product: this.product,\r\n        pdBussType: '1',\r\n        pdBussDetailType: '40',\r\n        needChecking: true\r\n      }\r\n      contactFormula(this.buildRequestData(param)).then(response => {\r\n        const pdtempPdCalc = response.data.pdtempPdCalc\r\n        const flag = response.data.flag\r\n        if (flag === true) {\r\n          // 关联产品优惠表\r\n          if (this.productCalcRevisionShowINfo) {\r\n            this.selectedDiscount.pdCmpnCalcCode = pdtempPdCalc.pdCalcCode\r\n          } else {\r\n            this.pdDisCount.pdCmpnCalcCode = pdtempPdCalc.pdCalcCode\r\n          }\r\n          updatePdtempPdCmpnInfo(this.buildRequestData({\"PdtempPdCmpnInfo\": this.productCalcRevisionShowINfo ? this.selectedDiscount : this.pdDisCount,})).then(() => {\r\n            this.notifySuccess(this.$t(\"rule.associationSuccess\"))\r\n            this.$refs.page_current.reload()\r\n            this.$refs.page_brief.reload()\r\n            if (!this.productCalcRevisionShowINfo) {\r\n              this.$emit('bringInCalcCode', pdtempPdCalc.pdBussDetailType, pdtempPdCalc.pdBussId, pdtempPdCalc.pdCalcCode)\r\n              this.pdDisCount.pdCmpnRange = [this.pdDisCount.pdCmpnRange]\r\n            } else {\r\n              for (const discount of this.discountTableData) {\r\n                if (discount.id === this.selectedDiscount.id) {\r\n                  this.$set(discount, 'pdCmpnCalcCode', pdtempPdCalc.pdCalcCode)\r\n                  break\r\n                }\r\n              }\r\n            }\r\n          })\r\n        } else {\r\n          this.$confirm(String(this.$t('underwritingAmountFormulaSelect.confirm_overwrite_formula')), String(this.$t('confirmMessage.tip')), {\r\n            confirmButtonText: String(this.$t('confirmMessage.confirm')),\r\n            cancelButtonText: String(this.$t('confirmMessage.cancel')),\r\n            type: 'warning'\r\n          }).then(() => {\r\n            param.needChecking = false\r\n            contactFormula(this.buildRequestData(param)).then(response => {\r\n              const pdtempPdCalc = response.data.pdtempPdCalc\r\n              if (this.productCalcRevisionShowINfo) {\r\n                this.selectedDiscount.pdCmpnCalcCode = pdtempPdCalc.pdCalcCode\r\n              } else {\r\n                this.pdDisCount.pdCmpnCalcCode = pdtempPdCalc.pdCalcCode\r\n              }\r\n              // 关联产品优惠表\r\n              updatePdtempPdCmpnInfo(this.buildRequestData({\"PdtempPdCmpnInfo\": this.productCalcRevisionShowINfo ? this.selectedDiscount : this.pdDisCount})).then(() => {\r\n                this.notifySuccess(this.$t(\"rule.associationSuccess\"))\r\n                this.$refs.page_current.reload()\r\n                this.$refs.page_brief.reload()\r\n                if (!this.productCalcRevisionShowINfo) {\r\n                  this.$emit('bringInCalcCode', pdtempPdCalc.pdBussDetailType, pdtempPdCalc.pdBussId, pdtempPdCalc.pdCalcCode)\r\n                  this.pdDisCount.pdCmpnRange = [this.pdDisCount.pdCmpnRange]\r\n                } else {\r\n                  for (const discount of this.discountTableData) {\r\n                    if (discount.id === this.selectedDiscount.id) {\r\n                      this.$set(discount, 'pdCmpnCalcCode', pdtempPdCalc.pdCalcCode)\r\n                      break\r\n                    }\r\n                  }\r\n                }\r\n              })\r\n            })\r\n          }).catch(() => {\r\n            this.messageInfo(this.$t('underwritingAmountFormulaSelect.canceled'))\r\n          })\r\n        }\r\n      })\r\n    },\r\n    // 获取相同编号的数组\r\n    getOrderNumber() {\r\n      let tableData = this.discountTableData\r\n      let orderIndexArr = []\r\n      // 按照 paymentId 排序，将 paymentId 相同的数据连在一起\r\n      tableData = this._.orderBy(tableData, 'pdPremId', 'asc')\r\n      this.discountTableData = tableData\r\n      let orderObj = {}\r\n      tableData.forEach((element, index) => {\r\n        element.rowIndex = index\r\n        if (orderObj[element.pdPremId]) {\r\n          orderObj[element.pdPremId].push(index)\r\n        } else {\r\n          orderObj[element.pdPremId] = []\r\n          orderObj[element.pdPremId].push(index)\r\n        }\r\n      })\r\n      // 需要合并的行的index已经存在了同一个数组里，把这些数组存储到 this.orderIndexArr\r\n      for (let k in orderObj) {\r\n        orderIndexArr.push(orderObj[k])\r\n      }\r\n      this.orderIndexArr_addition_discount = orderIndexArr\r\n    },\r\n    // 优惠表格合并\r\n    objectSpanMethod_discount({row, column, rowIndex, columnIndex}) {\r\n      if (columnIndex === 2 || columnIndex === 3) {\r\n        for (let i = 0; i < this.orderIndexArr_addition_discount.length; i++) {\r\n          let element = this.orderIndexArr_addition_discount[i]\r\n          for (let j = 0; j < element.length; j++) {\r\n            let item = element[j]\r\n            if (rowIndex === item) {\r\n              if (j === 0) {\r\n                return {\r\n                  rowspan: element.length,\r\n                  colspan: 1\r\n                }\r\n              } else {\r\n                return {\r\n                  rowspan: 0,\r\n                  colspan: 0\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    rowClick_discount(row, column, event) {\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (row.id === this.selectedDiscount.id) {\r\n          this.selectedDiscount = {}\r\n          this.formulaList = []\r\n          this.$refs.page_current.total = 0\r\n          this.$refs.page_current.page = 1\r\n          this.tableDataBriefFormula = []\r\n          this.$refs.page_brief.total = 0\r\n          this.$refs.page_brief.page = 1\r\n        }\r\n      }\r\n    },\r\n    selectedDiscountChanged() {\r\n      this.params_current.eq_pdBussId = this.selectedDiscount.id\r\n      this.params_brief.pdBussId = this.selectedDiscount.id\r\n      this.$nextTick(() => {\r\n        this.$refs.page_current.reload()\r\n        this.$refs.page_brief.reload()\r\n      })\r\n    },\r\n    bringInCalcCode(pdBussDetailType, pdBussId, calcCode) {\r\n      for (const discount of this.discountTableData) {\r\n        if (discount.id === Number(pdBussId)) {\r\n          this.$set(discount, 'pdCmpnCalcCode', calcCode)\r\n          break\r\n        }\r\n      }\r\n    },\r\n    // 订正时关闭更多公式的弹窗\r\n    changeDialogVisible_pdDiscountSelect(flag) {\r\n      this.showFormulaSelect = flag\r\n      this.$refs.page_current.reload()\r\n      this.$refs.page_brief.reload()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n</style>\r\n"]}]}