{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\test\\draggable\\JsonDrawer.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\test\\draggable\\JsonDrawer.vue","mtime":1609847107204},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBiZWF1dGlmaWVyQ29uZiB9IGZyb20gJ0AvdXRpbHMvZHJhZ2dhYmxlL2luZGV4Jw0KaW1wb3J0IENsaXBib2FyZEpTIGZyb20gJ2NsaXBib2FyZCcNCmltcG9ydCB7IHNhdmVBcyB9IGZyb20gJ2ZpbGUtc2F2ZXInDQoNCmltcG9ydCBsb2FkQmVhdXRpZmllciBmcm9tICdAL3V0aWxzL2RyYWdnYWJsZS9sb2FkQmVhdXRpZmllcicNCg0KaW1wb3J0ICogYXMgbW9uYWNvIGZyb20gJ21vbmFjby1lZGl0b3InOw0KbGV0IGJlYXV0aWZpZXINCg0KZXhwb3J0IGRlZmF1bHQgew0KICBjb21wb25lbnRzOiB7fSwNCiAgcHJvcHM6IHsNCiAgICBqc29uU3RyOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICByZXF1aXJlZDogdHJ1ZSwNCiAgICAgIGJlYXV0aWZpZXI6IG51bGwsDQogICAgICBqc29uRWRpdG9yOiBudWxsDQogICAgfQ0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7fQ0KICB9LA0KICBjb21wdXRlZDoge30sDQogIHdhdGNoOiB7fSwNCiAgY3JlYXRlZCgpIHt9LA0KICBtb3VudGVkKCkgew0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5wcmV2ZW50RGVmYXVsdFNhdmUpDQogICAgY29uc3QgY2xpcGJvYXJkID0gbmV3IENsaXBib2FyZEpTKCcuY29weS1qc29uLWJ0bicsIHsNCiAgICAgIHRleHQ6IHRyaWdnZXIgPT4gew0KICAgICAgICB0aGlzLiRub3RpZnkoew0KICAgICAgICAgIHRpdGxlOiAn5oiQ5YqfJywNCiAgICAgICAgICBtZXNzYWdlOiAn5Luj56CB5bey5aSN5Yi25Yiw5Ymq5YiH5p2/77yM5Y+v57KY6LS044CCJywNCiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuIHRoaXMuYmVhdXRpZmllckpzb24NCiAgICAgIH0NCiAgICB9KQ0KICAgIGNsaXBib2FyZC5vbignZXJyb3InLCBlID0+IHsNCiAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S7o+eggeWkjeWItuWksei0pScpDQogICAgfSkNCiAgfSwNCiAgYmVmb3JlRGVzdHJveSgpIHsNCiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMucHJldmVudERlZmF1bHRTYXZlKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgcHJldmVudERlZmF1bHRTYXZlKGUpIHsNCiAgICAgIGlmIChlLmtleSA9PT0gJ3MnICYmIChlLm1ldGFLZXkgfHwgZS5jdHJsS2V5KSkgew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCkNCiAgICAgIH0NCiAgICB9LA0KICAgIG9uT3BlbigpIHsNCiAgICAgIGxvYWRCZWF1dGlmaWVyKGJ0ZiA9PiB7DQogICAgICAgIGJlYXV0aWZpZXIgPSBidGYNCiAgICAgICAgdGhpcy5iZWF1dGlmaWVySnNvbiA9IGJlYXV0aWZpZXIuanModGhpcy5qc29uU3RyLCBiZWF1dGlmaWVyQ29uZi5qcykNCiAgICAgICAgIHRoaXMuc2V0RWRpdG9yVmFsdWUoJ2VkaXRvckpzb24nLCB0aGlzLmJlYXV0aWZpZXJKc29uKQ0KICAgICAgfSkNCiAgICB9LA0KICAgIG9uQ2xvc2UoKSB7fSwNCiAgICBzZXRFZGl0b3JWYWx1ZShpZCwgY29kZVN0cikgew0KICAgICAgaWYgKHRoaXMuanNvbkVkaXRvcikgew0KICAgICAgICB0aGlzLmpzb25FZGl0b3Iuc2V0VmFsdWUoY29kZVN0cikNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuanNvbkVkaXRvciA9IG1vbmFjby5lZGl0b3IuY3JlYXRlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSwgew0KICAgICAgICAgIHZhbHVlOiBjb2RlU3RyLA0KICAgICAgICAgIHRoZW1lOiAndnMtZGFyaycsDQogICAgICAgICAgbGFuZ3VhZ2U6ICdqc29uJywNCiAgICAgICAgICBhdXRvbWF0aWNMYXlvdXQ6IHRydWUNCiAgICAgICAgfSkNCiAgICAgICAgLy8gY3RybCArIHMg5Yi35pawDQogICAgICAgIHRoaXMuanNvbkVkaXRvci5vbktleURvd24oZSA9PiB7DQogICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gNDkgJiYgKGUubWV0YUtleSB8fCBlLmN0cmxLZXkpKSB7DQogICAgICAgICAgICB0aGlzLnJlZnJlc2goKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICB9LA0KICAgIGV4cG9ydEpzb25GaWxlKCkgew0KICAgICAgdGhpcy4kcHJvbXB0KCfmlofku7blkI06JywgJ+WvvOWHuuaWh+S7ticsIHsNCiAgICAgICAgaW5wdXRWYWx1ZTogYCR7K25ldyBEYXRlKCl9Lmpzb25gLA0KICAgICAgICBjbG9zZU9uQ2xpY2tNb2RhbDogZmFsc2UsDQogICAgICAgIGlucHV0UGxhY2Vob2xkZXI6ICfor7fovpPlhaXmlofku7blkI0nDQogICAgICB9KS50aGVuKCh7IHZhbHVlIH0pID0+IHsNCiAgICAgICAgaWYgKCF2YWx1ZSkgdmFsdWUgPSBgJHsrbmV3IERhdGUoKX0uanNvbmANCiAgICAgICAgY29uc3QgY29kZVN0ciA9IHRoaXMuanNvbkVkaXRvci5nZXRWYWx1ZSgpDQogICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY29kZVN0cl0sIHsgdHlwZTogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSkNCiAgICAgICAgc2F2ZUFzKGJsb2IsIHZhbHVlKQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHJlZnJlc2goKSB7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLiRlbWl0KCdyZWZyZXNoJywgSlNPTi5wYXJzZSh0aGlzLmpzb25FZGl0b3IuZ2V0VmFsdWUoKSkpDQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICB0aGlzLiRub3RpZnkoew0KICAgICAgICAgIHRpdGxlOiAn6ZSZ6K+vJywNCiAgICAgICAgICBtZXNzYWdlOiAnSlNPTuagvOW8j+mUmeivr++8jOivt+ajgOafpScsDQogICAgICAgICAgdHlwZTogJ2Vycm9yJw0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["JsonDrawer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"JsonDrawer.vue","sourceRoot":"src/views/test/draggable","sourcesContent":["<template>\r\n  <div>\r\n    <el-drawer v-bind=\"$attrs\" v-on=\"$listeners\" @opened=\"onOpen\" @close=\"onClose\">\r\n      <div class=\"action-bar\" :style=\"{'text-align': 'left'}\">\r\n        <span class=\"bar-btn\" @click=\"refresh\">\r\n          <i class=\"el-icon-refresh\" />\r\n          {{$t('table.refresh')}}\r\n        </span>\r\n        <span ref=\"copyBtn\" class=\"bar-btn copy-json-btn\">\r\n          <i class=\"el-icon-document-copy\" />\r\n          {{$t('i18nView.copyJSON')}}\r\n        </span>\r\n        <span class=\"bar-btn\" @click=\"exportJsonFile\">\r\n          <i class=\"el-icon-download\" />\r\n          {{$t('i18nView.exportJSONFile')}}\r\n        </span>\r\n        <span class=\"bar-btn delete-btn\" @click=\"$emit('update:visible', false)\">\r\n          <i class=\"el-icon-circle-close\" />\r\n          {{$t('table.close')}}\r\n        </span>\r\n      </div>\r\n      <div id=\"editorJson\" class=\"json-editor\" />\r\n    </el-drawer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { beautifierConf } from '@/utils/draggable/index'\r\nimport ClipboardJS from 'clipboard'\r\nimport { saveAs } from 'file-saver'\r\n\r\nimport loadBeautifier from '@/utils/draggable/loadBeautifier'\r\n\r\nimport * as monaco from 'monaco-editor';\r\nlet beautifier\r\n\r\nexport default {\r\n  components: {},\r\n  props: {\r\n    jsonStr: {\r\n      type: String,\r\n      required: true,\r\n      beautifier: null,\r\n      jsonEditor: null\r\n    }\r\n  },\r\n  data() {\r\n    return {}\r\n  },\r\n  computed: {},\r\n  watch: {},\r\n  created() {},\r\n  mounted() {\r\n    window.addEventListener('keydown', this.preventDefaultSave)\r\n    const clipboard = new ClipboardJS('.copy-json-btn', {\r\n      text: trigger => {\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '代码已复制到剪切板，可粘贴。',\r\n          type: 'success'\r\n        })\r\n        return this.beautifierJson\r\n      }\r\n    })\r\n    clipboard.on('error', e => {\r\n      this.$message.error('代码复制失败')\r\n    })\r\n  },\r\n  beforeDestroy() {\r\n    window.removeEventListener('keydown', this.preventDefaultSave)\r\n  },\r\n  methods: {\r\n    preventDefaultSave(e) {\r\n      if (e.key === 's' && (e.metaKey || e.ctrlKey)) {\r\n        e.preventDefault()\r\n      }\r\n    },\r\n    onOpen() {\r\n      loadBeautifier(btf => {\r\n        beautifier = btf\r\n        this.beautifierJson = beautifier.js(this.jsonStr, beautifierConf.js)\r\n         this.setEditorValue('editorJson', this.beautifierJson)\r\n      })\r\n    },\r\n    onClose() {},\r\n    setEditorValue(id, codeStr) {\r\n      if (this.jsonEditor) {\r\n        this.jsonEditor.setValue(codeStr)\r\n      } else {\r\n        this.jsonEditor = monaco.editor.create(document.getElementById(id), {\r\n          value: codeStr,\r\n          theme: 'vs-dark',\r\n          language: 'json',\r\n          automaticLayout: true\r\n        })\r\n        // ctrl + s 刷新\r\n        this.jsonEditor.onKeyDown(e => {\r\n          if (e.keyCode === 49 && (e.metaKey || e.ctrlKey)) {\r\n            this.refresh()\r\n          }\r\n        })\r\n      }\r\n    },\r\n    exportJsonFile() {\r\n      this.$prompt('文件名:', '导出文件', {\r\n        inputValue: `${+new Date()}.json`,\r\n        closeOnClickModal: false,\r\n        inputPlaceholder: '请输入文件名'\r\n      }).then(({ value }) => {\r\n        if (!value) value = `${+new Date()}.json`\r\n        const codeStr = this.jsonEditor.getValue()\r\n        const blob = new Blob([codeStr], { type: 'text/plain;charset=utf-8' })\r\n        saveAs(blob, value)\r\n      })\r\n    },\r\n    refresh() {\r\n      try {\r\n        this.$emit('refresh', JSON.parse(this.jsonEditor.getValue()))\r\n      } catch (error) {\r\n        this.$notify({\r\n          title: '错误',\r\n          message: 'JSON格式错误，请检查',\r\n          type: 'error'\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '@/styles/mixin.scss';\r\n\r\n::v-deep .el-drawer__header {\r\n  display: none;\r\n}\r\n@include action-bar;\r\n\r\n.json-editor{\r\n  height: calc(100vh - 33px);\r\n}\r\n</style>\r\n"]}]}