{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-structure-def\\program-def\\index.vue?vue&type=style&index=0&id=77ddff30&lang=scss&scoped=true&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-structure-def\\program-def\\index.vue","mtime":1609847106903},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1706753188288},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1706753191924},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1706753189537},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1706753187424},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KDQouc2hvd0RpdiB7DQogIHdpZHRoOiA5MCU7DQogIGhlaWdodDogMTAwJTsNCiAgbWFyZ2luLXRvcDogLTQwcHg7DQogIG1hcmdpbi1sZWZ0OiAtNDBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBiYWNrZ3JvdW5kOiAjZmZmZmZmMDA7DQogIHotaW5kZXg6IDk5OTsNCn0NCg0KLmRpdmlkZXIgew0KICBjb2xvcjogYmxhY2s7DQogIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOw0KICB3aWR0aDogMXB4Ow0KfQ0KDQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAo2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-definition/pd-framework-def/pd-structure-def/program-def","sourcesContent":["<template>\r\n  <cus-wraper>\r\n    <div :class=\"{ 'showDiv': this.showPageFlagS == 1 }\"></div>\r\n    <cus-page-title :label=\"$t('productProgramme1.pageTitle')\"/>\r\n    <!-- 产品信息 -->\r\n    <cus-product-info></cus-product-info>\r\n    <div v-if=\"reaadOnlyPpProg\">\r\n\r\n    <el-divider content-position=\"left\"><i class=\"el-icon-s-grid\">{{$t('i18nView.productSolution')}}</i></el-divider>\r\n    <!-- 方案表格 -->\r\n    <el-table :data=\"tableData_programme\" :span-method=\"objectSpanMethod_programme\" @row-click=\"rowClick\"\r\n              border element-loading-text=\"Loading\"\r\n              fit max-height=\"500\" ref=\"page_programme\" size=\"mini\">\r\n      <el-table-column :label=\"$t('table.select')\" align=\"center\" width=\"80px\">\r\n        <template slot-scope=\"scope\">\r\n          <el-radio-group @change=\"selectedProgrammeChanged\" v-model=\"selectedProgramme\">\r\n            <span>\r\n              <el-radio :label=\"scope.row\">{{ '' }}</el-radio>\r\n            </span>\r\n            <span\r\n              v-if=\"selectedProgramme.programme.id && scope.row.programme.id && selectedProgramme.programme.id === scope.row.programme.id\"></span>\r\n          </el-radio-group>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\">\r\n        <template v-slot=\"scope\">\r\n          {{ scope.row.mergedRowIndex + 1 }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('productProgramme.pdProgCode')\" align=\"center\" prop=\"programmeCode\"></el-table-column>\r\n      <el-table-column :label=\"$t('productProgramme.pdProgName')\" align=\"center\" prop=\"programmeName\"></el-table-column>\r\n      <el-table-column :label=\"$t('productProgramme1.premiumCode')\" align=\"center\" prop=\"premiumCode\"></el-table-column>\r\n      <el-table-column :label=\"$t('productProgramme1.premiumName')\" align=\"center\" prop=\"premiumName\"></el-table-column>\r\n      <el-table-column :label=\"$t('i18nView.guaranteeCode')\" align=\"center\" prop=\"benefitCode\"></el-table-column>\r\n      <el-table-column :label=\"$t('productProgramme.pdBnftName')\" align=\"center\" prop=\"benefitName\"></el-table-column>\r\n    </el-table>\r\n    <!-- 分页 -->\r\n    <cus-pagination :mergedAttrName=\"'programmeCode'\" :needMerging=\"true\"\r\n                    :orderBy=\"{attrNames: ['programmeCode', 'benefitType'], orders: ['asc', 'asc']}\"\r\n                    :orderIndexArrName=\"'orderIndexArr_programme'\" :pageSize=\"10\" :params=\"params_programme\"\r\n                    :showMergedIndex=\"true\" :tableData=\"tableData_programme\" @updateOrderIndexArr=\"updateOrderIndexArr\"\r\n                    ref=\"page_programme\" url=\"/pdtemp-pd-prog/base/list\" v-model=\"tableData_programme\"/>\r\n\r\n    </div>\r\n\r\n\r\n\r\n        <cus-form-title :label=\"$t('productProgramme.combination')\" ></cus-form-title>\r\n    <!-- 方案组合表单 -->\r\n    <div style=\"width: 80%\" :model=\"form_combination\">\r\n      <el-row style=\"margin-bottom: 10px\">\r\n        <span @click=\"pageFlag.premium = !pageFlag.premium\" class=\"tree-ctrl\">\r\n          <i class=\"el-icon-caret-bottom\" style=\"color: #606266;font-size: 12px\"\r\n             v-if=\"true === pageFlag.premium\"/>\r\n          <i class=\"el-icon-caret-right\" style=\"color: #606266;font-size: 12px\"\r\n             v-if=\"false === pageFlag.premium\"/>\r\n        </span>\r\n        <span @click=\"pageFlag.premium = !pageFlag.premium\"\r\n              style=\"margin-left: 20px;cursor: pointer ;font-size: 12px\">{{ $t('productProgramme1.premiumInfo') }}</span>\r\n        <div style=\"margin: 0 0 0 25px\" v-if=\"pageFlag.premium\">\r\n          <el-radio-group  :disabled=\"reaadOnlyPpProg==false\" v-model=\"form_combination.premium\">\r\n            <div v-for=\"premium in premiumList\">\r\n              <el-radio style=\"margin: 0 0 0 0px\" :label=\"premium\" v-model=\"premium.pdPremCode\">{{ premium.pdPremCode + ' - ' + premium.pdPayName }}</el-radio>\r\n              <el-button   @click=\"toPremiumPage(premium.pdPremCode)\" size=\"mini\" style=\"margin-left: 5px\" type=\"text\" dialog-disable=\"disable\">>></el-button>\r\n            </div>\r\n          </el-radio-group>\r\n        </div>\r\n      </el-row>\r\n\r\n      <el-row style=\"margin-bottom: 10px\">\r\n        <el-col :span=\"24\">\r\n          <span @click=\"pageFlag.survival = !pageFlag.survival\" class=\"tree-ctrl\">\r\n            <i class=\"el-icon-caret-bottom\" style=\"color: #606266;font-size: 12px\"\r\n               v-if=\"true === pageFlag.survival\"/>\r\n            <i class=\"el-icon-caret-right\" style=\"color: #606266;font-size: 12px\"\r\n               v-if=\"false === pageFlag.survival\"/>\r\n          </span>\r\n          <el-checkbox  :disabled=\"reaadOnlyPpProg==false\" :indeterminate=\"indeterminate.survival\" v-model=\"form_combination.survivalFlag\"></el-checkbox>\r\n          <span @click=\"pageFlag.survival = !pageFlag.survival\"\r\n                style=\"margin-left: 5px;cursor: pointer;font-size: 12px\">{{ $t('route.pdtemppdsrvlbnft') }}</span>\r\n          <div style=\"margin: 5px 0 0 25px\" v-if=\"pageFlag.survival\">\r\n            <el-checkbox-group  :disabled=\"reaadOnlyPpProg==false\" v-model=\"form_combination.survival\">\r\n              <div v-for=\"survival in survivalList\">\r\n                <el-row>\r\n                  <el-col :span=\"12\">\r\n                <el-checkbox :label=\"survival\" :key=\"survival.id\">{{ survival.pdBnftCode + ' - ' + survival.pdBnftName }}</el-checkbox>\r\n                <el-button    @click=\"toSrvBnftPage(survival)\" size=\"mini\" style=\"margin-left: 5px\" type=\"text\" dialog-disable=\"disable\">>>\r\n                </el-button>\r\n                  </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-switch active-text=\"计入方案保额\" active-value=\"Y\" inactive-value=\"N\" v-model=\"survival.pdAddAmntProgFlag\" ></el-switch>\r\n                    </el-col>\r\n                </el-row>\r\n              </div>\r\n            </el-checkbox-group>\r\n          </div>\r\n        </el-col>\r\n        </el-row>\r\n      <el-row>\r\n        <el-col :span=\"24\">\r\n          <span @click=\"pageFlag.claim = !pageFlag.claim\" class=\"tree-ctrl\">\r\n            <i class=\"el-icon-caret-bottom\" style=\"color: #606266;font-size: 12px\"\r\n               v-if=\"true === pageFlag.claim\"/>\r\n            <i class=\"el-icon-caret-right\" style=\"color: #606266;font-size: 12px\"\r\n               v-if=\"false === pageFlag.claim\"/>\r\n          </span>\r\n          <el-checkbox  :disabled=\"reaadOnlyPpProg==false\" :indeterminate=\"indeterminate.claim\" v-model=\"form_combination.claimFlag\"></el-checkbox>\r\n          <span @click=\"pageFlag.claim = !pageFlag.claim\"\r\n                style=\"margin-left: 5px;cursor: pointer ;font-size: 12px\">{{ $t('productProgramme.claimBenefit') }}</span>\r\n          <span style=\"margin-left: 45%\" v-show=\"true === pageFlag.claim\"></span>\r\n\r\n          <div style=\"margin: 5px 0 0 25px\" v-if=\"pageFlag.claim\">\r\n            <el-checkbox-group  :disabled=\"reaadOnlyPpProg==false\" v-model=\"form_combination.claim\">\r\n              <div v-for=\"claim in claimList\">\r\n                <el-row>\r\n                  <el-col :span=\"12\">\r\n                    <el-checkbox :label=\"claim\"  :key=\"claim.id\">{{ claim.pdBnftCode + ' - ' + claim.pdBnftName }}</el-checkbox>\r\n                    <el-button    @click=\"toClmBnftPage(claim)\" size=\"mini\" style=\"margin-left: 5px\" type=\"text\" dialog-disable=\"disable\">>></el-button>\r\n                  </el-col>\r\n                  <el-col :span=\"12\">\r\n                      <el-switch  active-text=\"计入方案保额\"  active-value=\"Y\" inactive-value=\"N\" v-model=\"claim.pdAddAmntProgFlag\" ></el-switch>\r\n                  </el-col>\r\n                </el-row>\r\n              </div>\r\n            </el-checkbox-group>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n\r\n  <cus-form-title :label=\"$t('productProgramme.basicInformation')\" :first=\"true\"></cus-form-title>\r\n    <!-- 方案基本信息表单 -->\r\n    <el-form :disabled=\"reaadOnlyPpProg==false\" :model=\"form_programme\" :rules=\"rules\"  label-width=\"auto\"\r\n             ref=\"form_programme\">\r\n      <cus-row>\r\n        <cus-col :span=\"16\">\r\n          <el-form-item :label=\"$t('productProgramme.pdProgName')\" prop=\"pdProgName\">\r\n            <el-input :placeholder=\"$t('productProgramme.message.please_enter')\" clearable @focus=\"setDefaultProgName\"\r\n                      v-model=\"form_programme.pdProgName\"></el-input>\r\n          </el-form-item>\r\n        </cus-col>\r\n\r\n      </cus-row>\r\n      <cus-row>\r\n        <cus-col>\r\n          <el-form-item :label=\"$t('productProgramme1.pdOptFlag')\" prop=\"pdOptFlag\">\r\n            <cus-radio codetype=\"pdOptFlag\" v-model=\"form_programme.pdOptFlag\" :disabled=\"premiumList.length===1\" :isRequired=\"true\"></cus-radio>\r\n          </el-form-item>\r\n        </cus-col>\r\n        <cus-col :span=\"16\">\r\n          <el-form-item :label=\"$t('productProgramme.pdAddAmntFlag')\" prop=\"pdAddAmntFlag\" >\r\n            <el-switch active-value=\"Y\" inactive-value=\"N\" v-model=\"form_programme.pdAddAmntFlag\" ></el-switch>\r\n          </el-form-item>\r\n        </cus-col>\r\n        </cus-row>\r\n        <cus-row>\r\n        <cus-col :span=\"24\">\r\n          <el-form-item :label=\"$t('productProgramme.pdAmntCalRule')\" prop=\"pdAmntCalRule\">\r\n            <cus-radio :codetype=\"'pdAmntCalRule'\" v-model=\"form_programme.pdAmntCalRule\"></cus-radio>\r\n          </el-form-item>\r\n        </cus-col>\r\n      </cus-row>\r\n        <cus-row>\r\n          <cus-col :span=\"24\">\r\n          <el-form-item :label=\"$t('productProgramme.pdAmntSaleType')\" prop=\"pdAmntSaleType\">\r\n            <cus-radio :codetype=\"'pdAmntSaleType'\" v-model=\"form_programme.pdAmntSaleType\"></cus-radio>\r\n          </el-form-item>\r\n        </cus-col>\r\n        </cus-row>\r\n      <cus-row v-if = \"false\">\r\n        <cus-col>\r\n          <el-form-item :label=\"$t('productProgramme.pdInsuPeriodCalMode')\" prop=\"pdInsuPeriodCalMode\">\r\n            <cus-select :codetype=\"'pdInsuPeriodCalMode'\" v-model=\"form_programme.pdInsuPeriodCalMode\"></cus-select>\r\n          </el-form-item>\r\n        </cus-col>\r\n        <cus-col>\r\n          <el-form-item :label=\"$t('productProgramme.pdInsuPeriod')\">\r\n            <el-form-item prop=\"pdInsuPeriod\" style=\"margin: auto 0 auto auto\">\r\n              <el-input :placeholder=\"$t('productProgramme.message.please_enter')\" clearable\r\n                        :disabled=\"!(form_programme.pdInsuPeriodCalMode=='0' ||form_programme.pdInsuPeriodCalMode=='3')\"\r\n                         type=\"number\" style=\"width: auto\" v-model=\"form_programme.pdInsuPeriod\">\r\n                <cus-select :codetype=\"'pdInsuPeriodUnit'\" :disabled=\"!(form_programme.pdInsuPeriodCalMode=='0' ||form_programme.pdInsuPeriodCalMode=='3')\" style=\"width: 80px\" slot=\"append\"\r\n                            v-model=\"form_programme.pdInsuPeriodUnit\"></cus-select>\r\n              </el-input>\r\n            </el-form-item>\r\n          </el-form-item>\r\n        </cus-col>\r\n        <cus-col>\r\n          <el-form-item :label=\"$t('productProgramme.pdInsuEndCalRule')\" prop=\"pdInsuEndCalRule\">\r\n            <cus-select :codetype=\"'pdInsuEndCalRule'\" v-model=\"form_programme.pdInsuEndCalRule\"></cus-select>\r\n          </el-form-item>\r\n        </cus-col>\r\n      </cus-row>\r\n      <cus-row v-if = \"false\">\r\n          <cus-col>\r\n          <el-form-item :label=\"$t('productProgramme.pdPayEndCalMode')\" prop=\"pdPayEndCalMode\">\r\n            <cus-select :codetype=\"'pdPayEndCalMode'\" v-model=\"form_programme.pdPayEndCalMode\"></cus-select>\r\n          </el-form-item>\r\n        </cus-col>\r\n        <cus-col>\r\n        </cus-col>\r\n        <cus-col>\r\n        </cus-col>\r\n      </cus-row>\r\n    </el-form>\r\n\r\n    <!-- 保存、删除、清空按钮 -->\r\n    <el-row v-if=\"reaadOnlyPpProg\" style=\"float: right;margin: 50px 0 50px 0\">\r\n      <el-button  size=\"small\" @click=\"handleUpdateAll\" icon=\"el-icon-success\" style=\"margin: 0 10px 0 0\" type=\"primary\"\r\n                 v-auth=\"'pdtemp-pd-prog:update'\" v-if=\"selectedProgramme.id\" dialog-disable=\"disable\">{{ $t('table.update') }}\r\n      </el-button>\r\n      <cus-popover :buttonText=\"$t('table.delete')\" :content=\"$t('confirmMessage.delete')\"\r\n                   @confirm=\"handleDeleteProgramme\" icon=\"el-icon-delete\" style=\"margin: 0 10px 0 0\" type=\"danger\"\r\n                   v-auth=\"'pdtemp-pd-prog:delete'\" v-if=\"selectedProgramme.id\" dialog-disable=\"disable\"></cus-popover>\r\n      <el-button  size=\"small\" @click=\"handleSaveAll\" icon=\"el-icon-success\" style=\"margin: 0 10px 0 0\" type=\"primary\"\r\n                 v-auth=\"'pdtemp-pd-prog:add'\" v-if=\"!selectedProgramme.id\" dialog-disable=\"disable\">{{ $t('table.save') }}\r\n      </el-button>\r\n      <el-button  size=\"small\" @click=\"handleClearFormProgramme\" icon=\"el-icon-refresh\" style=\"margin: 0\" type=\"primary\" dialog-disable=\"disable\" >\r\n        {{ $t('table.refresh') }}\r\n      </el-button>\r\n    </el-row>\r\n    <!-- 重复方案提示对话框 -->\r\n    <el-dialog :title=\"$t('productProgramme.message.duplicated_programme')\" :visible.sync=\"dialogVisible_duplicated\"\r\n               v-dialog-drag width=\"50%\">\r\n      <el-table :data=\"tableData_combination_duplicated_add\" :span-method=\"objectSpanMethod_combination_duplicated_add\"\r\n                border class=\"wraper-table\" element-loading-text=\"Loading\" fit max-height=\"500px\" size=\"mini\">\r\n        <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\">\r\n          <template v-slot=\"scope\">\r\n            {{ scope.row.mergedRowIndex + 1 }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('productProgramme.premiumCode')\" align=\"center\"\r\n                         prop=\"premiumCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('productProgramme.premiumName')\" align=\"center\"\r\n                         prop=\"premiumName\"></el-table-column>\r\n        <el-table-column :label=\"$t('i18nView.guaranteeCode')\" align=\"center\" prop=\"pdBnftCode\"></el-table-column>\r\n        <el-table-column :label=\"$t('productProgramme.pdBnftName')\" align=\"center\" prop=\"pdBnftName\"></el-table-column>\r\n      </el-table>\r\n      <el-row style=\"text-align: center;margin-top: 20px\">\r\n        <el-col :offset=\"6\" :span=\"12\">\r\n          <el-button  size=\"small\" @click=\"dialogVisible_duplicated = false\" type=\"danger\" dialog-disable=\"disable\">{{ $t('productProgramme.close') }}\r\n          </el-button>\r\n        </el-col>\r\n      </el-row>\r\n    </el-dialog>\r\n    <!-- 缴费页面 -->\r\n    <el-dialog :visible.sync=\"dialogVisible.premium\" title=\"产品缴费\" v-dialog-drag v-if=\"dialogVisible.premium\"\r\n               width=\"70%\" @close='closeDia' :close-on-click-modal=\"false\">\r\n      <premium :premiumCode=\"selectedPremiumCode\"></premium>\r\n    </el-dialog>\r\n    <!-- 赔付保障页面 -->\r\n    <el-dialog :visible.sync=\"dialogVisible.claimBenefit\" title=\"产品保障\" v-dialog-drag v-if=\"dialogVisible.claimBenefit\"\r\n               width=\"70%\" @close=\"closedDia\" :close-on-click-modal=\"false\">\r\n      <clmBnft :pdBnft=\"selectedClmBnft\"></clmBnft>\r\n    </el-dialog>\r\n    <!-- 赔付保障页面 -->\r\n    <el-dialog :visible.sync=\"dialogVisible.noClaimBenefit\" title=\"产品保障\" v-dialog-drag v-if=\"dialogVisible.noClaimBenefit\"\r\n               width=\"70%\" @close=\"closedDia\" :close-on-click-modal=\"false\">\r\n      <noClmBnft :pdBnft=\"selectedClmBnft\"></noClmBnft>\r\n    </el-dialog>\r\n    <!-- 生存保障页面 -->\r\n    <el-dialog :visible.sync=\"dialogVisible.survivalBenefit\" title=\"产品保障\" v-dialog-drag v-if=\"dialogVisible.survivalBenefit\"\r\n               width=\"70%\" :before-close=\"closedDia\" :close-on-click-modal=\"false\">\r\n        <srvBnft :pdBnftReadOnly=\"selectedSrvBnft\"></srvBnft>\r\n    </el-dialog>\r\n\r\n  </cus-wraper>\r\n</template>\r\n<script>\r\n\r\nimport {addPdtempPdProg, deletePdtempPdProg, updatePdtempPdProg,getBnfInfo,findAllPremiumByProductId} from \"@/api/basicinfo/pdtemppdprog\"\r\nimport {getPdClsLabInfo} from \"@/api/basicinfo/ProductAttributeDefinition\"\r\nimport premium from \"@/views/product-definition/pd-framework-def/pd-structure-def/payment-def/index\"\r\nimport clmBnft from \"@/views/product-definition/pd-framework-def/pd-structure-def/guarantee-def/general-medical/index\"\r\nimport srvBnft from \"@/views/product-definition/pd-framework-def/pd-structure-def/guarantee-def/survival/index\"\r\nimport noClmBnft from \"@/views/product-definition/pd-framework-def/pd-structure-def/guarantee-def/no-general-medical/index\"\r\n\r\nexport default {\r\n  name: 'ProgrammeDefinition',\r\n  props:{\r\n    reaadOnlyPpProg:{\r\n      type: Boolean,\r\n      default: true\r\n    }\r\n  },\r\n  components: {premium, clmBnft, srvBnft,noClmBnft},\r\n  filters: {},\r\n  data() {\r\n    return {\r\n        initFormData1:false,\r\n        initFormData2:false,\r\n        initFormData3:false,\r\n        initFormData4:false,\r\n      showPageFlagS: 0,\r\n      showPageFlag: 0,\r\n      selectedPremiumCode: '',\r\n      selectedClmBnft: {},\r\n      selectedSrvBnft: {},\r\n      // 产品信息\r\n      product: {\r\n        id: undefined,\r\n        pdCode: '',\r\n        pdEdition: '',\r\n        pdVerId: undefined,\r\n        pdSalechnl: '',\r\n        pdName: '',\r\n        pdShortname: '',\r\n        pdEnName: '',\r\n        pdShortEnName: '',\r\n        operator: '',\r\n        pdStartDateRule: '',\r\n        pdStartDateMode: '',\r\n        pdStartPeriod: undefined,\r\n        pdStartPeriodUnit: '',\r\n        pdEndDateRule: '',\r\n        pdEndDateMode: '',\r\n        pdEndPeriod: undefined,\r\n        pdEndPeriodUnit: '',\r\n        pdGracePeriod: undefined,\r\n        pdObservationDay: undefined,\r\n        pdApplDate: undefined,\r\n        pdProcessId: undefined,\r\n        pdStartDate: undefined,\r\n        pdStopDate: undefined,\r\n        createTime: undefined,\r\n        updateTime: undefined\r\n      },\r\n      product_extra: {\r\n        typeRegion: ''\r\n      },\r\n      // 方案表格\r\n      tableData_programme: [],\r\n      params_programme: {\r\n        productId: undefined,\r\n        like_pdProgName: '',\r\n        eq_pdProgCode: ''\r\n      },\r\n      selectedProgramme: {\r\n        id: undefined,\r\n        programmeCode: '',\r\n        programmeName: '',\r\n        premiumCode: '',\r\n        premiumName: '',\r\n        benefitCode: '',\r\n        benefitName: '',\r\n        benefitType: '',\r\n        programme: {},\r\n        premium: {}\r\n      },\r\n      // 方案组合表格\r\n      tableData_combination_add: [],\r\n      tableData_combination_before_add: [],\r\n      tableData_combination_duplicated_add: [],\r\n      orderIndexArr_programme: [],\r\n      orderIndexArr_combination_add: [],\r\n      orderIndexArr_combination_duplicated_add: [],\r\n      premiumList: [],\r\n      survivalList: [],\r\n      claimList: [],\r\n      dialogVisible: {\r\n        premium: false,\r\n        claimBenefit: false,\r\n        noClaimBenefit: false,\r\n        survivalBenefit: false\r\n      },\r\n      // 方案对象\r\n      form_programme: {\r\n        id: undefined,\r\n        pdInfoId: undefined,\r\n        pdVerId: undefined,\r\n        pdCode: '',\r\n        pdProgCode: '',\r\n        pdProgName: '',\r\n        pdOptFlag: 'N',\r\n        pdInsuPeriod: undefined,\r\n        pdInsuPeriodUnit: '',\r\n        pdInsuPeriodCalMode: '0',\r\n        pdInsuEndCalRule: '0',\r\n        pdAmntCalRule: '',\r\n        pdAddAmntFlag: 'Y',\r\n        pdPayEndCalMode: '',\r\n        pdAmntSaleType: '',\r\n        operator: '',\r\n        createTime: '',\r\n        updateTime: ''\r\n      },\r\n      // 方案组合对象\r\n      form_combination: {\r\n        premium: undefined,\r\n        survivalFlag: false,\r\n        claimFlag: false,\r\n        survival: [],\r\n        claim: []\r\n      },\r\n      // 方案组合新增对象\r\n      form_combination_add: {\r\n        // PdtempPdBnft 实体类属性\r\n        id: undefined,\r\n        pdBnftCode: '',\r\n        pdBnftName: '',\r\n        pdBnftType: '',\r\n        pdAddAmntFlag: '',\r\n        pdBnftCalMode: '',\r\n        pdCalcId: undefined,\r\n        pdUrgePayFlag: '',\r\n        createTime: '',\r\n        updateTime: '',\r\n        operator: '',\r\n        // vo属性\r\n        premiumId: undefined,\r\n        premiumCode: '',\r\n        premiumName: '',\r\n        pdAddAmntProgFlag: ''\r\n      },\r\n      dialogVisible_duplicated: false,\r\n      // 初始化标识\r\n      initFlag: {\r\n        premium: false,\r\n        benefit: false\r\n      },\r\n      pageFlag: {\r\n        premium: true,\r\n        survival: true,\r\n        claim: true\r\n      },\r\n      indeterminate: {\r\n        survival: false,\r\n        claim: false\r\n      },\r\n      // 表单验证\r\n      rules: {\r\n        pdProgName: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_enter') + this.$t('productProgramme.pdProgName'),\r\n          trigger: 'blur'\r\n        }],\r\n        pdAddAmntFlag: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdAddAmntFlag'),\r\n          trigger: 'change'\r\n        }],\r\n        pdOptFlag: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdOptFlag'),\r\n          trigger: 'change'\r\n        }],\r\n        pdInsuPeriodCalMode: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdInsuPeriodCalMode'),\r\n          trigger: 'change'\r\n        }],\r\n        pdInsuPeriod: [{\r\n          required: false,\r\n          message: this.$t('productProgramme.message.please_enter') + this.$t('productProgramme.pdInsuPeriod'),\r\n          trigger: 'blur'\r\n        }],\r\n        pdInsuPeriodUnit: [{\r\n          required: false,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdInsuPeriodUnit'),\r\n          trigger: 'change'\r\n        }],\r\n        pdInsuEndCalRule: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdInsuEndCalRule'),\r\n          trigger: 'change'\r\n        }],\r\n        pdAmntSaleType: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdAmntSaleType'),\r\n          trigger: 'change'\r\n        }],\r\n        pdAmntCalRule: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdAmntCalRule'),\r\n          trigger: 'change'\r\n        }],\r\n        pdPayEndCalMode: [{\r\n          required: true,\r\n          message: this.$t('productProgramme.message.please_select') + this.$t('productProgramme.pdPayEndCalMode'),\r\n          trigger: 'change'\r\n        }]\r\n      },\r\n    }\r\n  },\r\n  watch: {\r\n      'form_programme.pdInsuPeriodCalMode'(){\r\n          if (!(this.form_programme.pdInsuPeriodCalMode=='0' ||this.form_programme.pdInsuPeriodCalMode=='3') ){\r\n              this.form_programme.pdInsuPeriod='';\r\n              this.form_programme.pdInsuPeriodUnit='';\r\n          }\r\n      },\r\n      'form_programme.pdInsuPeriod'(){\r\n          if (this.form_programme.pdInsuPeriod){\r\n              if (!this.form_programme.pdInsuPeriodUnit){\r\n                  this.form_programme.pdInsuPeriodUnit='Y';\r\n              }\r\n          }else {\r\n              this.form_programme.pdInsuPeriodUnit='';\r\n          }\r\n      },\r\n      'form_programme.pdInsuPeriodUnit'(){\r\n          if (this.form_programme.pdInsuPeriod){\r\n              if (!this.form_programme.pdInsuPeriodUnit){\r\n                  this.form_programme.pdInsuPeriodUnit='Y';\r\n              }\r\n          }else {\r\n              this.form_programme.pdInsuPeriodUnit='';\r\n          }\r\n      },\r\n    'form_combination.claimFlag'(val) {\r\n      this.indeterminate.claim = false\r\n      if (val === true) {\r\n        this.form_combination.claim = []\r\n        for (const claim of this.claimList) {\r\n          this.form_combination.claim.push(claim)\r\n        }\r\n      } else {\r\n        this.form_combination.claim = []\r\n      }\r\n    },\r\n    'form_combination.claim'(val) {\r\n      if (val.length === 0) {\r\n        this.form_combination.claimFlag = false\r\n        this.indeterminate.claim = false\r\n      } else if (val.length < this.claimList.length) {\r\n        this.indeterminate.claim = true\r\n      } else {\r\n        this.indeterminate.claim = false\r\n        this.form_combination.claimFlag = true\r\n      }\r\n    },\r\n    'form_combination.survivalFlag'(val) {\r\n      this.indeterminate.survival = false\r\n      if (val === true) {\r\n        this.form_combination.survival = []\r\n        for (const survival of this.survivalList) {\r\n          this.form_combination.survival.push(survival)\r\n        }\r\n      } else {\r\n        this.form_combination.survival = []\r\n      }\r\n    },\r\n    'form_combination.survival'(val) {\r\n      if (val.length === 0) {\r\n        this.form_combination.survivalFlag = false\r\n        this.indeterminate.survival = false\r\n      } else if (val.length < this.survivalList.length) {\r\n        this.indeterminate.survival = true\r\n      } else {\r\n        this.indeterminate.survival = false\r\n        this.form_combination.survivalFlag = true\r\n      }\r\n    }\r\n  },\r\n  computed: {},\r\n  mounted(){\r\n    this.$emit('finish');\r\n  },\r\n  created() {\r\n    if (this.reaadOnlyPpProg===false){\r\n      this.reaadOnlyPpProg=false;\r\n      this.getProductInfo();\r\n      this.form_programme=JSON.parse(sessionStorage.getItem(\"form_programme\"));\r\n      this.pageFlag.survival = true\r\n      this.pageFlag.premium = true\r\n      this.pageFlag.claim = true;\r\n      this.premiumList=[];\r\n      this.claimList=[];\r\n      this.survivalList=[];\r\n      this.tableData_programme=[];\r\n      this.form_combination={\r\n        premium: undefined,\r\n          survivalFlag: false,\r\n          claimFlag: false,\r\n          survival: [],\r\n          claim: []\r\n      };\r\n      this.premiumList=JSON.parse(sessionStorage.getItem(\"premiumList\"));\r\n      this.claimList=JSON.parse(sessionStorage.getItem(\"claimList\"));\r\n      this.survivalList=JSON.parse(sessionStorage.getItem(\"survivalList\"));\r\n      this.tableData_programme=JSON.parse(sessionStorage.getItem(\"tableData_programme\"));\r\n      if (this.tableData_programme.length>0){\r\n        for(const demo1 of this.tableData_programme){\r\n          for (const items of this.claimList){\r\n            if (demo1.benefitCode==items.pdBnftCode){\r\n                this.form_combination.claim.push(items);\r\n            }\r\n          }\r\n        }\r\n        for(const demo1 of this.tableData_programme){\r\n          for (const items of this.premiumList){\r\n            if (demo1.premiumCode==items.pdPremCode){\r\n              this.form_combination.premium=items;\r\n            }\r\n          }\r\n        }\r\n        for(const demo1 of this.tableData_programme){\r\n          for (const items of this.survivalList){\r\n            if (demo1.benefitCode==items.pdBnftCode){\r\n              this.form_combination.survival.push(items);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }else {\r\n      this.reaadOnlyPpProg=true\r\n      this.cancelUpdateProgramme();\r\n      this.init()\r\n      this.showPageFlag = this.$route.query.showPageFlag\r\n      this.showPageFlagS = this.showPageFlag;\r\n    }\r\n  },\r\n  methods: {\r\n    setDefaultProgName(){\r\n\r\n      if(!this.form_programme.pdProgName){\r\n        this.premiumList.forEach(data=>{\r\n          if(this.form_combination.premium.pdPremCode == data.pdPremCode){\r\n            if(data.pdPayName.lastIndexOf(\"缴费\")){\r\n              this.form_programme.pdProgName = data.pdPayName.substring(0,data.pdPayName.lastIndexOf(\"缴费\"))+\"方案\"\r\n            }else{\r\n              this.form_programme.pdProgName = data.pdPayName+\"方案\"\r\n            }\r\n\r\n          }\r\n        })\r\n      }\r\n    },\r\n      closedDia(){\r\n\r\n        this.dialogVisible.survivalBenefit=false;\r\n                  this.dialogVisible.claimBenefit=false;\r\n                  this.dialogVisible.noClaimBenefit=false;\r\n                  if (this.selectedProgramme) {\r\n                      let a = this.selectedProgramme.programme.id;\r\n                      for (const item of this.tableData_programme) {\r\n                          if (item.programme.id === a) {\r\n                              this.selectedProgramme = item;\r\n                              break;\r\n                          }\r\n                      }\r\n                      this.selectedProgrammeChanged();\r\n                  }\r\n      },\r\n      closeDia(){\r\n          this.dialogVisible.premium=false;\r\n          if (this.selectedProgramme){\r\n              let a = this.selectedProgramme.programme.id;\r\n              for (const item of this.tableData_programme) {\r\n                  if (item.programme.id === a) {\r\n                      this.selectedProgramme = item;\r\n                      break;\r\n                  }\r\n              }\r\n              this.selectedProgrammeChanged();\r\n          }\r\n      },\r\n    init() {\r\n      this.getProductInfo();\r\n      this.initListShow();\r\n      this.init_typeRegion();\r\n    },\r\n    getProductInfo() {\r\n      // 带入产品信息\r\n      this.product = this.getPdData()\r\n      this.params_programme.productId = this.product.id\r\n    },\r\n      initListShow(){\r\n\r\n        this.premiumList=[];\r\n        this.claimList=[];\r\n        this.survivalList=[];\r\n        findAllPremiumByProductId(this.product.id).then(response => {\r\n              for (const premium of response.data) {\r\n                  this.premiumList.push(premium)\r\n              }\r\n              this.initFlag.premium = true\r\n              getBnfInfo(this.product.id).then(response => {\r\n                  let map = response.data;\r\n                  this.survivalList = map.survival;\r\n                  this.claimList = map.claim;\r\n                  let j=0;\r\n                  for(j = 0; j < this.claimList.length; j++) {\r\n                      if ( this.claimList[j].pdAddAmntProgFlag!='' || this.claimList[j].pdAddAmntProgFlag!=null){\r\n                          this.claimList[j].pdAddAmntProgFlag='';\r\n                      }\r\n                  }\r\n                  for(j = 0; j < this.survivalList.length; j++) {\r\n                      if ( this.survivalList[j].pdAddAmntProgFlag!='' || this.survivalList[j].pdAddAmntProgFlag!=null){\r\n                          this.survivalList[j].pdAddAmntProgFlag='';\r\n                      }\r\n                  }\r\n                  this.initFlag.benefit = true\r\n                  if (this.initFlag.premium === true && this.initFlag.benefit === true) {\r\n                      this.autoBuildProgramme()\r\n                  }\r\n\r\n                if (this.form_programme.pdAddAmntFlag === 'Y'){\r\n                  for (let i = 0 ; i< this.survivalList.length ; i++){\r\n                    this.survivalList[i].pdAddAmntProgFlag = 'Y'\r\n\r\n                  }\r\n                }\r\n\r\n                if (this.form_programme.pdAddAmntFlag === 'Y'){\r\n                  for (let i = 0 ; i< this.claimList.length ; i++){\r\n                    this.claimList[i].pdAddAmntProgFlag = 'Y'\r\n\r\n                  }\r\n                }\r\n\r\n              })\r\n          })\r\n\r\n      },\r\n\r\n    // 获取险种类型（产品类型）\r\n    init_typeRegion() {\r\n      const paramsMap = {\r\n        pd_info_id: this.product.id,\r\n        pd_cls_type: '1'\r\n      }\r\n      getPdClsLabInfo(this.buildRequestData(paramsMap)).then(response => {\r\n        const pdTempClsLabList = response.data\r\n        const pdCls1Array = this._.map(pdTempClsLabList, 'pdCls1')\r\n        if (pdCls1Array.length > 0) {\r\n          this.product_extra.typeRegion = pdCls1Array[0]\r\n        }\r\n      })\r\n\r\n    },\r\n    autoBuildProgramme() {\r\n\r\n      if (this.premiumList.length !== 1 || this.survivalList.length === 0 && this.claimList.length === 0) {\r\n        return\r\n      }\r\n      this.pageFlag.premium = true\r\n      this.pageFlag.survival = true\r\n      this.pageFlag.claim = true\r\n      this.form_combination.premium = this.premiumList[0]\r\n      // console.log(this.form_combination.premium)\r\n      this.form_combination.claim = this.claimList\r\n      this.form_combination.survival = this.survivalList;\r\n      if (this.claimList.length>0){\r\n          for(const item of this.claimList){\r\n              if (item.pdOptFlag=='N'){\r\n                  this.initFormData3=true;\r\n              }else {\r\n                  this.initFormData3=false;\r\n                  break;\r\n              }\r\n          }\r\n      }else{\r\n          this.initFormData3=true;\r\n      }\r\n        if (this.survivalList.length>0){\r\n            for(const item of this.survivalList){\r\n                if (item.pdOptFlag=='N'){\r\n                    this.initFormData2=true;\r\n                }else {\r\n                    this.initFormData2=false;\r\n                    break;\r\n                }\r\n            }\r\n        }else {\r\n            this.initFormData2=true;\r\n        }\r\n        if (this.premiumList.length==1){\r\n            this.initFormData1=true\r\n        }else {\r\n            this.initFormData1=false;\r\n        }\r\n        if (this.initFormData2 && this.initFormData1 && this.initFormData3){\r\n            this.$refs.page_programme.buildData().then(()=>{\r\n                if (this.tableData_programme.length<1){\r\n                    let arrStr = this.premiumList[0].pdPayName.replace(\"缴费\",\"\");\r\n                    this.form_programme.pdProgName=arrStr+'方案';\r\n                    this.form_programme.pdOptFlag='N';\r\n                    if (this.premiumList[0].pdPremCalMode=='P'){\r\n                        this.form_programme.pdAmntSaleType='4'\r\n                    }else {\r\n                        this.form_programme.pdAmntSaleType='1'\r\n                    }\r\n                    this.form_programme.pdAmntCalRule='1';\r\n                    this.form_programme.pdInsuPeriodCalMode='1';\r\n                    this.form_programme.pdPayEndCalMode='1';\r\n                    this.initFormData2=false;\r\n                    // this.initHandleSaveAll();\r\n                }\r\n            })\r\n        }\r\n      // this.handleAddProgramme(this.premiumList[0], this.survivalList, this.claimList, false)\r\n    },\r\n    handleSearch() {\r\n\r\n      this.$refs.page_programme.reload()\r\n    },\r\n    rowClick(row, column, event) {\r\n\r\n      if (event.target.nodeName === \"INPUT\") {\r\n        if (row.id === this.selectedProgramme.id) {\r\n          this.cancelUpdateProgramme()\r\n        }\r\n      }\r\n    },\r\n    selectedProgrammeChanged() {\r\n\r\n      let j=0;\r\n        for(j = 0; j < this.claimList.length; j++) {\r\n            if ( this.claimList[j].pdAddAmntProgFlag!='' || this.claimList[j].pdAddAmntProgFlag!=null){\r\n                this.claimList[j].pdAddAmntProgFlag='';\r\n            }\r\n        }\r\n        let jj=0;\r\n        for(jj = 0; jj < this.survivalList.length; jj++) {\r\n            if ( this.survivalList[jj].pdAddAmntProgFlag!='' || this.survivalList[jj].pdAddAmntProgFlag!=null){\r\n                this.survivalList[jj].pdAddAmntProgFlag='';\r\n            }\r\n        }\r\n      this.resetFormProgramme()\r\n      this.resetFormCombination()\r\n      this.$nextTick(() => {\r\n        // 带入方案基本信息\r\n        this.form_programme = Object.assign({}, this.selectedProgramme.programme)\r\n        // 带入缴费信息\r\n        this.pageFlag.premium = true\r\n        let existedPremium = this.selectedProgramme.premium\r\n        for (const premium of this.premiumList) {\r\n          if (premium.id === existedPremium.id) {\r\n            this.form_combination.premium = premium\r\n            break;\r\n          }\r\n        }\r\n        // 带入保障组合信息\r\n        let existedSurvivalList = []\r\n        let existedClaimList = []\r\n        for (const benefitVo of this.tableData_programme) {\r\n          if (benefitVo.programmeCode === this.form_programme.pdProgCode) {\r\n            switch (benefitVo.benefitType) {\r\n              case \"A\":\r\n              case \"M\":\r\n                existedSurvivalList.push(benefitVo)\r\n                this.pageFlag.survival = true\r\n                break\r\n              case \"C\":\r\n                existedClaimList.push(benefitVo)\r\n                this.pageFlag.claim = true\r\n                break\r\n              default:\r\n                break\r\n            }\r\n          }\r\n        }\r\n        for (const existedSurvival of existedSurvivalList) {\r\n          for (const survival of this.survivalList) {\r\n            if (survival.id === existedSurvival.id) {\r\n                survival.pdAddAmntProgFlag = existedSurvival.pdAddAmntProgFlag;\r\n              this.form_combination.survival.push(survival);\r\n              break\r\n            }\r\n          }\r\n        }\r\n        for (const existedClaim of existedClaimList) {\r\n          for (const claim of this.claimList) {\r\n            if (claim.id === existedClaim.id) {\r\n                claim.pdAddAmntProgFlag=existedClaim.pdAddAmntProgFlag\r\n              this.form_combination.claim.push(claim)\r\n              break\r\n            }\r\n          }\r\n        }\r\n      })\r\n\r\n    },\r\n    cancelUpdateProgramme() {\r\n\r\n      let j=0;\r\n        for(j = 0; j < this.claimList.length; j++) {\r\n            if ( this.claimList[j].pdAddAmntProgFlag!='' || this.claimList[j].pdAddAmntProgFlag!=null){\r\n                this.claimList[j].pdAddAmntProgFlag='';\r\n            }\r\n        }\r\n        let jj=0;\r\n        for(jj = 0; jj < this.survivalList.length; jj++) {\r\n            if ( this.survivalList[jj].pdAddAmntProgFlag!='' || this.survivalList[jj].pdAddAmntProgFlag!=null){\r\n                this.survivalList[jj].pdAddAmntProgFlag='';\r\n            }\r\n        }\r\n      this.resetSelectedProgramme()\r\n      this.resetFormProgramme()\r\n      this.resetFormCombination()\r\n      this.$nextTick(() => {\r\n        this.$refs.form_programme.clearValidate()\r\n      });\r\n    },\r\n    handleAddProgramme(premium, survival, claim, showTips) {\r\n\r\n      if (!premium) {\r\n        this.notifyError(this.$t('productProgramme.message.please_select_premium'))\r\n        return\r\n      } else if (survival.length === 0 && claim.length === 0) {\r\n        this.notifyError(this.$t('productProgramme.message.please_select_benefit'))\r\n        return\r\n      } else {\r\n\r\n      }\r\n      // this.resetTableDataCombinationBeforeAdd()\r\n      if (survival.length > 0) {\r\n        for (const survivalItem of survival) {\r\n          this.resetFormCombinationAdd()\r\n          Object.assign(this.form_combination_add, survivalItem)\r\n          this.form_combination_add.premiumId = premium.id\r\n          this.form_combination_add.premiumCode = premium.pdPremCode\r\n          this.form_combination_add.premiumName = premium.pdPayName\r\n          this.tableData_combination_before_add.push(this.form_combination_add)\r\n        }\r\n      }\r\n      if (claim.length > 0) {\r\n        for (const claimItem of claim) {\r\n          this.resetFormCombinationAdd()\r\n          Object.assign(this.form_combination_add, claimItem)\r\n          this.form_combination_add.premiumId = premium.id\r\n          this.form_combination_add.premiumCode = premium.pdPremCode\r\n          this.form_combination_add.premiumName = premium.pdPayName\r\n          this.tableData_combination_before_add.push(this.form_combination_add)\r\n        }\r\n      }\r\n      // 验证是否有重复信息\r\n      this.resetTableDataCombinationDuplicatedAdd()\r\n      for (const form_combination_before_add of this.tableData_combination_before_add) {\r\n\r\n      }\r\n      if (this.tableData_combination_duplicated_add.length > 0) {\r\n        this.getOrderNumber('combination_duplicated_add')\r\n        this.dialogVisible_duplicated = true\r\n      } else {\r\n\r\n        this.getOrderNumber('combination_add')\r\n        if (showTips === true) {\r\n          this.notifySuccess(this.$t('productProgramme.message.add_success'))\r\n        }\r\n      }\r\n    },\r\n    handleDeleteCombinationAdd(row) {\r\n\r\n      this.getOrderNumber('combination_add')\r\n    },\r\n    handleUpdateAll() {\r\n      this.$refs.form_programme.validate(pass => {\r\n        if (pass) {\r\n          this.form_programme.pdInfoId = this.product.id\r\n          this.form_programme.pdCode = this.product.pdCode;\r\n            let arr = [];\r\n            arr=this.form_combination.claim;\r\n            arr=arr.concat(this.form_combination.survival);\r\n            let map={\r\n                programme: this.form_programme,\r\n                premiumId: this.form_combination.premium.id,\r\n                premiumCode: this.form_combination.premium.pdPremCode,\r\n                benefitList: arr\r\n            }\r\n          updatePdtempPdProg(this.buildRequestData(map)).then(() => {\r\n              let a = this.selectedProgramme.programme.id;\r\n            this.$emit('childFn', true);\r\n            this.notifySuccess(this.$t('productProgramme.message.update_all_success'))\r\n              this.$refs.page_programme.buildData().then(() => {\r\n                  this.cancelUpdateProgramme();\r\n                  this.$nextTick(()=>{\r\n                  for (const item of this.tableData_programme){\r\n                      if (item.programme.id===a){\r\n                         this.selectedProgramme=item;\r\n                          this.selectedProgrammeChanged();\r\n                          break;\r\n                      }\r\n                  }\r\n\r\n                  })\r\n              })\r\n          })\r\n        } else {\r\n          this.notifyError(this.$t('productProgramme.message.form_validation_failed'))\r\n        }\r\n      })\r\n    },\r\n      initHandleSaveAll(){\r\n\r\n        this.$refs.form_programme.validate(pass => {\r\n              if (pass) {\r\n                  this.form_programme.pdInfoId = this.product.id\r\n                  this.form_programme.pdVerId = this.product.pdVerId\r\n                  this.form_programme.pdCode = this.product.pdCode;\r\n                  let arr = [];\r\n                  arr=this.form_combination.claim;\r\n                  arr=arr.concat(this.form_combination.survival);\r\n                  const param = {\r\n                      programme: this.form_programme,\r\n                      premiumId: this.form_combination.premium.id,\r\n                      premiumCode: this.form_combination.premium.pdPremCode,\r\n                      benefitList: arr,\r\n                      typeRegion: this.product_extra.typeRegion,\r\n                      needCheckingPremium: true\r\n                  }\r\n                  addPdtempPdProg(this.buildRequestData(param)).then(response => {\r\n                      let successFlag = response.data\r\n                      if (successFlag === true) {\r\n                          this.$refs.page_programme.buildData().then(() => {\r\n                              this.cancelUpdateProgramme();\r\n                          });\r\n                          this.$emit('childFn', true);\r\n                      } else {\r\n                          this.$confirm(this.$t('productProgramme.message.confirm_overwrite_programme'), this.$t('confirmMessage.tip'), {\r\n                              confirmButtonText: this.$t('confirmMessage.confirm'),\r\n                              cancelButtonText: this.$t('confirmMessage.cancel'),\r\n                              type: 'warning'\r\n                          }).then(() => {\r\n                              param.needCheckingPremium = false\r\n                              addPdtempPdProg(this.buildRequestData(param)).then(() => {\r\n                                  this.resetSelectedProgramme();\r\n                                  this.resetFormProgramme()\r\n                                  this.resetFormCombination()\r\n                                  this.$emit('childFn', true);\r\n                                  this.notifySuccess(this.$t('productProgramme.message.save_all_success'))\r\n                                  this.$refs.page_programme.reload()\r\n                                  this.$nextTick(() => {\r\n                                      this.$refs.form_programme.clearValidate()\r\n                                  })\r\n                              })\r\n                          }).catch(() => {\r\n                              this.$message({\r\n                                  type: 'info',\r\n                                  message: this.$t('productProgramme.message.canceled')\r\n                              });\r\n                          })\r\n                      }\r\n                  })\r\n              } else {\r\n                  this.notifyError(this.$t('productProgramme.message.form_validation_failed'))\r\n              }\r\n          })\r\n      },\r\n    handleSaveAll() {\r\n\r\n      this.$refs.form_programme.validate(pass => {\r\n        if (pass) {\r\n          if (this.form_combination.premium == null || this.form_combination.premium == ''){\r\n            this.notifyError(\"缴费信息不能为空\")\r\n            return\r\n          }\r\n          if (this.form_combination.claim.length == 0 && this.form_combination.survival.length == 0){\r\n            this.notifyError(\"保障信息不能为空\")\r\n            return\r\n          }\r\n\r\n          this.form_programme.pdInfoId = this.product.id\r\n          this.form_programme.pdVerId = this.product.pdVerId\r\n          this.form_programme.pdCode = this.product.pdCode;\r\n          let arr = [];\r\n          arr=this.form_combination.claim;\r\n          arr=arr.concat(this.form_combination.survival);\r\n          const param = {\r\n            programme: this.form_programme,\r\n            premiumId: this.form_combination.premium.id,\r\n            premiumCode: this.form_combination.premium.pdPremCode,\r\n            benefitList: arr,\r\n            typeRegion: this.product_extra.typeRegion,\r\n            needCheckingPremium: true\r\n          }\r\n          addPdtempPdProg(this.buildRequestData(param)).then(response => {\r\n            let successFlag = response.data\r\n            if (successFlag === true) {\r\n                this.$refs.page_programme.buildData().then(() => {\r\n                    this.cancelUpdateProgramme();\r\n                });\r\n              this.$emit('childFn', true);\r\n              this.notifySuccess(this.$t('productProgramme.message.save_all_success'))\r\n            } else {\r\n              this.$confirm(this.$t('productProgramme.message.confirm_overwrite_programme'), this.$t('confirmMessage.tip'), {\r\n                confirmButtonText: this.$t('confirmMessage.confirm'),\r\n                cancelButtonText: this.$t('confirmMessage.cancel'),\r\n                type: 'warning'\r\n              }).then(() => {\r\n                param.needCheckingPremium = false\r\n                addPdtempPdProg(this.buildRequestData(param)).then(() => {\r\n\r\n                  this.resetSelectedProgramme();\r\n                  this.resetFormProgramme()\r\n                  this.resetFormCombination()\r\n                  this.$emit('childFn', true);\r\n                  this.notifySuccess(this.$t('productProgramme.message.save_all_success'))\r\n                  this.$refs.page_programme.reload()\r\n                  this.$nextTick(() => {\r\n                    this.$refs.form_programme.clearValidate()\r\n                  })\r\n                })\r\n                this.cancelUpdateProgramme();\r\n              }).catch(() => {\r\n                this.$message({\r\n                  type: 'info',\r\n                  message: this.$t('productProgramme.message.canceled')\r\n                });\r\n              })\r\n            }\r\n          })\r\n        } else {\r\n          this.notifyError(this.$t('productProgramme.message.form_validation_failed'))\r\n        }\r\n      })\r\n    },\r\n    handleDeleteProgramme() {\r\n\r\n      deletePdtempPdProg(this.selectedProgramme.programme.id).then(() => {\r\n        this.notifySuccess(this.$t('successMessage.delete'));\r\n        this.init();\r\n        this.$refs.page_programme.buildData().then(() =>{\r\n            this.cancelUpdateProgramme();\r\n            this.$refs.form_programme.clearValidate();\r\n\r\n        });\r\n      })\r\n    },\r\n    handleClearFormProgramme() {\r\n\r\n      if (this.selectedProgramme.programme){\r\n            this.selectedProgrammeChanged();\r\n        }else {\r\n            this.cancelUpdateProgramme();\r\n        }\r\n\r\n    },\r\n    // 获取相同编号的数组（每次表格数据改变后需要调用这个方法）\r\n    getOrderNumber(arrayName) {\r\n\r\n      let tableData\r\n      let orderIndexArr\r\n      if (arrayName === 'combination_add') {\r\n      } else if (arrayName === 'combination_duplicated_add') {\r\n        tableData = this.tableData_combination_duplicated_add\r\n      } else {\r\n        return\r\n      }\r\n      orderIndexArr = []\r\n      // 按照 premiumCode 排序，将 premiumCode 相同的数据连在一起\r\n      tableData = this._.orderBy(tableData, ['premiumCode', 'pdBnftCode'], ['asc', 'asc'])\r\n      if (arrayName === 'combination_add') {\r\n      } else if (arrayName === 'combination_duplicated_add') {\r\n        this.tableData_combination_duplicated_add = tableData\r\n      }\r\n      let orderObj = {}\r\n      tableData.forEach((element, index) => {\r\n        element.rowIndex = index\r\n        if (orderObj[element.premiumCode]) {\r\n          orderObj[element.premiumCode].push(index)\r\n        } else {\r\n          orderObj[element.premiumCode] = []\r\n          orderObj[element.premiumCode].push(index)\r\n        }\r\n      })\r\n      // 需要合并的行的 index 已经存在了同一个数组里，把这些数组存储到 this.orderIndexArr\r\n      for (const k in orderObj) {\r\n        orderIndexArr.push(orderObj[k])\r\n      }\r\n      if (arrayName === 'combination_add') {\r\n        this.orderIndexArr_combination_add = orderIndexArr\r\n      } else if (arrayName === 'combination_duplicated_add') {\r\n        this.orderIndexArr_combination_duplicated_add = orderIndexArr\r\n        this.getMergedRowIndex(this.tableData_combination_duplicated_add, this.orderIndexArr_combination_duplicated_add)\r\n      }\r\n    },\r\n    getMergedRowIndex(tableData, orderIndexArr) {\r\n\r\n      a:for (const row of tableData) {\r\n        const rowIndex = row.rowIndex\r\n        for (let i = 0; i < orderIndexArr.length; i++) {\r\n          const val = orderIndexArr[i]\r\n          for (const number of val) {\r\n            if (rowIndex === number) {\r\n              row.mergedRowIndex = i\r\n              continue a\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    objectSpanMethod_programme({row, column, rowIndex, columnIndex}) {\r\n\r\n      if (columnIndex === 0 || columnIndex === 1 || columnIndex === 2 || columnIndex === 3 || columnIndex === 4 || columnIndex === 5) {\r\n        for (let i = 0; i < this.orderIndexArr_programme.length; i++) {\r\n          let element = this.orderIndexArr_programme[i]\r\n          for (let j = 0; j < element.length; j++) {\r\n            let item = element[j]\r\n            if (rowIndex === item) {\r\n              if (j === 0) {\r\n                return {\r\n                  rowspan: element.length,\r\n                  colspan: 1\r\n                }\r\n              } else {\r\n                return {\r\n                  rowspan: 0,\r\n                  colspan: 0\r\n                }\r\n              }\r\n            }else {\r\n                this.resetFormProgramme()\r\n                this.resetFormCombination()\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    objectSpanMethod_combination_add({row, column, rowIndex, columnIndex}) {\r\n\r\n      if (columnIndex === 0 || columnIndex === 1 || columnIndex === 2) {\r\n        for (let i = 0; i < this.orderIndexArr_combination_add.length; i++) {\r\n          let element = this.orderIndexArr_combination_add[i]\r\n          for (let j = 0; j < element.length; j++) {\r\n            let item = element[j]\r\n            if (rowIndex === item) {\r\n              if (j === 0) {\r\n                return {\r\n                  rowspan: element.length,\r\n                  colspan: 1\r\n                }\r\n              } else {\r\n                return {\r\n                  rowspan: 0,\r\n                  colspan: 0\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    objectSpanMethod_combination_duplicated_add({row, column, rowIndex, columnIndex}) {\r\n\r\n      if (columnIndex === 0 || columnIndex === 1 || columnIndex === 2 || columnIndex === 5) {\r\n        for (let i = 0; i < this.orderIndexArr_combination_duplicated_add.length; i++) {\r\n          let element = this.orderIndexArr_combination_duplicated_add[i]\r\n          for (let j = 0; j < element.length; j++) {\r\n            let item = element[j]\r\n            if (rowIndex === item) {\r\n              if (j === 0) {\r\n                return {\r\n                  rowspan: element.length,\r\n                  colspan: 1\r\n                }\r\n              } else {\r\n                return {\r\n                  rowspan: 0,\r\n                  colspan: 0\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    resetSelectedProgramme() {\r\n\r\n      this.selectedProgramme = {\r\n        id: undefined,\r\n        programmeCode: '',\r\n        programmeName: '',\r\n        premiumCode: '',\r\n        premiumName: '',\r\n        benefitCode: '',\r\n        benefitName: '',\r\n        benefitType: '',\r\n        programme: {},\r\n        premium: {}\r\n      }\r\n    },\r\n    // 重置（新建）对象与数组\r\n    resetFormProgramme() {\r\n\r\n      this.form_programme = {\r\n        id: undefined,\r\n        pdInfoId: undefined,\r\n        pdVerId: undefined,\r\n        pdCode: '',\r\n        pdProgCode: '',\r\n        pdProgName: '',\r\n        pdOptFlag: 'N',\r\n        pdInsuPeriod: undefined,\r\n        pdInsuPeriodUnit: '',\r\n        pdInsuPeriodCalMode: '',\r\n        pdInsuEndCalRule: '0',\r\n        pdAmntCalRule: '',\r\n        pdAddAmntFlag: 'Y',\r\n        pdPayEndCalMode: '',\r\n        pdAmntSaleType: '',\r\n        operator: '',\r\n        createTime: '',\r\n        updateTime: ''\r\n      }\r\n    },\r\n    resetFormCombination() {\r\n\r\n      this.pageFlag.premium = true\r\n      this.pageFlag.claim = true\r\n      this.pageFlag.survival = true\r\n      this.indeterminate.survival = false\r\n      this.indeterminate.claim = false\r\n      this.form_combination = {\r\n        premium: undefined,\r\n        survivalFlag: false,\r\n        claimFlag: false,\r\n        survival: [],\r\n        claim: []\r\n      }\r\n    },\r\n    resetFormCombinationAdd() {\r\n\r\n      this.form_combination_add = {\r\n        // PdtempPdBnft 实体类属性\r\n        id: undefined,\r\n        pdBnftCode: '',\r\n        pdBnftName: '',\r\n        pdBnftType: '',\r\n        pdAddAmntFlag: '',\r\n        pdBnftCalMode: '',\r\n        pdCalcId: undefined,\r\n        pdUrgePayFlag: '',\r\n        createTime: '',\r\n        updateTime: '',\r\n        operator: '',\r\n        // vo属性\r\n        premiumId: undefined,\r\n        premiumCode: '',\r\n        premiumName: '',\r\n        pdAddAmntProgFlag: ''\r\n      }\r\n    },\r\n    resetTableDataCombinationBeforeAdd() {\r\n\r\n      this.tableData_combination_before_add = []\r\n    },\r\n    resetTableDataCombinationDuplicatedAdd() {\r\n\r\n      this.tableData_combination_duplicated_add = []\r\n    },\r\n    toPremiumPage(pdPremCode) {\r\n\r\n      if (!pdPremCode) {\r\n        this.notifyError(this.$t('productProgramme.message.invalidPremCode'))\r\n      } else {\r\n        this.selectedPremiumCode = pdPremCode\r\n        this.dialogVisible.premium = true\r\n      }\r\n    },\r\n    toSrvBnftPage(survival) {\r\n\r\n      if (Object.keys(survival).length > 0) {\r\n          this.selectedSrvBnft = JSON.parse(JSON.stringify(survival));\r\n        this.dialogVisible.survivalBenefit = true\r\n      } else {\r\n        this.notifyError(this.$t('productProgramme.message.invalidBenefit'))\r\n      }\r\n    },\r\n    toClmBnftPage(survival) {\r\n\r\n      if (Object.keys(survival).length > 0) {\r\n        this.selectedClmBnft = JSON.parse(JSON.stringify(survival))\r\n        this.selectedClmBnft.readonly = true\r\n        if(survival.pdBnftDetailType==='7'){\r\n          this.dialogVisible.claimBenefit = true\r\n        }else{\r\n          this.dialogVisible.noClaimBenefit = true\r\n        }\r\n      } else {\r\n        this.notifyError(this.$t('productProgramme.message.invalidBenefit'))\r\n      }\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n.showDiv {\r\n  width: 90%;\r\n  height: 100%;\r\n  margin-top: -40px;\r\n  margin-left: -40px;\r\n  position: absolute;\r\n  background: #ffffff00;\r\n  z-index: 999;\r\n}\r\n\r\n.divider {\r\n  color: black;\r\n  background-color: black;\r\n  width: 1px;\r\n}\r\n\r\n</style>\r\n"]}]}