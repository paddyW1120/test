{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-attr-def\\base-attr-def\\template\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\product-definition\\pd-framework-def\\pd-attr-def\\base-attr-def\\template\\index.vue","mtime":1609847106843},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgZmlsZXVwbG9hZCwKICBkb3dubG9hZCwKfSBmcm9tICdAL2FwaS9iYXNpY2luZm8vUHJvZHVjdEF0dHJpYnV0ZURlZmluaXRpb24nCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ2NsYXVzZScsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGZpbGVMaXN0OiBbXSwKICAgICAgZm9ybTogewogICAgICAgIG9wZXJhdG9yOiB0aGlzLiRzdG9yZS5nZXR0ZXJzLnVzZXJjb2RlLAogICAgICAgIHBkQ29kZTogbnVsbCwKICAgICAgICBwZE5hbWU6IG51bGwsCiAgICAgICAgcHJvZHVjdFR5cGU6IG51bGwsCiAgICAgICAgZmlsZU5hbWU6IG51bGwsCiAgICAgICAgY29udGVudDogbnVsbCwKICAgICAgICB0eXBlOiBudWxsCiAgICAgIH0sCiAgICAgIHJ1bGVzOiB7CiAgICAgICAgcHJvZHVjdFR5cGU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ2NsYXVzZS5pbnB1dCcpICsgdGhpcy4kdCgnY2xhdXNlLnByb2R1Y3RUeXBlJyksCiAgICAgICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgZmlsZU5hbWU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ2NsYXVzZS5pbnB1dEZpbGUnKSwKICAgICAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgbGV0IHBkdGVtcFBkSW5mbyA9IHRoaXMuZ2V0UGREYXRhKCkKICAgIHRoaXMuZm9ybS5wZENvZGUgPSBwZHRlbXBQZEluZm8ucGRDb2RlCiAgICB0aGlzLmZvcm0ucGROYW1lID0gcGR0ZW1wUGRJbmZvLnBkTmFtZQogICAgdGhpcy5mb3JtLnBkRWRpdGlvbiA9IHBkdGVtcFBkSW5mby5wZEVkaXRpb24KICB9LAogIG1ldGhvZHM6IHsKICAgIHJlbW92ZVVwbG9hZCgpIHsKICAgICAgdGhpcy5mb3JtLmZpbGVOYW1lID0gbnVsbAogICAgICB0aGlzLmZvcm0uY29udGVudCA9IG51bGwKICAgICAgdGhpcy5mb3JtLnR5cGUgPSBudWxsCiAgICB9LAogICAgY2hhbmdlVXBsb2FkOiBmdW5jdGlvbihmaWxlLCBmaWxlTGlzdCkgewogICAgICB0aGlzLmZvcm0uZmlsZU5hbWUgPSBmaWxlLm5hbWUKICAgICAgdGhpcy5mb3JtLnR5cGUgPSBmaWxlLnJhdy50eXBlCiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyBlID0+IHsKICAgICAgICB0aGlzLmZvcm0uY29udGVudCA9IGUudGFyZ2V0LnJlc3VsdAogICAgICB9CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUucmF3KQogICAgfSwKICAgIHN1Ym1pdEZvcm0oKSB7CiAgICAgIGNvbnN0IGlzWExTWCA9CiAgICAgICAgdGhpcy5mb3JtLnR5cGUgPT09CiAgICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JwogICAgICBpZiAodGhpcy5mb3JtLnR5cGUgJiYgIWlzWExTWCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S4iuS8oOadoeasvuWPquiDveaYryB4bHN4IOagvOW8jyEnKQogICAgICB9CiAgICAgIHRoaXMuJHJlZnMuZm9ybS52YWxpZGF0ZSh2YWxpZCA9PiB7CiAgICAgICAgaWYgKHZhbGlkICYmIGlzWExTWCkgewogICAgICAgICAgZmlsZXVwbG9hZCh0aGlzLmZvcm0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICB0aGlzLm5vdGlmeVN1Y2Nlc3MocmVzcG9uc2UubWVzc2FnZSkKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIGRvd25sb2FkKCkgewogICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGVGaWVsZCgncHJvZHVjdFR5cGUnLCBlcnJvciA9PiB7CiAgICAgICAgaWYoIWVycm9yKXsKICAgICAgICAgICAgZG93bmxvYWQodGhpcy5mb3JtLnByb2R1Y3RUeXBlKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlFcnJvcign6K+l5Lqn5ZOB57G75Z6L5pqC5peg5qih5p2/77yBJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsZXQgZmlsZU5hbWUgPSB0aGlzLmdldENvZGVOYW1lKCdQcm9kdWN0VHlwZScsdGhpcy5mb3JtLnByb2R1Y3RUeXBlLHRydWUpCiAgICAgICAgICAgICAgZmlsZU5hbWUgPSB0aGlzLmZvcm0ucHJvZHVjdFR5cGUgKyAnLScgKyBmaWxlTmFtZSArICIueGxzeCIKICAgICAgICAgICAgICB0aGlzLmRvd25sb2FkUmVzcG9uc2VGaWxlKGRhdGEsZmlsZU5hbWUpCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/product-definition/pd-framework-def/pd-attr-def/base-attr-def/template","sourcesContent":["<template>\r\n  <cus-wraper>\r\n      <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"auto\">\r\n        <el-row :gutter=\"10\">\r\n          <el-col :span=\"10\">\r\n            <el-form-item :label=\"$t('template.productType')\" prop=\"productType\">\r\n              <cus-select :codetype=\"'ProductType'\" v-model=\"form.productType\">\r\n              </cus-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <cus-btn-wrapper>\r\n            <el-button  size=\"small\" type=\"primary\" v-auth=\"'template:download'\" class=\"el-icon-download\" @click=\"download\">{{ $t('template.download') }}\r\n            </el-button>\r\n          </cus-btn-wrapper>\r\n        </el-row>\r\n\r\n        <el-row :gutter=\"10\">\r\n          <el-col :span=\"7\">\r\n            <el-form-item :label=\"$t('template.fileUpload')\" prop=\"fileName\">\r\n              <el-upload v-model=\"form.fileName\" action=\"#\" :on-change=\"changeUpload\" accept=\"\" :limit=\"1\"\r\n                         :auto-upload=\"false\" :on-remove=\"removeUpload\" :file-list=\"fileList\" drag>\r\n                <i class=\"el-icon-upload\"></i>\r\n                <div class=\"el-upload__text\">{{$t('i18nView.uploadText1')}}<em>{{$t('i18nView.uploadText2')}}</em></div>\r\n                <div slot=\"tip\" class=\"el-upload__tip\">{{$t('i18nView.onlyUpDownModelFile')}}</div>\r\n              </el-upload>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-form-item>\r\n          <el-button  size=\"small\" v-waves type=\"primary\"  class=\"el-icon-upload\" v-auth=\"'template:upload'\" @click=\"submitForm\" >\r\n            {{$t('table.upload') }}\r\n          </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n\r\n  </cus-wraper>\r\n</template>\r\n<script>\r\n  import {\r\n    fileupload,\r\n    download,\r\n  } from '@/api/basicinfo/ProductAttributeDefinition'\r\n\r\n  export default {\r\n    name: 'clause',\r\n    data() {\r\n      return {\r\n        fileList: [],\r\n        form: {\r\n          operator: this.$store.getters.usercode,\r\n          pdCode: null,\r\n          pdName: null,\r\n          productType: null,\r\n          fileName: null,\r\n          content: null,\r\n          type: null\r\n        },\r\n        rules: {\r\n          productType: [\r\n            {\r\n              required: true,\r\n              message: this.$t('clause.input') + this.$t('clause.productType'),\r\n              trigger: 'blur'\r\n            }\r\n          ],\r\n          fileName: [\r\n            {\r\n              required: true,\r\n              message: this.$t('clause.inputFile'),\r\n              trigger: 'blur'\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      let pdtempPdInfo = this.getPdData()\r\n      this.form.pdCode = pdtempPdInfo.pdCode\r\n      this.form.pdName = pdtempPdInfo.pdName\r\n      this.form.pdEdition = pdtempPdInfo.pdEdition\r\n    },\r\n    methods: {\r\n      removeUpload() {\r\n        this.form.fileName = null\r\n        this.form.content = null\r\n        this.form.type = null\r\n      },\r\n      changeUpload: function(file, fileList) {\r\n        this.form.fileName = file.name\r\n        this.form.type = file.raw.type\r\n        let reader = new FileReader()\r\n        reader.onload = async e => {\r\n          this.form.content = e.target.result\r\n        }\r\n        reader.readAsDataURL(file.raw)\r\n      },\r\n      submitForm() {\r\n        const isXLSX =\r\n          this.form.type ===\r\n          'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\r\n        if (this.form.type && !isXLSX) {\r\n          this.$message.error('上传条款只能是 xlsx 格式!')\r\n        }\r\n        this.$refs.form.validate(valid => {\r\n          if (valid && isXLSX) {\r\n            fileupload(this.form).then(response => {\r\n              this.notifySuccess(response.message)\r\n            })\r\n          }\r\n        })\r\n      },\r\n      download() {\r\n        this.$refs.form.validateField('productType', error => {\r\n          if(!error){\r\n              download(this.form.productType).then(data => {\r\n                if (!data) {\r\n                  this.notifyError('该产品类型暂无模板！')\r\n                  return\r\n                }\r\n                let fileName = this.getCodeName('ProductType',this.form.productType,true)\r\n                fileName = this.form.productType + '-' + fileName + \".xlsx\"\r\n                this.downloadResponseFile(data,fileName)\r\n              })\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n\r\n\r\n</style>\r\n"]}]}