{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\wecom-login\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\wecom-login\\index.vue","mtime":1609847107212},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQoNCmltcG9ydCBhdXRoIGZyb20gJ0AvYXBpL3dlY29tLWxvZ2luL3VzZXJhdXRoJw0KaW1wb3J0IHsgc2V0QWVzS2V5LCBzZXREZWJ1ZyB9IGZyb20gJ0AvdXRpbHMvYXV0aCcNCmltcG9ydCB7IHdlQ29tTG9naW4gfSBmcm9tICdAL2FwaS9zeXN0ZW0vdXNlcicNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAnYXV0aCcsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLA0KICAgICAgcmFkaW86ICcnLA0KICAgICAgdGVuYW50TGlzdDogW10sDQogICAgICBsb2dpbkZvcm06IHsNCiAgICAgICAgdXNlcm5hbWU6ICcnLA0KICAgICAgICB0ZW5hbnRDb2RlOiAnJywNCiAgICAgICAgdGVuYW50SWQ6ICcnDQogICAgICB9DQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZG9SZWFsTG9naW4oKSB7DQogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgndXNlci9sb2dpbicsIHRoaXMubG9naW5Gb3JtKQ0KICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2xkY29kZS9zdG9yYWdlU2VsZWN0JykNCiAgICAgICAgICBsZXQgZmxhZyA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhwaG9uZXxwYWR8cG9kfGlQaG9uZXxpUG9kfGlvc3xpUGFkfEFuZHJvaWR8TW9iaWxlfEJsYWNrQmVycnl8SUVNb2JpbGV8TVFRQnJvd3NlcnxKVUN8RmVubmVjfHdPU0Jyb3dzZXJ8QnJvd3Nlck5HfFdlYk9TfFN5bWJpYW58V2luZG93cyBQaG9uZSkvaSkNCiAgICAgICAgICBpZiAoZmxhZyA9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncnVsZU1lc3NhZ2Uvc3RvcmFnZVJ1bGVNZXNzYWdlJykNCiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdydWxlQ2FjaGUvc3RvcmFnZVJ1bGVDYWNoZScpDQogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICdkYXNoYm9hcmQnIH0pLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogJ3dlQ29tRGFzaGJvYXJkJyB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICBhbGVydChlcnJvcikNCiAgICAgICAgfSkNCiAgICB9LA0KICAgIHNlbGVjdFRlbmFudChyb3cpIHsNCiAgICAgIHRoaXMubG9naW5Gb3JtLnRlbmFudElkID0gcm93LnRlbmFudElkDQogICAgICB0aGlzLmxvZ2luRm9ybS5wYXNzd29yZCA9IHJvdy50ZW5hbnRDb2RlDQogICAgfSwNCiAgICBzdWJtaXRGb3JtKCkgew0KICAgICAgdGhpcy5kb1JlYWxMb2dpbigpDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHNldERlYnVnKCd0cnVlJykNCiAgICAvL+S8geS4muW+ruS/oeeZu+W9lQ0KICAgIGF1dGguZ2V0Q29kZSgpLnRoZW4ocmVzID0+IHsNCiAgICAgIGxldCB3ZUNvbUlkID0gcmVzLmRhdGEudXNlcklkDQogICAgICBsZXQgcGFyYW0gPSB7IHdlQ29tSWQ6IHdlQ29tSWQgfQ0KICAgICAgd2VDb21Mb2dpbih7ICdwYXJhbXMnOiBwYXJhbSB9KS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgbGV0IGRhdGEgPSByZXNwb25zZS5kYXRhDQogICAgICAgIHNldEFlc0tleShkYXRhLmFlc0tleSkNCiAgICAgICAgc2V0RGVidWcoZGF0YS5kZWJ1ZykNCiAgICAgICAgbGV0IHRlbmFudExpc3QgPSBkYXRhLnRlbmFudHMNCiAgICAgICAgdGhpcy5sb2dpbkZvcm0udXNlcm5hbWUgPSBkYXRhLndlQ29tSWQNCiAgICAgICAgdGhpcy5sb2dpbkZvcm0ud2VDb21GbGFnID0gJzEnDQogICAgICAgIGlmICh0ZW5hbnRMaXN0Lmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgIHRoaXMubG9naW5Gb3JtLnRlbmFudElkID0gdGVuYW50TGlzdFswXS50ZW5hbnRJZA0KICAgICAgICAgIHRoaXMubG9naW5Gb3JtLnBhc3N3b3JkID0gdGVuYW50TGlzdFswXS50ZW5hbnRDb2RlDQogICAgICAgICAgdGhpcy5kb1JlYWxMb2dpbigpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy50ZW5hbnRMaXN0ID0gdGVuYW50TGlzdA0KICAgICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9KS5jYXRjaChlcnJvciA9PiB7DQogICAgICBhbGVydChlcnJvcikNCiAgICB9KQ0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/wecom-login","sourcesContent":["<template>\r\n  <el-dialog :close-on-click-modal=\"false\" center  :visible.sync=\"dialogVisible\" width=\"40%\">\r\n    <cus-page-title :label=\"$t('i18nView.comSelect')\"></cus-page-title>\r\n    <el-table :data=\"tenantList\" align=\"center\" border class=\"wraper-table\" element-loading-text=\"Loading\" fit\r\n              highlight-current-row\r\n              size=\"mini\">>\r\n      <el-table-column :label=\"$t('table.select')\" align=\"center\" width=\"50px\">\r\n        <template slot-scope=\"scope\">\r\n          <el-radio :label=\"scope.row.tenantId\" @change=\"selectTenant(scope.row)\" v-model=\"radio\">\r\n            {{ '' }}\r\n          </el-radio>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\"  width=\"50px\">\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" :label=\"$t('i18nView.lesseeNme')\" prop=\"tenantName\"></el-table-column>\r\n      <el-table-column align=\"center\" :label=\"$t('i18nView.comCode')\" prop=\"tenantCode\"></el-table-column>\r\n    </el-table>\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button size=\"small\" :disabled=\"radio===''\"  type=\"primary\" @click=\"submitForm\"><i class=\"el-icon-success el-icon--left\"></i>\r\n            {{\r\n              $t('table.confirm')\r\n            }} </el-button>\r\n        </span>\r\n  </el-dialog>\r\n\r\n</template>\r\n<script>\r\n\r\nimport auth from '@/api/wecom-login/userauth'\r\nimport { setAesKey, setDebug } from '@/utils/auth'\r\nimport { weComLogin } from '@/api/system/user'\r\n\r\nexport default {\r\n  name: 'auth',\r\n  data() {\r\n    return {\r\n      dialogVisible: false,\r\n      radio: '',\r\n      tenantList: [],\r\n      loginForm: {\r\n        username: '',\r\n        tenantCode: '',\r\n        tenantId: ''\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    doRealLogin() {\r\n      this.$store.dispatch('user/login', this.loginForm)\r\n        .then(() => {\r\n          this.$store.dispatch('ldcode/storageSelect')\r\n          let flag = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)\r\n          if (flag == null) {\r\n            this.$store.dispatch('ruleMessage/storageRuleMessage')\r\n            this.$store.dispatch('ruleCache/storageRuleCache')\r\n            this.$router.push({ path: 'dashboard' }).catch(() => {\r\n            })\r\n          } else {\r\n            this.$router.push({ path: 'weComDashboard' })\r\n          }\r\n        })\r\n        .catch(error => {\r\n          alert(error)\r\n        })\r\n    },\r\n    selectTenant(row) {\r\n      this.loginForm.tenantId = row.tenantId\r\n      this.loginForm.password = row.tenantCode\r\n    },\r\n    submitForm() {\r\n      this.doRealLogin()\r\n    }\r\n  },\r\n  created() {\r\n    setDebug('true')\r\n    //企业微信登录\r\n    auth.getCode().then(res => {\r\n      let weComId = res.data.userId\r\n      let param = { weComId: weComId }\r\n      weComLogin({ 'params': param }).then(response => {\r\n        let data = response.data\r\n        setAesKey(data.aesKey)\r\n        setDebug(data.debug)\r\n        let tenantList = data.tenants\r\n        this.loginForm.username = data.weComId\r\n        this.loginForm.weComFlag = '1'\r\n        if (tenantList.length === 1) {\r\n          this.loginForm.tenantId = tenantList[0].tenantId\r\n          this.loginForm.password = tenantList[0].tenantCode\r\n          this.doRealLogin()\r\n        } else {\r\n          this.tenantList = tenantList\r\n          this.dialogVisible = true\r\n        }\r\n      })\r\n    }).catch(error => {\r\n      alert(error)\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.wrapper {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 100%;\r\n}\r\n</style>\r\n"]}]}