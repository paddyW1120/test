{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\ibrms\\ruleManagement\\dynamicTableDialog\\index.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\ibrms\\ruleManagement\\dynamicTableDialog\\index.vue","mtime":1609847106756},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1706753188288},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1706753191924},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1706753189537},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1706753187424},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZWwtdGFibGUgLmhpZGRlbi1yb3cgew0KICBkaXNwbGF5OiBub25lOw0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgQA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/ibrms/ruleManagement/dynamicTableDialog","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"dynamicTableDialog\">\r\n      <el-row style=\"margin-bottom: 10px;\">\r\n         <el-button  type=\"primary\"   icon=\"el-icon-plus\"  class=\"filter-button\" size=\"mini\" @click=\"displayChildDialog\">{{$t('dynamicTableDialog.addData')}}</el-button>\r\n      </el-row>\r\n      <el-table\r\n        :data=\"dynamicData.bomItemData\"\r\n        :row-class-name=\"insertFilterMethod\"\r\n        style=\"width: 100%\"\r\n        max-height=\"250\"\r\n        size=\"mini\"\r\n        border\r\n      >\r\n        <el-table-column label=\"id\" prop=\"id\" v-if=\"false\"></el-table-column>\r\n        <div v-for=\"(item, index) in dynamicData.bomItem\" >\r\n           <el-table-column\r\n            :label=\"`${item.cnName}`\"\r\n            :prop=\"item.name\"\r\n            v-if=\"item.optionArray.length == 0\"\r\n\r\n          ></el-table-column>\r\n          <el-table-column\r\n            :label=\"`${item.cnName}`\"\r\n            :prop=\"item.name\"\r\n            v-if=\"item.optionArray.length > 0\"\r\n            :formatter=\"itemFormatter\"\r\n\r\n          ></el-table-column>\r\n        </div>\r\n\r\n        <el-table-column fixed=\"right\" :label=\"$t('dynamicTableDialog.execute')\" width=\"200\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button\r\n              size=\"mini\"\r\n              type=\"primary\"  @click=\"updateItem(scope.row)\" class=\"filter-button\"\r\n              icon=\"el-icon-edit\" ></el-button>\r\n            <el-button   @click=\"deleteItem(scope.row)\" size=\"mini\"  type=\"warning\">\r\n           <svg-icon icon-class=\"remove\"/></el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-dialog\r\n        :visible.sync=\"dynamicDialogVisible\"\r\n        @close=\"dynamicDialogVisible = false\"\r\n        width=\"65%\"\r\n        :show-close=\"false\"\r\n        :close-on-press-escape=\"false\"\r\n        :close-on-click-modal=\"false\"\r\n        append-to-body\r\n        v-dialog-drag\r\n        label-position=\"right\"\r\n      >\r\n     <cus-page-title-back @backTo=\"dynamicDialogVisible = false\" :label=\"dynamicData.bom.cnName\" :isDialog=\"true\"></cus-page-title-back>\r\n      <div style=\"height:600px; overflow: auto;\" class=\"scrollbar\">\r\n\r\n        <el-tabs v-model=\"activeName\" type=\"card\" @tab-click=\"handleTabClick\">\r\n          <el-tab-pane :label=\"dynamicData.bom.cnName\" :name=\"dynamicData.bom.name\">\r\n            <template slot-scope=\"scope\">\r\n              <dynamic-form-array :dForm=\"dynamicData\" :dItems=\"itemData\" />\r\n            </template>\r\n          </el-tab-pane>\r\n          <el-tab-pane\r\n            v-if=\"dynamicData.child.length > 0\"\r\n            :label=\"item.bom.cnName\"\r\n            :name=\"item.bom.name\"\r\n            v-for=\"(item, index) in dynamicData.child\"\r\n          >\r\n            <dynamic-table-dialog v-if=\"update\" :dData=\"item\" :dId=\"useId\" :dMethod=\"method\" />\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n        <span slot=\"footer\" class=\"dialog-footer\"  style=\"float: right; bottom: 30px;position: absolute;right: 30px;\" >\r\n          <el-button  size=\"mini\"\r\n            type=\"primary\"\r\n            @click=\"submitData\"\r\n          ><i class=\"el-icon-success el-icon--left\"></i>{{ $t('table.save')}}</el-button>\r\n          <el-button  size=\"mini\"\r\n            @click=\"refresh\"\r\n            type=\"warning\"\r\n          ><i class=\"el-icon-refresh el-icon--left\"></i>{{$t('table.refresh')}}</el-button>\r\n        </span>\r\n\r\n        </div>\r\n      </el-dialog>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport dynamicFormArray from \"@/views/ibrms/ruleManagement/dynamicFormArray\";\r\n\r\nexport default {\r\n  name: \"dynamicTableDialog\",\r\n  data() {\r\n    return {\r\n      dynamicData: {\r\n        isArray: \"\",\r\n        bom: {},\r\n        bomItem: [],\r\n        bomItemData: [],\r\n        child: []\r\n      },\r\n      itemData: [],\r\n      dynamicDialogVisible: false,\r\n      activeName: \"\",\r\n      update: true,\r\n      inputArray: [],\r\n      method: \"\",\r\n      id: \"\",\r\n      useId: \"\",\r\n      currentId: 0\r\n    };\r\n  },\r\n  components: {\r\n    dynamicFormArray\r\n  },\r\n  props: [\"dData\", \"dId\", \"dMethod\"],\r\n  mounted() {\r\n    ;\r\n    this.dynamicData = this.dData;\r\n    this.activeName = this.dynamicData.bom.name;\r\n    this.method = this.dMethod;\r\n    this.id = this.dId + \"-\" + this.dynamicData.bom.name;\r\n  },\r\n  methods: {\r\n    displayChildDialog() {\r\n      ;\r\n      this.dynamicDialogVisible = true;\r\n      this.itemData = [];\r\n      this.update = false;\r\n      this.method = \"insert\";\r\n      this.useId = this.id + \"-\" + this.currentId;\r\n      //重新渲染组件\r\n      this.$nextTick(() => {\r\n        this.update = true;\r\n      });\r\n      this.currentId++;\r\n    },\r\n    insertFilterMethod(row, index) {\r\n      ;\r\n      if (row.row.id.indexOf(this.dId) == -1) {\r\n        return \"hidden-row\";\r\n      }\r\n      return \"\";\r\n    },\r\n    handleTabClick(tab, event) {\r\n      // console.log(tab, event);\r\n    },\r\n    deleteItem(row) {\r\n      ;\r\n      let rowId = row.id;\r\n      this.deleteChildElement(this.dynamicData, rowId);\r\n    },\r\n    updateItem(row) {\r\n      ;\r\n      let rowId = row.id;\r\n      this.dynamicDialogVisible = true;\r\n      this.itemData = this.selectItemDataByIdReturnArray(rowId);\r\n      this.update = false;\r\n      this.method = \"update\";\r\n      this.useId = rowId;\r\n\r\n      this.$nextTick(() => {\r\n        this.update = true;\r\n      });\r\n    },\r\n    selectItemDataByIdReturnArray(rowId) {\r\n      ;\r\n      let targetData = {};\r\n      for (let i = 0; i < this.dynamicData.bomItemData.length; i++) {\r\n        if (this.dynamicData.bomItemData[i].id === rowId) {\r\n          targetData = this.dynamicData.bomItemData[i];\r\n        }\r\n      }\r\n      let arr = [];\r\n      for (let key in targetData) {\r\n        arr.push(targetData[key]);\r\n      }\r\n      return arr;\r\n    },\r\n    deleteChildElement(childBom, rowId) {\r\n      ;\r\n      //判断是否有子元素，有则遍历递归删除\r\n      if (childBom.child.length > 0) {\r\n        for (let i = 0; i < childBom.child.length; i++) {\r\n          let child = childBom.child[i];\r\n          this.deleteChildElement(child, rowId);\r\n        }\r\n      }\r\n      //遍历当前bom的数据，删除id相关的内容\r\n      for (let j = 0; j < childBom.bomItemData.length; j++) {\r\n        if (childBom.bomItemData[j].id.indexOf(rowId) != -1) {\r\n          childBom.bomItemData.splice(j, 1);\r\n        }\r\n      }\r\n    },\r\n    submitData() {\r\n      ;\r\n      let tableDialogObj = {};\r\n      for (let i = 0; i < this.dynamicData.bomItem.length; i++) {\r\n        if (this.itemData[i]) {\r\n          tableDialogObj[this.dynamicData.bomItem[i].name] = this.itemData[i];\r\n        } else {\r\n          tableDialogObj[this.dynamicData.bomItem[i].name] = undefined;\r\n        }\r\n      }\r\n      if (this.itemData[this.dynamicData.bomItem.length]) {\r\n        tableDialogObj.id = this.itemData[this.dynamicData.bomItem.length];\r\n      } else {\r\n        tableDialogObj.id = this.useId;\r\n      }\r\n\r\n      this.insertItemData(tableDialogObj);\r\n      this.dynamicDialogVisible = false;\r\n      this.itemData = [];\r\n    },\r\n    insertItemData(itemData) {\r\n      ;\r\n      //重复性校验\r\n      for (let i = 0; i < this.dynamicData.bomItemData.length; i++) {\r\n        let item = this.dynamicData.bomItemData[i];\r\n        if (item.id == itemData.id) {\r\n          this.dynamicData.bomItemData.splice(i, 1);\r\n        }\r\n      }\r\n      this.dynamicData.bomItemData.push(itemData);\r\n    },\r\n    refresh(){\r\n     this.itemData = [];\r\n    },\r\n    itemFormatter(row, column){\r\n        let key = column.property;\r\n        let optionArray = [];\r\n        this.dynamicData.bomItem.forEach(el => {\r\n            if(el.name == key){\r\n                optionArray =  el.optionArray;\r\n            }\r\n\r\n        });\r\n        let result=\"\";\r\n        if(optionArray){\r\n           optionArray.forEach(element => {\r\n              if(row[key] == element.value) {\r\n                result =  element.label;\r\n              }\r\n           });\r\n        }\r\n        console.log(\"result\",result);\r\n       return result;\r\n\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.el-table .hidden-row {\r\n  display: none;\r\n}\r\n</style>\r\n"]}]}