{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\ibrms\\objectManagement\\functionTest\\index.vue?vue&type=style&index=0&id=765e5780&lang=scss&scoped=true&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\ibrms\\objectManagement\\functionTest\\index.vue","mtime":1609847106739},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1706753188288},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1706753191924},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1706753189537},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1706753187424},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5zaG93RGl2IHsNCiAgd2lkdGg6IDkwJTsNCiAgaGVpZ2h0OiAxMDAlOw0KICBtYXJnaW4tdG9wOiAtNDBweDsNCiAgbWFyZ2luLWxlZnQ6IC00MHB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJhY2tncm91bmQ6ICNmZmZmZmYwMDsNCiAgei1pbmRleDogOTk5Ow0KfQ0KLyouZWwtdGV4dGFyZWF7Ki8NCi8qICB0ZXh0YXJlYXsqLw0KLyogICAgaGVpZ2h0OiAzMDBweDsqLw0KLyogICAgb3ZlcmZsb3c6IGF1dG87Ki8NCi8qICAgIHJlc2l6ZTogbm9uZTsqLw0KLyogIH0qLw0KLyp9Ki8NCi5jb2RlQXJlYSB7DQogIGhlaWdodDogMjI1cHggIWltcG9ydGFudDsNCiAgbWluLWhlaWdodDogMjI1cHggIWltcG9ydGFudDsNCiAgb3ZlcmZsb3c6IGF1dG87DQogIHJlc2l6ZTogbm9uZTsNCiAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xMiksIDAgMCA2cHggcmdiYSgwLCAwLCAwLCAwLjA0KTsNCn0NCi5jb250cm9sQXJlYSB7DQogIGhlaWdodDogMTAwcHggIWltcG9ydGFudDsNCiAgbWF4LWhlaWdodDogMTAwcHg7DQogIG92ZXJmbG93OiBhdXRvOw0KICByZXNpemU6IG5vbmU7DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/ibrms/objectManagement/functionTest","sourcesContent":["<template>\r\n  <cus-wraper>\r\n    <cus-page-title-back @backTo=\"goBackInfo\" :label=\"$t('ruleFunctionTest.mvel')\" />\r\n    <el-row>\r\n      <span class=\"formtitle\" style=\"font-weight:blod\">\r\n        <el-divider direction=\"vertical\" class=\"divider\"></el-divider>\r\n        <span>{{$t('ruleFunctionTest.info')}}</span>\r\n      </span>\r\n      <span style=\"margin-left: 5px;\">\r\n        <el-link\r\n          class=\"updateRule\"\r\n          type=\"primary\"\r\n          style=\"border-bottom:dashed 1px;\"\r\n          :disabled=\"(updateState ? false:'disabled')\"\r\n          @click=\"updateMVEL()\"\r\n        >{{$t('ruleFunctionTest.updateFunction')}}</el-link>\r\n      </span>\r\n    </el-row>\r\n\r\n    <el-form :model=\"form\" label-width=\"160px\" ref=\"form\" style=\"width: 98%\">\r\n      <div>\r\n        <el-row>\r\n          <div style=\"float: right;margin-right: 20px;\">\r\n            <el-button\r\n              size=\"mini\"\r\n              type=\"primary\"\r\n              icon=\"el-icon-caret-right\"\r\n              @click=\"runExpression\"\r\n            >{{$t('ruleFunctionTest.run')}}</el-button>\r\n            <el-button size=\"mini\" type=\"primary\" @click=\"submit\">\r\n              <i class=\"el-icon-success el-icon--left\"></i>\r\n              {{ this.function.functionEntity?$t('table.update'):$t('table.save')}}\r\n            </el-button>\r\n          </div>\r\n        </el-row>\r\n        <br />\r\n      </div>\r\n      <el-row :gutter=\"10\" justify=\"center\" type=\"flex\">\r\n        <el-col :span=\"14\">\r\n          <label style=\"font-size: 12px !important;\">{{$t('ruleFunctionTest.code')}}</label>\r\n          <textarea\r\n            class=\"el-textarea codeArea\"\r\n            v-model=\"form.expression\"\r\n            :disabled=\"(updateState ?'disabled':false)\"\r\n          ></textarea>\r\n        </el-col>\r\n        <el-col :span=\"10\">\r\n          <label style=\"font-size: 12px !important;\">{{$t('ruleFunctionTest.data')}}</label>\r\n          <textarea class=\"el-textarea codeArea\" v-model=\"form.data\"></textarea>\r\n        </el-col>\r\n      </el-row>\r\n      <br />\r\n      <el-row :gutter=\"10\" justify=\"center\" type=\"flex\">\r\n        <el-col :span=\"24\">\r\n          <el-input type=\"text\" v-model=\"form.result\" readonly style=\"font-size: 12px !important;\">\r\n            <template slot=\"prepend\">{{$t('ruleFunctionTest.result')}}</template>\r\n          </el-input>\r\n        </el-col>\r\n      </el-row>\r\n      <br />\r\n\r\n      <el-row :gutter=\"10\" justify=\"center\" type=\"flex\">\r\n        <el-col :span=\"24\">\r\n          <label  style=\"font-size: 12px !important;\">{{$t('ruleFunctionTest.console')}}</label>\r\n          <textarea class=\"el-textarea controlArea\" :model=\"form.console\" readonly :disabled=\"true\" style=\"font-size: 12px !important;\">{{form.console}}</textarea>\r\n        </el-col>\r\n      </el-row>\r\n      <br />\r\n      <el-button\r\n        size=\"mini\"\r\n        type=\"primary\"\r\n        @click=\"releaseExpression\"\r\n        style=\"font-size: 12px !important;float: right;margin-right: 20px;\"\r\n      >\r\n        <i class=\"el-icon-success el-icon--left\"></i>\r\n        {{$t('ruleFunctionTest.release')}}\r\n      </el-button>\r\n    </el-form>\r\n  </cus-wraper>\r\n</template>\r\n<script>\r\nimport { mapGetters } from \"vuex\";\r\nimport {\r\n  findRuleFunction,\r\n  executeFunction,\r\n  releaseFunction,\r\n  testCompleteFunction,\r\n  updateRuleFunction\r\n} from \"@/api/ibrms/ruleFunction\";\r\nimport { closeVisitTag } from \"@/utils/tagsView\";\r\n\r\nexport default {\r\n  name: \"ruleFunctionTest\",\r\n  data() {\r\n    return {\r\n      form: {\r\n        //表单数据与后端实体类对应\r\n        id: \"\", //主键ID\r\n        functionName: \"\",\r\n        functionEntity: \"\",\r\n        expression: \"\",\r\n        data: \"\",\r\n        result: \"\",\r\n        console: \"\"\r\n      },\r\n      radio: false,\r\n      functionId: \"\",\r\n      resultStr: \"\",\r\n      //检验规则\r\n      rules: {},\r\n      updateState: true,\r\n      function: {}\r\n    };\r\n  },\r\n\r\n  computed: {},\r\n  created() {\r\n    let baseInfo = this.$route.params.baseInfo;\r\n    this.function = baseInfo;\r\n    console.log(\"baseInfo\", baseInfo);\r\n    this.form.id = baseInfo.id;\r\n    this.form.functionName = baseInfo.name;\r\n    findRuleFunction(baseInfo.id).then(response => {\r\n      if (\r\n        response.data.functionEntity &&\r\n        response.data.functionEntity.length > 0\r\n      ) {\r\n        this.form.expression = response.data.functionEntity;\r\n      } else {\r\n        this.createFunctionModelAndDataStr(baseInfo);\r\n      }\r\n    });\r\n    this.createDataStr(baseInfo);\r\n    this.createResultStr(baseInfo);\r\n  },\r\n  methods: {\r\n    createFunctionModelAndDataStr(baseInfo) {\r\n      let functionStr = \"import java.lang.Math;\\t\\n function \";\r\n      let par = \"\";\r\n      for (let i = 0; i < baseInfo.paraNum; i++) {\r\n        let p = \"var\" + i + \",\";\r\n        par += p;\r\n      }\r\n      functionStr +=baseInfo.name + \"(\" + par.substring(0, par.length - 1) + \"){\\n\";\r\n      functionStr += \"\\t\\n\";\r\n      functionStr += \"}\";\r\n      this.form.expression = functionStr;\r\n    },\r\n    createResultStr(baseInfo) {\r\n      let par = \"\";\r\n      for (let i = 0; i < baseInfo.paraNum; i++) {\r\n        let p = \"var\" + i + \",\";\r\n        par += p;\r\n      }\r\n      this.resultStr =\r\n        \"\\n result = \" +\r\n        baseInfo.name +\r\n        \"(\" +\r\n        par.substring(0, par.length - 1) +\r\n        \");\\n\";\r\n      this.resultStr += \"return result;\";\r\n    },\r\n    createDataStr(baseInfo) {\r\n      let dataStr = {};\r\n      for (let j = 0; j < baseInfo.paraNum; j++) {\r\n        let paramName = \"var\" + j;\r\n        dataStr[paramName] = \"\";\r\n      }\r\n      this.form.data = JSON.stringify(dataStr);\r\n      console.log(dataStr);\r\n    },\r\n    handleSearch() {\r\n      this.$refs.page.reload();\r\n    },\r\n    handleDelete(id) {},\r\n    runExpression() {\r\n      /*let check = this.functionEntityCheck();\r\n        if(check === 0){\r\n          return;\r\n        }*/\r\n      let obj = JSON.parse(this.form.data);\r\n      let allExpression = this.form.expression + this.resultStr;\r\n      let vo = {\r\n        expressionStr: allExpression,\r\n        dataJsonStr: obj\r\n      };\r\n      executeFunction(vo)\r\n        .then(response => {\r\n          console.log(response);\r\n          let result = response.data;\r\n          this.form.result = result.result;\r\n          this.form.console = result.out;\r\n        })\r\n        .catch(err => {\r\n          this.form.result = \"\";\r\n          this.form.console = err.toString();\r\n        });\r\n    },\r\n    releaseExpression() {\r\n\r\n      if (this.function.functionEntity) {\r\n        if (this.function.state == \"2\") {\r\n            this.$message({\r\n              message: this.$t(\"ruleFunctionTest.checkInfo\"),\r\n              type: \"warning\"\r\n            });\r\n            return;\r\n        }\r\n        /*let check = this.functionEntityCheck();\r\n            if(check === 0){\r\n              return;\r\n            }*/\r\n        let vo = {\r\n          functionId: this.form.id,\r\n          state: \"1\"\r\n        };\r\n        testCompleteFunction(vo).then(response => {\r\n          console.log(response);\r\n          if (response.code == 200) {\r\n            this.$router.push({ name: \"函数管理\", params: {} });\r\n          } else {\r\n            this.$message.error(response.message);\r\n          }\r\n          return;\r\n        });\r\n      } else {\r\n        this.$message({\r\n          message: this.$t(\"ruleFunctionTest.testCheck\"),\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      }\r\n    },\r\n    functionEntityCheck() {\r\n      // let regtx = /(?<=function).*?(?=\\()/;\r\n      let regtx =  new RegExp(\"(?<=function).*?(?=\\\\()\")\r\n      let functionName = regtx.exec(this.form.expression);;\r\n      if (this.form.functionName != functionName[0].trim()) {\r\n        this.$message.error(this.$t(\"ruleFunctionTest.EntityCheck\"));\r\n        return 0;\r\n      } else if (!this.form.data) {\r\n        this.$message.error(this.$t(\"ruleFunctionTest.dataCheck\"));\r\n        return 0;\r\n      } else {\r\n        return 1;\r\n      }\r\n    },\r\n    resetForm() {\r\n      this.form = {\r\n        //表单数据与后端实体类对应\r\n        id: \"\", //主键ID\r\n        xxxx: \"\"\r\n      };\r\n    },\r\n    goBackInfo() {\r\n      //跳转到父页面\r\n      closeVisitTag();\r\n      this.$router.push({ name: \"函数管理\" });\r\n    },\r\n    updateMVEL() {\r\n      this.updateState = false;\r\n    },\r\n    submit() {\r\n      if (this.function.state != \"2\" && this.form.expression) {\r\n            this.function.functionEntity = this.form.expression;\r\n            updateRuleFunction(this.function).then(response => {\r\n              if (response.code == 200) {\r\n                  this.function = response.data;\r\n                  this.form.expression = this.function.functionEntity;\r\n                  this.notifySuccess(response.message);\r\n                  this.updateState = true;\r\n                }\r\n            });\r\n      } else {\r\n        this.$message.warning(this.$t(\"ruleFunctionTest.updateInfo\"));\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.showDiv {\r\n  width: 90%;\r\n  height: 100%;\r\n  margin-top: -40px;\r\n  margin-left: -40px;\r\n  position: absolute;\r\n  background: #ffffff00;\r\n  z-index: 999;\r\n}\r\n/*.el-textarea{*/\r\n/*  textarea{*/\r\n/*    height: 300px;*/\r\n/*    overflow: auto;*/\r\n/*    resize: none;*/\r\n/*  }*/\r\n/*}*/\r\n.codeArea {\r\n  height: 225px !important;\r\n  min-height: 225px !important;\r\n  overflow: auto;\r\n  resize: none;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12), 0 0 6px rgba(0, 0, 0, 0.04);\r\n}\r\n.controlArea {\r\n  height: 100px !important;\r\n  max-height: 100px;\r\n  overflow: auto;\r\n  resize: none;\r\n}\r\n</style>\r\n"]}]}