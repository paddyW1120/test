{"remainingRequest":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js!D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\login\\auth-redirect.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\src\\views\\login\\auth-redirect.vue","mtime":1609847106800},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1706753193796},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706753187435},{"path":"D:\\86181\\Desktop\\product\\pcs-product-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1706753190941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJEOi84NjE4MS9EZXNrdG9wL3Byb2R1Y3QvcGNzLXByb2R1Y3Qtdmlldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHQiKTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwoKdmFyIF91c2VyYXV0aCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQC9hcGkvd2Vjb20tbG9naW4vdXNlcmF1dGgiKSk7Cgp2YXIgX2F1dGggPSByZXF1aXJlKCJAL3V0aWxzL2F1dGgiKTsKCnZhciBfdXNlciA9IHJlcXVpcmUoIkAvYXBpL3N5c3RlbS91c2VyIik7CgovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwp2YXIgX2RlZmF1bHQgPSB7CiAgbmFtZTogJ0F1dGhSZWRpcmVjdCcsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICByYWRpbzogJycsCiAgICAgIHRlbmFudExpc3Q6IFtdLAogICAgICBsb2dpbkZvcm06IHsKICAgICAgICB1c2VybmFtZTogJycsCiAgICAgICAgdGVuYW50Q29kZTogJycsCiAgICAgICAgd2VDb21GbGFnOiAnJywKICAgICAgICB0ZW5hbnRJZDogJycKICAgICAgfQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgY29kZSA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmNvZGU7CiAgICB2YXIgc3RhdGUgPSB0aGlzLiRyb3V0ZS5xdWVyeS5zdGF0ZTsKICAgIGNvbnNvbGUubG9nKCdjb2RlOicgKyBjb2RlICsgJyAsc3RhdGU6JyArIHN0YXRlKTsKICAgIHRoaXMuYXV0aExvZ2luKGNvZGUsIHN0YXRlKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNlbGVjdFRlbmFudDogZnVuY3Rpb24gc2VsZWN0VGVuYW50KHJvdykgewogICAgICB0aGlzLmxvZ2luRm9ybS50ZW5hbnRJZCA9IHJvdy50ZW5hbnRJZDsKICAgICAgdGhpcy5sb2dpbkZvcm0ucGFzc3dvcmQgPSByb3cudGVuYW50Q29kZTsKICAgIH0sCiAgICBzdWJtaXRGb3JtOiBmdW5jdGlvbiBzdWJtaXRGb3JtKCkgewogICAgICB0aGlzLmRvUmVhbExvZ2luKCk7CiAgICB9LAogICAgYXV0aExvZ2luOiBmdW5jdGlvbiBhdXRoTG9naW4oY29kZSwgc3RhdGUpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICgwLCBfYXV0aC5zZXREZWJ1ZykoJ3RydWUnKTsgLy/kvIHkuJrlvq7kv6HnmbvlvZUKCiAgICAgIF91c2VyYXV0aC5kZWZhdWx0LmdldE9wZW5JZChjb2RlKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICB2YXIgd2VDb21JZCA9IHJlcy5kYXRhLnVzZXJJZDsKICAgICAgICB2YXIgcGFyYW0gPSB7CiAgICAgICAgICB3ZUNvbUlkOiB3ZUNvbUlkCiAgICAgICAgfTsKICAgICAgICAoMCwgX3VzZXIud2VDb21Mb2dpbikoewogICAgICAgICAgJ3BhcmFtcyc6IHBhcmFtCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICgwLCBfYXV0aC5zZXRBZXNLZXkpKGRhdGEuYWVzS2V5KTsKICAgICAgICAgICgwLCBfYXV0aC5zZXREZWJ1ZykoZGF0YS5kZWJ1Zyk7CiAgICAgICAgICB2YXIgdGVuYW50TGlzdCA9IGRhdGEudGVuYW50czsKICAgICAgICAgIF90aGlzLmxvZ2luRm9ybS51c2VybmFtZSA9IGRhdGEud2VDb21JZDsKICAgICAgICAgIF90aGlzLmxvZ2luRm9ybS53ZUNvbUZsYWcgPSAnMSc7CgogICAgICAgICAgaWYgKHRlbmFudExpc3QubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIF90aGlzLmxvZ2luRm9ybS50ZW5hbnRJZCA9IHRlbmFudExpc3RbMF0udGVuYW50SWQ7CiAgICAgICAgICAgIF90aGlzLmxvZ2luRm9ybS5wYXNzd29yZCA9IHRlbmFudExpc3RbMF0udGVuYW50Q29kZTsKCiAgICAgICAgICAgIF90aGlzLmRvUmVhbExvZ2luKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy50ZW5hbnRMaXN0ID0gdGVuYW50TGlzdDsKICAgICAgICAgICAgX3RoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIGFsZXJ0KGVycm9yKTsKICAgICAgfSk7CiAgICB9LAogICAgZG9SZWFsTG9naW46IGZ1bmN0aW9uIGRvUmVhbExvZ2luKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCd1c2VyL2xvZ2luJywgdGhpcy5sb2dpbkZvcm0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi4kc3RvcmUuZGlzcGF0Y2goJ2xkY29kZS9zdG9yYWdlU2VsZWN0Jyk7CgogICAgICAgIF90aGlzMi4kc3RvcmUuZGlzcGF0Y2goJ3J1bGVNZXNzYWdlL3N0b3JhZ2VSdWxlTWVzc2FnZScpOwoKICAgICAgICBfdGhpczIuJHN0b3JlLmRpc3BhdGNoKCdydWxlQ2FjaGUvc3RvcmFnZVJ1bGVDYWNoZScpOwoKICAgICAgICBfdGhpczIuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIHBhdGg6ICdkYXNoYm9hcmQnCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge30pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgIH0pOwogICAgfQogIH0sCiAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoaCkgewogICAgcmV0dXJuIGgoKTsgLy8gYXZvaWQgd2FybmluZyBtZXNzYWdlCiAgfQp9OwpleHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDs="},{"version":3,"sources":["auth-redirect.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <el-dialog :close-on-click-modal=\"false\" center :show-close=\"false\" :visible.sync=\"dialogVisible\" width=\"40%\">\r\n    <cus-page-title :label=\"$t('i18nView.comSelect')\"></cus-page-title>\r\n    <el-table :data=\"tenantList\" align=\"center\" border class=\"wraper-table\" element-loading-text=\"Loading\" fit\r\n              highlight-current-row\r\n              size=\"mini\">>\r\n      <el-table-column :label=\"$t('table.select')\" align=\"center\" width=\"50px\">\r\n        <template slot-scope=\"scope\">\r\n          <el-radio :label=\"scope.row.tenantId\" @change=\"selectTenant(scope.row)\" v-model=\"radio\">\r\n            {{ '' }}\r\n          </el-radio>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column :label=\"$t('table.id')\" align=\"center\" type=\"index\" width=\"50px\">\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" :label=\"$t('i18nView.lesseeNme')\" prop=\"tenantName\"></el-table-column>\r\n      <el-table-column align=\"center\" :label=\"$t('i18nView.comCode')\" prop=\"tenantCode\"></el-table-column>\r\n    </el-table>\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button size=\"small\" :disabled=\"radio===''\"  type=\"primary\" @click=\"submitForm\"><i class=\"el-icon-success el-icon--left\"></i>\r\n            {{\r\n              $t('table.confirm')\r\n            }} </el-button>\r\n        </span>\r\n  </el-dialog>\r\n</template>\r\n<script>\r\n\r\nimport auth from '@/api/wecom-login/userauth'\r\nimport { setAesKey, setDebug } from '@/utils/auth'\r\nimport { weComLogin } from '@/api/system/user'\r\n\r\nexport default {\r\n  name: 'AuthRedirect',\r\n  data() {\r\n    return {\r\n      dialogVisible: false,\r\n      radio: '',\r\n      tenantList: [],\r\n      loginForm: {\r\n        username: '',\r\n        tenantCode: '',\r\n        weComFlag: '',\r\n        tenantId: ''\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    let code = this.$route.query.code\r\n    let state = this.$route.query.state\r\n    console.log('code:' + code + ' ,state:' + state)\r\n    this.authLogin(code, state)\r\n  },\r\n  methods: {\r\n    selectTenant(row) {\r\n      this.loginForm.tenantId = row.tenantId\r\n      this.loginForm.password = row.tenantCode\r\n    },\r\n    submitForm() {\r\n      this.doRealLogin()\r\n    },\r\n    authLogin(code, state) {\r\n      setDebug('true')\r\n      //企业微信登录\r\n      auth.getOpenId(code).then(res => {\r\n        let weComId = res.data.userId\r\n        let param = { weComId: weComId }\r\n        weComLogin({ 'params': param }).then(response => {\r\n          let data = response.data\r\n          setAesKey(data.aesKey)\r\n          setDebug(data.debug)\r\n          let tenantList = data.tenants\r\n          this.loginForm.username = data.weComId\r\n          this.loginForm.weComFlag = '1'\r\n          if (tenantList.length === 1) {\r\n            this.loginForm.tenantId = tenantList[0].tenantId\r\n            this.loginForm.password = tenantList[0].tenantCode\r\n            this.doRealLogin()\r\n          } else {\r\n            this.tenantList = tenantList\r\n            this.dialogVisible = true\r\n\r\n          }\r\n        })\r\n      }).catch(error => {\r\n        alert(error)\r\n      })\r\n\r\n    },\r\n    doRealLogin() {\r\n      this.$store.dispatch('user/login', this.loginForm)\r\n        .then(() => {\r\n          this.$store.dispatch('ldcode/storageSelect')\r\n          this.$store.dispatch('ruleMessage/storageRuleMessage')\r\n          this.$store.dispatch('ruleCache/storageRuleCache')\r\n          this.$router.push({ path: 'dashboard' }).catch(() => {\r\n          })\r\n        })\r\n        .catch(error => {\r\n          console.log(error)\r\n        })\r\n    }\r\n  },\r\n  render: function(h) {\r\n    return h() // avoid warning message\r\n  }\r\n}\r\n</script>\r\n"],"sourceRoot":"src/views/login"}]}